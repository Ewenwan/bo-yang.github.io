<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Bo's Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Bo&#39;s blog.">
    <meta name="author" content="Bo Yang">
    
    <link rel="canonical" href="http://www.bo-yang.net//page10/">
    <link rel="alternate" type="application/rss+xml" title="RSS Feed for Bo's Blog" href="/feed.xml" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/pixyll.css?201602012210" type="text/css">

    <!-- Fonts -->
    <link href='//fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Lato:900,300' rel='stylesheet' type='text/css'>
    
      <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet">
    

    <!-- Google Prettify -->
    <link href="http://www.bo-yang.net//assets/google-code-prettify/desert.css" rel="stylesheet" type="text/css" media="all">

    <!-- MathJax -->
    
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
    

    <!-- Verifications -->
    

    <!-- Open Graph -->
    <!-- From: https://github.com/mmistakes/hpstr-jekyll-theme/blob/master/_includes/head.html -->
    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Bo&#39;s Blog">
    <meta property="og:description" content="Bo&#39;s blog.">
    <meta property="og:url" content="http://www.bo-yang.net//page10/">
    <meta property="og:site_name" content="Bo&#39;s Blog">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    
        <meta name="twitter:site" content="@bonnyang" />
    
    <meta name="twitter:title" content="Bo's Blog" />
    <meta name="twitter:description" content="Bo's blog." />
    <meta name="twitter:url" content="http://www.bo-yang.net//page10/" />

    <!-- Icons -->
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-160x160.png" sizes="160x160">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">

    
    <script type="text/javascript">
       (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
       (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
       m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
       })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
       ga('create', 'UA-50551633-1', 'auto');
       ga('send', 'pageview');
    </script>
    
</head>

<body class="site">

	
		<div id="fb-root"></div>
		<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.5&appId=";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));</script>
	

  <div class="site-wrap">
    <header class="site-header px2 px-responsive">
  <div class="mt2 wrap">
    <div class="measure">
        <a href="http://www.bo-yang.net/" class="site-title"><b>Bo's Blog</b></a>
      <nav class="site-nav">
        
    

    

    
        <a href="/archive/">Archive</a>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    


    

    

    

    

    

    

    

    
        <a href="/tags/">Tags</a>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    


    

    
        <a href="/about/">About Me</a>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    


    

    

    

    
        <a href="/contact/">Contact</a>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    


      </nav>
      <div class="clearfix"></div>
      
        <div class="social-icons">
  <div class="social-icons-right">
    
      <a class="fa fa-github" href="https://github.com/bo-yang"></a>
    
    
    
      <a class="fa fa-stack-overflow" href="https://stackoverflow.com/users/boyang"></a>
    
    <a class="fa fa-rss" href="/feed.xml"></a>
    
      <a class="fa fa-twitter" href="https://twitter.com/bonnyang"></a>
    
    
    
    
    
      <a class="fa fa-envelope" href="mailto:bonny95@gmail.com"></a>
    
    
      <a class="fa fa-linkedin" href="https://www.linkedin.com/in/boyanglink"></a>
    
    
    
  </div>
  <div class="right">
    
    
    
  </div>
</div>
<div class="clearfix"></div>

      
    </div>
  </div>
</header>


    <div class="post p2 p-responsive wrap" role="main">
      <div class="measure">
        

<div class="home">
  
    <div class="posts">
      
        <div class="post py3">
          <p class="post-meta">Jul 13, 2011</p>
          <a href="/scripts/vba/2011/07/13/importing-multi-excel-filesworksheets-into-an-excel-workbook/" class="post-link"><h3 class="h2 post-title">Importing Multi-Excel Files/Worksheets Into An Excel Workbook</h3></a>
          <p class="post-summary">
            
              <p>Two days ago, my wife asked me to write an Excel VBA script to automatically import multi-Excel worksheets stored in different workbooks into an already opened Excel workbook.  Her requirements were:</p>
<ol>
<li>Select a range in a worksheet, which stores the names of worksheets to be imported. After executing the macro, worksheets will be created if it doesn't exist, or it will be updated according to the specified  Excel worksheet in another Excel workbook. Table 1 is the range selected in the worksheet, in which the first column is the serial number of worksheet, the second column denotes department name and the worksheet name should be like "01 Department A".</li>
<li>The imported/created worksheets should be sorted by the serial number of Table 1.</li>
<li>The macro should be smart enough to match the Excel files to be imported. The name is like "01 XXXX_Department  A_20110707.xls".</li>
<li>After importing, specified cells in every other worksheets should be automatically copied to cells on the same row next to department.</li>
</ol>
<p style="text-align:center;">Table 1  Selected Range of a worksheet</p>
<table class="aligncenter" width="200" border="1" cellspacing="1" cellpadding="1">
<tbody>
<tr>
<td>1</td>
<td>Department  A</td>
</tr>
<tr>
<td>2</td>
<td>Department  B</td>
</tr>
<tr>
<td>3</td>
<td>Department  C</td>
</tr>
<tr>
<td>4</td>
<td>Department  D</td>
</tr>
<tr>
<td>5</td>
<td>Department  E</td>
</tr>
<tr>
<td>6</td>
<td>Department  F</td>
</tr>
<tr>
<td>7</td>
<td>Department  G</td>
</tr>
<tr>
<td>8</td>
<td>Department  H</td>
</tr>
<tr>
<td>9</td>
<td>Department  I</td>
</tr>
<tr>
<td>10</td>
<td>Department  J</td>
</tr>
</tbody>
</table>
<p>Actually I am not familiar with VBA, although I studied Visual Basic 6.0 for several months, I rarely touched it after passing the Jiangsu Province Computer Rank Test Level 2 in 2003. Besides, almost all my work was done in Linux/UNIX last 3 years.  As a result, I have to Google every VBA syntax and tips all day long.</p>
<p>Finally, I finishes the VBA macros and meet my wife's requirement in a inelegant way. Following is the verbose source code.</p>
<p>Following the macro to implement first 3 requirements.<br />
[sourcecode language="vb"]<br />
Option Explicit<br />
Dim curWS As Worksheet</p>
<p>Sub LoadWorksheets()<br />
'<br />
' LoadWorksheets Macro<br />
' Macro recorded 7/13/2011 by Bo Yang<br />
'<br />
' Keyboard Shortcut: Ctrl+Shift+L<br />
'<br />
' *How to use this macro?*<br />
' *Select columns &quot;??(NO)&quot; and &quot;??(Deparment)&quot; and then run this macro.*<br />
'<br />
    Application.ScreenUpdating = False  ' stop screen flickering</p>
<p>    ' Create new sheets according to selected cells and copy the<br />
    ' contebts of other files into the new sheets<br />
    Dim YesNo As Variant, myFolder As String, MyLF As String<br />
    Dim SelRange As Range, ColNo As Range, ColDepart As Range, cell As Range, Rng As Range<br />
    Dim SheetName As String, SheetToBeCopy As String<br />
    Dim ColCnt As Integer<br />
    Dim no_str As String, idx As Integer</p>
<p>    myFolder = &quot;D:\&quot;   '*****Change this value as you need*****<br />
    SheetToBeCopy = &quot;信息资产风险评估&quot;  ' *****Change this value as you need*****</p>
<p>    MyLF = Chr(10) &amp;amp; Chr(13)    ' a line feed command<br />
    Set curWS = ThisWorkbook.ActiveSheet ' Save current worksheet</p>
<p>    ' check that if user select valid columns<br />
    ColCnt = Selection.Columns.Count</p>
<p>    If ColCnt  2 Then<br />
        MsgBox (&quot;Please select 2 columns!!!&quot; &amp;amp; MyLF &amp;amp; _<br />
            &quot;The first column must be digital numbers,&quot; &amp;amp; MyLF &amp;amp; _<br />
            &quot;And the Second column must be department names&quot; _<br />
        )<br />
        Exit Sub<br />
    End If</p>
<p>    YesNo = MsgBox(&quot;This Macro is going to create new worksheets according to your selected cells.&quot; &amp;amp; MyLF &amp;amp; _<br />
        &quot;Do you want to continue?&quot;, _<br />
        vbYesNo, &quot;Caution&quot;)<br />
    Select Case YesNo<br />
    Case vbYes<br />
        myFolder = InputBox(&quot;Please enter the folder where all your Excel files locates:&quot;, Default:=myFolder)<br />
        SheetToBeCopy = InputBox(&quot;Please enter the worksheet you want to copy:&quot;, Default:=SheetToBeCopy)</p>
<p>        ' Create new worksheets<br />
        ' Discontinuous selection is supported by Selection.Areas<br />
        For Each Rng In Selection.Areas<br />
            Set SelRange = Rng.Cells<br />
            Set ColNo = Rng.Columns(1)<br />
            Set ColDepart = Rng.Columns(2)<br />
            idx = 1<br />
            For Each cell In ColDepart.Cells<br />
                no_str = ColNo.Cells(idx).Value<br />
                If Len(no_str) = 1 Then<br />
                    no_str = &quot;0&quot; + no_str<br />
                End If<br />
                Call CreateNewWorksheet(no_str, cell.Value, myFolder, SheetToBeCopy) ' call is needed here<br />
                idx = idx + 1<br />
            Next<br />
        Next</p>
<p>        curWS.Activate</p>
<p>        ' Sort worksheets<br />
        Call SortWorksheets</p>
<p>    Case vbNo<br />
        Application.ScreenUpdating = True<br />
        Exit Sub<br />
    End Select</p>
<p>    curWS.Activate<br />
    Application.ScreenUpdating = True<br />
End Sub</p>
<p>Function CreateNewWorksheet(no As String, Depart As String, FolderName As String, SheetToBeCopy As String) As String<br />
    Dim oSheet As Worksheet, vRet As Variant<br />
    Dim SheetName As String, FileName As String<br />
    Dim Entry As Integer, i As Integer</p>
<p>    ' Determine where to insert new worksheet<br />
    Entry = 0<br />
    For i = Sheets.Count To 1 Step -1<br />
        If Val(Worksheets(i).Name) &amp;gt; 0 Then<br />
            Entry = i<br />
            GoTo Determ_Entry<br />
        End If<br />
    Next i<br />
Determ_Entry:<br />
    If Entry = 0 Then<br />
        Entry = Sheets.Count<br />
    End If</p>
<p>    'Example of one worksheet name:<br />
    '   07 oa祙?DDISMS?ㄩ????_D???钻2???_D?'?轶???_20110705.xls<br />
    SheetName = no + &quot; &quot; + Depart<br />
    If Not SheetExists(SheetName) Then<br />
        'worksheet XXX doesn't exist in current workbook<br />
        'creating a new excel worksheet</p>
<p>        Set oSheet = Worksheets.Add<br />
        With oSheet<br />
            .Name = SheetName<br />
            .Move After:=Sheets(Entry)<br />
            .Activate<br />
        End With<br />
    End If</p>
<p>    FileName = FindFileName(no, Depart, FolderName)<br />
    If FileName  &quot;&quot; Then<br />
        Call CopyWorksheet(SheetName, FileName, SheetToBeCopy)<br />
    End If</p>
<p>    Exit Function</p>
<p>End Function</p>
<p>Function SheetExists(SheetName As String) As Boolean<br />
' returns TRUE if the sheet exists in the active workbook<br />
    SheetExists = False<br />
    On Error GoTo NoSuchSheet<br />
    If Len(Sheets(SheetName).Name) &amp;gt; 0 Then<br />
        SheetExists = True<br />
        Exit Function<br />
    End If<br />
NoSuchSheet:<br />
End Function</p>
<p>Function CopyWorksheet(SheetName As String, FileName As String, SheetToBeCopy As String) As String<br />
    'open Excel files and copy the contents to this sheet<br />
    Dim newWB As Workbook, curWB As Workbook<br />
    Dim startRange As Range</p>
<p>    If Dir(FileName)  &quot;&quot; Then<br />
        ' file exists<br />
        ' Clear all cells of current worksheet<br />
        Sheets(SheetName).UsedRange.Clear<br />
        Application.DisplayAlerts = False ' disable alerts</p>
<p>        ' Open workbooks to be copied<br />
        Set curWB = ThisWorkbook ' For WorkBook and Range objects, set is necessary during assignment<br />
        Set newWB = Workbooks.Open(FileName)<br />
        newWB.Sheets(SheetToBeCopy).AutoFilterMode = False ' disable auto filter<br />
        Set startRange = newWB.Sheets(SheetToBeCopy).UsedRange ' Only used range will be copied<br />
        newWB.Sheets(SheetToBeCopy).UsedRange.Copy<br />
        ' paste to target worksheet<br />
        curWB.Activate<br />
        Sheets(SheetName).Range(startRange.Address).PasteSpecial<br />
        Application.CutCopyMode = False  'Clear Clipboard<br />
        newWB.Close SaveChanges:=False  ' close without change<br />
        Application.DisplayAlerts = True</p>
<p>    End If</p>
<p>End Function</p>
<p>Function FindFileName(no As String, Depart As String, FolderName As String) As String<br />
    Dim Coll_Docs As New Collection<br />
    Dim Search_path, Search_Filter, Search_Fullname As String<br />
    Dim DocName As String<br />
    Dim i As Long</p>
<p>    Search_path = FolderName   ' where ?<br />
    Search_Filter = no + &quot;*&quot; + Depart + &quot;*&quot; + &quot;.xls&quot; ' what ?<br />
    Set Coll_Docs = Nothing</p>
<p>    DocName = Dir(Search_path &amp;amp; &quot;\&quot; &amp;amp; Search_Filter)</p>
<p>    Do Until DocName = &quot;&quot;            ' build the collection<br />
        Coll_Docs.Add Item:=DocName<br />
        DocName = Dir<br />
    Loop</p>
<p>    If Coll_Docs.Count = 1 Then<br />
        FindFileName = Search_path &amp;amp; &quot;\&quot; &amp;amp; Coll_Docs(1)<br />
    Else<br />
        FindFileName = &quot;&quot;<br />
    End If</p>
<p>End Function</p>
<p>Function SortWorksheetsByName() As String<br />
    ' sort worksheets in a workbook in ascending order<br />
    Dim sCount As Integer, i As Integer, j As Integer</p>
<p>    Application.ScreenUpdating = False<br />
    sCount = Worksheets.Count<br />
    If sCount = 1 Then Exit Function<br />
    For i = 1 To sCount - 1<br />
        For j = i + 1 To sCount<br />
            If Worksheets(j).Name  0 Then<br />
            Entry = i<br />
            GoTo Determ_Entry<br />
        End If<br />
    Next i<br />
Determ_Entry:</p>
<p>    For i = Entry To cnt - 1<br />
            For j = i + 1 To cnt<br />
                    If Val(Worksheets(i).Name) &amp;gt; Val(Worksheets(j).Name) Then<br />
                            Worksheets(j).Move Before:=Worksheets(i)<br />
                    End If<br />
            Next j<br />
    Next i</p>
<p>    curWS.Activate<br />
    'Application.ScreenUpdating = True<br />
End Function<br />
[/sourcecode]</p>
<p>And here comes the macro to implement the 4th requirement.<br />
[sourcecode language="vb"]<br />
Option Explicit</p>
<p>Sub UpdateCells()<br />
'<br />
' UpdateCells Macro<br />
' Macro recorded 7/13/2011 by Bo Yang<br />
'<br />
' Keyboard Shortcut: Ctrl+Shift+C<br />
'<br />
' Risk:Cell<br />
' 5: L2 , 4: L3 , 3: L4 , 2: L5 , 1: L6<br />
Dim Risk5 As Range<br />
Dim num As String, depart As Range, idx As Integer<br />
Dim SheetName As String<br />
Dim SelRange As Range<br />
Dim curWS As Worksheet</p>
<p>Application.ScreenUpdating = False</p>
<p>Set curWS = ActiveSheet<br />
Set SelRange = Selection</p>
<p>idx = 1<br />
For Each depart In SelRange.Columns(2).Cells<br />
    num = SelRange.Columns(1).Cells(idx).value<br />
    If Len(num) = 1 Then<br />
        num = &quot;0&quot; + num<br />
    End If<br />
    SheetName = num + &quot; &quot; + depart.value</p>
<p>    Set Risk5 = SelRange.Columns(3).Cells(idx)</p>
<p>    ThisWorkbook.Sheets(SheetName).Range(&quot;L2:L6&quot;).Copy<br />
    Risk5.Select<br />
    Risk5.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True<br />
    Application.CutCopyMode = False 'Clear Clipboard</p>
<p>    idx = idx + 1<br />
Next</p>
<p>Application.ScreenUpdating = True<br />
End Sub<br />
[/sourcecode]<br />
<span style="font-size:small;"><span class="Apple-style-span" style="line-height:normal;"><br />
</span></span></p>

            
          </p>
        </div>
      
        <div class="post py3">
          <p class="post-meta">Jul 11, 2011</p>
          <a href="/vba/2011/07/11/merge-multi-excel-sheets/" class="post-link"><h3 class="h2 post-title">将多个Excel文件批量导入某个Excel文件中</h3></a>
          <p class="post-summary">
            
              <p>这是我老婆提出的一个需求：(1)选中Excel表格中的某些行或列，运行某个Macro，自动根据选中的cells创建新的worksheets，worksheets的名字就是选中的cells的名字。(2)创建新的worksheet的同时，要把某指定目录下与新的worksheet同名的Excel文件的内容copy到新的worksheet中去。</p>
<p>下面是搜索了半天之后搞出来的Macro，没有异常处理，而且使用了copy/paste，文件太多时效率肯定不高。其实完全可以参照<span style="font-family:Arial, Helvetica, sans-serif;"></span></p>
<p><a href="http://www.exceltip.com/st/Copy_a_sheet_from_each_workbook_into_your_workbook_in_a_folder_using_VBA_in_Microsoft_Excel/560.html">Copy a sheet from each workbook into your workbook in a folder using VBA in Microsoft Excel</a>&nbsp;和 <a href="http://www.ozgrid.com/VBA/SpeedingUpVBACode.htm">Optimize Slow VBA Code</a> 中的方法来优化。</p></p>
<pre>Sub LoadSheets()
    Application.ScreenUpdating = False  ' stop screen flickering
    
    ' Create new sheets according to selected cells and copy the
    ' contebts of other files into the new sheets
    Dim YesNo As Variant, myFolder As String, MyLF As String
        
    MyLF = Chr(10) &amp; Chr(13)    ' a line feed command
    myFolder = &quot;D:Documents and SettingsbonnyMy Documentstools&quot;   'change this to the location of saved XML files
    'Windows 7下C盘默认不可写，请修改DefFolder的值
    
    YesNo = MsgBox(&quot;This Macro is going to create new worksheets according to your selected cells.&quot; &amp; myclf &amp; _
        &quot;Do you want to continue?&quot;, _
        vbYesNo, &quot;Caution&quot;)
    Select Case YesNo
    Case vbYes
        myFolder = InputBox(&quot;Please enter the folder where all your Excel files locates&quot;, Default:=myFolder)
        'Create new worksheets
        For Each cell In Selection.Cells
            Call CreateNewWorksheet(cell.Value, myFolder)
        Next
    Case vbNo
        Exit Sub
    End Select
    
    Application.ScreenUpdating = True
End Sub


            
          </p>
        </div>
      
        <div class="post py3">
          <p class="post-meta">Jun 22, 2011</p>
          <a href="/unix/linux/2011/06/22/solaris-shared-lib-error/" class="post-link"><h3 class="h2 post-title">Solaris下/usr/lib/secure/0@0.so.1的错误</h3></a>
          <p class="post-summary">
            
              <p>&nbsp;</p>
<p>这两天一直被下面的错误所困扰：</p>
<p>
<pre>AP13: lb -m ccmscell uptime 
ld.so.1: uname: fatal: /usr/lib/secure/0@0.so.1: open failed: No such file or directory
ksh[216]: 4412 Killed
ld.so.1: uptime: fatal: /usr/lib/secure/0@0.so.1: open failed: No such file or directory
</pre>
<p>&nbsp;&nbsp;</p>
<p>lb是一个调用rsh的脚本，ccmscell是一个server pool，uname是在lb中被调用的。</p>
<p>&nbsp;</p>
<p>仔细研究了N遍相关的脚本，Google了N次相关的错误信息，都没有找到有价&#20540;的线索。后来问了一位做过IT的同事，她说以前遇见过类&#20284;的问题，可她的解决方案最终被证明无效。</p>
<p>&nbsp;</p>
<p>最终发现不是所有的server上执行这条命令都有问题，有些是可以执行的。对比了之后发现，如果/usr/lib/secure/0@0.so.1的group设置为bin，owner设为root，就不会出现上面的问题。出问题的server上/usr/lib/secure/0@0.so.1的group为other。</p>
<p>&nbsp;</p>
<p>进一步调查后发现，/usr/lib/secure/0@0.so.1是在Solaris 5.8上被设为LD_PRELOAD_32的，因为很多程序要被setuid&#043;chroot的伪root调用。当且仅当上面的命令被该伪root执行时，才会出现上面的错误！</p>
<p>&nbsp;</p>
<p>幸亏Solaris 5.8已经开始走进坟墓了，即使在落后如我们公司的地方！</p>
<p>&nbsp;</p>
<p><strong><span style="font-family:mceinline;">【update2011-06-23】：</span></strong></p>
<p><strong><span style="font-family:mceinline;">今天发现root cause 不是由于/usr/lib/secure/0@0.so.1的group不对，而是因为remote server（比如pool&nbsp;ccmscell中的server）上没有/usr/lib/secure/0@0.so.1 —— 执行rsh命令的login是setuid&#043;chroot实现的伪root，因此远程的server就需要/usr/lib/secure/0@0.so.1了。</span></strong></p>
<p><span style="font-family:mceinline;font-weight:bold;">【update 2012-03-12】</span></p>
<p><strong><span style="font-family:mceinline;">今天在Solaris 9上遇到了这样一个错误：</span></strong></p>
<p><span style="font-family:mceinline;">&nbsp; &nbsp; ld.so.1: pt_chmod: warning: /lib/0@0.so.1: open failed: illegal insecure pathname<br />
</span></p>
<p><strong><span style="font-family:mceinline;">查了很久才想起来有可能是</span></strong><strong>/usr/lib/secure/0@0.so.1造成的。一检查</strong><strong>/usr/lib/secure/0@0.so.1，果然不存在。</strong></p>
<p><strong><span style="font-family:mceinline;"></span></strong><strong></strong><strong>在一个正常工作的server上，</strong></p>
<p><strong><span style="font-family:mceinline;"></span></strong><strong></strong><strong></strong>
<pre>AP31: echo $LD_PRELOAD_32
/usr/lib/secure/0@0.so.1</pre></p>
<p><strong><span style="font-family:mceinline;"></span></strong><strong></strong><strong>在不能工作的server上，</strong></p>
<p><strong><span style="font-family:mceinline;"></span></strong><strong></strong><strong></strong>
<pre>AP13: echo $LD_PRELOAD_32
/lib/0@0.so.1</pre></p>
<p><strong><span style="font-family:mceinline;"></span></strong><strong></strong><strong>——仅仅升级了一个软件就又把这个library搞丢了，某些同志们啊，唉……</strong></p>

            
          </p>
        </div>
      
        <div class="post py3">
          <p class="post-meta">Jun 3, 2011</p>
          <a href="/unix/linux/2011/06/03/ksh-IPCSCMD-variable/" class="post-link"><h3 class="h2 post-title">ksh中包含变量的命令调用</h3></a>
          <p class="post-summary">
            
              <p>当一个含有变量a的命令存储在某个变量b中时, 利用$($b)时有可能会报错。如下面的代码，有时可以成功执行，有时会发生&ldquo;ipcs|grep xxx can not be found"的错误。&nbsp;</p>
<p>
<pre>IFS="
"
if isLinux
then
	IPCSCMD="ipcs"
else
	IPCSCMD="ipcs|grep $LOGNAME"
fi
for Eachline in $($IPCSCMD)
do
	IFS=" " # Space
	# Handle IPCs
	...
done</pre>
<p>&nbsp;</p>
<p>究其根源，应该是对IPCSCMD的解析出了问题。将代码改为下面的形式，就可以正确执行了。注意IFS的变化&mdash;&mdash;改成下面的形式后必须将循环内的IFS改为Space和Tab。</p>
<p>
<pre>IFS="
"
if isLinux
then
	ipcs
else
	ipcs|grep $LOGNAME
fi | while read Eachline
do
	IFS=" 	" # Space and tab
	# Handle IPCs
	...
done
</pre>
<p>&nbsp;</p>
<p>&nbsp;</p>

            
          </p>
        </div>
      
        <div class="post py3">
          <p class="post-meta">Jun 2, 2011</p>
          <a href="/unix/linux/2011/06/02/chroot-setuid-setgid/" class="post-link"><h3 class="h2 post-title">chroot, setuid() and set gid</h3></a>
          <p class="post-summary">
            
              <p>这篇文章搜集整理了网上chroot, setuid() &amp; set gid相关的文章。</p>
<ol>
<li><a href="http://www.unixwiz.net/techtips/chroot-practices.html">Best Practices for UNIX chroot() Operations</a></li>
<li><strong><a href="http://www.bpfh.net/simes/computing/chroot-break.html">How to break out of a&nbsp;<tt>chroot()</tt></a></strong><strong><a href="http://www.bpfh.net/simes/computing/chroot-break.html">&nbsp;jail</a></strong></li>
<li><strong><a href="http://www.cs.berkeley.edu/~daw/papers/setuid-usenix02.pdf">Setuid Demystifid</a></strong></li>
<li><strong><a href="http://oldfield.wattle.id.au/luv/permissions.html">Introduction to Unix file permissions</a></strong></li>
</ol>

            
          </p>
        </div>
      
        <div class="post py3">
          <p class="post-meta">May 20, 2011</p>
          <a href="/unix/linux/2011/05/20/zcat-gzcat/" class="post-link"><h3 class="h2 post-title">如何判断一个(压缩)文件的类型，以及zcat/gzcat</h3></a>
          <p class="post-summary">
            
              <p>恰似&ldquo;一师是个好学校&rdquo;，dd是个好工具&mdash;&mdash;只消用它逐字copy出某个文件第一个block的内容，就可以判断出该文件的类型！！！</p>
<p>&nbsp;</p>
<p>
<pre>bjbldd&gt;1&gt; dd if=MMEgolden.tar bs=512 count=1 &gt; dd_tmp
1+0 records in
1+0 records out
bjbldd&gt;&gt; file dd_tmp
dd_tmp:         USTAR tar archive
bjbldd&gt;&gt; dd if=varofvar bs=512 count=1 &gt; dd_tmp
0+1 records in
0+1 records out
bjbldd&gt;&gt; file dd_tmp
dd_tmp:         executable /bin/ksh script
bjbldd&gt;&gt; dd if=Tk-804.029.tar.gz bs=512 count=1 &gt; dd_tmp
1+0 records in
1+0 records out
bjbldd&gt;&gt; file dd_tmp
dd_tmp:         gzip compressed data - deflate method , original file name , max compression
</pre>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>另外，zcat或者gzcat是用于cat gzip压缩文件的工具，只是在不同的平台有些差异：/bin/zcat在Linux上work的很好，可是当它在Solaris上cat gzip文件的内容时，就会报错。Solaris上cat gzip文件只能用/bin/gzcat. &mdash;&mdash;就是这个小小的差异，浪费了我一天的时间！</p>
<p>&nbsp;</p>
<p>跨平台的cat gzip文件的代码如下：</p>
<p>
<pre>OS="`/bin/uname`"
if [ "${OS}" != "Linux" ]
then
	ZCAT="/bin/zcat"
else
	ZCAT="/bin/gzcat"
fi
.......
${ZCAT} ${TMPDIR}/ngn_platform.cpio.Z | /bin/cpio -idmvu  -H odc ${SAT_CPIO_FLAG}</pre>
<p>&nbsp;</p>
<p>貌似cpio的用法也很强大哦～</p>

            
          </p>
        </div>
      
        <div class="post py3">
          <p class="post-meta">May 16, 2011</p>
          <a href="/unix/linux/2011/05/16/yum-proxy/" class="post-link"><h3 class="h2 post-title">yum的proxy设置</h3></a>
          <p class="post-summary">
            
              <p>方法一：</p>
<p>
<pre>export http_proxy="proxy:portnum"</pre>
<p>&nbsp;</p>
<p>方法二：（<a href="http://www.fedoraforum.org/forum/showthread.php?t=742">http://www.fedoraforum.org/forum/showthread.php?t=742</a>）</p>
<table id="post4089" class="tborder" style="width:100%;" border="0" cellspacing="1" cellpadding="6" align="center">
<tbody>
<tr>
<td class="alt1">
<div id="post_message_4089">create the following files in /etc/profile.d, and then this will work in *any* shell for *any* user of the system</p>
<pre>#proxy.sh
export http_proxy=http://host.com:port/
export ftp_proxy=http://host.com:port/
export no_proxy=.domain.com
export HTTP_PROXY=http://host.com:port/
export FTP_PROXY=http://host.com:port/
#proxy.csh
setenv http_proxy http://host.com:port/
setenv ftp_proxy http://host.com:port/
setenv no_proxy .domain.com
setenv HTTP_PROXY http://host.com:port/
setenv FTP_PROXY http://host.com:port/</pre>
<p>&nbsp;</p></div>
<div>方法三：(<a href="http://linux.die.net/man/5/yum.conf">http://linux.die.net/man/5/yum.conf</a>)</div>
<div>在/etc/yum.conf中设置proxy，prox_username和proxy_password选项。</div>
</td>
</tr>
</tbody>
</table>

            
          </p>
        </div>
      
        <div class="post py3">
          <p class="post-meta">May 16, 2011</p>
          <a href="/perl/unix/linux/2011/05/16/perl-library/" class="post-link"><h3 class="h2 post-title">Perl的library设置</h3></a>
          <p class="post-summary">
            
              <p>参考链接：</p>
<ol>
<li><a href="http://stackoverflow.com/questions/841785/how-do-i-include-a-perl-module-thats-in-a-different-directory">http://stackoverflow.com/questions/841785/how-do-i-include-a-perl-module-thats-in-a-different-directory</a></li>
<li><a href="http://stackoverflow.com/questions/185114/how-do-i-use-a-perl-module-in-a-directory-not-in-inc">http://stackoverflow.com/questions/185114/how-do-i-use-a-perl-module-in-a-directory-not-in-inc</a></li>
</ol>
<p>&nbsp;</p>
<p>在Fedora/RHEL/CentOS中，perl 的library默认安装路径为：</p>
<p>
<pre>@INC (@INC contains: /usr/lib64/perl5/site_perl/5.8.8/x86_64-linux-thread-multi /usr/lib/perl5/site_perl/5.8.8 /usr/lib/perl5/site_perl /usr/lib64/perl5/vendor_perl/5.8.8/x86_64-linux-thread-multi /usr/lib/perl5/vendor_perl/5.8.8 /usr/lib/perl5/vendor_perl /usr/lib64/perl5/5.8.8/x86_64-linux-thread-multi /usr/lib/perl5/5.8.8 .)</pre>
<p>&nbsp;</p>
<p>如果要使用自定义的perllib，就需要参考以下的设置了。</p>
<p>&nbsp;</p>
<p>EDIT: Putting the right solution first, originally from&nbsp;<a href="http://stackoverflow.com/questions/185114/how-do-i-use-a-perl-module-in-a-directory-not-in-inc">this question</a>. It's the only one that searches relative to the&nbsp;<strong>module</strong>&nbsp;directory:</p>
<pre class="lang-perl prettyprint"><code><span class="kwd">use</span><span class="pln"> </span><span class="typ">FindBin</span><span class="pun">;</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com"># locate this script</span><span class="pln"><br /></span><span class="kwd">use</span><span class="pln"> lib </span><span class="str">"$FindBin::Bin/.."</span><span class="pun">;</span><span class="pln"> &nbsp;</span><span class="com"># use the parent directory</span><span class="pln"><br /></span><span class="kwd">use</span><span class="pln"> yourlib</span><span class="pun">;</span><span class="pln"><br /></span></code></pre>
<p>There's many other ways that search for libraries relative to the&nbsp;<strong>current</strong>&nbsp;directory. You can invoke perl with the -I argument, passing the directory of the other module:</p>
<pre class="lang-perl prettyprint"><code><span class="pln">perl </span><span class="pun">-</span><span class="pln">I</span><span class="pun">..</span><span class="pln"> yourscript</span><span class="pun">.</span><span class="pln">pl<br /></span></code></pre>
<p><span class="goog_qs-tidbit goog_qs-tidbit-0">You can include a line near the top of your perl script:</span></p>
<pre class="lang-perl prettyprint"><code><span class="kwd"><span class="goog_qs-tidbit goog_qs-tidbit-0">use</span></span><span class="pln"><span class="goog_qs-tidbit goog_qs-tidbit-0"> lib </span></span><span class="str"><span class="goog_qs-tidbit goog_qs-tidbit-0">'..'</span></span><span class="pun"><span class="goog_qs-tidbit goog_qs-tidbit-0">;</span></span><span class="pln"><br /></span></code></pre>
<p><span class="goog_qs-tidbit goog_qs-tidbit-0">You can modify the environment variable PERL5LIB before you run the</span>&nbsp;script:</p>
<pre class="lang-perl prettyprint"><code><span class="pln">export PERL5LIB</span><span class="pun">=</span><span class="pln">$PERL5LIB</span><span class="pun">:..</span><span class="pln"><br /></span></code></pre>
<p>The push(@INC) strategy can also work, but it has to be wrapped in BEGIN{} to make sure that the push is run before the module search:</p>
<pre class="lang-perl prettyprint"><code><span class="kwd">BEGIN</span><span class="pln"> </span><span class="pun">{</span><span class="pln">push </span><span class="lit">@INC</span><span class="pun">,</span><span class="pln"> </span><span class="str">'..'</span><span class="pun">}</span><span class="pln"><br /></span><span class="kwd">use</span><span class="pln"> yourlib</span><span class="pun">;</span></code></pre>
<p>&nbsp;</p>

            
          </p>
        </div>
      
        <div class="post py3">
          <p class="post-meta">May 13, 2011</p>
          <a href="/unix/linux/2011/05/13/process-attached-to-shared-memory/" class="post-link"><h3 class="h2 post-title">How to list processes attached to a shared memory segment in linux?</h3></a>
          <p class="post-summary">
            
              <p>本文整理自网络，参考网页(references):</p>
<ol>
<li><a href="http://stackoverflow.com/questions/5658568/how-to-list-processes-attached-to-a-shared-memory-segment-in-linux">http://stackoverflow.com/questions/5658568/how-to-list-processes-attached-to-a-shared-memory-segment-in-linux</a></li>
<li><a href="http://publib.boulder.ibm.com/infocenter/iseries/v5r4/index.jsp?topic=%2Frzahz%2Fipcs.htm">http://publib.boulder.ibm.com/infocenter/iseries/v5r4/index.jsp?topic=%2Frzahz%2Fipcs.htm</a></li>
</ol>
<p>[Question]:</p>
<p><span><br />
</span></p>
<p>How do I determine what process is attached to a shared memory segment?</p>
<pre><code>awagner@tree:/home/awagner$ ipcs -m


            
          </p>
        </div>
      
        <div class="post py3">
          <p class="post-meta">May 3, 2011</p>
          <a href="/perl/unix/linux/2011/05/03/shell-floating-point/" class="post-link"><h3 class="h2 post-title">Shell浮点数运算</h3></a>
          <p class="post-summary">
            
              <p>Shell本身不支持浮点数运算，(())之类的数学运算符只能进行整数运算。要想在shell中运算浮点数，只能借助于bc, Awk或者Perl。 如</p>
<p>
<pre>a=0.1
b=0.2
c=$(echo "$a+$b" | bc -l)</pre>
<p>&nbsp;</p>
<p>或者</p>
<p>
<pre>perl -e "print STDOUT $a + $b;"</pre>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>需要注意的是，如果数学表达式中有负数，则必须确保运算符(+ - * /)与其前后的表达式之间至少有一空格。如：</p>
<p>
<pre>[bonn@bonn Downloads]$ echo $a $b
-0.1 -0.2
[bonn@bonn Downloads]$ echo "$a - $b" | bc -l
.1
[bonn@bonn Downloads]$ perl -e "print STDOUT $a - $b;"
0.1
</pre>
<p>&nbsp;</p>

            
          </p>
        </div>
      
    </div>

    <div class="pagination clearfix mb1 mt4">
  <div class="left">
    
      
        <a class="pagination-item" href="/page9/">Newer</a>
      
    
  </div>
  <div class="right">
    
      <a class="pagination-item" href="/page11/">Older</a>
    
  </div>
</div>

  
</div>

      </div>
    </div>
  </div>

  <footer class="center">
  <div class="measure">
      <small>
      <p>&copy; 2007-2016 by <a href="http://www.bo-yang.net/">Bo Yang. </a></p>
         
      Theme crafted with &lt;3 by <a href="http://johnotander.com">John Otander</a> (<a href="https://twitter.com/4lpine">@4lpine</a>).<br>
      &lt;/&gt; available on <a href="https://github.com/johnotander/pixyll">Github</a>.
    </small>
  </div>
</footer>

</body>
</html>
