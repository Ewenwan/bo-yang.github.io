
<!DOCTYPE HTML>
<html lang="en-US" xmlns="http://www.w3.org/1999/xhtml" xmlns:wb="http://open.weibo.com/wb">
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<head>
  <title>Bo Yang | Bo's Blog</title>
  
  <meta name="author" content="Bo Yang" />
  <meta http-equiv="content-type" content="text/html;charset=utf-8">

  <!-- using baidu cdn instead
  <link href="/assets/themes/clear/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
  -->
  <link href="http://libs.baidu.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet">


  <!-- Google Prettify -->
  <link href="/assets/themes/clear/google-code-prettify/desert.css" rel="stylesheet" type="text/css" media="all">
  <!-- Google Pretty end -->

  <link href="/assets/themes/clear/css/style.css" rel="stylesheet" type="text/css" media="all" />
  <!-- using baidu cdn instead
  <script type="text/javascript" src="/static/js/jquery-1.8.3.min.js"></script>
  -->

  <script src="http://libs.baidu.com/jquery/1.9.0/jquery.min.js"></script>
  <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>

<body>

  <div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container">
        <a class="brand" href="/">bo-yang</a>
        <ul class="nav">
          <li><a href="/archive.html">Archive</a></li>
          <li><a href="/about.html">About</a></li>
          <li><a href="/messages.html">Messages</a></li>
        </ul>
        <ul class="pull-right">
          <li>
            <form class="navbar-search" method="get" action="http://www.google.com/search" target="google_window">
              <input id="g_search" type="text" class="search-query" placeholder="Search..." name="q" />
              <input type="submit" name="btnG" style="display:none" id="searchsubmit" value="Search" />
              <input type="hidden" name="ie" value="UTF-8" />
              <input type="hidden" name="oe" value="UTF-8" />
              <input type="hidden" name="hl" value="en-US" />
              <input type="hidden" name="domains" value="http://bo-yang.github.io/" />
              <input type="hidden" name="sitesearch" value="http://bo-yang.github.io/" />
            </form>
          </li>
        </ul>
        <ul class="nav pull-right">
          <li><a href="/atom.xml">RSS</a></li>
        </ul>
      </div>
    </div>
  </div>

  <div class="container page-container">
    <div class="content">
      
<div class="page-header">
  <h1>Bo Yang  <small>Beginner's mind.</small></h1>
</div>

<div class="row-fluid page-body">
  <div class="span12">
    

<div class="row-fluid page-body">

  <div class="span9 left">
    
    <div class="main-container shadow">
      <div class="mainbody">
        <h2><a href="/2009/01/13/perl-note-2">Perl Notes(II)</a></h2>
        <p>
          Posted by <strong>Bo Yang</strong> at <strong>2009-01-13</strong> with tags <a href="/tags.html#Perl-ref" rel="nofollow">Perl</a>, <a href="/tags.html#Unix/Linux-ref" rel="nofollow">Unix/Linux</a>
        </p>
        
        <div class="post_at_index thepost">
        <p>
     <span class="Apple-style-span" style="color:rgb(0,0,0);font-family:Verdana;font-size:13px;"><span class="Apple-style-span" style="font-size:19px;font-weight:bold;">Part II<span>    Network Programming With Perl</span></span><br />
<h3 style="font-size:12pt;"><a name="1_Input_Output_Basics_" id="1_Input_Output_Basics_"></a>1 Input/Output Basics<br /></h3>
<h4 style="font-size:10pt;"><a name="1_1_Filehandles_" id="1_1_Filehandles_"></a>1.1 Filehandles<br /></h4>
<p></span>
<p class="docText" style="margin:0;">Filehandles are the foundation of networked applications. In this section we review the ins and outs of filehandles. Even if you're an experienced Perl programmer, you might want to scan this section to refresh your memory on some of the more obscure aspects of Perl I/O.</p>
<p><a name="ch01lev2sec7"></a><br />
<h5 style="font-size:8pt;"><a name="1_1_1_Standard_Filehandles_" id="1_1_1_Standard_Filehandles_"></a>1.1.1 Standard Filehandles<br /></h5>
<p class="docText" style="margin:0;">A filehandle connects a Perl script to the outside world. Reading from a filehandle brings in outside data, and writing to one exports data. Depending on how it was created, a filehandle may be connected to a disk file, to a hardware device such as a serial port, to a local process such as a command-line window in a windowing system, or to a remote process such as a network server. It's also possible for a filehandle to be connected to a "bit bucket" device that just sucks up data and ignores it.</p>
<p class="docText" style="margin:0;"></p>
<p class="docText" style="margin:0;">A filehandle is any valid Perl identifier that consists of uppercase and lowercase letters, digits, and the underscore character. Unlike other variables, a filehandle does not have a distinctive prefix (like "$"). So to make them distinct, Perl programmers often represent them in all capital letters, or caps.</p>
<p class="docText" style="margin:0;"></p>
<p class="docText" style="margin:0;">When a Perl script starts, exactly three filehandles are open by default: <tt>STDOUT</tt>, <tt>STDIN</tt>, and <tt>STDERR</tt>. The <tt>STDOUT</tt> filehandle, for "standard output," is the default filehandle for output. Data sent to this filehandle appears on the user's preferred output device, usually the command-line window from which the script was launched. <tt>STDIN</tt>, for "standard input," is the default input filehandle. Data read from this filehandle is taken from the user's preferred input device, usually the keyboard. <tt>STDERR</tt> ("standard error") is used for error messages, diagnostics, debugging, and other such incidental output. By default <tt>STDERR</tt> uses the same output device as <tt>STDOUT</tt>, but this can be changed at the user's discretion. The reason that there are separate filehandles for normal and abnormal output is so that the user can divert them independently; for example, to send normal output to a file and error output to the screen.</p>
<p class="docText" style="margin:0;"></p>
<p class="docText" style="margin:0;">This code fragment will read a line of input from <tt>STDIN</tt>, remove the terminating end-of-line character with the <tt>chomp()</tt> function, and echo it to standard output:</p>
<pre>$input = &lt;STDIN&gt;;
chomp($input);
print STDOUT "If I heard you correctly, you said: $input/n";
</pre>
<p class="docText" style="margin:0;">By taking advantage of the fact that <tt>STDIN</tt> and <tt>STDOUT</tt> are the defaults for many I/O operations, and by combining <tt>chomp()</tt> with the input operation, the same code could be written more succinctly like this:</p>
<pre>chomp($input = &lt;&gt;);
print "If I heard you correctly, you said: $input/n";
</pre>
<p class="docText" style="margin:0;">We review the <tt>&lt;&gt;</tt> and <tt>print()</tt> functions in the next section. Similarly, <tt>STDERR</tt> is the default destination for the <tt>warn()</tt> and <tt>die()</tt> functions.</p>
<p class="docText" style="margin:0;"></p>
<p class="docText" style="margin:0;">The user can change the attachment of the three standard filehandles before launching the script. On UNIX and Windows systems, this is done using the redirect metacharacters "&lt;" and "&gt;". For example, given a script named <span class="docEmphasis">muncher.pl</span> this command will change the script's standard input so that it comes from the file <span class="docEmphasis">data.txt</span>, and its standard output so that processed data ends up in <span class="docEmphasis">crunched.txt</span>:</p>
<pre>% <span class="docEmphStrong">muncher.pl &lt;data.txt &gt;crunched.txt</span>
						</pre>
<p class="docText" style="margin:0;">Standard error isn't changed, so diagnostic messages (e.g., from the built-in <tt>warn()</tt> and <tt>die()</tt> functions) appear on the screen.</p>
<p class="docText" style="margin:0;">On Macintosh systems, users can change the source of the three standard filehandles by selecting filenames from a dialog box within the MacPerl development environment.</p>
<p><a name="ch01lev2sec8"></a><br />
<h5 style="font-size:8pt;"><a name="1_1_2_Input_and_Output_Operati" id="1_1_2_Input_and_Output_Operati"></a>1.1.2 Input and Output Operations<br /></h5>
<p class="docText" style="margin:0;">Perl gives you the option of reading from a filehandle one line at a time, suitable for text files, or reading from it in chunks of arbitrary length, suitable for binary byte streams like image files.</p>
<p class="docText" style="margin:0;"></p>
<p class="docText" style="margin:0;">For input, the <tt>&lt;&gt;</tt> operator is used to read from a filehandle in a line-oriented fashion, and <tt>read()</tt> or <tt>sysread()</tt> to read in a byte-stream fashion. For output, <tt>print()</tt> and <tt>syswrite()</tt> are used for both text and binary data (you decide whether to make the output line-oriented by printing newlines).</p>
<p class="docText" style="margin:0;"></p>
<p style="margin:0;">
<table cellspacing="0" width="90%" border="1" style="font-size:1em;line-height:inherit;">
<tbody>
<tr style="text-align:left;">
<td>
<p class="docText" style="margin:0;"><span class="docEmphStrong"><span class="Apple-style-span" style="font-weight:bold;"><span class="Apple-style-span" style="color:rgb(0,0,255);">$line = &lt;FILEHANDLE&gt;</span></span></span></p>
<p class="docText" style="margin:0;"><span class="docEmphStrong"><span class="Apple-style-span" style="font-weight:bold;"><span class="Apple-style-span" style="color:rgb(0,0,255);">@lines = &lt;FILEHANDLE&gt;</span></span></span></p>
<p class="docText" style="margin:0;"><span class="docEmphStrong"><span class="Apple-style-span" style="font-weight:bold;"><span class="Apple-style-span" style="color:rgb(0,0,255);">$line &lt;&gt;</span></span></span></p>
<p class="docText" style="margin:0;"><span class="docEmphStrong"><span class="Apple-style-span" style="font-weight:bold;"><span class="Apple-style-span" style="color:rgb(0,0,255);">@lines &lt;&gt;</span></span></span></p>
<p class="docText" style="margin:0;"><span class="Apple-style-span" style="font-weight:bold;"><br /></span></p>
<p class="docText" style="margin:0;">The <tt>&lt;&gt;</tt> ("angle bracket") operator is sensitive to the context in which it is called. If it is used to assign to a scalar variable, a so-called scalar context, it reads a line of text from the indicated filehandle, returning the data along with its terminating end-of-line character. After reading the last line of the filehandle, <tt>&lt;&gt;</tt> will return <tt>undef</tt>, signaling the end-of-file (EOF) condition.</p>
<p class="docText" style="margin:0;">When <tt>&lt;&gt;</tt> is assigned to an array or used in another place where Perl ordinarily expects a list, it reads <span class="docEmphasis">all</span> lines from the filehandle through to EOF, returning them as one (potentially gigantic) list. This is called a list context.</p>
<p class="docText" style="margin:0;">If called in a "void context" (i.e., without being assigned to a variable),<tt>&lt;&gt;</tt> copies a line into the <tt>$_</tt> global variable. This is commonly seen in <tt>while()</tt> loops, and often combined with pattern matches and other operations that use <tt>$_</tt> implicitly:</p>
<pre>while (&lt;&gt;) {
   print "Found a gnu/n" if /GNU/i;
}
</pre>
<p class="docText" style="margin:0;">The <tt>&lt;FILEHANDLE&gt;</tt> form of this function explicitly gives the filehandle to read from. However, the <tt>&lt;&gt;</tt> form is "magical." If the script was called with a set of file names as command-line arguments, <tt>&lt;&gt;</tt> will attempt to <tt>open()</tt> each argument in turn and will then return lines from them as if they were concatenated into one large pseudofile.</p>
<p class="docText" style="margin:0;">If no files are given on the command line, or if a single file named "-" is given, then <tt>&lt;&gt;</tt> reads from standard input and is equivalent to <tt>&lt;STDIN&gt;</tt>. See the <span class="docEmphasis">perlfunc</span> POD documentation for an explanation of how this works (<tt>pod perlfunc</tt>, as explained in the Preface).</p>
<p class="docText" style="margin:0;"></p>
<p class="docText" style="margin:0;"><span class="docEmphStrong"><span class="Apple-style-span" style="font-weight:bold;"><span class="Apple-style-span" style="color:rgb(0,0,255);">$bytes = read (FILEHANDLE,$buffer,$length [,$offset])</span></span></span></p>
<p class="docText" style="margin:0;"><span class="docEmphStrong"><span class="Apple-style-span" style="font-weight:bold;"><span class="Apple-style-span" style="color:rgb(0,0,255);">$bytes = sysread (FILEHANDLE,$buffer,$length [,$offset])</span></span></span></p>
<p class="docText" style="margin:0;"></p>
<p class="docText" style="margin:0;">The <tt>read()</tt> and <tt>sysread()</tt> functions read data of arbitrary length from the indicated filehandle. Up to <tt>$length</tt> bytes of data will be read, and placed in the <tt>$buffer</tt> scalar variable. Both functions return the number of bytes actually read, numeric 0 on the end of file, or <tt>undef</tt> on an error.</p>
<p class="docText" style="margin:0;">This code fragment will attempt to read 50 bytes of data from <tt>STDIN</tt>, placing the information in <tt>$buffer</tt>, and assigning the number of bytes read to <tt>$bytes</tt>:</p>
<pre>my $buffer;
$bytes = read (STDIN,$buffer,50);
</pre>
<p class="docText" style="margin:0;">By default, the read data will be placed at the beginning of <tt>$buffer</tt>, overwriting whatever was already there. You can change this behavior by providing the optional numeric <tt>$offset</tt> argument, to specify that read data should be written into the variable starting at the specified position.</p>
<p class="docText" style="margin:0;">The main difference between <tt>read()</tt> and <tt>sysread()</tt> is that <tt>read()</tt> uses standard I/O buffering, and <tt>sysread()</tt> does not. This means that <tt>read()</tt> will not return until either it can fetch the exact number of bytes requested or it hits the end of file. The <tt>sysread()</tt> function, in contrast, can return partial reads. It is guaranteed to return at least 1 byte, but if it cannot immediately read the number of bytes requested from the filehandle, it will return what it can. This behavior is discussed in more detail later in the Buffering and Blocking section.</p>
<p class="docText" style="margin:0;"></p>
<p class="docText" style="margin:0;"><span class="docEmphStrong"><span class="Apple-style-span" style="font-weight:bold;"><span class="Apple-style-span" style="color:rgb(0,0,255);">$result = print FILEHANDLE $data1,$data2,$data3...</span></span></span></p>
<p class="docText" style="margin:0;"><span class="docEmphStrong"><span class="Apple-style-span" style="font-weight:bold;"><span class="Apple-style-span" style="color:rgb(0,0,255);">$result = print $data1,$data2,$data3...</span></span></span></p>
<p class="docText" style="margin:0;"></p>
<p class="docText" style="margin:0;">The <tt>print()</tt> function prints a list of data items to a filehandle. In the first form, the filehandle is given explicitly. Notice that there is no comma between the filehandle name and the first data item. In the second form, <tt>print()</tt> uses the current default filehandle, usually <tt>STDOUT</tt>. The default filehandle can be changed using the one-argument form of <tt>select()</tt> (discussed below). If no data arguments are provided, then <tt>print()</tt> prints the contents of <tt>$_</tt>.</p>
<p class="docText" style="margin:0;">If output was successful, <tt>print()</tt> returns a true value. Otherwise it returns false and leaves an error message in the variable named <tt>$!</tt>.</p>
<p class="docText" style="margin:0;">Perl is a parentheses-optional language. Although I prefer using parentheses around function arguments, most Perl scripts drop them with <tt>print()</tt>, and this book follows that convention as well.</p>
<p class="docText" style="margin:0;"></p>
<p class="docText" style="margin:0;"><span class="docEmphStrong"><span class="Apple-style-span" style="font-weight:bold;"><span class="Apple-style-span" style="color:rgb(0,0,255);">$result = printf $format,$data1,$data2,$data3...</span></span></span></p>
<p class="docText" style="margin:0;"></p>
<p class="docText" style="margin:0;">The <tt>printf()</tt> function is a formatted print. The indicated data items are formatted and printed according to the <tt>$format</tt> format string. The formatting language is quite rich, and is explained in detail in Perl's POD documentation for the related <tt>sprintf()</tt> (string formatting) function.</p>
<p class="docText" style="margin:0;"></p>
<p class="docText" style="margin:0;"><span class="docEmphStrong"><span class="Apple-style-span" style="font-weight:bold;"><span class="Apple-style-span" style="color:rgb(0,0,255);">$bytes = syswrite (FILEHANDLE,$data [,$length [,$offset]])</span></span></span></p>
<p class="docText" style="margin:0;"></p>
<p class="docText" style="margin:0;">The <tt>syswrite()</tt> function is an alternative way to write to a filehandle that gives you more control over the process. Its arguments are a filehandle and a scalar value (avariable or string literal). It writes the data to the filehandle, and returns the number of bytes successfully written.</p>
<p class="docText" style="margin:0;">By default, <tt>syswrite()</tt> attempts to write the entire contents of <tt>$data</tt>, beginning at the start of the string. You can alter this behavior by providing an optional <tt>$length</tt> and <tt>$offset</tt>, in which case <tt>syswrite()</tt> will write <tt>$length</tt> bytes beginning at the position specified by <tt>$offset</tt>.</p>
<p class="docText" style="margin:0;">Aside from familiarity, the main difference between <tt>print()</tt> and <tt>syswrite()</tt> is that the former uses standard I/O buffering, while the latter does not. We discuss this later in the Buffering and Blocking section.</p>
<p class="docText" style="margin:0;">Don't confuse <tt>syswrite()</tt> with Perl's unfortunately named <tt>write()</tt> function. The latter is part of Perl's report formatting package, which we won't discuss further.</p>
<p class="docText" style="margin:0;"></p>
<p class="docText" style="margin:0;"><span class="docEmphStrong"><span class="Apple-style-span" style="font-weight:bold;"><span class="Apple-style-span" style="color:rgb(0,0,255);">$previous = select(FILEHANDLE)</span></span></span></p>
<p class="docText" style="margin:0;"></p>
<p class="docText" style="margin:0;">The <tt>select()</tt> function changes the default output filehandle used by print <tt>print ()</tt>. It takes the name of the filehandle to set as the default, and returns the name of the previous default. There is also a version of <tt>select()</tt> that takes four arguments, which is used for I/O multiplexing. We introduce the four-argument version in <a class="docLink">Chapter 8</a>.</p>
</td>
</tr>
</tbody>
</table>
<p style="margin:0;">
<p class="docText" style="margin:0;">When reading data as a byte stream with <tt>read()</tt> or <tt>sysread()</tt>, a common idiom is to pass <tt>length($buffer)</tt> as the offset into the buffer. This will make <tt>read()</tt> append the new data to  the end of data that was already in the buffer. For example:</p>
<pre>my $buffer;
while (1) {
  $bytes = read (STDIN,$buffer,50,length($buffer));
  last unless $bytes &gt; 0;
}</pre>
<p><span class="Apple-style-span" style="font-size:11px;font-weight:bold;"><a name="ch01lev2sec9"></a></span><br />
<h5 style="font-size:8pt;"><a name="1_1_3_Detecting_the_End_of_Fil" id="1_1_3_Detecting_the_End_of_Fil"></a>1.1.3 Detecting the End of File<br /></h5>
<p class="docText" style="margin:0;">The end-of-file condition occurs when there's no more data to be read from a file or device. When reading from files this happens at the literal end of the file, but the EOF condition applies as well when reading from other devices. When reading from the terminal (command-line window), for example, EOF occurs when the user presses a special key: control-D on UNIX, control-Z on Windows/DOS, and command-. on Macintosh. When reading from a network-attached socket, EOF occurs when the remote machine closes its end of the connection.</p>
<p class="docText" style="margin:0;">The EOF condition is signaled differently depending on whether you are reading from the filehandle one line at a time or as a byte stream. For byte-stream operations with <tt>read()</tt> or <tt>sysread()</tt>, EOF is indicated when the function returns numeric 0. Other I/O errors return <tt>undef</tt> and set <tt>$!</tt> to the appropriate error message. To distinguish between an error and a normal end of file, you can test the return value with <tt>defined():</tt></p>
<pre>while (1) {
  my $bytes = read(STDIN,$buffer,100);
  die "read error" unless defined ($bytes);
  last unless $bytes &gt; 0;
}
</pre>
<p class="docText" style="margin:0;">In contrast, the <tt>&lt;&gt;</tt> operator doesn't distinguish between EOF and abnormal conditions, and returns <tt>undef</tt> in either case. To distinguish them, you can set <tt>$!</tt> to <tt>undef</tt> before performing a series of reads, and check whether it is defined afterward:</p>
<pre>undef $!;
while (defined(my $line = &lt;STDIN&gt;)) {
   $data .= $line;
}
die "Abnormal read error: $!" if defined ($!);
</pre>
<p class="docText" style="margin:0;">When you are using <tt>&lt;&gt;</tt> inside the conditional of a <tt>while()</tt> loop, as shown in the most recent code fragment, you can dispense with the explicit <tt>defined()</tt> test. This makes the loop easier on the eyes:</p>
<pre>while (my $line = &lt;STDIN&gt;) {
   $data .= $line;
}
</pre>
<p class="docText" style="margin:0;">This will work even if the line consists of a single 0 or an empty string, which Perl would ordinarily treat as false. Outside <tt>while()</tt> loops, be careful to use <tt>defined()</tt> to test the returned value for EOF.</p>
<p class="docText" style="margin:0;">Finally, there is the <tt>eof()</tt> function, which explicitly tests a filehandle for the EOF condition:</p>
<p style="margin:0;">
<table cellspacing="0" width="90%" border="1" style="font-size:1em;line-height:inherit;">
<tbody>
<tr style="text-align:left;">
<td>
<p class="docText" style="margin:0;"><span class="docEmphStrong"><span class="Apple-style-span" style="font-weight:bold;"><span class="Apple-style-span" style="color:rgb(0,0,255);">$eof = eof(FILEHANDLE)</span></span></span></p>
<p class="docText" style="margin:0;"><span class="Apple-style-span" style="color:rgb(0,0,255);font-weight:bold;"><br /></span></p>
<p class="docText" style="margin:0;">The <tt>eof()</tt> function returns true if the next read on <tt>FILEHANDLE</tt> will return an EOF. Called without arguments or parentheses, as in <tt>eof</tt>, the function tests the last filehandle read from.</p>
<p class="docText" style="margin:0;">When using <tt>while(&lt;&gt;)</tt> to read from the command-line arguments as a single pseudofile, <tt>eof()</tt> has "magical"—or at least confusing—properties. Called with empty parentheses, as in <tt>eof()</tt>, the function returns true at the end of the very last file. Called without parentheses or arguments, as in <tt>eof</tt>, the function returns true at the end of each of the individual files on the command line. See the Perl POD documentation for examples of the circumstances in which this behavior is useful.</p>
</td>
</tr>
</tbody>
</table>
<p style="margin:0;">
<p class="docText" style="margin:0;">In practice, you do not have to use <tt>eof()</tt> except in very special circumstances, and a reliance on it is often a signal that something is amiss in the structure of your program.</p>
<p><a name="ch01lev2sec10"></a><br />
<h5 style="font-size:8pt;"><a name="1_1_4_Anarchy_at_the_End_of_th" id="1_1_4_Anarchy_at_the_End_of_th"></a>1.1.4 Anarchy at the End of the Line<br /></h5>
<p class="docText" style="margin:0;">When performing line-oriented I/O, you have to watch for different interpretations of the end-of-line character. No two operating system designers can seem to agree on how lines should end in text files. On UNIX systems, lines end with the linefeed character (LF, octal <tt>/012</tt> in the ASCII table); on Macintosh systems, they end with the carriage return character (CR, octal <tt>/015</tt>); and the Windows/DOS designers decided to end each line of text with two characters, a carriage return/linefeed pair (CRLF, or octal <tt>/015/012</tt>). Most line-oriented network servers also use CRLF to terminate lines.</p>
<p class="docText" style="margin:0;">This leads to endless confusion when moving text files between machines. Fortunately, Perl provides a way to examine and change the end-of-line character. The global variable <tt>$/</tt> contains the current character, or sequence of characters, used to signal the end of line. By default, it is set to <tt>/012</tt> on Unix systems, <tt>/015</tt> on Macintoshes, and <tt>/015/012</tt> on Windows and DOS systems.</p>
<p class="docText" style="margin:0;">The line-oriented <tt>&lt;&gt;</tt> input function will read from the specified handle until it encounters the end-of-line character(s) contained in <tt>$/</tt>, and return the line of text with the end-of-line sequence still attached. The <tt>chomp()</tt> function looks for the end-of-line sequence at the end of a text string and removes it, respecting the current value of <tt>$/</tt>.</p>
<p class="docText" style="margin:0;">The string escape <tt>/n</tt> is the <span class="docEmphasis">logical</span> newline character, and means different things on different platforms. For example, <tt>/n</tt> is equivalent to <tt>/012</tt> on UNIX systems, and to <tt>/015</tt> on Macintoshes. (On Windows systems, <tt>/n</tt> is usually <tt>/012</tt>, but see the later discussion of DOS text mode.) In a similar vein, <tt>/r</tt> is the logical carriage return character, which also varies from system to system.</p>
<p class="docText" style="margin:0;">When communicating with a line-oriented network server that uses CRLF to terminate lines, it won't be portable to set <tt>$/</tt> to <tt>/r/n</tt>. Use the explicit string <tt>/015/012</tt> instead. To make this less obscure, the Socket and IO::Socket modules, which we discuss in great detail later, have an option to export globals named <tt>$CRLF</tt> and <tt>CRLF()</tt> that return the correct values.</p>
<p class="docText" style="margin:0;">There is an additional complication when performing line-oriented I/O on Microsoft Windows and DOS machines. For historical reasons, Windows/DOS distinguishes between filehandles in "text mode" and those in "binary mode." In binary mode, what you see is exactly what you get. When you print to a binary filehandle, the data is output exactly as you specified. Similarly, read operations return the data exactly as it was stored in the file.</p>
<p class="docText" style="margin:0;">In text mode, however, the standard I/O library automatically translates LF into CRLF pairs on the way out, and CRLF pairs into LF on the way in. The virtue of this is that it makes text operations on Windows and UNIX Perls look the same—from the programmer's point of view, the DOS text files end in a single <tt>/n</tt> character, just as they do in UNIX. The problem one runs into is when reading or writing binary files—such as images or indexed databases—and the files become mysteriously corrupted on input or output. This is due to the default line-end translation. Should this happen to you, you should turn off character translation by calling <tt>binmode()</tt> on the filehandle.</p>
<p style="margin:0;">
<table cellspacing="0" width="90%" border="1" style="font-size:1em;line-height:inherit;">
<tbody>
<tr style="text-align:left;">
<td>
<p class="docText" style="margin:0;"><span class="docEmphStrong"><span class="Apple-style-span" style="font-weight:bold;"><span class="Apple-style-span" style="color:rgb(0,0,255);">binmode (FILEHANDLE [$discipline])</span></span></span></p>
<p class="docText" style="margin:0;"><span class="Apple-style-span" style="color:rgb(0,0,255);font-weight:bold;"><br /></span></p>
<p class="docText" style="margin:0;">The <tt>binmode()</tt> function turns on binary mode for a filehandle, disabling character translation. It should be called after the filehandle is opened, but before doing any I/O with it. The single-argument form turns on binary mode. The two-argument form, available only with Perl 5.6 or higher, allows you to turn binary mode on by providing <tt>:raw</tt> as the value of <tt>$discipline</tt>, or restore the default text mode using <tt>:crlf</tt> as the value.</p>
<p class="docText" style="margin:0;"><tt>binmode()</tt> only has an effect on systems like Windows and VMS, where the end-of-line sequence is more than one character. On UNIX and Macintosh systems, it has no effect.</p>
</td>
</tr>
</tbody>
</table>
<p style="margin:0;">
<p class="docText" style="margin:0;">Another way to avoid confusion over text and binary mode is to use the <tt>sysread()</tt> and <tt>syswrite()</tt> functions, which bypass the character translation routines in the standard I/O library.</p>
<p class="docText" style="margin:0;">A whole bevy of special global variables control other aspects of line-oriented I/O, such as whether to append an end-of-line character automatically to data output with the <tt>print()</tt> statement, and whether multiple data values should be separated by a delimiter. See Appendix B for a brief summary.</p>
<p><a name="ch01lev2sec11"></a><br />
<h5 style="font-size:8pt;"><a name="1_1_5_Opening_and_Closing_File" id="1_1_5_Opening_and_Closing_File"></a>1.1.5 Opening and Closing Files<br /></h5>
<p class="docText" style="margin:0;">In addition to the three standard filehandles, Perl allows you to open any number of additional filehandles. To open a file for reading or writing, use the built-in Perl function <tt>open()</tt> If successful, <tt>open()</tt> gives you a filehandle to use for the read and/or write operations themselves. Once you are finished with the filehandle, call <tt>close()</tt> to close it. This code fragment illustrates how to open the file <span class="docEmphasis">message.txt</span> for writing, write two lines of text to it, and close it:</p>
<pre>open (FH,"&gt;message.txt") or die "Can't open file: $!";
print FH "This is the first line./n";
print FH "And this is the second./n";
close (FH) or die "Can't close file: $!";
</pre>
<p class="docText" style="margin:0;">We call <tt>open()</tt> with two arguments: a filehandle name and the name of the file we wish to open. The filehandle name is any valid Perl identifier consisting of any combination of uppercase and lowercase letters, digits, and the underscore character. To make them distinct, most Perl programmers choose all uppercase letters for filehandles. The " <tt>&gt;</tt> " symbol in front of the filename tells Perl to overwrite the file's contents if it already exists, or to create the file if it doesn't. The file will then be opened for writing.</p>
<p class="docText" style="margin:0;">If <tt>open()</tt> succeeds, it returns a true value. Otherwise, it returns false, causing Perl to evaluate the expression to the right of the <tt>or</tt> operator. This expression simply dies with an error message, using Perl's <tt>$!</tt> global variable to retrieve the last system error message encountered.</p>
<p class="docText" style="margin:0;">We call <tt>print()</tt> twice to write some text to the filehandle. The first argument to <tt>print()</tt> is the filehandle, and the second and subsequent arguments are strings to write to the filehandle. Again, notice that there is no comma between the filehandle and the strings to print. Whatever is printed to a filehandle shows up in its corresponding file. If the filehandle argument to <tt>print()</tt> is omitted, it defaults to <tt>STDOUT</tt>.</p>
<p class="docText" style="margin:0;">After we have finished printing, we call <tt>close()</tt> to close the filehandle. <tt>close()</tt> returns a true value if the filehandle was closed uneventfully, or false if some untoward event, such as a disk filling up, occurred. We check this result code using the same type of <tt>or</tt> test we used earlier.</p>
<p class="docText" style="margin:0;">Let's look at <tt>open()</tt> and <tt>close()</tt> in more detail.</p>
<p style="margin:0;">
<table cellspacing="0" width="90%" border="1" style="font-size:1em;line-height:inherit;">
<tbody>
<tr style="text-align:left;">
<td>
<p class="docText" style="margin:0;"><span class="docEmphStrong"><span class="Apple-style-span" style="font-weight:bold;"><span class="Apple-style-span" style="color:rgb(0,0,255);">$success = open(FILEHANDLE,$path)</span></span></span></p>
<p class="docText" style="margin:0;"><span class="docEmphStrong"><span class="Apple-style-span" style="font-weight:bold;"><span class="Apple-style-span" style="color:rgb(0,0,255);">$success = open(FILEHANDLE,$mode,$path)</span></span></span></p>
<p class="docText" style="margin:0;"><span class="Apple-style-span" style="color:rgb(0,0,255);font-weight:bold;"><br /></span></p>
<p class="docText" style="margin:0;">The <tt>open()</tt> call opens the file given in <tt>$path</tt>, associating it with a designated <tt>FILEHANDLE</tt>. There are both two- and three-argument versions of <tt>open()</tt>. In the three-argument version, which is available in Perl versions 5.6 and higher, a <tt>$mode</tt> argument specifies how the file is to be opened. <tt>$mode</tt> is a one- or two-character string chosen to be reminiscent of the I/O redirection operators in the UNIX and DOS shells. Choices are shown here.</p>
<p style="margin:0;">
<table cellspacing="0" cellpadding="1" width="90%" border="1" style="font-size:1em;line-height:inherit;">
<tbody>
<tr style="text-align:left;">
<th class="docTableHeader" valign="top"><span class="docEmphasis">Mode</span></th>
<th class="docTableHeader" valign="top"><span class="docEmphasis">Description</span></th>
</tr>
<tr style="text-align:left;">
<td class="docTableCell" valign="top"><tt>&lt;</tt></td>
<td class="docTableCell" valign="top">Open file for reading</td>
</tr>
<tr style="text-align:left;">
<td class="docTableCell" valign="top"><tt>&gt;</tt></td>
<td class="docTableCell" valign="top">Truncate file to zero length and open for writing</td>
</tr>
<tr style="text-align:left;">
<td class="docTableCell" valign="top"><tt>&gt;&gt;</tt></td>
<td class="docTableCell" valign="top">Open file for appending, do not truncate</td>
</tr>
<tr style="text-align:left;">
<td class="docTableCell" valign="top"><tt>+&gt;</tt></td>
<td class="docTableCell" valign="top">Truncate file and then open for read/write</td>
</tr>
<tr style="text-align:left;">
<td class="docTableCell" valign="top"><tt>&lt;+</tt></td>
<td class="docTableCell" valign="top">Open file for read/write, do not truncate</td>
</tr>
</tbody>
</table>
<p style="margin:0;">
</td>
</tr>
</tbody>
</table>
<p style="margin:0;">
<p class="docText" style="margin:0;">We can open the file named <span class="docEmphasis">darkstar.txt</span> for reading and associate it with the filehandle <tt>DARKFH</tt> like this:</p>
<pre>open(DARKFH,'&lt;','darkstar.txt');
</pre>
<p class="docText" style="margin:0;">In the two-argument form of <tt>open()</tt>, the mode is appended directly to the filename, as in:</p>
<pre>open(DARKFH,'&lt;darkstar.txt');
</pre>
<p class="docText" style="margin:0;">For readability, you can put any amount of whitespace between the mode symbol and the filename; it will be ignored. If you leave out the mode symbol, the file will be opened for reading. Hence the above examples are all equivalent to this:</p>
<pre>open(DARKFH,'darkstar.txt');
</pre>
<p class="docText" style="margin:0;">If successful, <tt>open()</tt> will return a true value. Otherwise it returns false. In the latter case, the <tt>$!</tt> global will contain a human-readable message indicating thecause of the error.</p>
<p style="margin:0;">
<table cellspacing="0" width="90%" border="1" style="font-size:1em;line-height:inherit;">
<tbody>
<tr style="text-align:left;">
<td>
<p class="docText" style="margin:0;"><span class="docEmphStrong"><span class="Apple-style-span" style="font-weight:bold;"><span class="Apple-style-span" style="color:rgb(0,0,255);">$success = close(FH);</span></span></span></p>
<p class="docText" style="margin:0;"><span class="Apple-style-span" style="color:rgb(0,0,255);font-weight:bold;"><br /></span></p>
<p class="docText" style="margin:0;">The <tt>close()</tt> function closes a previously opened file, returning true if successful, or false otherwise. In the case of an error, <span class="Apple-style-span" style="text-decoration:underline;">the error message can again be found in </span><tt><span class="Apple-style-span" style="text-decoration:underline;"><span class="Apple-style-span" style="font-weight:bold;"><span class="Apple-style-span" style="color:rgb(255,0,0);">$!</span></span></span></tt><span class="Apple-style-span" style="text-decoration:underline;">.</span></p>
<p class="docText" style="margin:0;">When your program exits, any filehandles that are still open will be closed automatically.</p>
</td>
</tr>
</tbody>
</table>
<p style="margin:0;">
<p class="docText" style="margin:0;">The three-argument form of <tt>open()</tt> is used only rarely. However, it has the virtue of not scanning the filename for special characters the way that the two-argument form does. This lets you open files whose names contain leading or trailing whitespace, "&gt;" characters, and other weird and arbitrary data. The filename "-" is special. When opened for reading, it tells Perl to open standard input. When opened for writing, it tells Perl to open standard output.</p>
<p class="docText" style="margin:0;">If you call <tt>open()</tt> on a filehandle that is already open, it will be automatically closed and then reopened on the file that you specify. Among other things, this call can be used to reopen one of the three standard filehandles on the file of your choice, changing the default source or destination of the <tt>&lt;&gt;</tt>, <tt>print()</tt>, and <tt>warn()</tt> functions. We will see an example of this shortly.</p>
<p class="docText" style="margin:0;">As with the <tt>print()</tt> function, many programmers drop the parentheses around <tt>open()</tt> and <tt>close()</tt>. For example, this is the most common idiom for opening a file:</p>
<pre>open DARKSTAR,"darkstar.txt" or die "Couldn't open darkstar.txt: $!"
</pre>
<p class="docText" style="margin:0;">I don't like this style much because it leads to visual ambiguity (does the <tt>or</tt> associate with the string "darkstar.txt" or with the <tt>open()</tt> function?). However, I do use this style with<tt>close()</tt>, <tt>print()</tt>, and <tt>return()</tt> because of their ubiquity.</p>
<p class="docText" style="margin:0;">The two-argument form of <tt>open()</tt> has a lot of magic associated with it (too much magic, some would say). The full list of magic behavior can be found in the <span class="docEmphasis">perlfunc</span> and <span class="docEmphasis">perlopentut</span> POD documentation. However, one trick is worth noting because we use it in later chapters. You can <span class="docEmphasis">duplicate</span> a filehandle by using it as the second argument to <tt>open()</tt> with the sequence <tt>&gt;&amp;</tt> or <tt>&lt;&amp;</tt> prepended to the beginning. <tt>&gt;&amp;</tt> duplicates filehandles used for writing, and <tt>&lt;&amp;</tt> duplicates those used for reading:</p>
<pre>open (OUTCOPY,"&gt;&amp;STDOUT");
open (INCOPY,"&lt;&amp;STDOUT");
</pre>
<p class="docText" style="margin:0;">This example creates a new filehandle named <tt>OUTCOPY</tt> that is attached to the same device as <tt>STDOUT</tt>. You can now write to <tt>OUTCOPY</tt> and it will have the same effect as writing to <tt>STDOUT</tt>. This is useful when you want to replace one or more of the three standard filehandles temporarily, and restore them later. For example, this code fragment will temporarily reopen <tt>STDOUT</tt> onto a file, invoke the system <span class="docEmphasis">date</span> command (using the <tt>system()</tt> function, which we discuss in more detail in <a class="docLink">Chapter 2</a>), and then restore the previous value of <tt>STDOUT</tt>. When <span class="docEmphasis">date</span> runs, its standard output is opened on the file, and its output appears there rather than in the command window:</p>
<pre>#!/usr/bin/perl
# file: redirect.pl

print "Redirecting STDOUT/n";
open (SAVEOUT,"&gt;&amp;STDOUT");
open (STDOUT,"&gt;test.txt") or die "Can't open test.txt: $!";

print "STDOUT is redirected/n";
system "date";

open (STDOUT,"&gt;&amp;SAVEOUT");
print "STDOUT restored/n";
</pre>
<p class="docText" style="margin:0;">When this script runs, its output looks like this:</p>
<pre>% redirect.pl
Redirecting STDOUT
STDOUT restored
</pre>
<p class="docText" style="margin:0;">and the file <span class="docEmphasis">test.txt</span> contains these lines:</p>
<pre>STDOUT is redirected
Thu Aug 10 09:19:24 EDT 2000
</pre>
<p class="docText" style="margin:0;">Notice how the second <tt>print()</tt> statement and the output of the <span class="docEmphasis">date</span> system command went to the file rather than to the screen because we had reopened <tt>STDOUT</tt> at that point. When we restored <tt>STDOUT</tt> from the copy saved in <tt>SAVEOUT</tt>, our ability to print to the terminal was restored.</p>
<p class="docText" style="margin:0;">Perl also provides an alternative API for opening files that avoids the magic and obscure syntax of <tt>open()</tt> altogether. The <tt>sysopen()</tt> function allows you to open files using the same syntax as the C library's <tt>open()</tt> function.</p>
<p style="margin:0;">
<table cellspacing="0" width="90%" border="1" style="font-size:1em;line-height:inherit;">
<tbody>
<tr style="text-align:left;">
<td>
<p class="docText" style="margin:0;"><span class="docEmphStrong"><span class="Apple-style-span" style="font-weight:bold;"><span class="Apple-style-span" style="color:rgb(0,0,255);">$result = sysopen (FILEHANDLE,$filename,$mode [,$perms])</span></span></span></p>
<p class="docText" style="margin:0;"><span class="Apple-style-span" style="color:rgb(0,0,255);font-weight:bold;"><br /></span></p>
<p class="docText" style="margin:0;">The <tt>sysopen()</tt> function opens the file indicated by <tt>$filename</tt>, using the I/O mode indicated by <tt>$mode</tt>. If the file doesn't exist, and <tt>$mode</tt> indicates that the file should be created, then the optional <tt>$perms</tt> value specifies the permission bits for the newly created file. We discuss I/O modes and permissions in more detail below.</p>
<p class="docText" style="margin:0;">If successful, <tt>sysopen()</tt> returns a true result and associates the opened file with <tt>FILEHANDLE</tt>. Otherwise it returns a false result and leaves the error message in <tt>$!</tt>.</p>
</td>
</tr>
</tbody>
</table>
<p style="margin:0;">
<p class="docText" style="margin:0;">The <tt>$mode</tt> argument used in <tt>sysopen()</tt> is different from the mode used in ordinary <tt>open()</tt>. Instead of being a set of characters, it is a numeric bitmask formed by ORing together one or more constants using the bitwise <tt>OR</tt> operator " <tt>|</tt> ". For example, the following snippet opens up a file for writing using a mode that causes it to be created if it doesn't exist, and truncated to length zero if it does (equivalent to <tt>open()</tt>'s " <tt>&gt;</tt> " mode):</p>
<pre>sysopen(FH, "darkstar.txt",O_WRONLY|O_CREAT|O_TRUNC)
      or die "Can't open: $!"
</pre>
<p class="docText" style="margin:0;">The standard <tt>Fcntl</tt> module exports the constants recognized by <tt>sysopen()</tt>, all of which begin with the prefix <tt>O_</tt>. Just use <tt>Fcntl</tt> at the top of your script togain access to them.</p>
<p class="docText" style="margin:0;">The mode constants useful for <tt>sysopen()</tt> are listed in <a class="docLink">Table 1.1</a>. Each call to <tt>sysopen()</tt> must have one (and only one) of <tt>O_RDONLY</tt>, <tt>O_WRONLY</tt>, and <tt>O_RDWR</tt>. The <tt>O_WRONLY</tt> and <tt>O_RDWR</tt> constants may be ORed with one or more of <tt>O_CREAT</tt>, <tt>O_EXCL</tt>, <tt>O_TRUNC</tt>, or <tt>O_APPEND</tt>.</p>
<p class="docText" style="margin:0;"><tt>O_CREAT</tt> causes the file to be created if it doesn't already exist. If it isn't specified, and the file doesn't exist when you try to open it for writing, then <tt>sysopen()</tt> will fail.</p>
<p class="docText" style="margin:0;">Combining <tt>O_CREAT</tt> with <tt>O_EXCL</tt> leads to the useful behavior of creating the file if it doesn't already exist, but failing if it does. This can be used to avoid accidentally clobbering an existing file.</p>
<p class="docText" style="margin:0;">If <tt>O_TRUNC</tt> is specified, then the file is truncated to zero length before the first write, effectively overwriting the previous contents. <tt>O_APPEND</tt> has the opposite effect, positioning the write pointer to the end of the file so that everything written to the file is appended to its existing contents.</p>
<p><a name="ch01table01"></a>
<p style="margin:0;"></p>
<p>
<div style="text-align:center;margin-top:0;margin-bottom:0;">Table 1.1. sysopen() Mode Constants</div>
<table cellspacing="0" cellpadding="1" width="100%" border="1" style="font-size:1em;line-height:inherit;">
<tbody>
<tr style="text-align:left;">
<th class="docTableHeader" valign="top"><span class="docEmphasis">Constant</span></th>
<th class="docTableHeader" valign="top"><span class="docEmphasis">Description</span></th>
</tr>
<tr style="text-align:left;">
<td class="docTableCell" valign="top"><tt>O_RDONLY</tt></td>
<td class="docTableCell" valign="top">Open read only.</td>
</tr>
<tr style="text-align:left;">
<td class="docTableCell" valign="top"><tt>O_WRONLY</tt></td>
<td class="docTableCell" valign="top">Open write only.</td>
</tr>
<tr style="text-align:left;">
<td class="docTableCell" valign="top"><tt>O_RDWR</tt></td>
<td class="docTableCell" valign="top">Open read/write.</td>
</tr>
<tr style="text-align:left;">
<td class="docTableCell" valign="top"><tt>O_CREAT</tt></td>
<td class="docTableCell" valign="top">Create file if it doesn't exist.</td>
</tr>
<tr style="text-align:left;">
<td class="docTableCell" valign="top"><tt>O_EXCL</tt></td>
<td class="docTableCell" valign="top">When combined with <tt>O_CREAT</tt>, create file if it doesn't exist and fail if it does.</td>
</tr>
<tr style="text-align:left;">
<td class="docTableCell" valign="top"><tt>O_TRUNC</tt></td>
<td class="docTableCell" valign="top">If file already exists, truncate it to zero.</td>
</tr>
<tr style="text-align:left;">
<td class="docTableCell" valign="top"><tt>O_APPEND</tt></td>
<td class="docTableCell" valign="top">Open file in append mode (equivalent to <tt>open()</tt>'s " <tt>&gt;&gt;</tt> ").</td>
</tr>
<tr style="text-align:left;">
<td class="docTableCell" valign="top"><tt>O_NOCTTY</tt></td>
<td class="docTableCell" valign="top">If the file is a terminal device, open it without allowing it to become the process's controlling terminal.</td>
</tr>
<tr style="text-align:left;">
<td class="docTableCell" valign="top"><tt>O_NONBLOCK</tt></td>
<td class="docTableCell" valign="top">Open file in nonblockingmode.</td>
</tr>
<tr style="text-align:left;">
<td class="docTableCell" valign="top"><tt>O_SYNC</tt></td>
<td class="docTableCell" valign="top">Open file for synchronous mode, so that all writes block until the data is physically written.</td>
</tr>
</tbody>
</table>
<p style="margin:0;">
<p class="docText" style="margin:0;">The <tt>O_NOCTTY</tt>, <tt>O_NONBLOCK</tt>, and <tt>O_SYNC</tt> modes all have specialized uses that are discussed in later chapters.</p>
<p class="docText" style="margin:0;">If <tt>sysopen()</tt> needs to create a file, the <tt>$perm</tt> argument specifies the permissions mode of the resulting file. File permissions is a UNIX concept that maps imperfectly onto the Windows/DOS world, and not at all onto the Macintosh world. It is an octal value, such as <tt>0644</tt> (which happens to specify read/write permissions for the owner of the file, and read-only permissions for others).</p>
<p class="docText" style="margin:0;">If <tt>$perm</tt> is not provided, <tt>sysopen()</tt> defaults to <tt>0666</tt>, which grants read/write access to everyone. However, whether you specify the permissions or accept the default, the actual permissions of the created file are determined by performing the bitwise AND between the <tt>$perm</tt> argument and the current contents of the user's <span class="docEmphasis">umask</span> (another UNIX concept). This is often set, at the user's discretion, to forbid access to the file from outside the user's account or group.</p>
<p class="docText" style="margin:0;">In most circumstances, it is best to omit the permissions argument and let the user adjust the <span class="docEmphasis">umask</span>. This also increases the portability of the program. See the <tt>umask()</tt> entry in the <span class="docEmphasis">perlfunc</span> POD documentation for information on how you can examine and set the umask programatically.</p>
<p><a name="ch01lev2sec12"></a><br />
<h5 style="font-size:8pt;"><a name="1_1_6_Buffering_and_Blocking_" id="1_1_6_Buffering_and_Blocking_"></a>1.1.6 Buffering and Blocking<br /></h5>
<p class="docText" style="margin:0;">When you <tt>print()</tt> or <tt>syswrite()</tt> to a filehandle, the actual output operation does not occur immediately. If you are writing to a file, the system has to wait for the write head to reach the proper location on the disk drive, and for the spinning platter to bring the proper location under the head. This is usually an insignificant length of time (although it may be quite noticeable on a laptop that intermittently spins down its disk to save battery power), but other output operations can take much more time. In particular, network operations may take a considerable length of time to complete. The same applies to input.</p>
<p class="docText" style="margin:0;">There is a fundamental mismatch between computational speed and I/O speed. A program can execute the contents of a tight loop a million times a second, but a single I/O operation may take several seconds to complete. To overcome this mismatch, modern operating systems use the techniques of buffering and blocking.</p>
<p class="docText" style="margin:0;">The idea behind buffering is shown in <a class="docLink">Figure 1.3</a>. Buffers decouple the I/O calls invoked by the program from the actual I/O operations that occur at the hardware level. A call to <tt>print()</tt>, for example, doesn't send data directly to the terminal, network card, or disk drive, but instead it results in data being written to a memory area. This occurs quickly, because writes to memory are fast. Meanwhile, in an asynchronous fashion, the operating system reads from data previously written to the buffer and performs the actions necessary to write the information to the hardware device.</p>
<p>Figure 1.3. Buffers help solve the mismatch between computation speed and I/O speed
<p class="docText" style="margin:0;"></p>
<div id="r:n9" style="text-align:center;margin-top:0;margin-bottom:0;padding:1em 0;"><a target="_blank" href="http://docs.google.com/File?id=dd6nw3mt_211c67qrqfz_b"><img src="http://docs.google.com/File?id=dd6nw3mt_211c67qrqfz_b" style="width:500px;height:512px;border-style:initial;border-color:initial;border-width:0;" /></a></div>
<p style="margin:0;">
<p class="docText" style="margin:0;">Similarly, for input operations, the operating system receives data from active input devices (the keyboard, disk drive, network card) and writes that data to an input buffer somewhere in memory. The data remains in the input buffer until your program calls <tt>&lt;&gt;</tt> or <tt>read()</tt>, at which point the data is copied from the operating system's buffer into the memory space corresponding to a variable in your program.</p>
<p class="docText" style="margin:0;">The advantage of buffering is significant, particularly if your program performs I/O in a "bursty" way; that is, it performs numerous reads and writes of unpredictable size and timing. Instead of waiting for each operation to complete at the hardware level, the data is safely buffered in the operating system and "flushed"—passed on to the output device—whenever the downstream hardware can accept it.</p>
<p class="docText" style="margin:0;">The buffers in <a class="docLink">Figure 1.3</a> are conceptually circular FIFO (first in first out) data structures. When data is written beyond the end of the buffer memory area, the operating system merely begins writing new data at the beginning. The operating system maintains two pointers in each of its I/O buffers. The write pointer is the place where new data enters the buffer. The read pointer is the position from which stored data is moved out of the buffer to its next destination. For example, on write operations, each <tt>print()</tt> you perform adds some data to the output buffer and advances the write pointer forward. The operating system reads older data starting at the read pointer and copies it to the low-level hardware device.</p>
<p class="docText" style="margin:0;">The size of the I/O buffer minus the distance between the write pointer and the read pointer is the amount of free space remaining. If your program is writing faster than the output hardware can receive it, then the buffer will eventually fill up and the buffer's free space will be zero. What happens then?</p>
<p class="docText" style="margin:0;">Because there is no room for new data in the buffer, the output operation cannot succeed immediately. As a result, the write operation blocks. Your program will be suspended at the blocked <tt>print()</tt> or <tt>syswrite()</tt> for an indefinite period of time. When the backlog in the output buffer clears and there is again room to receive new data, the output operation will unblock and <tt>print()</tt> or <tt>syswrite()</tt> will return.</p>
<p class="docText" style="margin:0;">In a similar fashion, reads will block when the input buffer is empty; that is, it blocks when the amount of free space is equal to the size of the buffer. In this case, calls to <tt>read()</tt> or <tt>sysread()</tt> will block until some new data has entered the buffer and there is something to be read.</p>
<p class="docText" style="margin:0;">Blocking is often the behavior you want, but sometimes you need more control over I/O. There are several techniques to manage blocking. One technique, discussed in <a class="docLink">Chapter 2</a> under Timing Out System Calls, uses signals to abort an I/O operation prematurely if it takes too long. Another technique, discussed in <a class="docLink">Chapter 12</a>, uses the four-argument <tt>select()</tt> system call to test a filehandle for its readiness to perform I/O before actually making the read or write call. A third technique, discussed in <a class="docLink">Chapter 13</a>, is to mark the filehandle as nonblocking, which causes the read or write operation to return immediately with an error code if the operation would block.</p>
<p><a name="ch01lev2sec13"></a><br />
<h5 style="font-size:8pt;"><a name="1_1_7_Standard_I_O_Buffering_" id="1_1_7_Standard_I_O_Buffering_"></a>1.1.7 Standard I/O Buffering<br /></h5>
<p class="docText" style="margin:0;">Although we have spoken of a single buffer for I/O operations on a filehandle, there may in fact be several buffers at different layers of the operating system. For example, when writing to a disk file, there is a very low-level buffer on the disk hardware itself, another one in the SCSI or IDE driver that controls the disk, a third in the driver for the filesystem, and a fourth in the standard C library used by Perl. I may have missed a few.</p>
<p class="docText" style="margin:0;">You cannot control or even access most of these buffers directly, but there is one class of buffer that you should be aware of. Many of Perl's I/O operations flow through "stdio," a standard C-language library which maintains its own I/O buffers independent of the operating system's.<sup class="docFootnote"><a class="docLink">[1]</a></sup></p>
<blockquote style="border-color:rgb(221,221,221);border-style:dashed;border-width:1px;padding:10px;"><p class="docFootnote" style="margin:0;"><sup><a name="ch01fn01">[1]</a></sup> You can think of the stdio library as a layersitting on top of the OS, making the OS look more C-like to programs; similarly, a Pascal standard I/O library makes the OS look as if it were written in Pascal.</p>
</blockquote>
<p class="docText" style="margin:0;">Perl's <tt>&lt;&gt;</tt> operator, <tt>read()</tt>, and <tt>print()</tt> all use stdio. When you call <tt>print()</tt>, the data is transferred to an output buffer in the stdio layer before being sent to the operating system itself. Likewise, <tt>&lt;&gt;</tt> and <tt>read()</tt> both read data from an stdio buffer rather than directly from the OS. Each filehandle has its own set of buffers for input and output. For efficiency reasons, stdio waits until its output buffers reach a certain size before flushing their contents to the OS.</p>
<p class="docText" style="margin:0;">Normally, the presence of the stdio buffering is not a problem, but it can run you into trouble when doing more sophisticated types of I/O such as network operations. Consider the common case of an application that requires you to write a small amount of data to a remote server, wait for a response, and then send more data. You may think that the data has been sent across the network, but in fact it may not have been. The output data may still be sitting in its local stdio buffer, waiting for more data to come before flushing the buffer. The remote server will never receive the data, and so will never return a response. Your program will never receive a response and so will never send additional data. Deadlock ensues.</p>
<p class="docText" style="margin:0;">In contrast, the lower-level buffering performed by the operating system doesn't have this property. The OS will always attempt to deliver whatever data is in its output buffers as soon as the hardware can accept it.</p>
<p class="docText" style="margin:0;">There are two ways to work around stdio buffering. One is to turn on "autoflush" mode for the filehandle. Autoflush mode applies only to output operations. When active, Perl tells stdio to flush the filehandle's buffer every time <tt>print()</tt> is called.</p>
<p class="docText" style="margin:0;">To turn on autoflush mode, set the special variable <tt>$|</tt> to a true value. Autoflush mode affects the currently selected filehandle, so to change autoflush mode for a specific filehandle, one must first <tt>select()</tt> it, set <tt>$|</tt> to true, and then <tt>select()</tt> the previously selected filehandle. For example, to turn on autoflush mode for filehandle <tt>FH</tt>:</p>
<pre>my $previous = select(FH);
$| = 1;
select($previous);
</pre>
<p class="docText" style="margin:0;">You will sometimes see this motif abbreviated using the following mind-blowing idiom:</p>
<pre>select((select(FH),$|=1)[0]);
</pre>
<p class="docText" style="margin:0;">However, it is much cleaner to bring in the <tt>IO::Handle</tt> module, which adds an <tt>autoflush()</tt> method to filehandles. With <tt>IO::Handle</tt> loaded, <tt>FH</tt> can be put into autoflush mode like this:</p>
<pre>use IO::Handle;
FH-&gt;autoflush(1);
</pre>
<p class="docText" style="margin:0;">If the OO syntax confuses you, see the Objects and References section later in this chapter.</p>
<p class="docText" style="margin:0;">The other way to avoid stdio buffering problems is to use the <tt>sysread()i</tt> and <tt>syswrite()</tt> calls. These calls bypass the stdio library and go directly to the operating system I/O calls. An important advantage of these calls is that they interoperate well with other low-level I/O calls, such as the four-argument <tt>select()</tt> call, and with advanced techniques such as nonblocking I/O.</p>
<p class="docText" style="margin:0;">Another ramification of the fact that the <tt>sys*()</tt> functions bypass stdio is the difference in behavior between <tt>read()</tt> and <tt>sysread()</tt> when asked to fetch a larger chunk of data than is available. In the case of <tt>read()</tt>, the function will block indefinitely until it can fetch exactly the amount of data requested. The only exception to this is when the filehandle encounters the end of file before the full request has been satisfied, in which case <tt>read()</tt> will return everything to the end of the file. In contrast, <tt>sysread()</tt> can and will return partial reads. If it can't immediately read the full amount of data requested, it will return the data that is available. If no data is available, <tt>sysread()</tt> will block until it can return at least 1 byte. This behavior makes <tt>sysread()</tt> invaluable for use in network communications, where data frequently arrives in chunks of unpredictable size.</p>
<p class="docText" style="margin:0;">For these reasons, <tt>sysread()</tt> and <tt>syswrite()</tt> are preferred for many network applications.</p>
<p><a name="ch01lev2sec14"></a><br />
<h5 style="font-size:8pt;"><a name="1_1_8_Passing_and_Storing_File" id="1_1_8_Passing_and_Storing_File"></a>1.1.8 Passing and Storing Filehandles<br /></h5>
<p class="docText" style="margin:0;">Network applications frequently must open multiple filehandles simultaneously, pass them to subroutines, and keep track of them in hashes and other data structures. Perl allows you to treat filehandles as strings, store them into variables, and pass them around to subroutines. For example, this functional but flawed code fragment stores the <tt>MY_FH</tt> filehandle into a variable named <tt>$fh</tt>, and then passes it to a subroutine named <tt>hello()</tt> to use in printing a friendly message:</p>
<pre># Flawed technique
$fh = MY_FH;
hello($fh);
sub hello {
  my $handle = shift;
  print $handle "Howdy folks!/n";
}
</pre>
<p class="docText" style="margin:0;">This technique often works; however, it will run you into problems as soon asyou try to pass filehandles to subroutines in other packages, such as functions exported by modules. The reason is that passing filehandles as strings loses the filehandle package information. If we pass the filehandle <tt>MY_FH</tt> from the main script (package <tt>main</tt>) to a subroutine defined in the <tt>MyUtils</tt> module, the subroutine will try to access a filehandle named <tt>MyUtils::MY_FH</tt> rather than the true filehandle, which is <tt>main::MY_FH</tt>. The same problem also occurs, of course, when a subroutine from one package tries to return a filehandle to a caller from another package.</p>
<p class="docText" style="margin:0;">The correct way to move filehandles around is as a <span class="docEmphasis">typeglob</span> or a <span class="docEmphasis">typeglob reference.</span> Typeglobs are symbol table entries, but you don't need to know much more about them than that in order to use them (see the <span class="docEmphasis">perlref</span> POD documentation for the full details). To turn a filehandle into a glob put an asterisk ("*") in front of its name:</p>
<pre>$fh = *MY_FH;
</pre>
<p class="docText" style="margin:0;">To turn a filehandle into a typeglob reference, put "/*" in front of its name:</p>
<pre>$fh = /*MY_FH;
</pre>
<p class="docText" style="margin:0;">In either case, <tt>$fh</tt> can now be used to pass the filehandle back and forth between subroutines and to store filehandles in data structures. Of the two forms, the glob reference (<tt>/*HANDLE</tt>) is the safer, because there's less risk of accidentally writing to the variable and altering the symbol table. This is the form we use throughout this book, and the one used by Perl's I/O-related modules, such as IO::Socket.</p>
<p class="docText" style="margin:0;">Typeglob references can be passed directly to subroutines:</p>
<pre>hello(/*MY_FH):
</pre>
<p class="docText" style="margin:0;">They can also be returned directly by subroutines:</p>
<pre>my $fh = get_fh();
sub get_fh {
   open (FOO,"foo.txt") or die "foo: $!";
   return /*FOO;
}
</pre>
<p class="docText" style="margin:0;">Typeglob refs can be used anywhere a bare filehandle is accepted, including as the first argument to <tt>print()</tt>, <tt>read()</tt>, <tt>sysread()</tt>, <tt>syswrite()</tt>, or any of the socket-related calls that we discuss in later chapters.</p>
<p class="docText" style="margin:0;">Sometimes you will need to examine a scalar variable to determine whether it contains a valid filehandle. The <tt>fileno()</tt> function makes this possible:</p>
<p style="margin:0;">
<table cellspacing="0" width="90%" border="1" style="font-size:1em;line-height:inherit;">
<tbody>
<tr style="text-align:left;">
<td>
<p class="docText" style="margin:0;"><span class="Apple-style-span" style="font-weight:bold;"><span class="Apple-style-span" style="color:rgb(0,0,255);">$integer = fileno (FILEHANDLE)</span></span></p>
<p class="docText" style="margin:0;"><span class="Apple-style-span" style="color:rgb(0,0,255);font-weight:bold;"><br /></span></p>
<p class="docText" style="margin:0;">The <tt>fileno()</tt> function accepts a filehandle in the form of a bare string, a typeglob, or a typeglob reference. If the filehandle is valid, <tt>fileno()</tt> returns the <span class="docEmphasis">file descriptor</span> for the filehandle. This is a small integer that uniquely identifies the filehandle to the operating system. <tt>STDIN</tt>, <tt>STDOUT</tt>, and <tt>STDERR</tt> generally correspond to descriptors 0, 1, and 2, respectively (but this can change if you close and reopen them). Other filehandles have descriptors greater than 3.</p>
<p class="docText" style="margin:0;">If the argument passed to <tt>fileno()</tt> does not correspond to a valid filehandle (including former filehandles that have been closed), <tt>fileno()</tt> returns <tt>undef</tt>. Here is the idiom for checking whether a scalar variable contains a filehandle:</p>
<pre>die "not a filehandle" unless defined fileno($fh);
</pre>
</td>
</tr>
</tbody>
</table>
<p style="margin:0;">
<p><a name="ch01lev2sec15"></a><br />
<h5 style="font-size:8pt;"><a name="1_1_9_Detecting_Errors_" id="1_1_9_Detecting_Errors_"></a>1.1.9 Detecting Errors<br /></h5>
<p class="docText" style="margin:0;">Because of the vicissitudes of Internet communications, I/O errors are common in network applications. As a rule, each of the Perl functions that performs I/O returns <tt>undef</tt>, a false value, on failure. More specific information can be found by examining the special global variable <tt>$!</tt>.</p>
<p class="docText" style="margin:0;"><tt>$!</tt> has an interesting dual nature. Treated as a string, it will return a human-readable error message such as <tt>Permission denied</tt>. Treated as a number, however, it will return the numeric constant for the error, as defined by the operating system (e.g., <tt>EACCES</tt>). It is generally more reliable to use these numeric error constants to distinguish particular errors, because they are standardized across operating systems.</p>
<p class="docText" style="margin:0;">You can obtain the values of specific error message constants by importing them from the <tt>Errno</tt> module. In the <tt>use</tt> statement, you can import individual constants by name, or all of them at once. To bring in individual constants, list them in the <tt>use()</tt> statement, as shown here:</p>
<pre>use Errno qw(EACCES ENOENT);
my $result = open (FH,"&gt;/etc/passwd");
if (!$result) { # oops, something went wrong
   if ($! == EACCESS) {
      warn "You do not have permission to open this file.";
   } elsif ($! == ENOENT) {
      warn "File or directory not found.";
   } else {
      warn "Some other error occurred: $!";
   }
}
</pre>
<p class="docText" style="margin:0;">The <tt>qw()</tt> operator is used to split a text string into a list of words. The first line above is equivalent to:</p>
<pre>use Errno ('EACCESS','ENOENT');
</pre>
<p class="docText" style="margin:0;">and brings in the <tt>EACCESS</tt> and <tt>ENOENT</tt> constants. Notice that we use the numeric comparison operator " <tt>==</tt> " when comparing <tt>$!</tt> to numeric constants.</p>
<p class="docText" style="margin:0;">To bring in all the common error constants, import the tag <tt>:POSIX</tt>. Thisbrings in the error constants that are defined by the POSIX standard, across-platform API that UNIX, Windows NT/2000, and many other operating systems are largely compliant with. For example:</p>
<pre>use Errno qw(:POSIX);
</pre>
<p class="docText" style="margin:0;">Do not get into the habit of testing <tt>$!</tt> to see if an error occurred during the last operation. <tt>$!</tt> is set when an operation fails, but is not unset when an operation succeeds. The value of <tt>$!</tt> should be relied on only immediately after a function has indicated failure.</p>
<p style="margin:0;">
<h4 style="font-size:10pt;"><a name="1_2_" id="1_2_"></a>1.2 Using Object-Oriented Syntax with the IO::Handle and IO::File Modules<br /></h4>
<p style="margin:0;">
<h5 style="font-size:8pt;">1.2.1 Objects and References<br /></h5>
<p class="docText" style="margin:0;">In Perl, references are pointers to data structures. You can create a reference to an existing data structure using the backslash operator. For example:</p>
<pre>$a = 'hi there';
$a_ref = /$a; # reference to a scalar
@b = ('this','is','an','array');
$b_ref = /@b; # reference to an array
%c = ( first_name =&gt; 'Fred', last_name =&gt; 'Jones');
$c_ref = /%c; # reference to a hash
</pre>
<p class="docText" style="margin:0;">Once a reference has been created, you can make copies of it, as you would any regular scalar, or stuff it into arrays or hashes. When you want to get to the data contained inside a reference, you dereference it using the prefix appropriate for its contents:</p>
<pre>$a = $$a_ref;
@b = @$b_ref;
%c = %$c_ref;
</pre>
<p class="docText" style="margin:0;">You can index into array and hash references without dereferencing the whole thing by using the <tt>-&gt;</tt> syntax:</p>
<pre>$b_ref-&gt;[2];          # yields "an"
$c_ref-&gt;{last_name};  # yields "Jones"
</pre>
<p class="docText" style="margin:0;">It is also possible to create references to anonymous, unnamed arrays and hashes, using the following syntax:</p>
<pre>$anonymous_array = ['this','is','an','anonymous','array'];
$anonymous_hash  = { first_name =&gt;'Jane', last_name =&gt; 'Doe' };
</pre>
<p class="docText" style="margin:0;">If you try to print out a reference, you'll get a string like <tt>HASH(0x82ab0e0)</tt>, which indicates the type of reference and the memory location where it can be found (which is just short of useless).</p>
<p class="docText" style="margin:0;">An <span class="docEmphasis">object</span> is a reference with just a little bit extra. It is "blessed" into a particular module's package in such a way that it carries information about what module created it.<sup class="docFootnote"><a class="docLink">[2]</a></sup> The blessed reference will continue to work just like other references. For example, if the object named <tt>$object</tt> is a blessed hash reference, you can index into it like this:</p>
<blockquote style="border-color:rgb(221,221,221);border-style:dashed;border-width:1px;padding:10px;"><p class="docFootnote" style="margin:0;"><sup><a name="ch01fn02">[2]</a></sup> The function responsible for turning ordinary references into blessed ones is, naturally enough, called <span class="docEmphStrong">bless()</span>.</p>
</blockquote>
<pre>$object-&gt;{last_name};
</pre>
<p class="docText" style="margin:0;">What makes objects different from plain references is that they have <span class="docEmphasis">methods</span>. A method call uses the <tt>-&gt;</tt> notation, but followed by a subroutine name and optional subroutine-style arguments:</p>
<pre>$object-&gt;print_record(); # invoke the print_record() method
</pre>
<p class="docText" style="margin:0;">You may sometimes see a method called with arguments, like this:</p>
<pre>$object-&gt;print_record(encoding =&gt; 'EBCDIC');
</pre>
<p class="docText" style="margin:0;">The "=&gt;" symbol is accepted by Perl as a synonym for ','. It makes the relationship between the two arguments more distinct, and has the added virtue of automatically quoting the argument on the left. This allows us to write encoding rather than <span class="docEmphasis">"encoding"</span>. If a method takes no arguments, it's often written with the parentheses omitted, as in:</p>
<pre>$object-&gt;print_record;
</pre>
<p class="docText" style="margin:0;">In many cases, <tt>print_record()</tt> will be a subroutine defined in the object's package. Assuming that the object was created by a module named BigDatabase, the above is just a fancy way of saying this:</p>
<pre>BigDatabase::print_record($object);
</pre>
<p class="docText" style="margin:0;">However, Perl is more subtle than this, and the <tt>print_record()</tt>, method definition might actually reside in another module, which the current module <span class="docEmphasis">inherits</span> from. How this works is beyond the scope of this introduction, and can be found in the <span class="docEmphasis">perltoot</span>, <span class="docEmphasis">perlobj</span>, and <span class="docEmphasis">perlref</span> POD pages, as well as in [Wall 2000] and the other general Perl reference works listed in Appendix D.</p>
<p class="docText" style="margin:0;">To create an object, you must invoke one of its <span class="docEmphasis">constructors</span>. A constructor is a method call that is invoked from the module's name. For example, to create a new BigDatabase object:</p>
<pre>$object = BigDatabase-&gt;new(); # call the new() constructor
</pre>
<p class="docText" style="margin:0;">Constructors, which are a special case of a <span class="docEmphasis">class method,</span> are frequently named <tt>new()</tt>. However, any subroutine name is possible. Again, this syntax is part trickery. In most cases an equivalent call would be:</p>
<pre>$object = BigDatabase::new('BigDatabase');
</pre>
<p class="docText" style="margin:0;">This is not quite the same thing, however, because class methods can also be inherited.</p>
<p><a name="ch01lev2sec17"></a><br />
<h5 style="font-size:8pt;">1.2.2 The IO::Handle and IO::File Modules<br /></h5>
<p class="docText" style="margin:0;">The IO::Handle and IO::File modules, standard components of Perl, together provide object-oriented interface to filehandles. IO::Handle provides generic methods that are shared by all filehandle objects, including pipes and sockets. The more specialized class, IO::File, adds functionality for opening and manipulating files. Together, these classes smooth out some of the bumps and irregularities in Perl's built-in filehandles, and make larger programs easier to understand and maintain.</p>
<p class="docText" style="margin:0;">IO::File's elegance does not by itself provide any very compelling reason to choose the object-oriented syntax over native filehandles. Its main significance is that IO::Socket, IO::Pipe, and other I/O-related modules also inherit their behavior from IO::Handle. This means that programs that read and write from local files and those that read and write to remote network servers share a common, easy-to-use interface.</p>
<p class="docText" style="margin:0;">We'll get a feel for the module by looking at a tiny example of a program that opens a file, counts the number of lines, and reports its findings (<a class="docLink">Figure 1.4</a>).</p>
<p>Figure 1.4. The count_lines.pl program
<p class="docText" style="margin:0;"></p>
<div id="rld9" style="text-align:center;margin-top:0;margin-bottom:0;padding:1em 0;"><img src="http://docs.google.com/File?id=dd6nw3mt_212gxq8wfdw_b" style="width:500px;height:215px;" /></div></p>
<blockquote style="border-color:rgb(221,221,221);border-style:dashed;border-width:1px;padding:10px;"><p style="margin:0;"></p>
<p class="docText" style="margin:0;"><b>Lines 1–3: Load modules</b> We turn on strict syntax checking, and load the IO::File module.</p>
<p style="margin:0;">
<p style="margin:0;">
<p class="docText" style="margin:0;"><b>Lines 4–5: Initialize variables</b> We recover from the command line the name of the file to perform the line count on, and initialize the <tt>$counter</tt> variable to zero.</p>
<p style="margin:0;">
<p style="margin:0;">
<p class="docText" style="margin:0;"><b>Line 6: Create a new IO::File object</b> We call the <tt>IO::File::new()</tt> method, using the syntax <tt>IO::File-&gt;new()</tt>. The argument is the name of the file to open. If successful, <tt>new()</tt> returns a new IO::File object that we can use for I/O. Otherwise it returns <tt>undef</tt>, and we die with an error message.</p>
<p style="margin:0;">
<p style="margin:0;">
<p class="docText" style="margin:0;"><b>Lines 7–9: Main loop</b> We call the IO::File object's <tt>getline()</tt> method in the test portion of a <tt>while()</tt> loop. This method returns the next line of text, or <tt>undef</tt> on end of file—just like <tt>&lt;&gt;</tt>.</p>
<p class="docList" style="margin:0;">Each time through the loop we bump up <tt>$counter</tt>. The loop continues until <tt>getline()</tt> returns <tt>undef.</tt></p>
<p style="margin:0;">
<p style="margin:0;">
<p class="docText" style="margin:0;"><b>Line 10: Print results</b> We print out our results by calling <tt>STDOUT-&gt;print()</tt>. We'll discuss why this surprising syntax works in a moment.</p>
<p style="margin:0;">
</blockquote>
<p class="docText" style="margin:0;">When I ran <span class="docEmphasis">count_lines.pl</span> on the unfinished manuscript for this chapter, I got the following result:</p>
<pre>% <span class="docEmphStrong">count_lines.pl ch1.pod</span>
Counted 2428 lines
</pre>
<p class="docText" style="margin:0;">IO::File objects are actually blessed typeglob references (see the Passing and Storing Filehandles section earlier in this chapter). This means that you can use them in an object-oriented fashion, as in:</p>
<pre>$fh-&gt;print("Function calls are for the birds./n");
</pre>
<p class="docText" style="margin:0;">or with the familiar built-in function calls:</p>
<pre>print $fh "Object methods are too effete./n";
</pre>
<p class="docText" style="margin:0;">Many of IO::File's methods are simple wrappers around Perl's built-in functions. In addition to <tt>print()</tt> and <tt>getline()</tt> methods, there are <tt>read()</tt>, <tt>syswrite()</tt>, and <tt>close()</tt> methods, among others. We discuss the pros and cons of using object-oriented method calls and function calls in <a class="docLink">Chapter 5</a>, where we introduce IO:: Socket.</p>
<p class="docText" style="margin:0;">When you load IO::File (technically, when IO::File loads IO::Handle, which it inherits from), it adds methods to ordinary filehandles. This means that any of the methods in IO::File can also be used with <tt>STDIN</tt>, <tt>STDOUT</tt>, <tt>STDERR</tt>, or even with any conventional filehandles that you happen to create. This is why line 10 of <a class="docLink">Figure 1.4</a> allows us to print to standard output by calling <tt>print()</tt>.</p>
<p class="docText" style="margin:0;">Of the method listings that follow, only the <tt>new()</tt> and <tt>new_tmpfile()</tt> methods are actually defined by IO::File. The rest are inherited from IO::Handle and can be used with other descendents of IO::Handle, such as IO::Socket. This list is not complete. I've omitted some of the more obscure methods, including those that allow you to move around inside a file in a record-oriented fashion, because we won't need them for network communications.</p>
<p class="docText" style="margin:0;"></p>
<p style="margin:0;">
<table cellspacing="0" width="90%" border="1" style="font-size:1em;line-height:inherit;">
<tbody>
<tr style="text-align:left;">
<td>
<p class="docText" style="margin:0;"><span class="docEmphStrong"><span class="Apple-style-span" style="font-weight:bold;"><span class="Apple-style-span" style="color:rgb(0,0,255);">$fh = IO::File-&gt;new($filename [,$mode [,$perms]])</span></span></span></p>
<p class="docText" style="margin:0;">The <tt>new()</tt> method is the main constructor for IO::File. It is a unified replacement for both <tt>open()</tt> and <tt>sysopen()</tt>. Called with a single argument, <tt>new()</tt> acts like the two-argument form of <tt>open()</tt>, taking a filename optionally preceded by a mode string. For example, this will open the indicated file for appending:</p>
<pre>$fh = IO::File-&gt;new("&gt;darkstar.txt");
</pre>
<p class="docText" style="margin:0;">If called with two or three arguments, IO::File treats the second argument as the open mode, and the third argument as the file creation permissions. <tt>$mode</tt> may be a Perl-style mode string, such as " <tt>+&lt;</tt> ", or an octal numeric mode, such as those used by <tt>sysopen()</tt>. As a convenience, IO::File automatically imports the <tt>Fcntl O_*</tt> constants when it loads. In addition, <tt>open()</tt> allows for an alternative type of symbolic mode string that is used in the C <tt>fopen()</tt> call; for example, it allows " <tt>w</tt> " to open the file for writing. We won't discuss those modes further here, because they do not add functionality.</p>
<p class="docText" style="margin:0;">The permission agreement given by <tt>$perms</tt> is an octal number, and has the same significance as the corresponding parameter passed to <tt>sysopen()</tt>.</p>
<p class="docText" style="margin:0;">If <tt>new()</tt> cannot open the indicated file, it will return <tt>undef</tt> and set <tt>$!</tt> to the appropriate system error message.</p>
<p class="docText" style="margin:0;"></p>
<p class="docText" style="margin:0;"><span class="docEmphStrong"><span class="Apple-style-span" style="font-weight:bold;"><span class="Apple-style-span" style="color:rgb(0,0,255);">$fh = IO::File-&gt;new_tmpfile</span></span></span></p>
<p class="docText" style="margin:0;">The <tt>new_tmpfile()</tt> constructor, which is called without arguments, creates a temporary file opened for reading and writing. On UNIX systems, this file is anonymous, meaning that it cannot be seen on the file system. When the IO::File object is destroyed, the file and all its contents will be deleted automatically.</p>
<p class="docText" style="margin:0;">This constructor is useful for storing large amounts of temporary data.</p>
<p class="docText" style="margin:0;"></p>
<p class="docText" style="margin:0;"><span class="docEmphStrong"><span class="Apple-style-span" style="font-weight:bold;"><span class="Apple-style-span" style="color:rgb(0,0,255);">$result = $fh-&gt;close</span></span></span></p>
<p class="docText" style="margin:0;">The <tt>close()</tt> method closes the IO::File object, returning a true result if successful. If you do not call <tt>close()</tt> explicitly, it will be called automatically when the object is destroyed. This happens when the script exits, if you happen to <tt>undef()</tt> the object, or if the object goes out of scope such as when a <tt>my</tt> variable reaches the end of its enclosing block.</p>
<p class="docText" style="margin:0;"></p>
<p class="docText" style="margin:0;"><span class="docEmphStrong"><span class="Apple-style-span" style="font-weight:bold;"><span class="Apple-style-span" style="color:rgb(0,0,255);">$result = $fh-&gt;open($filename [,$mode [,$perms]])</span></span></span></p>
<p class="docText" style="margin:0;">You can reopen a filehandle object on the indicated file by using its <tt>open()</tt> method. The input arguments are identical to <tt>new()</tt>. The method result indicates whether the open was successful.</p>
<p class="docText" style="margin:0;">This is chiefly used for reopening the standard filehandles <tt>STDOUT</tt>, <tt>STDIN</tt>, and <tt>STDERR</tt>. For example:</p>
<pre>STDOUT-&gt;open("log.txt") or die "Can't reopen STDOUT: $!";
</pre>
<p class="docText" style="margin:0;">Calls to <tt>print()</tt> will now write to the file <span class="docEmphasis"><tt>log.txt</tt> </span>.</p>
<p class="docText" style="margin:0;"></p>
<p class="docText" style="margin:0;"><span class="docEmphStrong"><span class="Apple-style-span" style="font-weight:bold;"><span class="Apple-style-span" style="color:rgb(0,0,255);">$result = $fh-&gt;print(@args)</span></span></span></p>
<p class="docText" style="margin:0;"><span class="docEmphStrong"><span class="Apple-style-span" style="font-weight:bold;"><span class="Apple-style-span" style="color:rgb(0,0,255);">$result=$fh-&gt;printf($fmt,@args)</span></span></span></p>
<p class="docText" style="margin:0;"><span class="docEmphStrong"><span class="Apple-style-span" style="font-weight:bold;"><span class="Apple-style-span" style="color:rgb(0,0,255);">$bytes=$fh-&gt;write($data [,$length [,$offset]])</span></span></span></p>
<p class="docText" style="margin:0;"><span class="docEmphStrong"><span class="Apple-style-span" style="font-weight:bold;"><span class="Apple-style-span" style="color:rgb(0,0,255);">$bytes = $fh-&gt;syswrite($data [,$length [,$offset]])</span></span></span></p>
<p class="docText" style="margin:0;">The <tt>print()</tt>, <tt>printf()</tt>, and <tt>syswrite()</tt> methods work exactly like their built-in counterparts. For example, <tt>print()</tt> takes a list of data items, writes them to the filehandle object, and returns true if successful.</p>
<p class="docText" style="margin:0;">The <tt>write()</tt> method is the opposite of <tt>read()</tt>, writing a stream of bytes to the filehandle object and returning the number successfully written. It is similar to <tt>syswrite()</tt>, except that it uses stdio buffering. This method corrects the inconsistent naming of the built-in <tt>write()</tt> function, which creates formatted reports. The IO::File object method that corresponds to the built-in <tt>write()</tt> goes by the name of <tt>format_write()</tt>.</p>
<p class="docText" style="margin:0;"></p>
<p class="docText" style="margin:0;"><span class="docEmphStrong"><span class="Apple-style-span" style="font-weight:bold;"><span class="Apple-style-span" style="color:rgb(0,0,255);">$line = $fh-&gt;getline</span></span></span></p>
<p class="docText" style="margin:0;"><span class="docEmphStrong"><span class="Apple-style-span" style="font-weight:bold;"><span class="Apple-style-span" style="color:rgb(0,0,255);">@lines=$fh-&gt;getlines</span></span></span></p>
<p class="docText" style="margin:0;"><span class="docEmphStrong"><span class="Apple-style-span" style="font-weight:bold;"><span class="Apple-style-span" style="color:rgb(0,0,255);">$bytes = $fh-&gt;read($buffer,$length ",$offset")</span></span></span></p>
<p class="docText" style="margin:0;"><span class="docEmphStrong"><span class="Apple-style-span" style="font-weight:bold;"><span class="Apple-style-span" style="color:rgb(0,0,255);">$bytes = $fh-&gt;ysread($buffer,$length ",$offsetr")</span></span></span></p>
<p class="docText" style="margin:0;">The <tt>getline()</tt> and <tt>getlines()</tt> methods together replace the <tt>&lt;&gt;</tt> operator. <tt>getline()</tt> reads one line from the filehandle object and returns it, behaving in the same way in both scalar and list contexts. The <tt>getlines()</tt> method acts like <tt>&lt;&gt;</tt> in a list context, returning a list of all the available lines. <tt>getline()</tt> will return undef at the end of file.</p>
<p class="docText" style="margin:0;">The <tt>read()</tt> and <tt>sysread()</tt> methods act just like their built-in function counterparts.</p>
<p class="docText" style="margin:0;"></p>
<p class="docText" style="margin:0;"><span class="docEmphStrong"><span class="Apple-style-span" style="font-weight:bold;"><span class="Apple-style-span" style="color:rgb(0,0,255);">$previous = $fh-&gt;autoflush([$boolean])</span></span></span></p>
<p class="docText" style="margin:0;">The <tt>autoflush()</tt> method gets or sets the <tt>autoflush()</tt> mode for the filehandle object. Called without arguments, it turns <span class="docEmphasis">on</span> autoflush. Called with a single boolean argument, it sets autoflush to the indicated status. In either case, <tt>autoflush()i</tt> returns the previous value of the autoflush state.</p>
<p class="docText" style="margin:0;"><span class="docEmphStrong">$boolean = $fh-&gt;opened</span></p>
<p class="docText" style="margin:0;">The <tt>opened()</tt> method returns true if the filehandle object is currently valid. It is equivalent to:</p>
<pre>defined fileno($fh);
</pre>
<p class="docText" style="margin:0;"><span class="docEmphStrong"><span class="Apple-style-span" style="font-weight:bold;"><span class="Apple-style-span" style="color:rgb(0,0,255);">$boolean = $fh-&gt;eof</span></span></span></p>
<p class="docText" style="margin:0;">Returns true if the next read on the filehandle object will return EOF.</p>
<p class="docText" style="margin:0;"></p>
<p class="docText" style="margin:0;"><span class="docEmphStrong"><span class="Apple-style-span" style="font-weight:bold;"><span class="Apple-style-span" style="color:rgb(0,0,255);">$fh-&gt;flush</span></span></span></p>
<p class="docText" style="margin:0;">The <tt>flush()</tt> method immediately flushes any data that is buffered in the filehandle object. If the filehandle is being used for writing, then its buffered data is written to disk (or to the pipe, or network, as we'll see when we get to IO::Socket objects). If the filehandle is being used for reading, any data in the buffer is <tt>discarded</tt>, forcing the next read to come from disk.</p>
<p class="docText" style="margin:0;"></p>
<p class="docText" style="margin:0;"><span class="docEmphStrong"><span class="Apple-style-span" style="font-weight:bold;"><span class="Apple-style-span" style="color:rgb(0,0,255);">$boolean = $fh-&gt;blocking("$boolean")</span></span></span></p>
<p class="docText" style="margin:0;">The <tt>blocking()</tt> method turns on and off blocking mode for the filehandle. </p>
<p class="docText" style="margin:0;"></p>
<p class="docText" style="margin:0;"><span class="docEmphStrong"><span class="Apple-style-span" style="color:rgb(0,0,255);"><span class="Apple-style-span" style="font-weight:bold;">$fh-&gt;clearerr</span></span></span></p>
<p class="docText" style="margin:0;"><span class="docEmphStrong"><span class="Apple-style-span" style="color:rgb(0,0,255);"><span class="Apple-style-span" style="font-weight:bold;">$boolean = $fh-&gt;error</span></span></span></p>
<p class="docText" style="margin:0;">These two methods are handy if you wish to perform a series of I/O operations and check the error status only after you're finished. The <tt>error()i</tt> method will return true if any errors have occurred on the filehandle since it was created, or since the last call to <tt>clearerr()</tt>. The <tt>clearerr()</tt> method clears this flag.</p>
</td>
</tr>
</tbody>
</table>
<p style="margin:0;">
<p class="docText" style="margin:0;"></p>
<p class="docText" style="margin:0;">In addition to the methods listed here, IO::File has a constructor named <tt>new_from_fd()</tt>, and a method named <tt>fdopen()</tt>, both inherited from IO::Handle. These methods can be used to save and restore objects in much the way that the <tt>&gt;&amp;FILEHANDLE</tt> does with standard filehandles.</p>
<p class="docText" style="margin:0;"></p>
<p style="margin:0;">
<table cellspacing="0" width="90%" border="1" style="font-size:1em;line-height:inherit;">
<tbody>
<tr style="text-align:left;">
<td>
<p class="docText" style="margin:0;"><span class="docEmphStrong"><span class="Apple-style-span" style="font-weight:bold;"><span class="Apple-style-span" style="color:rgb(0,0,255);">$fh = IO::File-&gt;new_from_fd($fd,$mode)</span></span></span></p>
<p class="docText" style="margin:0;">The <tt>new_from_fd()</tt> method opens up a copy of the filehandle object indicated by <tt>$fd</tt> using the read/write mode given by <tt>$mode</tt>. The object may be an IO::Handle object, an IO::File object, a regular filehandle, or a numeric file descriptor returned <tt>byfileno()</tt>. <tt>$mode</tt> must match the mode with which <tt>$fd</tt> was originally opened. For example:</p>
<pre>$saveout = IO::File-&gt;new_from_fd(STDOUT,"&gt;");
</pre>
<p class="docText" style="margin:0;"><span class="docEmphStrong"><span class="Apple-style-span" style="font-weight:bold;"><span class="Apple-style-span" style="color:rgb(0,0,255);">$result = $fh-&gt;fdopen($fd,$mode)</span></span></span></p>
<p class="docText" style="margin:0;">The <tt>fdopen()</tt> method is used to reopen an existing filehandle object, making it a copy of another one. The <tt>$fd</tt> argument may be an IO::Handle object or a regular filehandle, or a numeric file descriptor <tt>$mode</tt> must match the mode with which <tt>$fd</tt> was originally opened.</p>
<p class="docText" style="margin:0;">This is typically used in conjunction with <tt>new_from_fd()</tt> to restore a saved filehandle:</p>
<pre>$saveout = IO::File-&gt;new_from_fd(STDOUT,"&gt;"); # save STDOUT
STDOUT-&gt;open('&gt;log.txt');                     # reopen on a file
STDOUT-&gt;print("Yippy yie yay!/n");            # print something
STDOUT-&gt;fdopen($saveout,"&gt;");                 # reopen on saved 
<img height="9" alt="graphics/ccc.gif" width="14" align="left" border="0" />value
</pre>
<div><span class="Apple-style-span" style="font-family:-webkit-monospace;white-space:pre;"><br /></span></div>
</td>
</tr>
</tbody>
</table>

        </div>
        <a href="javascript:void(0);" style="float:right" onclick="window.scrollTo(0, 0);">Top</a>
        <div style="clear: both;"></div>
      </div>
    </div>
    
    <div class="main-container shadow">
      <div class="mainbody">
        <h2><a href="/2009/01/13/add-a-directory-to-my-include-path-at-runtime">How do I add a directory to my include path (@INC) at runtime?</a></h2>
        <p>
          Posted by <strong>Bo Yang</strong> at <strong>2009-01-13</strong> with tags <a href="/tags.html#Perl-ref" rel="nofollow">Perl</a>, <a href="/tags.html#Unix/Linux-ref" rel="nofollow">Unix/Linux</a>
        </p>
        
        <div class="post_at_index thepost">
        <p>
     <span class="Apple-style-span" style="color:rgb(17,17,17);font-family:Arial;font-size:16px;"><span class="Apple-style-span" style="font-size:20px;font-weight:bold;">How do I add a directory to my include path (@INC) at runtime?</span></span>
<p style="font-size:100%;">Here are the suggested ways of modifying your include path, including environment variables, run-time switches, and in-code statements:</p>
<ul>
<li><a name="the-PERLLIB-environment-variable"></a><b>the PERLLIB environment variable</b>
<pre class="verbatim" style="margin-left:10px;background-image:initial;background-repeat:initial;background-attachment:initial;-webkit-background-clip:initial;-webkit-background-origin:initial;background-color:rgb(238,238,221);width:90%;background-position:initial initial;border-color:rgb(204,204,204);border-style:solid;border-width:1px;padding:10px;">	$ export PERLLIB=/path/to/my/dir
	$ perl program.pl</pre>
</li>
<li><a name="the-PERL5LIB-environment-variable"></a><b>the PERL5LIB environment variable</b>
<pre class="verbatim" style="margin-left:10px;background-image:initial;background-repeat:initial;background-attachment:initial;-webkit-background-clip:initial;-webkit-background-origin:initial;background-color:rgb(238,238,221);width:90%;background-position:initial initial;border-color:rgb(204,204,204);border-style:solid;border-width:1px;padding:10px;">	$ export PERL5LIB=/path/to/my/dir
	$ perl program.pl</pre>
</li>
<li><a name="the-perl--Idir-command-line-flag"></a><b>the perl -Idir command line flag</b>
<pre class="verbatim" style="margin-left:10px;background-image:initial;background-repeat:initial;background-attachment:initial;-webkit-background-clip:initial;-webkit-background-origin:initial;background-color:rgb(238,238,221);width:90%;background-position:initial initial;border-color:rgb(204,204,204);border-style:solid;border-width:1px;padding:10px;">	$ perl -I/path/to/my/dir program.pl</pre>
</li>
<li><a name="the-use-lib-pragma%3a"></a><b>the use lib pragma:</b>
<pre class="verbatim" style="margin-left:10px;background-image:initial;background-repeat:initial;background-attachment:initial;-webkit-background-clip:initial;-webkit-background-origin:initial;background-color:rgb(238,238,221);width:90%;background-position:initial initial;border-color:rgb(204,204,204);border-style:solid;border-width:1px;padding:10px;">	<a class="l_k" href="http://perldoc.perl.org/functions/use.html" style="color:rgb(139,0,139);font-weight:bold;">use</a> <span class="w" style="color:rgb(0,0,0);">lib</span> <span class="q" style="color:rgb(205,85,85);">"$ENV{HOME}/myown_perllib"</span><span class="sc" style="color:rgb(0,0,0);">;</span></pre>
</li>
</ul>
<p style="font-size:100%;">The last is particularly useful because it knows about machine dependent architectures. The lib.pm pragmatic module was first included with the 5.002 release of Perl.</p>

        </div>
        <a href="javascript:void(0);" style="float:right" onclick="window.scrollTo(0, 0);">Top</a>
        <div style="clear: both;"></div>
      </div>
    </div>
    
    <div class="main-container shadow">
      <div class="mainbody">
        <h2><a href="/2009/01/12/perl-parameters">Shell向Perl脚本中传递变量的方法</a></h2>
        <p>
          Posted by <strong>Bo Yang</strong> at <strong>2009-01-12</strong> with tags <a href="/tags.html#Perl-ref" rel="nofollow">Perl</a>, <a href="/tags.html#Unix/Linux-ref" rel="nofollow">Unix/Linux</a>
        </p>
        
        <div class="post_at_index thepost">
        <p><span style="border-collapse:collapse;color:#000000;font-family:song;font-size:13px;"></p>
<div><span style="font-family:Arial;">方法一：</span></div>
<p><span style="font-family:Arial;">In shell using export&nbsp;&nbsp;to output a variable, and&nbsp;in perl using special variable %ENV to get shell's variables.<br />i.e.:<br />--- shell box---<br />$ /bin/ksh<br /># export x=Foo<br /># perl -e 'print $ENV{"x"}'<br />-------------</span></span></p>
<div><span style="border-collapse:collapse;color:#000000;font-size:13px;"><span style="font-family:Arial;"><br /></span></span></div>
<div><span style="border-collapse:collapse;color:#000000;font-size:13px;"><span style="font-family:Arial;">方法二：</span></span></div>
<div><span style="border-collapse:collapse;color:#000000;font-family:song;font-size:13px;"><span style="border-collapse:separate;font-size:12px;letter-spacing:2px;line-height:18px;"><span style="font-family:Arial;">象C一样，PERL也有存储命令行参数的数组@ARGV，可以用来分别处理各个命令行参数；与C不同的是，$ARGV[0]是第一个参数，而不是程序名本身。<br />&nbsp;&nbsp;&nbsp;&nbsp;$var = $ARGV[0]; # 第一个参数<br />&nbsp;&nbsp;&nbsp;&nbsp;$numargs = @ARGV; # 参数的个数<br />&nbsp;&nbsp;PERL中，&lt;&gt;操作符实际上是对数组@ARGV的隐含的引用，其工作原理为：<br />1、当PERL解释器第一次看到&lt;&gt;时，打开以$ARGV[0]为文件名的文件；<br />2、执行动作shift(@ARGV); 即把数组@ARGV的元素向前移动一个，其元素数量即减少了一个。<br />3、&lt;&gt;操作符读取在第一步打开的文件中的所有行。<br />4、读完后，解释器回到第一步重复。<br />&nbsp;&nbsp;例：<br />&nbsp;&nbsp;&nbsp;&nbsp;@ARGV = ("myfile1", "myfile2"); #实际上由命令行参数赋值<br />&nbsp;&nbsp;&nbsp;&nbsp;while ($line = &lt;&gt;) {<br />&nbsp;&nbsp;&nbsp;&nbsp;print ($line);<br />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<br />&nbsp;&nbsp;将把文件myfile1和myfile2的内容打印出来。</span></span><br /></span></div>

        </div>
        <a href="javascript:void(0);" style="float:right" onclick="window.scrollTo(0, 0);">Top</a>
        <div style="clear: both;"></div>
      </div>
    </div>
    
    <div class="main-container shadow">
      <div class="mainbody">
        <h2><a href="/2009/01/06/special-variable-in-perl">Perl中的特殊变量</a></h2>
        <p>
          Posted by <strong>Bo Yang</strong> at <strong>2009-01-06</strong> with tags <a href="/tags.html#Perl-ref" rel="nofollow">Perl</a>, <a href="/tags.html#Unix/Linux-ref" rel="nofollow">Unix/Linux</a>
        </p>
        
        <div class="post_at_index thepost">
        <p>
<span class="Apple-style-span" style="color:rgb(0,0,0);font-size:16px;">
<div style="min-height:1100px;counter-reset:__goog_page__ 0;font-family:Verdana;font-size:10pt;line-height:normal;background-color:rgb(255,255,255);margin:6px;padding:0;">
<h1 style="text-align:center;font-size:18pt;">Perl中的特殊变量<br /></h1>
<div style="margin-top:0;margin-bottom:0;"></div>
<div style="margin-top:0;margin-bottom:0;">
<h3 style="font-size:12pt;">1. $&amp;, $`,$' 用在模式匹配中<br /></h3>
<p><span style="font-family:verdana;"><span style="color:rgb(0,0,0);"><b><img align="top" alt="" src="http://images.csdn.net/syntaxhighlighting/OutliningIndicators/None.gif" style="border-style:initial;border-color:initial;border-width:0;" /><br /><img align="top" alt="" src="http://images.csdn.net/syntaxhighlighting/OutliningIndicators/None.gif" style="border-style:initial;border-color:initial;border-width:0;" /><span class="Apple-style-span" style="color:rgb(0,0,255);">$&amp;  用来存放匹配中的值<br /></span><span class="Apple-style-span" style="color:rgb(0,0,255);"><img align="top" alt="" src="http://images.csdn.net/syntaxhighlighting/OutliningIndicators/None.gif" style="border-style:initial;border-color:initial;border-width:0;" />$`   用来存放匹配中之前所有字符<br /></span><span class="Apple-style-span" style="color:rgb(0,0,255);"><img align="top" alt="" src="http://images.csdn.net/syntaxhighlighting/OutliningIndicators/None.gif" style="border-style:initial;border-color:initial;border-width:0;" />$</span></b></span><span><span class="Apple-style-span" style="color:rgb(0,0,255);"><span class="Apple-style-span" style="font-weight:bold;">'</span></span></span><span style="color:rgb(0,0,0);"><span class="Apple-style-span" style="color:rgb(0,0,255);"><span class="Apple-style-span" style="font-weight:bold;">   用来存放匹配中之后所有字符</span></span><br /><img align="top" alt="" src="http://images.csdn.net/syntaxhighlighting/OutliningIndicators/None.gif" style="border-style:initial;border-color:initial;border-width:0;" /><br /><img align="top" alt="" src="http://images.csdn.net/syntaxhighlighting/OutliningIndicators/None.gif" style="border-style:initial;border-color:initial;border-width:0;" />如：<br /><img align="top" alt="" src="http://images.csdn.net/syntaxhighlighting/OutliningIndicators/None.gif" style="border-style:initial;border-color:initial;border-width:0;" /></span><span style="color:rgb(0,128,0);">#</span><span style="color:rgb(0,128,0);">!/usr/bin/perl -w</span><span style="color:rgb(0,128,0);"><br /><img align="top" alt="" src="http://images.csdn.net/syntaxhighlighting/OutliningIndicators/None.gif" style="border-style:initial;border-color:initial;border-width:0;" /></span><span style="color:rgb(0,0,255);">if</span><span style="color:rgb(0,0,0);">(</span><span style="color:rgb(0,0,0);"><b>"</b></span><span style="color:rgb(0,0,0);"><b>Hello good  there,neigbor hello</b></span><span style="color:rgb(0,0,0);"><b>"</b></span><span style="color:rgb(0,0,0);"> </span><span style="color:rgb(0,0,0);">=~</span><span style="color:rgb(0,0,0);"> </span><span style="color:rgb(0,0,0);">/</span><span style="color:rgb(0,0,0);">S(</span><span style="color:rgb(0,0,0);"></span><span style="color:rgb(0,0,0);">w</span><span style="color:rgb(0,0,0);">+</span><span style="color:rgb(0,0,0);">)</span><span style="color:rgb(0,0,0);">,/</span><span style="color:rgb(0,0,0);">)<br /><img align="top" alt="" src="http://images.csdn.net/syntaxhighlighting/OutliningIndicators/None.gif" style="border-style:initial;border-color:initial;border-width:0;" />{<br /><img align="top" alt="" src="http://images.csdn.net/syntaxhighlighting/OutliningIndicators/None.gif" style="border-style:initial;border-color:initial;border-width:0;" />        </span><span style="color:rgb(0,0,255);">print</span><span style="color:rgb(0,0,0);"> </span><span style="color:rgb(0,0,0);"><b>"</b></span><span style="color:rgb(0,0,0);"><b>That actually matched '$&amp;'. </b></span><span style="color:rgb(0,0,0);"><b>"</b></span><span style="color:rgb(0,0,0);">;<br /><img align="top" alt="" src="http://images.csdn.net/syntaxhighlighting/OutliningIndicators/None.gif" style="border-style:initial;border-color:initial;border-width:0;" />        </span><span style="color:rgb(0,0,255);">print</span><span style="color:rgb(0,0,0);"> $`</span><span style="color:rgb(0,0,0);">.</span><span style="color:rgb(0,0,0);"><b>"</b></span><span style="color:rgb(0,0,0);"><b> </b></span><span style="color:rgb(0,0,0);"><b>"</b></span><span style="color:rgb(0,0,0);">;<br /><img align="top" alt="" src="http://images.csdn.net/syntaxhighlighting/OutliningIndicators/None.gif" style="border-style:initial;border-color:initial;border-width:0;" />        </span><span style="color:rgb(0,0,255);">print</span><span style="color:rgb(0,0,0);"> $</span><span style="color:rgb(0,0,0);"><b>'</b></span><span style="color:rgb(0,0,0);"><b>." ";<br /><img align="top" alt="" src="http://images.csdn.net/syntaxhighlighting/OutliningIndicators/None.gif" style="border-style:initial;border-color:initial;border-width:0;" />}<br /><img align="top" alt="" src="http://images.csdn.net/syntaxhighlighting/OutliningIndicators/None.gif" style="border-style:initial;border-color:initial;border-width:0;" /><br /><span class="Apple-style-span" style="font-weight:normal;">执行的结果为：<br /></span><span class="Apple-style-span" style="font-weight:normal;"><img align="top" alt="" src="http://images.csdn.net/syntaxhighlighting/OutliningIndicators/None.gif" style="border-style:initial;border-color:initial;border-width:0;" /></span><span class="Apple-style-span" style="font-weight:normal;"><img src="http://images.csdn.net/syntaxhighlighting/OutliningIndicators/None.gif" align="top" alt="" style="border-style:initial;border-color:initial;border-width:0;" /><br /></span><span class="Apple-style-span" style="font-weight:normal;"><img align="top" alt="" src="http://images.csdn.net/syntaxhighlighting/OutliningIndicators/None.gif" style="border-style:initial;border-color:initial;border-width:0;" />That actually matched </span></b></span><span style="color:rgb(0,0,0);">'</span><span style="color:rgb(0,0,0);">there</span><span style="color:rgb(0,0,0);">,</span><span style="color:rgb(0,0,0);">'</span><span style="color:rgb(0,0,0);">.<br /><img align="top" alt="" src="http://images.csdn.net/syntaxhighlighting/OutliningIndicators/None.gif" style="border-style:initial;border-color:initial;border-width:0;" />Hello good  <br /><img align="top" alt="" src="http://images.csdn.net/syntaxhighlighting/OutliningIndicators/None.gif" style="border-style:initial;border-color:initial;border-width:0;" />neigbor hello<br /><img align="top" alt="" src="http://images.csdn.net/syntaxhighlighting/OutliningIndicators/None.gif" style="border-style:initial;border-color:initial;border-width:0;" /><br />－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－<span style="font-family:Verdana;"><img src="http://images.csdn.net/syntaxhighlighting/OutliningIndicators/None.gif" align="top" alt="" style="border-style:initial;border-color:initial;border-width:0;" /><span style="font-family:verdana;"><font size="2">－－－－－－－－</font></span></span></span></span></div>
<div style="margin-top:0;margin-bottom:0;"><span style="font-family:verdana;"><span style="color:rgb(0,0,0);"><img align="top" alt="" src="http://images.csdn.net/syntaxhighlighting/OutliningIndicators/None.gif" style="border-style:initial;border-color:initial;border-width:0;" /><br /><img align="top" alt="" src="http://images.csdn.net/syntaxhighlighting/OutliningIndicators/None.gif" style="border-style:initial;border-color:initial;border-width:0;" />另外常用的变量@_<br /><img align="top" alt="" src="http://images.csdn.net/syntaxhighlighting/OutliningIndicators/None.gif" style="border-style:initial;border-color:initial;border-width:0;" />@_是子程序的一个私有变量◆；如果有一个全局变量@_，它将在此子程序调用前存储起来，当子程序调用完成后，其早期的值会被重新赋还给@_◆。这意味着当将参数传递给子程序时不用担心它会影响此程序中其它子程序的@_这个变量的值。嵌套的子程序调用时，@_的值和上述类似。甚至此子程序递归调用时，每一次调用将得到新的@_，因此子程序调用时将得到其自身的参数列表。<br /><img align="top" alt="" src="http://images.csdn.net/syntaxhighlighting/OutliningIndicators/None.gif" style="border-style:initial;border-color:initial;border-width:0;" /><br /><img align="top" alt="" src="http://images.csdn.net/syntaxhighlighting/OutliningIndicators/None.gif" style="border-style:initial;border-color:initial;border-width:0;" />◆除非调用的子程序前有&amp;而后面没有括号（或者没有参数），此时@_从此调用者的上下文(context)得到。这通常不是个好主意，但有时很<br /><img align="top" alt="" src="http://images.csdn.net/syntaxhighlighting/OutliningIndicators/None.gif" style="border-style:initial;border-color:initial;border-width:0;" />有用。</span></span></div>
<div style="margin-top:0;margin-bottom:0;"></div>
<h3 style="font-size:12pt;">2. Perl - $_ and @_<br /></h3>
<p><span style="font-family:Arial;">
<div class="generaltext" style="font-family:Arial, Helvetica, sans-serif;font-style:normal;font-weight:normal;font-variant:normal;color:rgb(0,0,0);background-color:rgb(255,255,255);letter-spacing:normal;text-align:left;vertical-align:top;text-decoration:none;border-bottom-width:0;margin-top:0;margin-bottom:0;"><font size="2">Perl's a great language for special variables - variables that are set up without the programmer having to intervene and providing information ranging from the number of lines read from the <b>current input file ($.)</b> through the <b>current process ID ($$) </b>and the <b>operating system ($^O)</b>. Other special variables effect how certain operations are performed (<b>$| controlling output buffering / flushing</b>, for example), or are fundamental in the operation of certain facilities - no more so than $_ and @_.</p>
<p>Lets clear a misconception. </font><b>$_</b><font size="2"> and </font><b>@_</b><font size="2"> are </font><i>different variables</i><font size="2">. In Perl, you can have a list and a scalar of the same name, and they refer to unrelated pieces of memory.</p>
<p></font><font color="brown"><b>$_ is known as the "default input and pattern matching space"</b>.</font><font size="2"> In other words, if you read in from a file handle at the top of a </font><b>while</b><font size="2"> loop, or run a </font><b>foreach</b><font size="2"> loop and don't name a loop variable, $_ is set up for you. Then any regular expression matches, </font><b>chop</b><font size="2">s (and </font><b>lc</b><font size="2">s and many more) without a parameter, and even </font><b>print</b><font size="2">s assume you want to work on $_. Thus:<br /></font><code>while ($line = &lt;FH&gt;) {<br />  if ($line =~ /Perl/) {<br />    print FHO $line;<br />    }<br />  print uc $line;<br />  }</code></p>
<p><font size="2">Shortens to:<br /></font><code>while (&lt;FH&gt;) {<br />  /Perl/ and<br />    print FHO ;<br />  print uc;<br />  }</code></p>
<p><font color="brown"><b>@_ is the list of incoming parameters to a sub.</b></font><font size="2"> So if you write a sub, you refer to the first parameter in it as </font><b>$_[0]</b><font size="2">, the second parameter as </font><b>$_[1]</b><font size="2"> and so on. And you can refer to</font><b>$_#</b><font size="2"> as the index number of the last parameter:<br /></font><code>sub demo {<br />  print "Called with ",$#_+1," params/n";<br />  print "First param was $_[0]/n";</code></p>
<p><font size="2">Note that the </font><b>English</b><font size="2"> module adds in the ability to refer to the special variables by other longer, but easier to remember, names such as @ARG for @_ and $PID for $$. But </font><code>use English;</code><font size="2"> can have a detrimental performance effect if you're matching regular expressions against long incoming strings. </font></div>
<div style="text-align:left;"></div>
<p></span></div>
<p></span></p>

        </div>
        <a href="javascript:void(0);" style="float:right" onclick="window.scrollTo(0, 0);">Top</a>
        <div style="clear: both;"></div>
      </div>
    </div>
    
    <div class="main-container shadow">
      <div class="mainbody">
        <h2><a href="/2008/12/29/perl-note-1">Perl Notes(I)</a></h2>
        <p>
          Posted by <strong>Bo Yang</strong> at <strong>2008-12-29</strong> with tags <a href="/tags.html#Perl-ref" rel="nofollow">Perl</a>, <a href="/tags.html#Unix/Linux-ref" rel="nofollow">Unix/Linux</a>
        </p>
        
        <div class="post_at_index thepost">
        <p><span style="font-family:Verdana;font-size:13px;"></p>
<h2 style="font-size:14pt;">Part I&nbsp;&nbsp; &nbsp;Programming Perl</h2>
<h3 style="font-size:12pt;"><a name="1_Perl_Data_Types_029207318089"></a>1 Perl Data Types</h3>
<h4 style="font-size:10pt;"><a name="1_1_Funny_Characters_558344643"></a>1.1 Funny Characters</h4>
<div style="margin-top:0;margin-bottom:0;">
<table style="font-size:1em;line-height:inherit;" border="1">
<tbody>
<tr style="text-align:left;">
<th>Type</th>
<th>Character</th>
<th>Example</th>
<th>Is a name for:</th>
</tr>
<tr style="text-align:left;">
<td>Scalar</td>
<td><tt class="literal">$</tt></td>
<td><tt class="literal">$cents</tt></td>
<td>An individual value (number or string)</td>
</tr>
<tr style="text-align:left;">
<td>Array</td>
<td><tt class="literal">@</tt></td>
<td><tt class="literal">@large</tt></td>
<td>A list of values, keyed by number</td>
</tr>
<tr style="text-align:left;">
<td>Hash</td>
<td><tt class="literal">%</tt></td>
<td><tt class="literal">%interest</tt></td>
<td>A group of values, keyed by string<a name="INDEX-42"></a></td>
</tr>
<tr style="text-align:left;">
<td>Subroutine</td>
<td><tt class="literal">&amp;</tt></td>
<td><tt class="literal">&amp;how</tt></td>
<td>A callable chunk of Perl code<a name="INDEX-43"></a><a name="INDEX-44"></a></td>
</tr>
<tr style="text-align:left;">
<td>Typeglob</td>
<td><tt class="literal">*</tt></td>
<td><tt class="literal">*struck</tt></td>
<td>Everything named&nbsp;<tt class="literal">struck</tt></td>
</tr>
</tbody>
</table>
</div>
<h4 style="font-size:10pt;"><a name="1_2_Singularities_374153536744"></a>1.2&nbsp;Singularities</h4>
<div style="margin-top:0;margin-bottom:0;">Strings and numbers are singular pieces of data, while lists of strings or numbers are plural.&nbsp;Scalar variables can be assigned any form of scalar value: integers, floating-point numbers, strings, and even esoteric things like references to other variables, or to objects.</div>
<div style="margin-top:0;margin-bottom:0;"></div>
<div style="margin-top:0;margin-bottom:0;">
<p style="margin:0;"><a name="INDEX-50"></a><a name="INDEX-51"></a><a name="INDEX-52"></a><a name="INDEX-53"></a><a name="INDEX-54"></a><a name="INDEX-55"></a><a name="INDEX-56"></a><a name="INDEX-57"></a><a name="INDEX-58"></a>As in the Unix&nbsp;shell, you can use different quoting mechanisms to make different kinds of values. Double quotation marks (double quotes) do&nbsp;<em class="emphasis">variable interpolation</em>&nbsp;and&nbsp;<em class="emphasis">backslash interpolation</em>&nbsp;(such as turning&nbsp;<tt class="literal">/n</tt>&nbsp;into a newline) while single quotes suppress interpolation. And backquotes (the ones leaning to the left``) will execute an external program and return the output of the program, so you can capture it as a single string containing all the lines of output.</p>
<blockquote style="border-color:#dddddd;border-style:dashed;border-width:1px;padding:10px;">
<pre class="programlisting">$answer = 42; # an integer
$pi = 3.14159265; # a "real" number
$avocados = 6.02e23; # scientific notation
$pet = "Camel"; # string
$sign = "I love my $pet"; # string with interpolation
$cost = 'It costs $100'; # string without interpolation
$thence = $whence; # another variable's value
$salsa = $moles * $avocados; # a gastrochemical expression
$exit = system("vi $file"); # numeric status of a command
$cwd = `pwd`; # string output from a command</pre>
</blockquote>
<p><a name="INDEX-59"></a><a name="INDEX-60"></a><a name="INDEX-61"></a><a name="INDEX-62"></a>And while we haven't covered fancy values yet, we should point out that scalars may also hold references to other data structures, including subroutines and objects.</p>
<blockquote style="border-color:#dddddd;border-style:dashed;border-width:1px;padding:10px;">
<pre class="programlisting">$ary = /@myarray; # reference to a named array
$hsh = /%myhash; # reference to a named hash
$sub = /&amp;mysub; # reference to a named subroutine

$ary = [1,2,3,4,5]; # reference to an unnamed array
$hsh = {Na =&gt; 19, Cl =&gt; 35}; # reference to an unnamed hash
$sub = sub { print $state }; # reference to an unnamed subroutine

$fido = new Camel "Amelia"; # reference to an object</pre>
</blockquote>
</div>
<div style="margin-top:0;margin-bottom:0;">Following the principle of least surprise, the variable is created with a null value, either&nbsp;<tt class="literal">""</tt>&nbsp;or&nbsp;<tt class="literal">0</tt>. Depending on where you use them, variables will be interpreted automatically as strings, as numbers, or as "true" and "false" values (commonly called Boolean values).&nbsp;Perl will automatically convert the data into the form required by the current context, within reason. For example, suppose you said this:</div>
<blockquote style="border-color:#dddddd;border-style:dashed;border-width:1px;padding:10px;">
<pre class="programlisting">$camels = '123';
print $camels + 1, "/n";</pre>
</blockquote>
<p>The original value of&nbsp;<tt class="literal">$camels</tt>&nbsp;is a string, but it is converted to a number to add&nbsp;<tt class="literal">1</tt>&nbsp;to it, and then converted back to a string to be printed out as&nbsp;<tt class="literal">124</tt>.</p>
<div style="margin-top:0;margin-bottom:0;"></div>
<div style="margin-top:0;margin-bottom:0;">
<p style="margin:0;">Similarly, a reference behaves as a reference when you give it a "dereference" context, but otherwise acts like a simple scalar value. For example, we might say:</p>
<blockquote style="border-color:#dddddd;border-style:dashed;border-width:1px;padding:10px;">
<pre class="programlisting">$fido = new Camel "Amelia";
if (not $fido) { die "dead camel"; }
$fido-&gt;saddle();</pre>
</blockquote>
</div>
<h4 style="font-size:10pt;"><a name="1_3_Pluralities_90712378174066"></a>1.3&nbsp;Pluralities</h4>
<div style="margin-top:0;margin-bottom:0;">Perl has two types of multivalued variables: arrays and hashes.</div>
<h5 style="font-size:8pt;"><a name="1_3_1_Array_20716473553329706_14659717492759228"></a>1.3.1 Array</h5>
<div style="margin-top:0;margin-bottom:0;">An&nbsp;<em class="emphasis">array</em>&nbsp;is an ordered list of scalars, accessed[6] by the scalar's position in the list.&nbsp;To assign a list value to an array, you simply group the values together (with a set of parentheses):</div>
<blockquote style="border-color:#dddddd;border-style:dashed;border-width:1px;padding:10px;">
<pre class="programlisting">@home = ("couch", "chair", "table", "stove");</pre>
</blockquote>
<p>Conversely, if you use&nbsp;<tt class="literal">@home</tt>&nbsp;in a list context, such as on the right side of a list assignment, you get back out the same list you put in. So you could set four scalar variables from the array like this:</p>
<blockquote style="border-color:#dddddd;border-style:dashed;border-width:1px;padding:10px;">
<pre class="programlisting">($potato, $lift, $tennis, $pipe) = @home;</pre>
</blockquote>
<p>These are called list assignments. They logically happen in parallel, so you can swap two variables by saying:</p>
<blockquote style="border-color:#dddddd;border-style:dashed;border-width:1px;padding:10px;">
<pre class="programlisting">($alpha,$omega) = ($omega,$alpha);</pre>
</blockquote>
<div style="margin-top:0;margin-bottom:0;">Arrays are zero-based.&nbsp;Array subscripts are enclosed in square brackets [like this], so if you want to select an individual array element, you would refer to it as&nbsp;<tt class="literal">$home[</tt><em class="replaceable">n</em><tt class="literal">].</tt></div>
<div style="margin-top:0;margin-bottom:0;"><span style="font-family:'-webkit-monospace';"><br /></span></div>
<div style="margin-top:0;margin-bottom:0;">Since arrays are ordered, you can do various useful operations on them, such as the stack operations&nbsp;<tt class="literal"><span style="font-family:Verdana;">push</span></tt>&nbsp;and&nbsp;<tt class="literal"><span style="font-family:Verdana;">pop</span></tt>.&nbsp;Perl regards the<strong>&nbsp;end&nbsp;</strong>of your array as the top of a stack.</div>
<h5 style="font-size:8pt;"><a name="1_3_2_Hash_35820974223315716_17378652468323708"></a>1.3.2 Hash</h5>
<div style="margin-top:0;margin-bottom:0;">A&nbsp;<em class="emphasis">hash</em>&nbsp;is an unordered set of scalars, accessed&nbsp;by some string value that is associated with each scalar. For this reason hashes are often called&nbsp;<em class="emphasis">associative arrays</em>. &nbsp;A hash has no beginning or end.&nbsp;Since the keys to a hash are not automatically implied by their position, you must supply the key as well as the value when populating a hash.</div>
<div style="text-align:left;margin-top:0;margin-bottom:0;"><span style="color:#000066;"><br /></span></div>
<div style="margin-top:0;margin-bottom:0;">
<p style="margin:0;">Suppose you wanted to translate abbreviated day names to the corresponding full names. You could write the following list assignment:</p>
<blockquote style="border-color:#dddddd;border-style:dashed;border-width:1px;padding:10px;">
<pre class="programlisting">%longday = ("Sun", "Sunday", "Mon", "Monday", "Tue", "Tuesday",
 "Wed", "Wednesday", "Thu", "Thursday", "Fri",
 "Friday", "Sat", "Saturday");</pre>
</blockquote>
<p><a name="INDEX-95"></a><a name="INDEX-96"></a><a name="INDEX-97"></a>But that's rather difficult to read, so Perl provides the&nbsp;<tt class="literal"><strong>=&gt;</strong></tt>&nbsp;(equals sign, greater-than sign) sequence as an alternative separator to the comma. Using this syntactic sugar (and some creative formatting), it is much easier to see which strings are the keys and which strings are the associated values.</p>
<blockquote style="border-color:#dddddd;border-style:dashed;border-width:1px;padding:10px;">
<pre class="programlisting">%longday = (
 "Sun" =&gt; "Sunday",
 "Mon" =&gt; "Monday",
 "Tue" =&gt; "Tuesday",
 "Wed" =&gt; "Wednesday",
 "Thu" =&gt; "Thursday",
 "Fri" =&gt; "Friday",
 "Sat" =&gt; "Saturday",
);</pre>
</blockquote>
</div>
<div style="margin-top:0;margin-bottom:0;">You can select an individual hash element by enclosing the key in braces (those fancy brackets also known as "curlies"). For example, if you want to find out the value associated with&nbsp;<tt class="literal">Wed</tt>&nbsp;in the hash above, you would use&nbsp;<tt class="literal">$longday{"Wed"}</tt>. Note again that you are dealing with a scalar value, so you use&nbsp;<tt class="literal">$</tt>&nbsp;on the front, not&nbsp;<tt class="literal">%</tt>, which would indicate the entire hash.</div>
<div style="margin-top:0;margin-bottom:0;"></div>
<div style="margin-top:0;margin-bottom:0;">
<p style="margin:0;">Linguistically, the relationship encoded in a hash is genitive or possessive, like the word "of" in English, or like "'s". The wife&nbsp;<em class="emphasis">of</em>&nbsp;Adam is Eve, so we write:</p>
<blockquote style="border-color:#dddddd;border-style:dashed;border-width:1px;padding:10px;">
<pre class="programlisting">$wife{"Adam"} = "Eve";</pre>
</blockquote>
</div>
<h5 style="font-size:8pt;"><a name="1_3_3_Complexities_52397375367"></a>1.3.3&nbsp;Complexities</h5>
<div style="margin-top:0;margin-bottom:0;">Perl lets you manipulate simple scalar references that happen to refer to complicated arrays and hashes.&nbsp;To extend our previous example, suppose we want to switch from talking about Adam's wife to Jacob's wife. Now, as it happens, Jacob had four wives. (Don't try this at home.) In trying to represent this in Perl, we find ourselves in the odd situation where we'd like to pretend that Jacob's four wives were really one wife. (Don't try this at home, either.) You might think you could write it like this:</div>
<blockquote style="border-color:#dddddd;border-style:dashed;border-width:1px;padding:10px;">
<pre class="programlisting">$wife{"Jacob"} = ("Leah", "Rachel", "Bilhah", "Zilpah"); # WRONG</pre>
</blockquote>
<p><a name="INDEX-106"></a><a name="INDEX-107"></a><a name="INDEX-108"></a><a name="INDEX-109"></a><a name="INDEX-110"></a>But that wouldn't do what you want, because even parentheses and commas are not powerful enough to turn a list into a scalar in Perl. (Parentheses are used for syntactic grouping, and commas for syntactic separation.) Rather, you need to tell Perl explicitly that you want to pretend that a list is a scalar. It turns out that square brackets are powerful enough to do that:&nbsp;&nbsp;</p>
<blockquote style="border-color:#dddddd;border-style:dashed;border-width:1px;padding:10px;">
<pre class="programlisting">$wife{"Jacob"} = ["Leah", "Rachel", "Bilhah", "Zilpah"]; # ok</pre>
</blockquote>
<div style="margin-top:0;margin-bottom:0;">That statement creates an unnamed array and puts a reference to it into the hash element&nbsp;<tt class="literal">$wife{"Jacob"}</tt>.</div>
<div style="margin-top:0;margin-bottom:0;"></div>
<div style="margin-top:0;margin-bottom:0;">suppose we wanted to list not only Jacob's wives but all the sons of each of his wives. In this case we want to treat a hash as a scalar. We can use braces for that. (Inside each hash value we'll use square brackets to represent arrays, just as we did earlier. But now we have an array in a hash in a hash.)</p>
<blockquote style="border-color:#dddddd;border-style:dashed;border-width:1px;padding:10px;">
<pre class="programlisting">$kids_of_wife{"Jacob"} = {
 "Leah" =&gt; ["Reuben", "Simeon", "Levi", "Judah", "Issachar", "Zebulun"],
 "Rachel" =&gt; ["Joseph", "Benjamin"],
 "Bilhah" =&gt; ["Dan", "Naphtali"],
 "Zilpah" =&gt; ["Gad", "Asher"],
};</pre>
</blockquote>
<p>That would be more or less equivalent to saying:</p>
<blockquote style="border-color:#dddddd;border-style:dashed;border-width:1px;padding:10px;">
<pre class="programlisting">$kids_of_wife{"Jacob"}{"Leah"}[0] = "Reuben";
$kids_of_wife{"Jacob"}{"Leah"}[1] = "Simeon";
$kids_of_wife{"Jacob"}{"Leah"}[2] = "Levi";
$kids_of_wife{"Jacob"}{"Leah"}[3] = "Judah";
$kids_of_wife{"Jacob"}{"Leah"}[4] = "Issachar";
$kids_of_wife{"Jacob"}{"Leah"}[5] = "Zebulun";
$kids_of_wife{"Jacob"}{"Rachel"}[0] = "Joseph";
$kids_of_wife{"Jacob"}{"Rachel"}[1] = "Benjamin";
$kids_of_wife{"Jacob"}{"Bilhah"}[0] = "Dan";
$kids_of_wife{"Jacob"}{"Bilhah"}[1] = "Naphtali";
$kids_of_wife{"Jacob"}{"Zilpah"}[0] = "Gad";
$kids_of_wife{"Jacob"}{"Zilpah"}[1] = "Asher";</pre>
</blockquote>
</div>
<h5 style="font-size:8pt;"><a name="1_3_4_Simplicities_95647719036"></a>1.3.4&nbsp;Simplicities</h5>
<div style="margin-top:0;margin-bottom:0;">
<p style="margin:0;"><a name="INDEX-121"></a><a name="INDEX-122"></a><a name="INDEX-123"></a>Perl also has several ways of topicalizing. One important topicalizer is the&nbsp;<tt class="literal">package</tt>&nbsp;declaration. Suppose you want to talk about&nbsp;<tt class="literal">Camel</tt>s in Perl. You'd likely start off your&nbsp;<tt class="literal">Camel</tt>&nbsp;module by saying:</p>
<blockquote style="border-color:#dddddd;border-style:dashed;border-width:1px;padding:10px;">
<pre class="programlisting">package Camel;</pre>
</blockquote>
</div>
<div style="margin-top:0;margin-bottom:0;">Perl will assume from this point on that any unspecified verbs or nouns are about&nbsp;<tt class="literal">Camel</tt>s. It does this by automatically prefixing any global name with the module name "<tt class="literal">Camel::</tt>".</div>
<div style="margin-top:0;margin-bottom:0;"></div>
<div style="margin-top:0;margin-bottom:0;">
<p style="margin:0;"><a name="INDEX-128"></a><a name="INDEX-129"></a>When you say&nbsp;<tt class="literal">package Camel</tt>, you're starting a new package. But sometimes you just want to borrow the nouns and verbs of an existing package. Perl lets you do that with a&nbsp;<tt class="literal">use</tt>&nbsp;declaration, which not only borrows verbs from another package, but also checks that the module you name is loaded in from disk. In fact, you&nbsp;<em class="emphasis">must</em>&nbsp;say something like:</p>
<blockquote style="border-color:#dddddd;border-style:dashed;border-width:1px;padding:10px;">
<pre class="programlisting">use Camel;</pre>
</blockquote>
<p>before you say:</p>
<blockquote style="border-color:#dddddd;border-style:dashed;border-width:1px;padding:10px;">
<pre class="programlisting">$fido = new Camel "Amelia";</pre>
</blockquote>
</div>
<div style="margin-top:0;margin-bottom:0;">
<p style="margin:0;">In fact, some of the built-in modules don't actually introduce verbs at all, but simply warp the Perl language in various useful ways. These special modules we call&nbsp;<em class="emphasis">pragmas</em>. For instance, you'll often see people use the pragma&nbsp;<tt class="literal">strict</tt>, like this:</p>
<blockquote style="border-color:#dddddd;border-style:dashed;border-width:1px;padding:10px;">
<pre class="programlisting">use strict;</pre>
</blockquote>
</div>
<h4 style="font-size:10pt;"><a name="1_4_Verbs_7150770369917154_6162498742341995"></a>1.4 Verbs</h4>
<div style="margin-top:0;margin-bottom:0;">Many of the verbs in Perl are commands: they tell the Perl interpreter to do something.&nbsp;A statement starting with a verb is generally purely imperative and evaluated entirely for its side effects. (We sometimes call these verbs&nbsp;<em class="emphasis">procedures</em>, especially when they're user-defined.)</div>
<div style="margin-top:0;margin-bottom:0;"></div>
<div style="margin-top:0;margin-bottom:0;">Other verbs translate their input parameters into return values, just as a recipe tells you how to turn raw ingredients into something (hopefully) edible. We tend to call these verbs&nbsp;<em class="emphasis">functions.</em></div>
<div style="margin-top:0;margin-bottom:0;"></div>
<div style="margin-top:0;margin-bottom:0;">Verbs are also sometimes called operators (when built-in), or subroutines (when user-defined).&nbsp;Historically, Perl required you to put an ampersand character (<tt class="literal">&amp;</tt>) on any calls to user-defined subroutines (see&nbsp;<tt class="literal">$fido = &amp;fetch();</tt>&nbsp;earlier). But with Perl version 5, the ampersand became optional, so that user-defined verbs can now be called with the same syntax as built-in verbs (<tt class="literal">$fido = fetch();</tt>).&nbsp;We still use the ampersand when talking about the&nbsp;<em class="emphasis">name</em>&nbsp;of the routine, such as when we take a reference to it (<tt class="literal">$fetcher = /&amp;fetch;</tt>).</div>
<div style="margin-top:0;margin-bottom:0;"></div>
<h4 style="font-size:10pt;"><a name="1_5_Filehandles_12350966874510"></a>1.5 Filehandles</h4>
<div style="margin-top:0;margin-bottom:0;">A filehandle is just a name you give to a file, device, socket, or pipe to help you remember which one you're talking about, and to hide some of the complexities of buffering and such. (Internally, filehandles are similar to streams from a language like C++ or I/O channels from BASIC.)</div>
<div style="margin-top:0;margin-bottom:0;"></div>
<div style="margin-top:0;margin-bottom:0;">You create a filehandle and attach it to a file by using<strong>&nbsp;</strong><tt class="literal"><strong>open</strong></tt>. The&nbsp;<tt class="literal"><strong>open</strong></tt>&nbsp;function takes at least two parameters: the filehandle and filename you want to associate it with. Perl also gives you some predefined (and preopened) filehandles.&nbsp;<tt class="literal"><strong>STDIN</strong></tt>&nbsp;is your program's normal input channel, while&nbsp;<tt class="literal"><strong>STDOUT</strong></tt>&nbsp;is your program's normal output channel. And&nbsp;<tt class="literal"><strong>STDERR</strong></tt>&nbsp;is an additional output channel that allows your program to make snide remarks off to the side while it transforms (or attempts to transform) your input into your output.</div>
<div style="margin-top:0;margin-bottom:0;"></div>
<div style="margin-top:0;margin-bottom:0;">
<blockquote style="border-color:#dddddd;border-style:dashed;border-width:1px;padding:10px;">
<pre class="programlisting">open(SESAME, "filename") # read from existing file
open(SESAME, "&lt;filename") # (same thing, explicitly)
open(SESAME, "&gt;filename") # create file and write to it
open(SESAME, "&gt;&gt;filename") # append to existing file
open(SESAME, "| output-pipe-command") # set up an output filter
open(SESAME, "input-pipe-command |") # set up an input filter</pre>
</blockquote>
<p>As you can see, the name you pick for the filehandle is arbitrary. Once opened, the filehandle&nbsp;<tt class="literal">SESAME</tt>&nbsp;can be used to access the file or pipe until it is explicitly closed (with, you guessed it,&nbsp;<tt class="literal"><strong>close(SESAME)</strong></tt>), or until the filehandle is attached to another file by a subsequent&nbsp;<tt class="literal">open</tt>&nbsp;on the same filehandle.</div>
<div style="margin-top:0;margin-bottom:0;"></div>
<div style="margin-top:0;margin-bottom:0;">Once you've opened a filehandle for input, you can read a line using the line reading operator,&nbsp;<tt class="literal">&lt;</tt><tt class="literal">&gt;</tt>.&nbsp;<span style="text-decoration:underline;">The angle operator encloses the filehandle (</span><tt class="literal"><span style="text-decoration:underline;">&lt;SESAME&gt;</span></tt><span style="text-decoration:underline;">) you want to read lines from. The empty angle operator,&nbsp;</span><tt class="literal"><span style="text-decoration:underline;">&lt;&gt;</span></tt><span style="text-decoration:underline;">, will read lines from all the files specified on the command line, or&nbsp;</span><tt class="literal"><span style="text-decoration:underline;">STDIN</span></tt><span style="text-decoration:underline;">, if none were specified</span>.</div>
<div style="margin-top:0;margin-bottom:0;"></div>
<div style="margin-top:0;margin-bottom:0;">
<p style="margin:0;">An example using the&nbsp;<tt class="literal">STDIN</tt>&nbsp;filehandle to read an answer supplied by the user would look something like this:</p>
<blockquote style="border-color:#dddddd;border-style:dashed;border-width:1px;padding:10px;">
<pre class="programlisting">print STDOUT "Enter a number: "; # ask for a number
$number = &lt;STDIN&gt;; # input the number
print STDOUT "The number is $number./n"; # print the number</pre>
</blockquote>
</div>
<div style="margin-top:0;margin-bottom:0;">
<p style="margin:0;"><a name="INDEX-187"></a><a name="INDEX-188"></a><a name="INDEX-189"></a>If you try the previous example, you may notice that you get an extra blank line. This happens because the line-reading operation does not automatically remove the newline from your input line (your input would be, for example, "<tt class="literal">9/n</tt>"). For those times when you do want to remove the newline, Perl provides the&nbsp;<tt class="literal"><strong>chop</strong></tt>&nbsp;and&nbsp;<tt class="literal"><strong>chomp</strong></tt>&nbsp;functions.&nbsp;<tt class="literal"><span style="text-decoration:underline;">chop</span></tt><span style="text-decoration:underline;">&nbsp;will indiscriminately remove (and return) the last character of the string, while&nbsp;</span><tt class="literal"><span style="text-decoration:underline;">chomp</span></tt><span style="text-decoration:underline;">&nbsp;will only remove the end of record marker (generally, "</span><tt class="literal"><span style="text-decoration:underline;">/n</span></tt><span style="text-decoration:underline;">") and return the number of characters so removed.&nbsp;</span>You'll often see this idiom for inputting a single line:</p>
<blockquote style="border-color:#dddddd;border-style:dashed;border-width:1px;padding:10px;">
<pre class="programlisting">chop($number = &lt;STDIN&gt;); # input number and remove newline</pre>
</blockquote>
</div>
<h3 style="font-size:12pt;"><a name="2_Operators__668523520231247"></a>2 Operators</h3>
<h4 style="font-size:10pt;"><a name="2_1_Some_Binary_Arithmetic_Ope_7225654777139425"></a>2.1&nbsp;Some Binary Arithmetic Operators</h4>
<div style="margin-top:0;margin-bottom:0;">
<table style="font-size:1em;line-height:inherit;" border="1">
<tbody>
<tr style="text-align:left;">
<th>Example</th>
<th>Name</th>
<th>Result</th>
</tr>
<tr style="text-align:left;">
<td><tt class="literal">$a + $b</tt></td>
<td>Addition</td>
<td>Sum of&nbsp;<tt class="literal">$a</tt>&nbsp;and&nbsp;<tt class="literal">$b</tt><a name="INDEX-198"></a></td>
</tr>
<tr style="text-align:left;">
<td><tt class="literal">$a * $b</tt></td>
<td>Multiplication</td>
<td>Product of&nbsp;<tt class="literal">$a</tt>&nbsp;and&nbsp;<tt class="literal">$b</tt><a name="INDEX-199"></a></td>
</tr>
<tr style="text-align:left;">
<td><tt class="literal">$a % $b</tt></td>
<td>Modulus</td>
<td>Remainder of&nbsp;<tt class="literal">$a</tt>&nbsp;divided by&nbsp;<tt class="literal">$b</tt></td>
</tr>
<tr style="text-align:left;">
<td><tt class="literal">$a ** $b</tt></td>
<td>Exponentiation</td>
<td><tt class="literal">$a</tt>&nbsp;to the power of&nbsp;<tt class="literal">$b</tt></td>
</tr>
</tbody>
</table>
</div>
<h4 style="font-size:10pt;"><a name="2_2_String_Operators__7529557030647993"></a>2.2&nbsp;String Operators</h4>
<div style="margin-top:0;margin-bottom:0;">
<p style="margin:0;">Perl defines a separate operator (<tt class="literal">.</tt>) for string concatenation:</p>
<blockquote style="border-color:#dddddd;border-style:dashed;border-width:1px;padding:10px;">
<pre class="programlisting">$a = 123;
$b = 456;
print $a + $b; # prints 579
print $a . $b; # prints 123456</pre>
</blockquote>
</div>
<div style="margin-top:0;margin-bottom:0;">
<p style="margin:0;"><a name="INDEX-211"></a><a name="INDEX-212"></a><a name="INDEX-213"></a>There's also a "multiply" operator for strings, called the&nbsp;<em class="emphasis">repeat</em>&nbsp;operator. Again, it's a separate operator (<tt class="literal">x</tt>) to keep it distinct from numeric multiplication:</p>
<blockquote style="border-color:#dddddd;border-style:dashed;border-width:1px;padding:10px;">
<pre class="programlisting">$a = 123;
$b = 3;
print $a * $b; # prints 369
print $a x $b; # prints 123123123</pre>
</blockquote>
</div>
<div style="margin-top:0;margin-bottom:0;">
<p style="margin:0;">The&nbsp;<tt class="literal">x</tt>&nbsp;operator may seem relatively worthless at first glance, but it is quite useful at times, especially for things like this:</p>
<blockquote style="border-color:#dddddd;border-style:dashed;border-width:1px;padding:10px;">
<pre class="programlisting">print "-" x $scrwid, "/n";</pre>
</blockquote>
<p>which draws a line across your screen, presuming&nbsp;<tt class="literal">$scrwid</tt>&nbsp;contains your screen width, and not your screw identifier.</div>
<h4 style="font-size:10pt;"><a name="2_3_Assignment_Operators__48074441868811846"></a>2.3 Assignment Operators</h4>
<div style="margin-top:0;margin-bottom:0;">You can do shortcut with almost any binary operator in Perl, even some that you can't do it with in C:</p>
<blockquote style="border-color:#dddddd;border-style:dashed;border-width:1px;padding:10px;">
<pre class="programlisting">$line .= "/n"; # Append newline to $line.
$fill x= 80; # Make string $fill into 80 repeats of itself.
$val ||= "2"; # Set $val to 2 if it isn't already "true".</pre>
</blockquote>
</div>
<h4 style="font-size:10pt;"><a name="2_4_Unary_Arithmetic_Operators_7676581423729658"></a>2.4 Unary Arithmetic Operators</h4>
<div style="margin-top:0;margin-bottom:0;">
<table style="font-size:1em;line-height:inherit;" border="1">
<tbody>
<tr style="text-align:left;">
<th>Example</th>
<th>Name</th>
<th>Result</th>
</tr>
<tr style="text-align:left;">
<td><tt class="literal">++$a, $a++</tt></td>
<td>Autoincrement</td>
<td>Add 1 to&nbsp;<tt class="literal">$a</tt></td>
</tr>
<tr style="text-align:left;">
<td><tt class="literal">--$a, $a--</tt></td>
<td>Autodecrement</td>
<td>Subtract 1 from&nbsp;<tt class="literal">$a</tt></td>
</tr>
</tbody>
</table>
</div>
<div style="margin-top:0;margin-bottom:0;">The same with C.</div>
<h4 style="font-size:10pt;"><a name="2_5_Logical_Operators__22455949615687132"></a>2.5 Logical Operators</h4>
<div style="margin-top:0;margin-bottom:0;">
<table style="font-size:1em;line-height:inherit;" border="1">
<tbody>
<tr style="text-align:left;">
<th>Example</th>
<th>Name</th>
<th>Result</th>
</tr>
<tr style="text-align:left;">
<td><tt class="literal">$a &amp;&amp; $b</tt></td>
<td>And</td>
<td><tt class="literal">$a</tt>&nbsp;if&nbsp;<tt class="literal">$a</tt>&nbsp;is false,&nbsp;<tt class="literal">$b</tt>&nbsp;otherwise<a name="INDEX-242"></a><a name="INDEX-243"></a></td>
</tr>
<tr style="text-align:left;">
<td><tt class="literal">$a || $b</tt></td>
<td>Or</td>
<td><tt class="literal">$a</tt>&nbsp;if&nbsp;<tt class="literal">$a</tt>&nbsp;is true,&nbsp;<tt class="literal">$b</tt>&nbsp;otherwise<a name="INDEX-244"></a><a name="INDEX-245"></a></td>
</tr>
<tr style="text-align:left;">
<td><tt class="literal">! $a</tt></td>
<td>Not</td>
<td>True if&nbsp;<tt class="literal">$a</tt>&nbsp;is not true</td>
</tr>
<tr style="text-align:left;">
<td><tt class="literal">$a and $b</tt></td>
<td>And</td>
<td><tt class="literal">$a</tt>&nbsp;if&nbsp;<tt class="literal">$a</tt>&nbsp;is false,&nbsp;<tt class="literal">$b</tt>&nbsp;otherwise</td>
</tr>
<tr style="text-align:left;">
<td><tt class="literal">$a or $b</tt></td>
<td>Or</td>
<td><tt class="literal">$a</tt>&nbsp;if&nbsp;<tt class="literal">$a</tt>&nbsp;is true,&nbsp;<tt class="literal">$b</tt>&nbsp;otherwise<a name="INDEX-246"></a></td>
</tr>
<tr style="text-align:left;">
<td><tt class="literal">not $a</tt></td>
<td>Not</td>
<td>True if&nbsp;<tt class="literal">$a</tt>&nbsp;is not true</td>
</tr>
<tr style="text-align:left;">
<td><tt class="literal">$a xor $b</tt></td>
<td>Xor</td>
<td>True if&nbsp;<tt class="literal">$a</tt>&nbsp;or&nbsp;<tt class="literal">$b</tt>&nbsp;is true, but not both<a name="INDEX-247"></a></td>
</tr>
</tbody>
</table>
</div>
<h4 style="font-size:10pt;"><a name="2_6_Some_Numeric_and_String_Co_6402344861999154"></a>2.6&nbsp;Some Numeric and String Comparison Operators</h4>
<div style="margin-top:0;margin-bottom:0;">
<table style="font-size:1em;line-height:inherit;" border="1">
<tbody>
<tr style="text-align:left;">
<th>Comparison</th>
<th>Numeric</th>
<th>String</th>
<th>Return Value</th>
</tr>
<tr style="text-align:left;">
<td>Equal</td>
<td><tt class="literal">==</tt></td>
<td><tt class="literal">eq</tt></td>
<td>True if&nbsp;<tt class="literal">$a</tt>&nbsp;is equal to&nbsp;<tt class="literal">$b</tt><a name="INDEX-257"></a></td>
</tr>
<tr style="text-align:left;">
<td>Not equal</td>
<td><tt class="literal">!=</tt></td>
<td><tt class="literal">ne</tt></td>
<td>True if&nbsp;<tt class="literal">$a</tt>&nbsp;is not equal to&nbsp;<tt class="literal">$b</tt><a name="INDEX-258"></a></td>
</tr>
<tr style="text-align:left;">
<td>Less than</td>
<td><tt class="literal">&lt;</tt></td>
<td><tt class="literal">lt</tt></td>
<td>True if&nbsp;<tt class="literal">$a</tt>&nbsp;is less than&nbsp;<tt class="literal">$b</tt><a name="INDEX-259"></a></td>
</tr>
<tr style="text-align:left;">
<td>Greater than</td>
<td><tt class="literal">&gt;</tt></td>
<td><tt class="literal">gt</tt></td>
<td>True if&nbsp;<tt class="literal">$a</tt>&nbsp;is greater than&nbsp;<tt class="literal">$b</tt><a name="INDEX-260"></a></td>
</tr>
<tr style="text-align:left;">
<td>Less than or equal</td>
<td><tt class="literal">&lt;=</tt></td>
<td><tt class="literal">le</tt></td>
<td>True if&nbsp;<tt class="literal">$a</tt>&nbsp;not greater than&nbsp;<tt class="literal">$b</tt><a name="INDEX-261"></a></td>
</tr>
<tr style="text-align:left;">
<td>Comparison</td>
<td><tt class="literal">&lt;=&gt;</tt></td>
<td><tt class="literal">cmp</tt></td>
<td>0 if equal, 1 if&nbsp;<tt class="literal">$a</tt>&nbsp;greater, -1 if&nbsp;<tt class="literal">$b</tt>&nbsp;greater</td>
</tr>
</tbody>
</table>
</div>
<h4 style="font-size:10pt;"><a name="2_7_Some_File_Test_Operators__26567320991307497"></a>2.7&nbsp;Some File Test Operators</h4>
<div style="margin-top:0;margin-bottom:0;">
<p style="margin:0;">Here are a few of the file test operators:</p>
<p><a name="perl3-tab-over-file"></a></p>
<table style="font-size:1em;line-height:inherit;" border="1">
<tbody>
<tr style="text-align:left;">
<th>Example</th>
<th>Name</th>
<th>Result</th>
</tr>
<tr style="text-align:left;">
<td><tt class="literal">-e $a</tt></td>
<td>Exists</td>
<td>True if file named in&nbsp;<tt class="literal">$a</tt>&nbsp;exists<a name="INDEX-270"></a></td>
</tr>
<tr style="text-align:left;">
<td><tt class="literal">-r $a</tt></td>
<td>Readable</td>
<td>True if file named in&nbsp;<tt class="literal">$a</tt>&nbsp;is readable<a name="INDEX-271"></a><a name="INDEX-272"></a></td>
</tr>
<tr style="text-align:left;">
<td><tt class="literal">-w $a</tt></td>
<td>Writable</td>
<td>True if file named in&nbsp;<tt class="literal">$a</tt>&nbsp;is writable<a name="INDEX-273"></a><a name="INDEX-274"></a></td>
</tr>
<tr style="text-align:left;">
<td><tt class="literal">-d $a</tt></td>
<td>Directory</td>
<td>True if file named in&nbsp;<tt class="literal">$a</tt>&nbsp;is a directory<a name="INDEX-275"></a><a name="INDEX-276"></a></td>
</tr>
<tr style="text-align:left;">
<td><tt class="literal">-f $a</tt></td>
<td>File</td>
<td>True if file named in&nbsp;<tt class="literal">$a</tt>&nbsp;is a regular file<a name="INDEX-277"></a><a name="INDEX-278"></a></td>
</tr>
<tr style="text-align:left;">
<td><tt class="literal">-T $a</tt></td>
<td>Text File</td>
<td>True if file named in&nbsp;<tt class="literal">$a</tt>&nbsp;is a text file<a name="INDEX-279"></a><a name="INDEX-280"></a></td>
</tr>
</tbody>
</table>
<p style="margin:0;">You might use them like this:</p>
<blockquote style="border-color:#dddddd;border-style:dashed;border-width:1px;padding:10px;">
<pre class="programlisting">-e "/usr/bin/perl" or warn "Perl is improperly installed/n";
-f "/vmlinuz" and print "I see you are a friend of Linus/n";</pre>
</blockquote>
</div>
<h3 style="font-size:12pt;"><a name="3_Control_Structures__5578092923387885"></a>3 Control Structures</h3>
<h4 style="font-size:10pt;"><a name="3_1_Truth__13155366573482752"></a>3.1 Truth</h4>
<div style="margin-top:0;margin-bottom:0;">
<p style="margin:0;"><a name="INDEX-290"></a><span style="text-decoration:underline;">Truth in Perl is always evaluated in a scalar context.</span>&nbsp;Other than that, no type coercion is done. So here are the rules for the various kinds of values a scalar can hold:</p>
<ol style="margin-top:0;margin-bottom:0;">
<li style="margin-top:0;margin-bottom:0;">
<p style="margin:0;"><span style="color:#0000ff;">Any string is true except for&nbsp;</span><tt class="literal"><span style="color:#0000ff;">""</span></tt><span style="color:#0000ff;">&nbsp;and&nbsp;</span><tt class="literal"><span style="color:#0000ff;">"0"</span></tt><span style="color:#0000ff;">.</span><span style="color:#0000ff;"><a name="INDEX-291"></a></span></p>
</li>
<li style="margin-top:0;margin-bottom:0;">
<p style="margin:0;"><span style="color:#0000ff;">Any number is true except for 0.</span><span style="color:#0000ff;"><a name="INDEX-292"></a></span></p>
</li>
<li style="margin-top:0;margin-bottom:0;">
<p style="margin:0;"><span style="color:#0000ff;">Any reference is true.</span><span style="color:#0000ff;"><a name="INDEX-293"></a></span></p>
</li>
<li style="margin-top:0;margin-bottom:0;">
<p style="margin:0;"><span style="color:#0000ff;">Any undefined value is false.&nbsp;</span></p>
</li>
</ol>
</div>
<div style="margin-top:0;margin-bottom:0;">For example:</div>
<div style="margin-top:0;margin-bottom:0;"><span style="font-family:verdana;"><br />
</span>
<pre style="color:#000066;font-size:120%;">"0.00" + 0 # would become the number 0 (coerced by the +), so false.
/$a # is a reference to $a, so true, even if $a is false.
undef() # is a function returning the undefined value, so false.</pre>
</div>
<p></span></p>

        </div>
        <a href="javascript:void(0);" style="float:right" onclick="window.scrollTo(0, 0);">Top</a>
        <div style="clear: both;"></div>
      </div>
    </div>
    
    <div class="main-container shadow">
      <div class="mainbody">
        <h2><a href="/2008/12/24/get-ip-addr-from-host-name">由服务器名字(Host name)获得IP地址</a></h2>
        <p>
          Posted by <strong>Bo Yang</strong> at <strong>2008-12-24</strong> with tags <a href="/tags.html#C-ref" rel="nofollow">C</a>, <a href="/tags.html#Network/Telecom-ref" rel="nofollow">Network/Telecom</a>, <a href="/tags.html#Unix/Linux-ref" rel="nofollow">Unix/Linux</a>
        </p>
        
        <div class="post_at_index thepost">
        <p>
    一下代码可以根据host name获得IP地址：
<div>
<div class="highlighter">
<ol start="1" class="highlighter-c">
<li><span class="preprocessor">#include &lt;stdio.h&gt;</span><span></span></li>
<li class="alt"><span></span><span class="preprocessor">#include &lt;netdb.h&gt;</span><span></span></li>
<li><span></span><span class="preprocessor">#include &lt;sys/socket.h&gt;</span><span></span></li>
<li class="alt"><span></span><span class="preprocessor">#include &lt;arpa/inet.h&gt;</span><span></span></li>
<li><span></span><span class="preprocessor">#include &lt;netinet/in.h&gt;</span><span></span></li>
<li class="alt"><span></span></li>
<li><span></span><span class="keyword">int</span><span> main(</span><span class="keyword">int</span><span> argc,</span><span class="keyword">char</span><span> **argv)</span></li>
<li class="alt"><span>{</span></li>
<li><span>    </span><span class="keyword">struct</span><span> hostent *hptr;</span></li>
<li class="alt"><span>    </span><span class="keyword">struct</span><span> in_addr *in_addr_ptr;</span></li>
<li><span>    </span><span class="keyword">char</span><span> *ptr,**pptr,**listptr,*addr_ptr;</span></li>
<li class="alt"><span>    </span><span class="keyword">char</span><span> str[32];</span></li>
<li><span>    </span><span class="comment">/*Host name--the first param*/</span><span></span></li>
<li class="alt"><span>    ptr=argv[1];</span></li>
<li><span>    </span><span class="keyword">if</span><span>((hptr=gethostbyname(ptr))==NULL)</span></li>
<li class="alt"><span>    {</span></li>
<li><span>        printf(</span><span class="string">"gethostbyname error for host: %s/n"</span><span>,ptr);</span></li>
<li class="alt"><span>        </span><span class="keyword">return</span><span> -1;</span></li>
<li><span>    }</span></li>
<li class="alt"><span>    </span><span class="comment">/*print official host name*/</span><span></span></li>
<li><span>    printf(</span><span class="string">"offial host name: %s/n"</span><span>,hptr-&gt;h_name);</span></li>
<li class="alt"><span>    </span><span class="comment">/*print all the aliases of the host*/</span><span></span></li>
<li><span>    </span><span class="keyword">for</span><span>(pptr=hptr-&gt;h_aliases;*pptr!=NULL;pptr++)</span></li>
<li class="alt"><span>        printf(</span><span class="string">"alias:%s/n"</span><span>,*pptr);</span></li>
<li><span></span></li>
<li class="alt"><span>    </span><span class="comment">/*print IP address*/</span><span></span></li>
<li><span>    </span><span class="keyword">switch</span><span> (hptr-&gt;h_addrtype) {</span></li>
<li class="alt"><span>    </span><span class="keyword">case</span><span> AF_INET:</span></li>
<li><span>        listptr = hptr-&gt;h_addr_list;</span></li>
<li class="alt"><span>        </span><span class="keyword">if</span><span> ( (in_addr_ptr = (</span><span class="keyword">struct</span><span> in_addr *) *listptr) != NULL) {</span></li>
<li><span></span></li>
<li class="alt"><span>            addr_ptr = inet_ntoa(*in_addr_ptr);</span></li>
<li><span>            </span></li>
<li class="alt"><span>            printf(</span><span class="string">"address: %s/n"</span><span>,addr_ptr);</span></li>
<li><span>        </span></li>
<li class="alt"><span>            </span><span class="keyword">return</span><span>(0);</span></li>
<li><span>        }</span></li>
<li class="alt"><span>        </span><span class="keyword">else</span><span> {</span></li>
<li><span>            </span><span class="keyword">return</span><span>(NULL);</span></li>
<li class="alt"><span>        }</span></li>
<li><span></span></li>
<li class="alt"><span>    </span><span class="keyword">default</span><span>:</span></li>
<li><span>        printf(</span><span class="string">"unknown address type %d/n"</span><span>,hptr-&gt;h_addrtype);</span></li>
<li class="alt"><span></span></li>
<li><span>        </span><span class="keyword">return</span><span>(NULL);</span></li>
<li class="alt"><span>    }</span></li>
<li><span></span></li>
<li class="alt"><span>    </span><span class="keyword">return</span><span> 0;</span></li>
<li><span>}</span></li>
<li class="alt"><span></span></li>
<li><span></span></li>
</ol>
</div>
<p><span class="Apple-style-span" style="color:rgb(0,0,0);font-family:verdana;line-height:18px;font-size:10pt;"></span>
<p style="text-indent:2em;line-height:22px;font-size:14px;margin:1em 0 .5em;padding:0;"><font size="4">struct hostent *gethostbyname(const char *name);<br />这个函数的传入值是域名或者主机名，例如"</font><a href="http://www.google.com%22%2C%22wpc/" style="text-decoration:none;color:rgb(51,102,153);"><font size="4">www.google.com","wpc</font></a><font size="4">"等等。<br />传出值，是一个hostent的结构（如下）。如果函数调用失败，将返回NULL。</font></p>
<p style="text-indent:2em;line-height:22px;font-size:14px;margin:1em 0 .5em;padding:0;"><font size="4">struct hostent {<br />  char  *h_name;<br />  char  **h_aliases;<br />  int   h_addrtype;<br />  int   h_length;<br />  char  **h_addr_list;<br />  };<br />解释一下这个结构：<br />其中，<br />  char *h_name 表示的是主机的规范名。例如</font><a href="http://www.google.com/" style="text-decoration:none;color:rgb(51,102,153);"><font size="4">www.google.com</font></a><font size="4">的规范名其实是</font><a href="http://www.l.google.com/" style="text-decoration:none;color:rgb(51,102,153);"><font size="4">www.l.google.com</font></a><font size="4">。<br />  char   **h_aliases 表示的是主机的别名。</font><a href="http://www.google.com/" style="text-decoration:none;color:rgb(51,102,153);"><font size="4">www.google.com</font></a><font size="4">就是google他自己的别名。有的时候，有的主机可能有好几个别名，这些，其实都是为了易于用户记忆而为自己的网站多取的名字。<br />  int   h_addrtype 表示的是主机ip地址的类型，到底是ipv4(AF_INET)，还是ipv6(AF_INET6)<br />  int   h_length 表示的是主机ip地址的长度<br />  int   **h_addr_lisst 表示的是主机的ip地址，注意，这个是以网络字节序存储的。千万不要直接用printf带%s参数来打这个东西，会有问题的哇。所以到真正需要打印出这个IP的话，需要调用inet_ntop()。</font></p>
<p style="text-indent:2em;line-height:22px;font-size:14px;margin:1em 0 .5em;padding:0;"><span class="Apple-style-span" style="font-size:18px;"><span class="Apple-style-span" style="color:rgb(128,128,128);font-family:新宋体;font-size:12px;line-height:14px;">#include &lt;arpa/inet.h&gt;</span><br /></span></p>
<p style="text-indent:2em;line-height:22px;font-size:14px;margin:1em 0 .5em;padding:0;"><font size="4">const char *inet_ntop(int af, const void *src, char *dst, socklen_t cnt) ：<br />这个函数，是将类型为af的网络地址结构src，转换成主机序的字符串形式，存放在长度为cnt的字符串中。<br />这个函数，其实就是返回指向dst的一个指针。如果函数调用错误，返回值是NULL。</font></p>
<p style="text-indent:2em;line-height:22px;font-size:14px;margin:1em 0 .5em;padding:0;"><span class="Apple-style-span" style="font-size:18px;">编译时要加上-lsocket选项，否则编译器将会报出invalid reference的错误。如： gcc -o name2addr name2addr.c -lsocket.</span></p>
</div>

        </div>
        <a href="javascript:void(0);" style="float:right" onclick="window.scrollTo(0, 0);">Top</a>
        <div style="clear: both;"></div>
      </div>
    </div>
    
    <div class="main-container shadow">
      <div class="mainbody">
        <h2><a href="/2008/12/04/return-ulong-pointer">return (((ulong*)(x))[-1])</a></h2>
        <p>
          Posted by <strong>Bo Yang</strong> at <strong>2008-12-04</strong> with tags <a href="/tags.html#C-ref" rel="nofollow">C</a>
        </p>
        
        <div class="post_at_index thepost">
        <p>
<span class="Apple-style-span" style="color:rgb(0,0,0);font-family:������;">看到一个函数，定义如下： </span>
<div>
<div class="highlighter">
<ol start="1" class="highlighter-c">
<li><span class="preprocessor">#include "u.h"</span><span></span></li>
<li class="alt"><span></span><span class="preprocessor">#include "lib.h"</span><span></span></li>
<li><span></span></li>
<li class="alt"><span></span><span class="keyword">ulong</span><span></span></li>
<li><span>getcallerpc(</span><span class="keyword">void</span><span> *x)</span></li>
<li class="alt"><span>{</span></li>
<li><span>    </span><span class="keyword">return</span><span> (((</span><span class="keyword">ulong</span><span>*)(x))[-1]);</span></li>
<li class="alt"><span>}</span></li>
<li><span></span></li>
<li class="alt"><span></span></li>
</ol>
</div>
<p><span class="Apple-style-span" style="color:rgb(0,0,0);font-family:������;">((ulong*)(x))  将void* 的x针针强制转换为 ulong* </p>
<p>此时可以理解为x指向一个ulong类型的数组 <br />[-1] : 表示去x前面的那个元素 </p>
<p>上面的代码等价与 </p>
<p>ulong px=（ulong*）x <br />--px <br />return (*px) </p>
<p>一般情况下不会用 下表-1,估计此处有什么特殊用法，要看实际是怎么用的了.<br /></span></div>
<div><span class="Apple-style-span" style="color:rgb(0,0,0);font-family:������;"><br /></span></div>
<div><span class="Apple-style-span" style="color:rgb(0,0,0);font-family:������;">------------------------------------------------------------------------</span></div>
<div><span class="Apple-style-span" style="color:rgb(0,0,0);font-family:������;"><br /></span></div>
<div><span class="Apple-style-span" style="color:rgb(0,0,0);font-family:������;">ulong getcallerpc(void *x) <br />{ <br />    return (((ulong*)(x))[-1]); <br />} </p>
<p>在((ulong*)(x))[-1] 中： <br />x是一个指针 <br />（ulong*)(x)：将x转换为ulong型的指针，我们假设（ulong*)(x)转换后指针为y，则 <br />((ulong*)(x))[-1]为：y[-1]，而y[-1]就指向y首地址前面的那个地址。这种情况只有 <br />当你自己知道前面那个地址是什么了，也就是楼上所说的特殊用法了。~_~<br /></span></div>

        </div>
        <a href="javascript:void(0);" style="float:right" onclick="window.scrollTo(0, 0);">Top</a>
        <div style="clear: both;"></div>
      </div>
    </div>
    
    <div class="main-container shadow">
      <div class="mainbody">
        <h2><a href="/2008/12/03/null-pointer">NULL Pointer Bugs</a></h2>
        <p>
          Posted by <strong>Bo Yang</strong> at <strong>2008-12-03</strong> with tags <a href="/tags.html#C-ref" rel="nofollow">C</a>, <a href="/tags.html#Unix/Linux-ref" rel="nofollow">Unix/Linux</a>
        </p>
        
        <div class="post_at_index thepost">
        <div style="min-height:1100px;font-family:Verdana;font-size:10pt;line-height:1;background-color:rgb(255,255,255);width:648px!important;border-color:rgb(204,204,204) rgb(187,187,187) rgb(187,187,187) rgb(204,204,204);border-style:solid;border-width:1px 2px 2px 1px;margin:15px auto 25px;padding:40px 50px;">
<h1 style="text-align:center;font-size:18pt;">NULL Pointer Bugs<br /></h1>
<div style="margin-top:0;margin-bottom:0;"></div>
<div style="margin-top:0;margin-bottom:0;"><span style="font-family:Charter;"><font size="3">A NULL character pointer is </font><b>NOT</b><font size="3"> the same as a pointer to a NULL string. In Solaris, the following program will lead to a "</font><span style="color:rgb(51,0,0);font-family:'courier new';white-space:pre;"><font size="2">Segmentation Fault</font><span style="color:rgb(0,0,0);font-family:Charter;white-space:normal;"><font size="3">".</font></span></span></span></div>
<div style="margin-top:0;margin-bottom:0;"><span style="font-family:Charter;"><br /><font size="3"></font></span></div>
<div style="margin-top:0;margin-bottom:0;">
<div style="margin-top:0;margin-bottom:0;">
<div class="highlighter">
<ol start="1" class="highlighter-c">
<li><span class="preprocessor">#include &lt;stdio.h&gt;</span><span></span></li>
<li class="alt"><span></span><span class="preprocessor">#include &lt;string.h&gt;</span><span></span></li>
<li><span></span></li>
<li class="alt"><span></span><span class="keyword">int</span><span> main()</span></li>
<li><span>{</span></li>
<li class="alt"><span>    </span><span class="keyword">char</span><span> *</span><span class="keyword">string</span><span>=NULL;</span></li>
<li><span></span></li>
<li class="alt"><span>    printf(</span><span class="string">"/n String length=%d"</span><span>,strlen(</span><span class="keyword">string</span><span>));</span></li>
<li><span></span></li>
<li class="alt"><span>    </span><span class="keyword">return</span><span> 0;</span></li>
<li><span>}</span></li>
</ol>
</div>
<p></div>
<div>I don't know hwy this happens clearly now, and it should be pay more attention.</div>
</div>
</div>

        </div>
        <a href="javascript:void(0);" style="float:right" onclick="window.scrollTo(0, 0);">Top</a>
        <div style="clear: both;"></div>
      </div>
    </div>
    
    <div class="main-container shadow">
      <div class="mainbody">
        <h2><a href="/2008/12/01/kshell-note-5">Korn Shell Notes(V)</a></h2>
        <p>
          Posted by <strong>Bo Yang</strong> at <strong>2008-12-01</strong> with tags <a href="/tags.html#Shell-ref" rel="nofollow">Shell</a>, <a href="/tags.html#Linux-ref" rel="nofollow">Linux</a>
        </p>
        
        <div class="post_at_index thepost">
        <p>
     <span class="Apple-style-span" style="color:rgb(0,0,0);font-family:Verdana;font-size:13px;"><span class="Apple-style-span" style="font-size:19px;font-style:italic;font-weight:bold;">19. Input/Output Commands</span><br />
<h2 style="font-size:14pt;"><span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span></h2>
<h3 style="font-size:12pt;"><a name="19_1_Escape_Characters_1455877" id="19_1_Escape_Characters_1455877"></a><span style="font-family:'Courier New';"><span style="font-family:Verdana;">19.1 Escape Characters</span></span></h3>
<h3 style="font-size:12pt;"><span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span></h3>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">
<div id="t.5t" style="text-align:center;margin-top:0;margin-bottom:0;padding:1em 0;"><img src="http://docs.google.com/File?id=dd6nw3mt_183d5p8rtgc_b" style="width:533px;height:397px;" /></p>
</div>
<p></span></span>
<div style="text-align:left;margin-top:0;margin-bottom:0;">The /c escape character causes the trailing newline to be dropped from the output. It is often used to create prompts.<br /><span style="font-family:'Courier New';">    $ print "Enter choice: /c"</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    Enter choice: $</span><br />Notice that the command prompt was displayed following the argument, and not on the next line.</p>
<h3 style="font-size:12pt;"><a name="19_2_print_Options_00785647007" id="19_2_print_Options_00785647007"></a>19.2 print Options</h3>
<div id="fkqi" style="text-align:center;margin-top:0;margin-bottom:0;padding:1em 0;"><img src="http://docs.google.com/File?id=dd6nw3mt_184ggh3tnpj_b" style="width:546px;height:518px;" />
<div style="text-align:left;margin-top:0;margin-bottom:0;">
<h3 style="font-size:12pt;"><a name="_19_3_The_exec_Command_3587034" id="_19_3_The_exec_Command_3587034"></a>19.3 The exec Command</h3>
<p>The <b>exec</b> command is used to perform I/O redirection with file descriptors 0 through 9 using this format:<br /><span style="font-family:Georgia;"><b>        exec</b> <i>I/O-redirection-command</i></span><br />The I/O redirection performed by the exec command stays in effect until specifically closed, changed, or if the script or shell terminates.</div>
</div>
<p>Here, file redir.out is opened as file descriptor 5 for reading and writing:<br /><span style="font-family:'Courier New';">    $ exec 5&lt;&gt;redir.out</span><br />Now the print command writes something to file descriptor 5:<br /><span style="font-family:'Courier New';">    $ print —u5 "This is going to fd 5"</span><br />and the cat command reads from it:<br /><span style="font-family:'Courier New';">    $ cat &lt;&amp;5</span><br style="font-family:'Courier New';" /></div>
<p><span style="font-family:'Courier New';"></span><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><span style="font-family:'Courier New';">    This is going to fd 5</span><br />To finish up, we use another exec to close file descriptor 5:<br />$ exec 5&lt;&amp;—</p>
<p>Standard input can be taken from a file like this:<br /><span style="font-family:'Courier New';">    exec 0&lt;file</span><br />Commands could be read in from file, and it would be almost as if you typed them at your terminal.</p>
<p></span></span><br />
<h3 style="font-size:12pt;"><a name="_19_4_The_read_Command_8516806" id="_19_4_The_read_Command_8516806"></a><span style="font-family:'Courier New';"><span style="font-family:Verdana;">19.4 The read Command</span></span></h3>
<h3 style="font-size:12pt;"><span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span></h3>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">The read command is used to read input from a terminal or file. The basic format for the read command is:<br /><span style="font-family:Georgia;"><b>        read</b> <i>variables</i></span><br />where a line is read from standard input. Each word in the input is assigned to a corresponding variable, so the first variable gets the first word, the second variable the second word, and so on. Here, "This is output" is read in to the variables X, Y, and Z. The first word of the input is This, so it is assigned to the first variable X. The second word is is, so it is assigned to the second variable Y. The third word is output, so it is assigned to Z.<br /><span style="font-family:'Courier New';">    $ print "This is output" | read X Y Z</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    $ print $X</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    This</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    $ print $Y</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    is</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    $ print $Z</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    output</span><br /><u><br />If there aren't enough variables for all the words in the input, the last variable gets all the remaining words.</u> This command is the same as the last one, except that an extra string "again" is given.<br /><span style="font-family:'Courier New';">    $ print "This is output again " | read X Y Z</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    $ print $X</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    This</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    $ print $Y</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    is</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    $ print $Z</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    output again</span>
<div id="przl" style="text-align:center;margin-top:0;margin-bottom:0;padding:1em 0;"><img src="http://docs.google.com/File?id=dd6nw3mt_185zd8vcvfj_b" style="width:541px;height:340px;" /></p>
</div>
<p></span></span>
<div style="text-align:left;margin-top:0;margin-bottom:0;">
<h4 style="font-size:10pt;"><a name="_19_4_1_Reading_Input_from_Fil" id="_19_4_1_Reading_Input_from_Fil"></a>19.4.1 Reading Input from Files</h4>
<p>The read command by itself will only read one line of input, so you need a looping command with it. To read in the contents of a file, use this format:<br /><b><span style="font-family:Georgia;">        exec </span></b><span style="font-family:Georgia;"><i><span style="font-family:Verdana;">0</span>&lt;file</i></span><b><br style="font-family:Georgia;" /><span style="font-family:Georgia;">        while read </span></b><span style="font-family:Georgia;"><i>variable</i></span><b><br style="font-family:Georgia;" /><span style="font-family:Georgia;">        do</span><br style="font-family:Georgia;" /></b><i><span style="font-family:Georgia;">                    commands</span></i><b><br style="font-family:Georgia;" /><span style="font-family:Georgia;">        done</span></b><br />The exec command opens file for standard input, and the while command causes input to be read a line at a time until there is no more input.</div>
<p><span style="font-family:'Courier New';"></span><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><br />Here is an alternate format that will also work for reading input from files:<br /><b><span style="font-family:Georgia;">        cat </span></b><span style="font-family:Georgia;"><i>file</i></span><b><span style="font-family:Georgia;"> | while read </span></b><i><span style="font-family:Georgia;">variable</span></i><b><br style="font-family:Georgia;" /><span style="font-family:Georgia;">        do</span><br style="font-family:Georgia;" /></b><i><span style="font-family:Georgia;">                commands</span></i><b><br style="font-family:Georgia;" /><span style="font-family:Georgia;">        done</span></b><br />On the systems tested, the exec format for reading input from files was about 40-60 times faster than the last version above.</p>
<p></span></span><br />
<h4 style="font-size:10pt;"><a name="_19_4_2_The_IFS_Variable_80535" id="_19_4_2_The_IFS_Variable_80535"></a><span style="font-family:'Courier New';"><span style="font-family:Verdana;">19.4.2 The IFS Variable</span></span></h4>
<h4 style="font-size:10pt;"><span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span></h4>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">The read command normally uses the IFS (Internal Field Separator) variable as the word separators. The default for IFS is space, tab, or snewline character, in that order, but it can be set to something else.<br />By setting IFS to :, the fields in the /etc/passwd file could be read into separate variables.<br /><span style="font-family:'Courier New';">    $ cat ifs_test</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    IFS=:</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    exec 0&lt;/etc/passwd</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    while read -r NAME PASS UID GID COMM HOME SHELL</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    do</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">        print "Account name= $NAME</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    Home directory= $HOME</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    Login Shell= $SHELL"</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    done</span></p>
<p></span></span><br />
<h3 style="font-size:12pt;"><a name="_19_4_3_Reading_Input_Interact" id="_19_4_3_Reading_Input_Interact"></a><span style="font-family:'Courier New';"><span style="font-family:Verdana;">19.4.3 Reading Input Interactively</span></span></h3>
<h3 style="font-size:12pt;"><span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span></h3>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">The read command allows input to be read interactively using this format:<br /><span style="font-family:Georgia;"><b>        read</b> <i>name</i><b>?</b><i>prompt</i></span><br />where </span></span><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><span style="font-family:Georgia;"><i>prompt</i></span></span></span><span style="font-family:'Courier New';"><span style="font-family:Verdana;"> is displayed on standard error and the response is read into </span></span><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><span style="font-family:Georgia;"><i>name</i></span></span></span><span style="font-family:'Courier New';"><span style="font-family:Verdana;">.</p>
<p>So instead of using two commands to display a prompt and read the input:<br /><span style="font-family:'Courier New';">    $ print —n "Enter anything: "</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    $ read ANSWER</span><br />The same thing can be done with one command.<br /><span style="font-family:'Courier New';">    $ read ANSWER?"Enter anything: "</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    Enter anything: ANYTHING</span><br />Here is ANSWER:<br /><span style="font-family:'Courier New';">    $ print $ANSWER</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    ANYTHING</span></p>
<p></span></span><br />
<h3 style="font-size:12pt;"><a name="_19_4_4_The_REPLY_variable_360" id="_19_4_4_The_REPLY_variable_360"></a><span style="font-family:'Courier New';"><span style="font-family:Verdana;">19.4.4 The<span style="font-family:Georgia;"> </span><b>REPLY</b> variable</span></span></h3>
<h3 style="font-size:12pt;"><span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span></h3>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">If no variables are given to the <b>read</b> command, the input is automatically assigned to the <b>REPLY</b> variable. Here, ANYTHING is read into REPLY:<br /><span style="font-family:'Courier New';">    $ print ANYTHING | read</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    $ print $REPLY</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    ANYTHING</span></p>
<p></span></span><br />
<h2 style="font-size:14pt;"><a name="_20_Miscellaneous_Programming_" id="_20_Miscellaneous_Programming_"></a><i><span style="font-family:'Courier New';"><span style="font-family:Verdana;">20 Miscellaneous Programming Features</span></span></i></h2>
<h2 style="font-size:14pt;"><span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span></h2>
<h3 style="font-size:12pt;"><a name="_20_1_The_Command_872161202132" id="_20_1_The_Command_872161202132"></a><span style="font-family:'Courier New';"><span style="font-family:Verdana;">20.1 The . Command</span></span></h3>
<h3 style="font-size:12pt;"><span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span></h3>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">The <b>.</b> command reads in a complete file, then executes the commands in it as if they were typed in at the prompt. This is done in the current shell, so any variable, alias, or function settings stay in effect. It is typically used to read in and execute a profile, environment, alias, or functions file. Here the .profile file is read in and executed:<br />$ . .profile</p>
<p>The following example illustrates the difference between executing files as Korn shell scripts and reading/executing them using the .command. The .test file sets the variable X:<br /><span style="font-family:'Courier New';">    $ cat .test</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    X=ABC</span><br /><u>When the .test file is executed as a Korn shell script, variable X is not defined in the current environment, because scripts are run in a subshell</u>:<br /><span style="font-family:'Courier New';">    $ ksh .test</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    $ print $X</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    $</span><br /><u>After the .test file is read in and executed using the . command, notice that the variable X is still defined</u>:<br /><span style="font-family:'Courier New';">    $ . .test</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    $ print $X</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    ABC</span><br />The standard search path, PATH, is checked if the file is not in the current directory.</p>
<p></span></span><br />
<h3 style="font-size:12pt;"><a name="_20_2_Functions_01172757241874" id="_20_2_Functions_01172757241874"></a><span style="font-family:'Courier New';"><span style="font-family:Verdana;">20.2 Functions</span></span></h3>
<h3 style="font-size:12pt;"><span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span></h3>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">Functions are most efficient for commands with arguments that are invoked fairly often, and are defined with the following format:</p>
<p><span style="font-family:Georgia;"><b>        function</b> <i>name</i> {</span><br style="font-family:Georgia;" /><i><span style="font-family:Georgia;">                commands</span></i><br style="font-family:Georgia;" /><span style="font-family:Georgia;">        }<br /></span><br />To maintain compatibility with the Bourne shell, functions can also be declared with this POSIX-style format:<br /><span style="font-family:Georgia;"><i>        function-name</i><b>()</b> {</span><br style="font-family:Georgia;" /><i><span style="font-family:Georgia;">                commands</span></i><br style="font-family:Georgia;" /><span style="font-family:Georgia;">        }</span><br style="font-family:Georgia;" /><br />These types of functions have many limitations compared to Korn shell style functions, such as no support for local variables.</p>
<p></span></span><br />
<h3 style="font-size:12pt;"><a name="_20_3_Scope_Availability_75594" id="_20_3_Scope_Availability_75594"></a><span style="font-family:'Courier New';"><span style="font-family:Verdana;">20.3 Scope &amp; Availability</span></span></h3>
<h3 style="font-size:12pt;"><span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span></h3>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">By default, functions are not available to subshells. This means that <u>a regular function that was read in your working environment, <b>.profile</b> file, or environment file would not be available in a Korn shell script.<br /></u><br />To export a function, use the <b>typeset -fx</b> command:<br /><b>        typeset -fx</b> <i>function-name</i></p>
<p>To make a function available across separate invocations of the Korn shell, include the </span></span><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><b> typeset -fx</b> <i>function-name</i></span></span><span style="font-family:'Courier New';"><span style="font-family:Verdana;"> command in the environment file.</p>
<p></span></span><br />
<h3 style="font-size:12pt;"><a name="_20_4_Function_Variables_90486" id="_20_4_Function_Variables_90486"></a><span style="font-family:'Courier New';"><span style="font-family:Verdana;">20.4 Function Variables</span></span></h3>
<h3 style="font-size:12pt;"><span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span></h3>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">All function variables, except those explicitly declared locally within the function with the <b>typeset</b> command, are inherited and shared by the calling Korn shell script. In this example, the X, Y, and Z variables are set within and outside of the function f:</p>
<p><span style="font-family:'Courier New';">    $ cat ftest</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    X=1</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    function f {</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">        Y=2</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">        typeset Z=4</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">        print "In function f, X=$X, Y=$Y, Z=$Z"</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">        X=3</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    }</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    f</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    print "Outside function f, X=$X, Y=$Y, Z=$Z"</span></p>
<p>Notice that when executed, all the variable values are shared between the function and calling script, except for variable Z, because it is explicitly set to a local function variable using the typeset command.<br />The value is not passed back to the calling Korn shell script:<br /><span style="font-family:'Courier New';">    $ ftest</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    In function f, X=1, Y=2, Z=4</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    Outside function f, X=3, Y=2, Z=</span></p>
<p>The current working directory, aliases, functions, traps, and open files from the invoking script or current environment are also shared with functions.</p>
<p></span></span><br />
<h3 style="font-size:12pt;"><a name="_20_5_Displaying_Current_Funct" id="_20_5_Displaying_Current_Funct"></a><span style="font-family:'Courier New';"><span style="font-family:Verdana;">20.5 Displaying Current Functions</span></span></h3>
<h3 style="font-size:12pt;"><span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span></h3>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">The list of currently available functions are displayed using the <b>typeset -f </b>command.</p>
<p></span></span><br />
<h3 style="font-size:12pt;"><a name="_20_6_Autoloading_Functions_38" id="_20_6_Autoloading_Functions_38"></a><span style="font-family:'Courier New';"><span style="font-family:Verdana;">20.6 Autoloading Functions</span></span></h3>
<h3 style="font-size:12pt;"><span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span></h3>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">To improve performance, functions can be specified to autoload. <u>This causes the function to be read in when invoked, instead of each time a Korn shell script is invoked, and is used with functions that are not invoked frequently</u>. To define an autoloading function, use the <span style="font-family:Georgia;"><b>typeset -fu</b> <i>function-name</i></span> command. Here, lsf is made an autoloading function:<br /><span style="font-family:'Courier New';">    $ typeset —fu lsf</span></p>
<p>The <b>autoload</b> alias can also be used to define an autoloading function. On most systems, it is preset to <b>typeset -fu</b>.</p>
<p>The <b>FPATH</b> variable which contains the pathnames to search for autoloading functions must be set and have at least one directory for autoloading functions to work.</p>
<p></span></span><br />
<h3 style="font-size:12pt;"><a name="_20_7_Discipline_Functions_023" id="_20_7_Discipline_Functions_023"></a><span style="font-family:'Courier New';"><span style="font-family:Verdana;">20.7 Discipline Functions</span></span></h3>
<h3 style="font-size:12pt;"><span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span></h3>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><u>Discipline functions are a special type of function used to manipulate variables. They are defined but not specifically called. Rather, they are called whenever the variable associated with the function is accessed.</u></p>
<p>There are some specific rules as to how discipline functions are named and accessed. First of all, discipline functions are named using this syntax:<br /><i><span style="font-family:Georgia;">       <b> </b><b>name.function</b></span></i></p>
<p>Notice the the funcion has two parts separated with a dot. <u>The first part name corresponds to the name of a variable, and the second part must be <b>get</b>, <b>set</b>, or <b>unset</b></u>. These correspond to the following operations on the variable:<br /></span></span>
<ul style="margin-top:0;margin-bottom:0;">
<li style="margin-top:0;margin-bottom:0;"><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><b>get</b>     whenever the base discipline variable is accessed</span></span></li>
<li style="margin-top:0;margin-bottom:0;"><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><b>set</b>     whenever the base discipline variable is set</span></span></li>
<li style="margin-top:0;margin-bottom:0;"><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><b>unset</b>     whenever the base discipline variable is unset</span></span></li>
</ul>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><br />For example, the discipline function LBIN.get, LBIN.set, LBIN.unset is called whenever the variable LBIN is accessed, set, or unset.</p>
<p>All three discipline functions are optional, so not all need to be specified. Within a discipline function, the following special reserved variables can be used:<br /></span></span>
<ul style="margin-top:0;margin-bottom:0;">
<li style="margin-top:0;margin-bottom:0;"><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><b>.sh.name</b>     name of current variable</span></span></li>
<li style="margin-top:0;margin-bottom:0;"><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><b>.sh.value</b>     value of the current variable</span></span></li>
<li style="margin-top:0;margin-bottom:0;"><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><b>.sh.subscript</b>     name of the subscript (if array variable)</span></span></li>
</ul>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><br />From a practical perspective, discipline functions are often used to help debug by tracing the setting and current value of variables in running scripts. Here is a function that can be used to trace setting the value of X:<br /><span style="font-family:'Courier New';">    function X.set {</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">        print "DEBUG: ${.sh.name} = ${.sh.value}"</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    }</span><br style="font-family:'Courier New';" /><br />Discipline functions are also a good place to centralize your variable assignment validation rules. Here is a function that checks to make sure that X it set ao a number between 3 and 10:<br /><span style="font-family:'Courier New';">    function X.set {</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">        if (( .sh.value&lt;3 || .sh.value &gt;10 ))</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">        then</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">            print "Bad value for ${.sh.name}: ${.sh.value}"</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">        fi</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    }</span></p>
<p>Note that <b>builtin</b> functions can also be used as additional discipline functions.</p>
<p></span></span><br />
<h3 style="font-size:12pt;"><a name="_20_8_FPATH_8677511420100927" id="_20_8_FPATH_8677511420100927"></a><span style="font-family:'Courier New';"><span style="font-family:Verdana;">20.8 FPATH</span></span></h3>
<h3 style="font-size:12pt;"><span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span></h3>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">The <b>FPATH</b> variable contains a list of colon-separated directories to check when an autoloading function is invoked. It is analogous to<b> PATH</b> and <b>CDPATH</b>, except that the Korn shell checks for function files, instead of commands or directories. Each directory in FPATH is searched from left-to-right for a file whose name matches the name of the function. Once found, it is read in and executed in the current environment. With the following <b>FPATH</b> setting, if an autoloading function <b>lsf</b> was invoked, the Korn shell would check for a file called <b>lsf</b> in <b>/home/anatole/.fdir</b>, then <b>/etc/.functions</b>, and if existent, read and execute it:</p>
<p><span style="font-family:'Courier New';">    $ print $FPATH</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    /home/anatole/.fdir:/etc/.functions</span></p>
<p>There is no default value for <b>FPATH</b>, so if not specifically set, this feature is not enabled.</p>
<p></span></span><br />
<h3 style="font-size:12pt;"><a name="_20_9_Removing_Function_Defini" id="_20_9_Removing_Function_Defini"></a><span style="font-family:'Courier New';"><span style="font-family:Verdana;">20.9 Removing Function Definitions</span></span></h3>
<h3 style="font-size:12pt;"><span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span></h3>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">Functions are removed by using the <b>unset -f</b> command. Here, the rd function is removed:<br /><span style="font-family:'Courier New';">    $ unset -f rd</span><br style="font-family:'Courier New';" /><br /></span></span><br />
<h3 style="font-size:12pt;"><a name="_20_10_Traps_9392005437985063" id="_20_10_Traps_9392005437985063"></a><span style="font-family:'Courier New';"><span style="font-family:Verdana;">20.10 Traps</span></span></h3>
<h3 style="font-size:12pt;"><span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span></h3>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">The trap command is used to execute commands when the specified signals are received.<br /><span style="font-family:Georgia;"><b>        trap</b> commands signals</span></p>
<p><u>Trap commands are useful in controlling side effects from Korn shell scripts</u>. For example, if you have a script that creates a number of temporary files, and you hit the &lt;BREAK&gt; or &lt;DELETE&gt; key in the middle of execution, you may inadvertently leave the temporary files. By setting a <b>trap</b> command, the temporary files can be cleaned up on an error or interrupt.</p>
<p>The <b>trap_test</b> script creates some files, then removes them when an interrupt is received. <span style="background-color:rgb(0,255,255);">Notice that the </span><b>trap</b><span style="background-color:rgb(0,255,255);"> command is surrounded in single quotes. This is so that the </span><b>FILES</b><span style="background-color:rgb(0,255,255);"> variable is evaluated when the signal is received, not when the trap is set.</span><br /><span style="font-family:'Courier New';">    $ cat trap_test</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    trap 'print "$0 interrupted - removing temp files" ;/</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    rm —rf $FILES; exit 1' 1 2</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    FILES="a b c d e f"</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    touch $FILES</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    sleep 100</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    $ trap_test</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    Ctl-c</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    trap_test interrupted - removing temp files</span></p>
<p>If an invalid trap is set, an error is generated.</p>
<p></span></span><br />
<h4 style="font-size:10pt;"><a name="_20_10_1_Ignoring_Signals_1856" id="_20_10_1_Ignoring_Signals_1856"></a><span style="font-family:'Courier New';"><span style="font-family:Verdana;">20.10.1 Ignoring Signals</span></span></h4>
<h3 style="font-size:12pt;"><span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span></h3>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">The <b>trap</b> command can be used to ignore signals by specifying null as the command argument:<br /><span style="font-family:Georgia;">        <b>trap  "" </b> <i>signals</i></span><br />This could be used to make all or part of a Korn shell script uninterruptable using normal interrupt keys like Ctl-c.</p>
<p></span></span><br />
<h4 style="font-size:10pt;"><a name="_20_10_2_Resetting_Traps_86836" id="_20_10_2_Resetting_Traps_86836"></a><span style="font-family:'Courier New';"><span style="font-family:Verdana;">20.10.2 Resetting Traps</span></span></h4>
<h4 style="font-size:10pt;"><span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span></h4>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">The trap command can also be used to reset traps to their default action by omitting the command argument:<br />    <b>trap</b> - <i>signals</i><br />or<br />    <b>trap</b><i> signals</i></p>
<p></span></span><br />
<h4 style="font-size:10pt;"><a name="_20_10_3_Exit_Function_Traps_3" id="_20_10_3_Exit_Function_Traps_3"></a><span style="font-family:'Courier New';"><span style="font-family:Verdana;">20.10.3 Exit &amp; Function Traps</span></span></h4>
<h4 style="font-size:10pt;"><span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span></h4>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">A trap can be set to execute when a Korn shell script exits. This is done by using a 0 or EXIT as the signals argument to the trap command:<br /><b>        trap</b> '<i><span style="font-family:Georgia;">commands</span></i>' <b>0</b><br />or<br /><b>        trap</b> '</span></span><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><i><span style="font-family:Georgia;">commands</span></i></span></span><span style="font-family:'Courier New';"><span style="font-family:Verdana;">' <b>EXIT</b><br />This could be used to consolidate Korn shell script cleanup functions into one place.<br /></span></span><br />
<h4 style="font-size:10pt;"><a name="_20_10_4_Trap_Signal_Precedenc" id="_20_10_4_Trap_Signal_Precedenc"></a><span style="font-family:'Courier New';"><span style="font-family:Verdana;">20.10.4 Trap Signal Precedence</span></span></h4>
<h3 style="font-size:12pt;"><span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span></h3>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">If multiple traps are set, the order of precedence is:<br /></span></span>
<ul style="margin-top:0;margin-bottom:0;">
<li style="margin-top:0;margin-bottom:0;"><b><span style="font-family:'Courier New';"><span style="font-family:Verdana;">DEBUG</span></span></b></li>
<li style="margin-top:0;margin-bottom:0;"><b><span style="font-family:'Courier New';"><span style="font-family:Verdana;">ERR</span></span></b></li>
<li style="font-family:Georgia;margin-top:0;margin-bottom:0;"><i>Signal Number</i></li>
<li style="margin-top:0;margin-bottom:0;"><b><span style="font-family:'Courier New';"><span style="font-family:Verdana;">EXIT</span></span></b></li>
</ul>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><br /></span></span><br />
<h4 style="font-size:10pt;"><a name="_20_10_5_Trapping_Keyboard_Sig" id="_20_10_5_Trapping_Keyboard_Sig"></a><span style="font-family:'Courier New';"><span style="font-family:Verdana;">20.10.5 Trapping Keyboard Signals</span></span></h4>
<h4 style="font-size:10pt;"><span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span></h4>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">The Korn shell traps <b>KEYBD</b> signals (sent when you type a character) and automatically assigns the following reserved variables:<br /></span></span>
<ul style="margin-top:0;margin-bottom:0;">
<li style="margin-top:0;margin-bottom:0;"><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><b>.sh.edchar</b>     contains last character of key sequence</span></span></li>
<li style="margin-top:0;margin-bottom:0;"><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><b>.sh.edtext</b>     contains current input line</span></span></li>
<li style="margin-top:0;margin-bottom:0;"><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><b>.sh.edmode</b>     contains NULL character (or escape character is user in command mode)</span></span></li>
<li style="margin-top:0;margin-bottom:0;"><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><b>.sh.edcol</b>     contains position within the current line</span></span></li>
</ul>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><br /></span></span><br />
<h3 style="font-size:12pt;"><a name="_20_11_Debugging_Korn_Shell_Sc" id="_20_11_Debugging_Korn_Shell_Sc"></a><span style="font-family:'Courier New';"><span style="font-family:Verdana;">20.11 Debugging Korn Shell Scripts</span></span></h3>
<h3 style="font-size:12pt;"><span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span></h3>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">The Korn shell provides a number of options that are useful in debugging scripts: <b>noexec</b>, <b>verbose</b>, and <b>xtrace</b>. The noexec option causes commands to be read without being executed. It is used to check for syntax errors in Korn shell scripts. The verbose option causes the input to be displayed as it is read. The xtrace option causes the commands in a script to be displayed as they are executed.</span></span></span>
<div><span class="Apple-style-span" style="color:rgb(0,0,0);font-family:Verdana;font-size:13px;"><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><img src="http://docs.google.com/File?id=dd6nw3mt_186cd3mp7hq_b&amp;writelyrefresh=0" /><br /></span></span></span>
<div><span class="Apple-style-span" style="color:rgb(0,0,0);font-family:Verdana;font-size:13px;">
<div style="text-align:left;margin-top:0;margin-bottom:0;">
<h4 style="font-size:10pt;">20.11.1 Debugging with trap</h4>
<p>The <b>trap</b> command can also be helpful in debugging Korn shell scripts. The syntax for this type of trap command is:<br /><b>        trap </b><i>commands</i><b> DEBUG</b><br />or<br /><b>        trap </b><i>commands</i><b> ERR</b></div>
<p><span style="font-family:'Courier New';"></span><span style="font-family:'Courier New';"><span style="font-family:Verdana;">
<div style="text-align:left;margin-top:0;margin-bottom:0;"><img src="http://docs.google.com/File?id=dd6nw3mt_1872q8bgfhj_b" style="width:459px;height:143px;" /></p>
<h3 style="font-size:12pt;"><a name="_20_12_Co_Processes_1690269969" id="_20_12_Co_Processes_1690269969"></a>20.12 Co-Processes</h3>
<p><u>Co-processes are commands that are terminated with a <b>|&amp;</b> character. They are executed in the background, but have their standard input and output attached to the current shell.</u><i> </i>The <b>print -p</b> command is used to write to the standard input of a co-process, while <b>read -p</b> is used to read from the standard output of a co-process. Here, the output of the date command is read into the DATE variable using the read -p command:<br /><span style="font-family:'Courier New';">    $ date |&amp;</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    [2] 241</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    $ read —p DATE</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    $ print $DATE</span><br style="font-family:'Courier New';" /><span style="font-family:'Courier New';">    Thu Jul 18 12:23:57 PST 1996</span><br />Co-processes can be used to edit a file from within a Korn shell script.</div>
<p></span></span><span style="font-family:'Courier New';"></span><span style="font-family:'Courier New';"><span style="font-family:Verdana;">
<div id="s_ck" style="text-align:center;margin-top:0;margin-bottom:0;padding:1em 0;"><img src="http://docs.google.com/File?id=dd6nw3mt_188f9s93ndw_b" style="width:562px;height:406px;" /></div>
<div id="s_ck" style="text-align:center;margin-top:0;margin-bottom:0;padding:1em 0;"><span class="Apple-style-span" style="color:rgb(255,0,0);font-size:28pt;"><span class="Apple-style-span" style="font-weight:bold;">THE END</span></span></div>
<div style="text-align:center;"></div>
<p></span></span></span></div>
</div>

        </div>
        <a href="javascript:void(0);" style="float:right" onclick="window.scrollTo(0, 0);">Top</a>
        <div style="clear: both;"></div>
      </div>
    </div>
    
    <div class="main-container shadow">
      <div class="mainbody">
        <h2><a href="/2008/11/30/kshell-note-4">Korn Shell Notes(IV)</a></h2>
        <p>
          Posted by <strong>Bo Yang</strong> at <strong>2008-11-30</strong> with tags <a href="/tags.html#Shell-ref" rel="nofollow">Shell</a>, <a href="/tags.html#Linux-ref" rel="nofollow">Linux</a>
        </p>
        
        <div class="post_at_index thepost">
        <div id="yn69" style="padding:1em 0;text-align:left;">
<h2><i><span style="font-family:'Courier New';"><span style="font-family:Verdana;">16 The Environment</span></span></i><br />
</h2>
<h2>
<span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span><br />
</h2>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;"></p>
<div id="i4_8" style="padding:1em 0;text-align:center;">
<img src="http://docs.google.com/File?id=dd6nw3mt_168dd38bmfm_b" style="width:472px;height:714px;" />
</div>
<p></span></span><span style="font-family:'Courier New';"><span style="font-family:Verdana;"></p>
<div id="i4_8" style="padding:1em 0;text-align:left;">
<h3><a id="16_1_CDPATH_5651453254671944_6_11823947909311716" name="16_1_CDPATH_5651453254671944_6_11823947909311716"></a><br />
 16.1 CDPATH<br />
 </h3>
<p> The <b>CDPATH</b><br />
variable is provided to make directory navigation easier. It contains a<br />
list of colon-separated directories to check when a full pathname is<br />
not given to the cd command. Each directory in CDPATH is searched from<br />
left-to-right for a directory that matches the cd argument. A : alone<br />
in CDPATH stands for the current directory.</p>
<h3><a id="16_2_PATH_2677888549093702_009_6379903118402938" name="16_2_PATH_2677888549093702_009_6379903118402938"></a><br />
 16.2 PATH<br />
 </h3>
<p> The <b>PATH</b><br />
variable contains a list of colon-separated directories to check when a<br />
command is invoked. Each directory in PATH is searched from<br />
left-to-right for a file whose name matches the command name. If not<br />
found, an error message is displayed. A : alone in PATH specifies to<br />
check the current directory.</p>
<h3><a id="16_3_TMOUT_809440743503734_145_3826941331997027" name="16_3_TMOUT_809440743503734_145_3826941331997027"></a><br />
 16.3 TMOUT<br />
 </h3>
<p>The TMOUT variable specifies the number of seconds that the Korn shell<br />
will wait for input before displaying a 60-second warning message and<br />
exiting. If not set, the default used is 0, which disables the timeout<br />
feature. To set a 10-minute timer, set TMOUT to 600:<br />
<span style="font-family:Courier New;">    $ TMOUT=600</span><br />
 This variable is usually set by the system administrator in the <span style="font-family:Courier New;">/etc/profile</span> file.
</div>
<p></span></span></p>
<h3><a id="16_4_MAILCHECK_687330215443556" name="16_4_MAILCHECK_687330215443556"></a><br />
<span style="font-family:'Courier New';"><span style="font-family:Verdana;">16.4 MAILCHECK</span></span><br />
</h3>
<h3>
<span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span><br />
</h3>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">The<br />
MAILCHECK variable specifies how often, in seconds, to check for new<br />
mail. If not set, or set to zero, new mail is checked before each new<br />
prompt is displayed. Otherwise, the default setting is 600 seconds (10<br />
minutes).</p>
<p></span></span></p>
<h3><a id="16_5_MAIL_7713528906556307_892_6743312418053198" name="16_5_MAIL_7713528906556307_892_6743312418053198"></a><br />
<span style="font-family:'Courier New';"><span style="font-family:Verdana;">16.5 MAIL</span></span><br />
</h3>
<h3>
<span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span><br />
</h3>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">The <b>MAIL</b> variable contains the name of a single mailbox file to check for new mail. It is not used if MAILPATH is set.</p>
<p></span></span></p>
<h3><a id="16_6_MAILPATH_3551441223568878" name="16_6_MAILPATH_3551441223568878"></a><br />
<span style="font-family:'Courier New';"><span style="font-family:Verdana;">16.6 MAILPATH</span></span><br />
</h3>
<h3>
<span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span><br />
</h3>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">The<br />
MAILPATH variable contains a colon-separated list of mailbox files to<br />
check for new mail and is used if you want to read multiple mailboxes.<br />
It overrides the MAIL variable if both are set. This MAILPATH setting<br />
specifies to check two mailbox files, <span style="font-family:Courier New;">/home/anatole/mbox and /news/mbox</span>.<br />
<span style="font-family:Courier New;">    $ print $MAILPATH</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    MAILPATH=/home/anatole/mbox:/news/mbox</p>
<p></span>Just<br />
so you don't think you can go snooping around someone else's mailbox,<br />
this only works if you have read permission on the mailbox file.<br />
 If MAILPATH is not set, there is no default.</p>
<p></span></span></p>
<h3><a id="_16_7_TERM_9189810912229358_5009562197822405" name="_16_7_TERM_9189810912229358_5009562197822405"></a><br />
<span style="font-family:'Courier New';"><span style="font-family:Verdana;"> 16.7 TERM </span></span><br />
</h3>
<h3>
<span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span><br />
</h3>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">The<br />
TERM variable specifies your terminal type, and is usually set by your<br />
system administrator in the global /etc/profile file. If it's not set<br />
there, then it's probably in your ~/.profile file.</p>
<p></span></span></p>
<h3><a id="16_8_Enabling_Disabling_Option_48916886920819536" name="16_8_Enabling_Disabling_Option_48916886920819536"></a><br />
<span style="font-family:'Courier New';"><span style="font-family:Verdana;">16.8 Enabling/Disabling Options</span></span><br />
</h3>
<h3>
<span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span><br />
</h3>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">Korn shell options are enabled with the <b>set -o</b><i>option</i> or <b>set</b> -<i>option</i> command. For example, the noglob option disables file name substitution and can be set using either of these commands :<br />
<span style="font-family:Courier New;">    $ set —f</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Verdana;">or</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    $ set —o noglob</span><br />
Options can also be enabled by specifying them on the ksh command line.<br />
Here, a Korn subshell is started with the emacs option enabled:<br />
<span style="font-family:Courier New;">    $ ksh —o emacs</span><br />
 Options can be disabled with the <span style="font-family:Georgia;"><b>set +o</b> <i>option</i></span> or <b>set</b> +<i>option</i> command. In this example, the noglob option is disabled:<br />
<span style="font-family:Courier New;">    $ set +o noglob</span></p>
<p></span></span></p>
<h3><a id="16_9_Displaying_the_Current_Se_47245364006423674" name="16_9_Displaying_the_Current_Se_47245364006423674"></a><br />
<span style="font-family:'Courier New';"><span style="font-family:Verdana;">16.9 Displaying the Current Settings</span></span><br />
</h3>
<h3>
<span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span><br />
</h3>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">The setting of the current options is displayed with the <b>set -o </b>command.</p>
<div id="kt4h" style="padding:1em 0;text-align:center;">
<a href="http://docs.google.com/File?id=dd6nw3mt_1728crddqft_b" target="_blank"><img src="http://docs.google.com/File?id=dd6nw3mt_1728crddqft_b" style="width:455px;height:734px;" /></a>
</div>
<p>
</span></span></p>
<h3><a id="16_10_Aliases_3822333845613286_08960525051202617" name="16_10_Aliases_3822333845613286_08960525051202617"></a><br />
<span style="font-family:'Courier New';"><span style="font-family:Verdana;">16.10 Aliases</span></span><br />
</h3>
<h3>
<span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span><br />
</h3>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">Aliases<br />
are command name macros used as shorthand for other commands,<br />
especially frequently used ones. This saves a lot of typing time.<br />
Aliases are defined with the alias name=value<br /> command.Make sure to<br />
enclose the value in quotes if it contains whitespace. Here we create<br />
an alias l that is set to the ls -Fac command:<br />
<span style="font-family:Courier New;">    $ alias l="ls —Fac"</span><br />
 Now when you type in l,<span style="font-family:Courier New;"> ls -Fac</span> is executed:<br />
<span style="font-family:Courier New;">    $ l</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    ./</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    ../</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    compress.Z*</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    func.Z*</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    test/</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    uncompress.Z*</span><br />
<span style="font-family:Courier New;">    . . .</span></p>
<p> Alias values can contain any text, including special characters, like wild-cards, pipes, or I/O redirection operators.</p>
<p> Here we set two aliases: p and h. When invoked, we get h instead of Hello.<br />
<span style="font-family:Courier New;">    $ alias p='print' h=Hello</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    $ p h</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    h</span><br />
 After the p alias is reset with a trailing blank, h gets substituted in the next command correctly:<br />
<span style="font-family:Courier New;">    $ alias p='print ' h=Hello</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    $ p h</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    Hello</span></p>
<p></span></span></p>
<h4><a id="16_10_1_Displaying_Current_Ali" name="16_10_1_Displaying_Current_Ali"></a><br />
<span style="font-family:'Courier New';"><span style="font-family:Verdana;">16.10.1 Displaying Current Aliases</span></span><br />
</h4>
<h4>
<span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span><br />
</h4>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">A list of the current aliases is displayed using the <b>alias</b> command without arguments.</p>
<p></span></span></p>
<h4><a id="16_10_2_Removing_Aliases_26645" name="16_10_2_Removing_Aliases_26645"></a><br />
<span style="font-family:'Courier New';"><span style="font-family:Verdana;">16.10.2 Removing Aliases</span></span><br />
</h4>
<h4>
<span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span><br />
</h4>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">Aliases are removed with the<b> unalias</b> command. Let's try it with the l alias:<br />
<span style="font-family:Courier New;">    $ unalias l</span></p>
<p></span></span></p>
<h2><a id="17_Korn_Shell_Scripts_48337193" name="17_Korn_Shell_Scripts_48337193"></a><br />
<i><span style="font-family:'Courier New';"><span style="font-family:Verdana;">17 Korn Shell Scripts</span></span></i><br />
</h2>
<h2>
<span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span><br />
</h2>
<h3><a id="17_1_Positional_Parameters_109" name="17_1_Positional_Parameters_109"></a><br />
<span style="font-family:'Courier New';"><span style="font-family:Verdana;">17.1 Positional Parameters</span></span><br />
</h3>
<h3>
<span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span><br />
</h3>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">Positional<br />
parameters are special variables used to keep track of arguments to the<br />
Korn shell, scripts, and functions. Positional parameter names contain<br />
only digits and cannot be set directly using <i>variable=value</i> syntax. By default, parameter zero (or $0) is set to the name of the shell, script or function.<br />
<span style="font-family:Courier New;">    $ print $0</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    /bin/ksh</span><br />
The remaining parameters 1 to n are set to each of the arguments passed<br />
to the shell, script or function. For example, if you invoke a Korn<br />
shell script called <b>ptest</b> and pass the arguments <b>A</b>, <b>B</b>, and <b>C</b>, then in the script ptest, <b>$0</b> would be set to <b>ptest</b>, <b>$1</b> to <b>A</b>, <b>$2</b> to <b>B</b>, and <b>$3</b> to <b>C</b>.</p>
<div id="oal2" style="padding:1em 0;text-align:left;">
<img src="http://docs.google.com/File?id=dd6nw3mt_173f7n7tvcw_b" style="width:240px;height:157px;" />
</div>
<p></p>
<div id="t7df" style="padding:1em 0;text-align:center;">
<img src="http://docs.google.com/File?id=dd6nw3mt_174pzmvjcfz_b" style="width:536px;height:541px;" />
</div>
<p>
 There are three special Korn shell variables that provide information about the current positional parameters. <u>The first is <b>$#</b>, and it contains the number of positional parameters</u>. <u>The other two are <b>$@</b> and <b>$*</b>, and they both contain all the positional parameters.</u><br />
So in the above ptest example, $# would be 3, and both $* and $@ would<br />
be A B C. Here is a Korn shell script that manipulates positional<br />
parameters. It displays the name of the current script, the number of<br />
positional parameters, and the value of each of the positional<br />
parameters:<br />
<span style="font-family:Courier New;">    $ cat check_params</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    print "Script name: $0"</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    print "Number of args passed: $#"</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    print "Arguments passed: $*"</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    print "Arg 1=$1, Arg 2=$2, Arg 3=$3"</span></p>
<p></span></span></p>
<h3><a id="17_2_Modifying_Positional_Para" name="17_2_Modifying_Positional_Para"></a><br />
<span style="font-family:'Courier New';"><span style="font-family:Verdana;">17.2 Modifying Positional Parameters</span></span><br />
</h3>
<h3>
<span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span><br />
</h3>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">By default, <b>$0</b> is set to the name of the shell, script or function. It cannot be set or modified. The remaining parameters from <b>$1</b> to<b> $n</b> can be reassigned with the<span style="color:rgb(0,0,255);"> </span><b>shift</b><br />
command. The shift command, with no arguments, shifts positional<br />
parameters left once, so that $1 takes the value of $2, $2 takes the<br />
value of $3, and so on. <u>The original value of $1 is lost.<br />
</u> <u><br />
</u>Let's change the check_params script so that it shifts the positional<br />
 parameters left once:<br />
<span style="font-family:Courier New;">    $ cat check_params</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    print "Script name: $0"</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    print "Number of args passed: $#"</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    print "Arguments passed: $*"</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    print "Arg 1=$1, Arg 2=$2, Arg 3=$3"</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    shift</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    print "Number of remaining args: $#"</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    print "Remaining args: $*"</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    print "Arg 1=$1, Arg 2=$2, Arg 3=$3"</span><br />
 When we run it again with the arguments A B:<br />
<span style="font-family:Courier New;">    $ check_params A B</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    Script name: check_params</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    Number of args passed: 2</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    Arguments passed: A B</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    Arg 1=A, Arg 2=B, Arg 3=</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    Number of remaining args: 1</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    Remaining args: B</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    Arg 1=B, Arg 2=, Arg 3=</span><br />
 After the shift command, $1 is set to B and $2 is unset. The original value of $1 is lost.</p>
<p> The positional parameters can be shifted left more than once by providing an integer argument to the <b>shift</b> command: <b><span style="font-family:Georgia;">shift <i>n</i></span></b>.</p>
<p></span></span></p>
<h3><a id="17_3_The_exit_command_23414194" name="17_3_The_exit_command_23414194"></a><br />
<span style="font-family:'Courier New';"><span style="font-family:Verdana;">17.3 The exit command</span></span><br />
</h3>
<h3>
<span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span><br />
</h3>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">The <b>exit</b> command allows you to terminate execution from anywhere in a Korn shell script and return an <b>exit</b> value using this format:<br />
<b>        exit</b><br />
 or<br />
<b>        exit <i>n</i></b><br />
 where <i>n</i> is the exit status to return. <u>If n is not specified, the exit status of the previous command is used</u>. If you don't use exit, then scripts finish after the last command is executed.</p>
<p></span></span></p>
<h3><a id="_17_4_The_Command__5899032850007576" name="_17_4_The_Command__5899032850007576"></a><br />
<span style="font-family:'Courier New';"><span style="font-family:Verdana;">17.4 The [[...]] Command</span></span><br />
</h3>
<h3>
<span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span><br />
</h3>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">The<br />
[[...]] command is used to evaluate conditional expressions with file<br />
attributes, strings, integers, and more. The basic format is:<br />
         <b>[[</b><i><b> </b><span style="font-family:Georgia;">expression</span></i> <b>]]</b><br />
 where </span></span><span style="font-family:Courier New;"><span style="font-family:Verdana;"><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><i><span style="font-family:Georgia;">expression</span></i></span></span></span></span><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><br />
is the condition you are evaluating. There must be whitespace after the<br />
opening brackets, and before the closing brackets. Whitespace must also<br />
separate the expression arguments and operators. For example, these are<br />
incorrect:<br />
<span style="font-family:Courier New;">    [[$X=$Y]]</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    [[$X = $Y]]</span><br />
 while this is correct:<br />
<span style="font-family:Courier New;">    [[ $X == $Y ]]</span><br />
 Notice that there is white space between $X, $Y, and the = operator.</p>
<p>If the expression evaluates to true, then a zero exit status is<br />
returned, otherwise the expression evaluates to false and a non-zero<br />
exit status is returned.</p>
<p> If you are familiar with the<b> test</b> and <b>[...]</b><br />
commands, then you'll recognize that [[...]] is just a new and improved<br />
version of the same commands. It basically functions the same way,<br />
except that a number of new operators are available.<br />
</span></span>
</div>
<div id="yn69" style="padding:1em 0;text-align:left;">
<span style="font-family:'Courier New';"><span style="font-family:Verdana;"></p>
<div id="t5_z" style="padding:1em 0;text-align:center;">
</div>
<p></span></span></p>
<div style="text-align:center;">
<div style="text-align:left;">
<h4><a id="_17_4_1_Checking_Strings__5241385150842537" name="_17_4_1_Checking_Strings__5241385150842537"></a><br />
 17.4.1 Checking Strings<br />
 </h4>
</div>
<p>
</div>
<div style="text-align:center;">
<span style="font-family:Courier New;"><span style="font-family:Verdana;"><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><a href="http://docs.google.com/File?id=dd6nw3mt_175gwrn86d5_b" target="_blank"><img src="http://docs.google.com/File?id=dd6nw3mt_175gwrn86d5_b" style="width:507px;height:459px;" /></a></span></span></span></span></p>
<div style="text-align:left;">
We could use the [[...]] command to check if a variable is set to a<br />
certain value. Here, variable X is assigned abc, then evaluated in this<br />
expression:<br />
<span style="font-family:Courier New;">    $ X=abc</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    $ [[ $X = abc ]] &amp;&amp; print "X is set to abc"</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    X is set to abc</span>
</div>
<div style="text-align:left;">
 Using the test and [...] commands, the same command could be written as:<br />
<span style="font-family:Courier New;">    test "$X" = abc &amp;&amp; print "X is set to abc"</span><br />
 or<br />
<span style="font-family:Courier New;">    [ "$X" = abc ] &amp;&amp; print "X is set to abc"</p>
<p></span>To check if a variable is set to null, the -z option can be used:<br />
<span style="font-family:Courier New;">    [[ —z $VAR ]] &amp;&amp; print "VAR is set to null"</span><br />
 or it could be compared to the null string like this:<br />
<span style="font-family:Courier New;">    [[ $VAR = "" ]] &amp;&amp; "VAR is set to null"</span>
</div>
</div>
<p><span style="font-family:'Courier New';"></span><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><br />
</span></span></p>
<h4><a id="_17_4_2_Checking_Patterns__24458779692309196" name="_17_4_2_Checking_Patterns__24458779692309196"></a><br />
<span style="font-family:'Courier New';"><span style="font-family:Verdana;">17.4.2 Checking Patterns</span></span><br />
</h4>
<h4>
<span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span><br />
</h4>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">The Korn shell also lets you compare strings to patterns. We could check if X begins with a 'a' like this:<br />
<span style="font-family:Courier New;">    $ X=abc</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    $ [[ $X = a* ]] &amp;&amp; print "$X matches a*"</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    abc matches a*</span></p>
<p> Using the +([09]) pattern, we could check if X is set to a number:<br />
<span style="font-family:Courier New;">    $ X=123</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    $ [[ $X = +([0—9]) ]] &amp;&amp; print "$X is a number"</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    123 is a number</span></p>
<p></span></span></p>
<h4><a id="_17_4_3_Checking_File_Attribut_4279807512566526" name="_17_4_3_Checking_File_Attribut_4279807512566526"></a><br />
<span style="font-family:'Courier New';"><span style="font-family:Verdana;">17.4.3 Checking File Attributes</span></span><br />
</h4>
<h4>
<span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span><br />
</h4>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;"></p>
<div id="f9e-" style="padding:1em 0;text-align:center;">
<img src="http://docs.google.com/File?id=dd6nw3mt_176d9kt7dg6_b" style="width:432px;height:572px;" /></p>
</div>
<p></span></span></p>
<div style="text-align:left;">
 The most basic operation to perform on a file is to see if it exists, and that can be done using the -a operator.<br />
<span style="font-family:Courier New;">    $ touch tmp</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    $ [[ —a tmp ]] &amp;&amp; print "File tmp exists"</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    File tmp exists</span></p>
<p>This only indicates that it exists, but not much else. It may be a<br />
directory, or a symbolic link, but using this operator, that's all we<br />
know. If we wanted more information, the -f or -d operators could tell<br />
us if a file existed and was a regular file (-f) or if it was just a<br />
directory (-d).</p>
<h4><a id="_17_4_4_Checking_Integer_Attri_07001292456862485" name="_17_4_4_Checking_Integer_Attri_07001292456862485"></a><br />
 17.4.4 Checking Integer Attributes<br />
</h4>
<div id="q-dl" style="padding:1em 0;text-align:center;">
<a href="http://docs.google.com/File?id=dd6nw3mt_177frb3r2c8_b" target="_blank"><img src="http://docs.google.com/File?id=dd6nw3mt_177frb3r2c8_b" /></a>
</div>
<p>
The [[...]] command provides a few integer operators that allow<br />
integers to be compared. It is frequently used to check the number of<br />
command-line arguments. This expression evaluates to true if there are<br />
less than or equal to three positional parameters set:<br />
 [[ $# —le 3 ]] &amp;&amp; print "3 or less args given"
</div>
<p><span style="font-family:'Courier New';"></span><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><br />
The ((...)) command offers the same arithmetic comparison operators as<br />
the [[...]] command, plus many others. Besides offering more arithmetic<br />
operators, the ((...)) command provides substantial performance<br />
improvements over the [[...]] and test commands.</p>
<p></span></span></p>
<h4><a id="_17_4_5_The_Operator__42667919512565855" name="_17_4_5_The_Operator__42667919512565855"></a><br />
<span style="font-family:'Courier New';"><span style="font-family:Verdana;">17.4.5 The ! Operator</span></span><br />
</h4>
<h4>
<span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span><br />
</h4>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">The ! operator negates the result of any [[...]] expression when used like this:<br />
<b><span style="font-family:Georgia;">[[ ! <i>expression</i> ]]</span></b><br />
 For example, to check if X is not equal to abc:<br />
<span style="font-family:Courier New;">    $ X=xyz</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    $ [[ ! $X = abc ]] &amp;&amp; print "$X not equals abc"</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    xyz not equals abc</span></p>
<p>There is one logical operator that can only be implemented with the !<br />
operator. There is no [[...]] file operator that will evaluate to true<br />
on a zero-length file.<br />
<span style="font-family:Courier New;">    $ &gt;emptyfile</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    $ [[ ! —s emptyfile ]] &amp;&amp; print "emptyfile is empty"</span><br style="font-family:Courier New;" /><br />
<span style="font-family:Courier New;">    emptyfile is empty</span></p>
<p></span></span><br />
<h4><a id="_17_4_6_Compound_Expressions_47728179982164753" name="_17_4_6_Compound_Expressions_47728179982164753"></a><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><br />
 17.4.6 Compound Expressions</span></span></h4>
<h4><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><br />
</span></span></h4>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">
<div id="l2r." style="padding:1em 0;text-align:center;"><img src="http://docs.google.com/File?id=dd6nw3mt_179fq89jwhp_b" />
<div style="text-align:left;"><span style="font-family:'Courier New';"><span style="font-family:Verdana;">(1) <b>&amp;&amp;</b> - The AND Operator<br /></span></span>The &amp;&amp; operator is used with the [[...]] command to test if multiple expressions are true using this format:<br /><span style="font-family:Courier New;">    [[ expression1 &amp;&amp; expression2 ]]</span></div>
</div>
<p></span></span><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><br />
 This expression checks if the noglob and noclobber options are set:<br /><span style="font-family:Courier New;">    [[ —o noglob &amp;&amp; —o noclobber ]]</span></p>
<p>(2) <b>||</b> - The OR Operator<br />The | | operator is used with the [[...]] command to test if expression1 OR expression2 are true using this format:<br /><span style="font-family:Courier New;">    [[ expression1 | | expression2 ]]</span></p>
<p></span></span><br />
<h4><a id="17_4_7_vs_test_and__7445772201941858" name="17_4_7_vs_test_and__7445772201941858"></a><span style="font-family:'Courier New';"><span style="font-family:Verdana;">17.4.7 [ [...] ] vs test and [...]</span></span></h4>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">The [[...]] command is preferred to test and [...], since many of the errors associated with test and [...] do not occur.</p>
<p></span></span><br />
<h2><a id="_18_Control_Commands" name="_18_Control_Commands"></a><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><br />
<i>18 Control Commands</i></span></span></h2>
<h2><span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span></h2>
<h3><a id="18_1_The_case_command" name="18_1_The_case_command"></a><span style="font-family:'Courier New';"><span style="font-family:Verdana;">18.1 The case command</span></span></h3>
<h3><span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span></h3>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">The case command provides multiple-branch capability. The syntax for the case command is:
<div id="of:d" style="padding:1em 0;text-align:left;"><img style="width:401px;height:251px;" src="http://docs.google.com/File?id=dd6nw3mt_180dxmkc4d8_b" /><br />where value is compared to <i>pattern1, pattern2, ... patternn</i>.</p>
<p>The<br />
same patterns used in file name substitution can also be used in case<br />
statements to match patterns. The new Korn shell pattern matching<br />
formats also allow multiple case patterns to be given like this:
<div id="p2_e" style="padding:1em 0;text-align:center;"><img style="width:613px;height:396px;" src="http://docs.google.com/File?id=dd6nw3mt_181fghtsb7m_b" /></div>
<h3><a id="18_2_The_for_Command" name="18_2_The_for_Command"></a>18.2 The for Command</h3>
<p>The basic syntax for the for command is:<br /><b><span style="font-family:Georgia;">        for </span></b><span style="font-family:Georgia;"><i>variable</i></span><b><span style="font-family:Georgia;"> in </span></b><i><span style="font-family:Georgia;">word1  word2 . . . wordn</span></i><b><br style="font-family:Georgia;" /><span style="font-family:Georgia;">        do</span><br style="font-family:Georgia;" /><span style="font-family:Georgia;">                   </span></b><span style="font-family:Georgia;"><i> </i><i>commands</i></span><b><br style="font-family:Georgia;" /><span style="font-family:Georgia;">        done</span></b></div>
<p>File name substitution, command substitution, and variable substitution<br />
can also be used to generate a list of word arguments for the for<br />
command. The first line of the previous command could have been given<br />
as:<br /><span style="font-family:Courier New;">    for FILE in chap[1-3]</span><br />or<br /><span style="font-family:Courier New;">    for FILE in $(ls chap[1-3])</span><br />or<br /><span style="font-family:Courier New;">    CHAPS=$(ls chap[1-3])</span><br /><span style="font-family:Courier New;">    for FILE in $CHAPS</p>
<p></span>The <b>$* </b>and <b>$@</b> variables can be used to loop on command-line arguments like this:<br /><b><span style="font-family:Georgia;">        for </span></b><span style="font-family:Georgia;"><i>variable</i></span><b><span style="font-family:Georgia;"> in $*</span><br style="font-family:Georgia;" /><span style="font-family:Georgia;">        do</span><br style="font-family:Georgia;" /></b><i><span style="font-family:Georgia;">                commands</span></i><b><br style="font-family:Georgia;" /><span style="font-family:Georgia;">        done</span></b></p>
<p>The for command can also be used without the list of word arguments:<br /></span></span><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><b><span style="font-family:Georgia;">        for </span></b><span style="font-family:Georgia;"><i>variable</i></span><b><span style="font-family:Georgia;"> </span><br style="font-family:Georgia;" /><br />
<span style="font-family:Georgia;">        do</span><br style="font-family:Georgia;" /><br />
</b><i><span style="font-family:Georgia;">                commands</span></i><b><br style="font-family:Georgia;" /><br />
<span style="font-family:Georgia;">        done</span></b></span></span><br /><span style="font-family:'Courier New';"><span style="font-family:Verdana;">The commands are executed once for each positional parameter, and <i>variable</i> is set to each successive positional parameter. It is equivalent to:<br /></span></span><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><b><span style="font-family:Georgia;">       for </span></b><span style="font-family:Georgia;"><i>variable</i></span><b><span style="font-family:Georgia;"> in $@</span><br style="font-family:Georgia;" /><br />
<span style="font-family:Georgia;">        do</span><br style="font-family:Georgia;" /><br />
</b><i><span style="font-family:Georgia;">                commands</span></i><b><br style="font-family:Georgia;" /><br />
<span style="font-family:Georgia;">        done</span></b></p>
<p></span></span><br />
<h3><a id="18_3_The_if_Command" name="18_3_The_if_Command"></a><span style="font-family:'Courier New';"><span style="font-family:Verdana;">18.3 The if Command</span></span></h3>
<h3><span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span></h3>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">The basic syntax of the if command is:<br /><b><span style="font-family:Georgia;">        if </span></b><span style="font-family:Georgia;"><i>command1</i></span><b><br style="font-family:Georgia;" /><span style="font-family:Georgia;">        then</span><br style="font-family:Georgia;" /><span style="font-family:Georgia;">                </span></b><i><span style="font-family:Georgia;">commands</span></i><b><br style="font-family:Georgia;" /><span style="font-family:Georgia;">        </span></b></span></span><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><b><span style="font-family:Georgia;">elif </span></b><span style="font-family:Georgia;"><i>command2<br />        </i></span></span></span><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><b><span style="font-family:Georgia;"> then</span></b></span></span><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><span style="font-family:Georgia;"><i><br />                commands<br /></i></span></span></span><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><b><span style="font-family:Georgia;">        else<br />                </span></b></span></span><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><i><span style="font-family:Georgia;">commands</span></i></span></span><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><b><span style="font-family:Georgia;"><br />        fi</span></b><br />
</span></span><br />
<h3><a id="18_4_The_while_Command" name="18_4_The_while_Command"></a><span style="font-family:'Courier New';"><span style="font-family:Verdana;">18.4 The while Command</span></span></h3>
<h3><a id="_while_command1_do_commands_do" name="_while_command1_do_commands_do"></a><span style="font-family:'Courier New';"><font size="2">        while <i>command1</i><br />        do<br />                <i>commands</i><br />        done</font><span style="font-family:Verdana;"></span></span></h3>
<h3><a id="18_5_The_until_Command" name="18_5_The_until_Command"></a><span style="font-family:'Courier New';"><span style="font-family:Verdana;">18.5 The until Command</span></span></h3>
<h3><a id="The_until_command_is_another_l" name="The_until_command_is_another_l"></a><span style="font-family:'Courier New';"></span></h3>
<h3><span style="font-family:'Courier New';"><font size="2">The<br />
until command is another looping command. It's like the while command,<br />
except that instead of looping while the condition is true, it loops<br />
while the condition is false. The syntax for the until command is:<br /><b>        until </b><i><span style="font-family:Georgia;">command1</span></i><b><br />        do<br />                </b><i><span style="font-family:Georgia;">commands</span></i><b><br />        done</b><br />where commands are executed until command1 returns a zero exit status.</font><span style="font-family:Verdana;"></span></span></h3>
<h3><a id="18_6_Breaking_Out_of_Loops" name="18_6_Breaking_Out_of_Loops"></a><span style="font-family:'Courier New';"><span style="font-family:Verdana;">18.6 Breaking Out of Loops</span></span></h3>
<h3><span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span></h3>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><b>break</b> command  causes an exit from a loop-type command, but not from the entire script.</p>
<p>The break command can also be used to exit from a nested loop using this format:<br /><b>        break </b><span style="font-family:Georgia;"><i>n</i></span><br />where </span></span><u><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><b> </b><span style="font-family:Georgia;"><i>n</i></span></span></span></u><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><u> specifies the <i>n</i>th enclosing loop to exit from</u>.<br />Here is a new version of the nloop script that breaks out of both loops if i equals 2 and j equals 0:<br /><span style="font-family:Courier New;">$ cat nloop</span><br style="font-family:Courier New;" /><span style="font-family:Courier New;">for i in 1 2 3</span><br style="font-family:Courier New;" /><span style="font-family:Courier New;">do</span><br style="font-family:Courier New;" /><span style="font-family:Courier New;">    for j in 0 5</span><br style="font-family:Courier New;" /><span style="font-family:Courier New;">    do</span><br style="font-family:Courier New;" /><span style="font-family:Courier New;">        if ((i == 2 &amp;&amp; j == 0))</span><br style="font-family:Courier New;" /><span style="font-family:Courier New;">        then</span><br style="font-family:Courier New;" /><span style="font-family:Courier New;">            break 2</span><br style="font-family:Courier New;" /><span style="font-family:Courier New;">        else</span><br style="font-family:Courier New;" /><span style="font-family:Courier New;">            print "$i$j"</span><br style="font-family:Courier New;" /><span style="font-family:Courier New;">        fi</span><br style="font-family:Courier New;" /><span style="font-family:Courier New;">    done</span><br style="font-family:Courier New;" /><span style="font-family:Courier New;">done</span></p>
<p>Now the output would be:<br /><span style="font-family:Courier New;">    $ nloop</span><br style="font-family:Courier New;" /><span style="font-family:Courier New;">    10</span><br style="font-family:Courier New;" /><span style="font-family:Courier New;">    15</span><br />If<br />
break was used instead of break 2, then only the inner for loop would<br />
have been terminated, and execution would have continued with i set to<br />
3 in the outer loop, and j set to 0 in the inner loop.</p>
<p></span></span><br />
<h3><a id="18_7_The_continue_Command" name="18_7_The_continue_Command"></a><span style="font-family:'Courier New';"><span style="font-family:Verdana;">18.7 The continue Command</span></span></h3>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">The <b>continue</b> command causes execution to continue at the top of the current loop.</p>
<p>18.8 The select Command<br />The <b>select </b>command<br />
is used to display a simple menu that contains numbered items, and a<br />
prompt message. The syntax for the select command is:</p>
<p><b>        select </b><span style="font-family:Georgia;"><i>variable </i></span><b>in </b><i><span style="font-family:Georgia;">word1 word2 . . . wordn</span></i><b><br />        do<br />                </b><span style="font-family:Georgia;"><i>commands</i></span><b><br />        done</b><br />where <i>word1</i> through <i>wordn</i> are displayed as numbered menu choices followed by a prompt (default #?). </p>
<p><u>If the response is in the range 1 through n, then <i>variable</i> is set to the corresponding word, <b>REPLY</b> is set to the response, and the commands are executed.</u> Execution continues until a break, exit, return, or EOF is encountered.</p>
<p></span></span></p>
<h3><span style="font-family:'Courier New';"><span style="font-family:Verdana;">18.8 The select Command</span></span></h3>
<h3><span style="font-family:'Courier New';"><span style="font-family:Verdana;"></span></span></h3>
<p><span style="font-family:'Courier New';"><span style="font-family:Verdana;">The<br />
select command is used to display a simple menu that contains numbered<br />
items, and a prompt message. The syntax for the select command is:</p>
<p><b><span style="font-family:Georgia;"><span>    </span><span>    </span>select </span></b><span style="font-family:Georgia;"><i>variable</i></span><b><span style="font-family:Georgia;"> in </span></b><span style="font-family:Georgia;"><i>word1 word2 . . . wordn</i></span><b><br style="font-family:Georgia;" /><br />
<span style="font-family:Georgia;"><span>    </span><span>    </span>do</span><br style="font-family:Georgia;" /><br />
</b><i><span style="font-family:Georgia;"><span>    </span><span>    </span><span>    </span><span>    </span>commands</span></i><b><br style="font-family:Georgia;" /><br />
<span style="font-family:Georgia;"><span>    </span><span>    </span>done</span></b></p>
<p>where <i>word1</i> through <i>wordn </i>are displayed as numbered menu choices followed by a prompt (default #?). If the response is in the range 1 through n, then <i>variable</i> is set to the corresponding word, <b>REPLY</b> is set to the response, and the <i>commands</i> are executed. Execution continues until a <b>break</b>, <b>exit</b>, <b>return</b>, or <b>EOF</b> is encountered.</p>
<p>The <b>select</b> command can also be used without the list of word arguments:</p>
<p></span></span><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><b><span style="font-family:Georgia;"><span>   </span><span>    </span>select </span></b><span style="font-family:Georgia;"><i>variable</i></span><b><span style="font-family:Georgia;"> </span></b><span style="font-family:Georgia;"><i></i></span><b><br style="font-family:Georgia;" /><br />
<span style="font-family:Georgia;"><span>    </span><span>    </span>do</span><br style="font-family:Georgia;" /><br />
</b><i><span style="font-family:Georgia;"><span>    </span><span>    </span><span>    </span><span>    </span>commands</span></i><b><br style="font-family:Georgia;" /><br />
<span style="font-family:Georgia;"><span>    </span><span>    </span>done</span></b></span></span><br />
<span style="font-family:'Courier New';"><span style="font-family:Verdana;">It<br />
functions the same way as the previous select syntax, except that the<br />
positional parameters are displayed as numbered menu choices from 1 to<br />
n, instead of the words from the word list. It is equivalent to:<br />
</span></span><span style="font-family:'Courier New';"><span style="font-family:Verdana;"><b><span style="font-family:Georgia;"><span>   </span><span>    </span>select </span></b><span style="font-family:Georgia;"><i>variable</i></span><b><span style="font-family:Georgia;"> in </span></b><span style="font-family:Georgia;"><i>"$@"</i></span><b><br style="font-family:Georgia;" /><br />
<span style="font-family:Georgia;"><span>    </span><span>    </span>do</span><br style="font-family:Georgia;" /><br />
</b><i><span style="font-family:Georgia;"><span>    </span><span>    </span><span>    </span><span>    </span>commands</span></i><b><br style="font-family:Georgia;" /><br />
<span style="font-family:Georgia;"><span>    </span><span>    </span>done</span></b></span></span><br />
<span style="font-family:'Courier New';"><span style="font-family:Verdana;"><br /></span></span></div>

        </div>
        <a href="javascript:void(0);" style="float:right" onclick="window.scrollTo(0, 0);">Top</a>
        <div style="clear: both;"></div>
      </div>
    </div>
    

    <div class="main-container shadow">
      <div class="mainbody">
        
<div class="pagination">
    <ul>
    
        <li class="prev">
        <a href="/page14">&larr; Previous</a>
        
        </li>
    

    
        <li><a href="/">1</a></li>
        

        
            <li><a href="/page2">2</a></li>
            
        
            <li><a href="/page3">3</a></li>
            
        
            <li><a href="/page4">4</a></li>
            
        
            <li><a href="/page5">5</a></li>
            
        
            <li><a href="/page6">6</a></li>
            
        
            <li><a href="/page7">7</a></li>
            
        
            <li><a href="/page8">8</a></li>
            
        
            <li><a href="/page9">9</a></li>
            
        
            <li><a href="/page10">10</a></li>
            
        
            <li><a href="/page11">11</a></li>
            
        
            <li><a href="/page12">12</a></li>
            
        
            <li><a href="/page13">13</a></li>
            
        
            <li><a href="/page14">14</a></li>
            
        
            <li class="disabled"><a>15</a></li>
            
        
            <li><a href="/page16">16</a></li>
            
        
            <li><a href="/page17">17</a></li>
            
        
            <li><a href="/page18">18</a></li>
            
        
            <li><a href="/page19">19</a></li>
            
        
            <li><a href="/page20">20</a></li>
            
        
    

    
        <li class="next"><a href="/page16">Next &rarr;</a></li>
    
    </ul>
</div>


      </div>
    </div>

  </div>

  <div class="span3 right">
    <div class="side-container shadow">
      <div class="sidebar">
		  <wb:follow-button uid="2461544952" type="red_1" width="63" height="24" ></wb:follow-button>
		  <!-- Site Meter -->
<script type="text/javascript" src="http://s51.sitemeter.com/js/counter.js?site=s51bo-yang">
</script>
<noscript>
<a href="http://s51.sitemeter.com/stats.asp?site=s51bo-yang" target="_top">
<img src="http://s51.sitemeter.com/meter.asp?site=s51bo-yang" alt="Site Meter" border="0"/></a>
</noscript>
<!-- Copyright (c)2009 Site Meter -->


      </div>
  </div>

    <div class="side-container shadow">
      <div class="sidebar">
        
        <h3>Recent Posts</h3>
        <ul>
        
          <li><span>2014-05-26</span> &raquo; <a href="/2014/05/26/binary-tree-traversal">
            Binary Tree Traversal</a></li>
        
          <li><span>2014-04-30</span> &raquo; <a href="/2014/04/30/fisher-vector-in-action-recognition">
            Action Recognition with Fisher Vectors</a></li>
        
          <li><span>2014-03-29</span> &raquo; <a href="/2014/03/29/how-to-install-jekyll-in-mac-osx-mavericks">
            How To Install Jekyll in Mac OSX Mavericks</a></li>
        
          <li><span>2014-03-26</span> &raquo; <a href="/2014/03/26/c-code-to-print-pascal-triangle">
            C++ Code to Print Pascal Triangle</a></li>
        
          <li><span>2014-01-22</span> &raquo; <a href="/2014/01/22/baci-simple-install-and-compile-guide">
            BACI Simple Install and Compile Guide</a></li>
        
          <li><span>2014-01-10</span> &raquo; <a href="/2014/01/10/dense-trajectory-notes">
            Dense Trajectory Notes</a></li>
        
          <li><span>2013-10-20</span> &raquo; <a href="/2013/10/20/parallel-mex-file-in-matlab">
            Parallelize mex file in Matlab</a></li>
        
          <li><span>2013-10-11</span> &raquo; <a href="/2013/10/11/notes-of-advanced-machine-learningi">
            Notes of Advanced Machine Learning(I)</a></li>
        
          <li><span>2013-10-10</span> &raquo; <a href="/2013/10/10/undefined-reference-error-during-installing-opencv">
            "undefined reference" error during installing OpenCV</a></li>
        
          <li><span>2013-10-10</span> &raquo; <a href="/2013/10/10/build-dense-trajectory-codes-in-ubuntu">
            Build Dense Trajectory Codes in Ubuntu</a></li>
        
        </ul>
        
      </div>
    </div>

    <div class="side-container shadow">
      <div class="sidebar">
        
        <h3>Tags</h3>
        <div class="tag_box">
        
        
  
    
        <a href="/tags.html#MFC-ref" class="btn btn-mini">MFC <span>10</span></a>
    
        <a href="/tags.html#Algorithm-ref" class="btn btn-mini">Algorithm <span>8</span></a>
    
        <a href="/tags.html#C-ref" class="btn btn-mini">C <span>16</span></a>
    
        <a href="/tags.html#EMC-ref" class="btn btn-mini">EMC <span>5</span></a>
    
        <a href="/tags.html#fault diagnosis-ref" class="btn btn-mini">fault diagnosis <span>2</span></a>
    
        <a href="/tags.html#EMI-ref" class="btn btn-mini">EMI <span>1</span></a>
    
        <a href="/tags.html#notes-ref" class="btn btn-mini">notes <span>3</span></a>
    
        <a href="/tags.html#CBR-ref" class="btn btn-mini">CBR <span>1</span></a>
    
        <a href="/tags.html#AI-ref" class="btn btn-mini">AI <span>5</span></a>
    
        <a href="/tags.html#Database-ref" class="btn btn-mini">Database <span>1</span></a>
    
        <a href="/tags.html#电磁兼容-ref" class="btn btn-mini">电磁兼容 <span>4</span></a>
    
        <a href="/tags.html#Unix-ref" class="btn btn-mini">Unix <span>1</span></a>
    
        <a href="/tags.html#Linux-ref" class="btn btn-mini">Linux <span>5</span></a>
    
        <a href="/tags.html#Personal-ref" class="btn btn-mini">Personal <span>10</span></a>
    
        <a href="/tags.html#Unix/Linux-ref" class="btn btn-mini">Unix/Linux <span>88</span></a>
    
        <a href="/tags.html#网络/通信-ref" class="btn btn-mini">网络/通信 <span>1</span></a>
    
        <a href="/tags.html#Telecommunication-ref" class="btn btn-mini">Telecommunication <span>1</span></a>
    
        <a href="/tags.html#Tcl/Tk-ref" class="btn btn-mini">Tcl/Tk <span>6</span></a>
    
        <a href="/tags.html#Shell-ref" class="btn btn-mini">Shell <span>12</span></a>
    
        <a href="/tags.html#Network/Telecom-ref" class="btn btn-mini">Network/Telecom <span>3</span></a>
    
        <a href="/tags.html#Perl-ref" class="btn btn-mini">Perl <span>14</span></a>
    
        <a href="/tags.html#Essay-ref" class="btn btn-mini">Essay <span>12</span></a>
    
        <a href="/tags.html#Industry-ref" class="btn btn-mini">Industry <span>6</span></a>
    
        <a href="/tags.html#Cloud Computing-ref" class="btn btn-mini">Cloud Computing <span>2</span></a>
    
        <a href="/tags.html#Android-ref" class="btn btn-mini">Android <span>2</span></a>
    
        <a href="/tags.html#VBA-ref" class="btn btn-mini">VBA <span>4</span></a>
    
        <a href="/tags.html#ESXi-ref" class="btn btn-mini">ESXi <span>1</span></a>
    
        <a href="/tags.html#Virtual Machine-ref" class="btn btn-mini">Virtual Machine <span>2</span></a>
    
        <a href="/tags.html#Browser-ref" class="btn btn-mini">Browser <span>2</span></a>
    
        <a href="/tags.html#Plan 9-ref" class="btn btn-mini">Plan 9 <span>9</span></a>
    
        <a href="/tags.html#Go-ref" class="btn btn-mini">Go <span>3</span></a>
    
        <a href="/tags.html#Virtualization-ref" class="btn btn-mini">Virtualization <span>2</span></a>
    
        <a href="/tags.html#CPP-ref" class="btn btn-mini">CPP <span>6</span></a>
    
        <a href="/tags.html#Linux/UNIX-ref" class="btn btn-mini">Linux/UNIX <span>1</span></a>
    
        <a href="/tags.html#Tips-ref" class="btn btn-mini">Tips <span>5</span></a>
    
        <a href="/tags.html#RHEL6.1-ref" class="btn btn-mini">RHEL6.1 <span>1</span></a>
    
        <a href="/tags.html#RPC-ref" class="btn btn-mini">RPC <span>1</span></a>
    
        <a href="/tags.html#rup-ref" class="btn btn-mini">rup <span>1</span></a>
    
        <a href="/tags.html#ksh-ref" class="btn btn-mini">ksh <span>1</span></a>
    
        <a href="/tags.html#Ubuntu-ref" class="btn btn-mini">Ubuntu <span>1</span></a>
    
        <a href="/tags.html#file descriptor-ref" class="btn btn-mini">file descriptor <span>1</span></a>
    
        <a href="/tags.html#Expect-ref" class="btn btn-mini">Expect <span>1</span></a>
    
        <a href="/tags.html#Here Document-ref" class="btn btn-mini">Here Document <span>1</span></a>
    
        <a href="/tags.html#C/C++-ref" class="btn btn-mini">C/C++ <span>3</span></a>
    
        <a href="/tags.html#Evolutionary Computation-ref" class="btn btn-mini">Evolutionary Computation <span>1</span></a>
    
        <a href="/tags.html#Genetic Algorihtm-ref" class="btn btn-mini">Genetic Algorihtm <span>1</span></a>
    
        <a href="/tags.html#ldd-ref" class="btn btn-mini">ldd <span>1</span></a>
    
        <a href="/tags.html#signal-ref" class="btn btn-mini">signal <span>1</span></a>
    
        <a href="/tags.html#swap-ref" class="btn btn-mini">swap <span>1</span></a>
    
        <a href="/tags.html#NIC-ref" class="btn btn-mini">NIC <span>1</span></a>
    
        <a href="/tags.html#Mac OS-ref" class="btn btn-mini">Mac OS <span>1</span></a>
    
        <a href="/tags.html#VNC-ref" class="btn btn-mini">VNC <span>1</span></a>
    
        <a href="/tags.html#X11-ref" class="btn btn-mini">X11 <span>1</span></a>
    
        <a href="/tags.html#Merge sort-ref" class="btn btn-mini">Merge sort <span>1</span></a>
    
        <a href="/tags.html#boost-ref" class="btn btn-mini">boost <span>1</span></a>
    
        <a href="/tags.html#CDF-ref" class="btn btn-mini">CDF <span>1</span></a>
    
        <a href="/tags.html#Matlab-ref" class="btn btn-mini">Matlab <span>3</span></a>
    
        <a href="/tags.html#Multi-Process-ref" class="btn btn-mini">Multi-Process <span>1</span></a>
    
        <a href="/tags.html#Multi-Threading-ref" class="btn btn-mini">Multi-Threading <span>1</span></a>
    
        <a href="/tags.html#Bioinformatics-ref" class="btn btn-mini">Bioinformatics <span>1</span></a>
    
        <a href="/tags.html#Computer Vision-ref" class="btn btn-mini">Computer Vision <span>3</span></a>
    
        <a href="/tags.html#DTF-ref" class="btn btn-mini">DTF <span>2</span></a>
    
        <a href="/tags.html#ffmpeg-ref" class="btn btn-mini">ffmpeg <span>1</span></a>
    
        <a href="/tags.html#OpenCV-ref" class="btn btn-mini">OpenCV <span>1</span></a>
    
        <a href="/tags.html#Machine Learning-ref" class="btn btn-mini">Machine Learning <span>1</span></a>
    
        <a href="/tags.html#parfor-ref" class="btn btn-mini">parfor <span>1</span></a>
    
        <a href="/tags.html#BACI-ref" class="btn btn-mini">BACI <span>1</span></a>
    
        <a href="/tags.html#Alogrithm-ref" class="btn btn-mini">Alogrithm <span>1</span></a>
    
        <a href="/tags.html#Jekyll-ref" class="btn btn-mini">Jekyll <span>1</span></a>
    
        <a href="/tags.html#Github-ref" class="btn btn-mini">Github <span>1</span></a>
    
        <a href="/tags.html#Fisher Vector-ref" class="btn btn-mini">Fisher Vector <span>1</span></a>
    
        <a href="/tags.html#SVM-ref" class="btn btn-mini">SVM <span>1</span></a>
    
  



        </div>
        
      </div>
    </div>

    <div class="side-container shadow">
      <div class="sidebar">
        
        <h3>Links</h3>
        <ul>
        
        
    <li><a href=https://github.com/bo-yang title="My GitHub Channel">My GitHub Channel</a></li>

    <li><a href=https://www.linkedin.com/pub/bo-yang/21/a3/893 title="My Linkedin Page">My Linkedin Page</a></li>

    <li><a href=http://blog.csdn.net/bonny95 title="My Chinese Blog(obsolete)">My Chinese Blog(obsolete)</a></li>

        </ul>
        
      </div>
    </div>
  </div>

</div>

  </div>
</div>


    </div>

    <footer>
        <p>&copy; 2007 <span id="now_year"></span> Bo Yang. </p>
        <script type="text/javascript">
          var now_year = new Date().getFullYear();
          if (now_year != 2007) {
              $('#now_year').html('- ' + now_year);
          }
        </script>
      </footer>
  </div>

  <script type="text/javascript" src="/assets/themes/clear/google-code-prettify/prettify.js"></script>
  <script type="text/javascript">
    $(function() {

      $('a[href^="http"]').each(function () {
        $(this).attr('target', '_blank');
      });

      $('pre').addClass('prettyprint linenums').attr('style', 'overflow:auto');
      window.prettyPrint && prettyPrint();

      function traverse($node, len, maxCount) {
        var reachMaxCount = len > maxCount;
        if (reachMaxCount) {
          $node.hide();
        }
        var $contents = $node.contents();
        for (var i = 0; i < $contents.length; ++i) {
          if (reachMaxCount) {
            $contents.eq(i).hide();
            continue;
          }
          if ($contents[i].nodeType == 3) { // TextNode
            var tmp = len;
            var s = $contents[i].nodeValue;
            len += s.length;
            reachMaxCount = len > maxCount;
            if (reachMaxCount && $contents[i].parentNode.nodeName != 'A') {
              $contents[i].nodeValue = s.substring(0, maxCount - tmp);
            }
          }
          else if ($contents[i].nodeType == 1) { // Element
            len = traverse($contents.eq(i), len, maxCount);
          }
        }
        return len;
      }

      $('.post_at_index').each(function() {
        var count = traverse($(this), 0, 400);
        if (count > 400) {
          var thisUrl = $(this).siblings().first().children().attr('href');
          $(this).after('\n<a href="' + thisUrl + '" rel="nofollow">' + 'Read More ...</a>');
        }
      });
    });
  </script>
  

</body>
</html>

