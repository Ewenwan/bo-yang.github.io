<!DOCTYPE html>
<html lang="en">
<head>
  <title>John Duff - Home </title>
  <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
  <meta name="verify-v1" content="fI45uNHehVNiO9Dt0Fp7XnsV0Z/ozBTkPoS6RlYAe50=" />
  <meta name="y_key" content="6c948e75a617b12d" />
  <meta name='technorati-claim' content='8QN7CWNH8BSJ' />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" media="screen" href="/css/bootstrap.css">
  <link rel="stylesheet" type="text/css" href="/css/default.css" />
  <link rel="stylesheet" type="text/css" href="/css/syntax.css" />
  <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="John Duff's blog" />
</head>

<body class='blog'>
  <div class="container">
    <div class="row">
      <div class="span4 sidebar affix">
        <div class="well">
          <h2 class='site-title'>
            <a href="http://bo-yang.github.io">Bo Yang</a>
          </h2>

		  <p><i>You got to make the back of the fence that nobody will see just as good looking as the front of the fence.</i></p>

          <ul id="navigation" class="clearfix">
            <li class='about'><a href='/about/'>About</a></li>
            <li class='archives'><a href='/archives/'>Archives</a></li>
            <li class="github"><a href="http://github.com/bo-yang" rel='me' class='url'>@github</a></li>
          </ul>
        </div>
      </div>
      <div class="span8 main offset4">
        <div class="well">
          <div id='index'>

  <div class="post">
    <h2><a href="/unix/linux/2011/05/20/%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520%25e5%25a6%2582%25e4%25bd%2595%25e5%2588%25a4%25e6%2596%25ad%25e4%25b8%2580%25e4%25b8%25aa%2528%25e5%258e%258b%25e7%25bc%25a9%2529%25e6%2596%2587%25e4%25bb%25b6%25e7%259a%2584%25e7%25b1%25bb%25e5%259e%258b%25ef%25bc%258c%25e4%25bb%25a5%25e5%258f%258azcatgzcat%250d%250a%2520%25/">如何判断一个(压缩)文件的类型，以及zcat/gzcat</a></h2>

    <p>恰似&ldquo;一师是个好学校&rdquo;，dd是个好工具&mdash;&mdash;只消用它逐字copy出某个文件第一个block的内容，就可以判断出该文件的类型！！！</p>
<p>&nbsp;</p>
<p>
<pre>bjbldd&gt;1&gt; dd if=MMEgolden.tar bs=512 count=1 &gt; dd_tmp
1+0 records in
1+0 records out
bjbldd&gt;&gt; file dd_tmp
dd_tmp:         USTAR tar archive
bjbldd&gt;&gt; dd if=varofvar bs=512 count=1 &gt; dd_tmp
0+1 records in
0+1 records out
bjbldd&gt;&gt; file dd_tmp
dd_tmp:         executable /bin/ksh script
bjbldd&gt;&gt; dd if=Tk-804.029.tar.gz bs=512 count=1 &gt; dd_tmp
1+0 records in
1+0 records out
bjbldd&gt;&gt; file dd_tmp
dd_tmp:         gzip compressed data - deflate method , original file name , max compression
</pre>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>另外，zcat或者gzcat是用于cat gzip压缩文件的工具，只是在不同的平台有些差异：/bin/zcat在Linux上work的很好，可是当它在Solaris上cat gzip文件的内容时，就会报错。Solaris上cat gzip文件只能用/bin/gzcat. &mdash;&mdash;就是这个小小的差异，浪费了我一天的时间！</p>
<p>&nbsp;</p>
<p>跨平台的cat gzip文件的代码如下：</p>
<p>
<pre>OS="`/bin/uname`"
if [ "${OS}" != "Linux" ]
then
	ZCAT="/bin/zcat"
else
	ZCAT="/bin/gzcat"
fi
.......
${ZCAT} ${TMPDIR}/ngn_platform.cpio.Z | /bin/cpio -idmvu  -H odc ${SAT_CPIO_FLAG}</pre>
<p>&nbsp;</p>
<p>貌似cpio的用法也很强大哦～</p>


    <small class="meta">May 20, 2011 | <a href='/unix/linux/2011/05/20/%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520%25e5%25a6%2582%25e4%25bd%2595%25e5%2588%25a4%25e6%2596%25ad%25e4%25b8%2580%25e4%25b8%25aa%2528%25e5%258e%258b%25e7%25bc%25a9%2529%25e6%2596%2587%25e4%25bb%25b6%25e7%259a%2584%25e7%25b1%25bb%25e5%259e%258b%25ef%25bc%258c%25e4%25bb%25a5%25e5%258f%258azcatgzcat%250d%250a%2520%25/#disqus_thread'>View Comments</a></small>
  </div>

  <div class="post">
    <h2><a href="/bkup/2011/05/20/%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520%25e5%25a6%2582%25e4%25bd%2595%25e5%2588%25a4%25e6%2596%25ad%25e4%25b8%2580%25e4%25b8%25aa%2528%25e5%258e%258b%25e7%25bc%25a9%2529%25e6%2596%2587%25e4%25bb%25b6%25e7%259a%2584%25e7%25b1%25bb%25e5%259e%258b%25ef%25bc%258c%25e4%25bb%25a5%25e5%258f%258azcatgzcat%250d%250a%2520%25/">如何判断一个(压缩)文件的类型，以及zcat/gzcat</a></h2>

    <p>恰似&ldquo;一师是个好学校&rdquo;，dd是个好工具&mdash;&mdash;只消用它逐字copy出某个文件第一个block的内容，就可以判断出该文件的类型！！！</p>
<p>&nbsp;</p>
<p>
<pre>bjbldd&gt;1&gt; dd if=MMEgolden.tar bs=512 count=1 &gt; dd_tmp
1+0 records in
1+0 records out
bjbldd&gt;&gt; file dd_tmp
dd_tmp:         USTAR tar archive
bjbldd&gt;&gt; dd if=varofvar bs=512 count=1 &gt; dd_tmp
0+1 records in
0+1 records out
bjbldd&gt;&gt; file dd_tmp
dd_tmp:         executable /bin/ksh script
bjbldd&gt;&gt; dd if=Tk-804.029.tar.gz bs=512 count=1 &gt; dd_tmp
1+0 records in
1+0 records out
bjbldd&gt;&gt; file dd_tmp
dd_tmp:         gzip compressed data - deflate method , original file name , max compression
</pre>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>另外，zcat或者gzcat是用于cat gzip压缩文件的工具，只是在不同的平台有些差异：/bin/zcat在Linux上work的很好，可是当它在Solaris上cat gzip文件的内容时，就会报错。Solaris上cat gzip文件只能用/bin/gzcat. &mdash;&mdash;就是这个小小的差异，浪费了我一天的时间！</p>
<p>&nbsp;</p>
<p>跨平台的cat gzip文件的代码如下：</p>
<p>
<pre>OS="`/bin/uname`"
if [ "${OS}" != "Linux" ]
then
	ZCAT="/bin/zcat"
else
	ZCAT="/bin/gzcat"
fi
.......
${ZCAT} ${TMPDIR}/ngn_platform.cpio.Z | /bin/cpio -idmvu  -H odc ${SAT_CPIO_FLAG}</pre>
<p>&nbsp;</p>
<p>貌似cpio的用法也很强大哦～</p>


    <small class="meta">May 20, 2011 | <a href='/bkup/2011/05/20/%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520%25e5%25a6%2582%25e4%25bd%2595%25e5%2588%25a4%25e6%2596%25ad%25e4%25b8%2580%25e4%25b8%25aa%2528%25e5%258e%258b%25e7%25bc%25a9%2529%25e6%2596%2587%25e4%25bb%25b6%25e7%259a%2584%25e7%25b1%25bb%25e5%259e%258b%25ef%25bc%258c%25e4%25bb%25a5%25e5%258f%258azcatgzcat%250d%250a%2520%25/#disqus_thread'>View Comments</a></small>
  </div>

  <div class="post">
    <h2><a href="/bkup/2011/05/16/%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520yum%25e7%259a%2584proxy%25e8%25ae%25be%25e7%25bd%25ae%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520/">yum的proxy设置</a></h2>

    <p>方法一：</p>
<p>
<pre>export http_proxy="proxy:portnum"</pre>
<p>&nbsp;</p>
<p>方法二：（<a href="http://www.fedoraforum.org/forum/showthread.php?t=742">http://www.fedoraforum.org/forum/showthread.php?t=742</a>）</p>
<table id="post4089" class="tborder" style="width:100%;" border="0" cellspacing="1" cellpadding="6" align="center">
<tbody>
<tr>
<td class="alt1">
<div id="post_message_4089">create the following files in /etc/profile.d, and then this will work in *any* shell for *any* user of the system</p>
<pre>#proxy.sh
export http_proxy=http://host.com:port/
export ftp_proxy=http://host.com:port/
export no_proxy=.domain.com
export HTTP_PROXY=http://host.com:port/
export FTP_PROXY=http://host.com:port/
#proxy.csh
setenv http_proxy http://host.com:port/
setenv ftp_proxy http://host.com:port/
setenv no_proxy .domain.com
setenv HTTP_PROXY http://host.com:port/
setenv FTP_PROXY http://host.com:port/</pre>
<p>&nbsp;</p></div>
<div>方法三：(<a href="http://linux.die.net/man/5/yum.conf">http://linux.die.net/man/5/yum.conf</a>)</div>
<div>在/etc/yum.conf中设置proxy，prox_username和proxy_password选项。</div>
</td>
</tr>
</tbody>
</table>


    <small class="meta">May 16, 2011 | <a href='/bkup/2011/05/16/%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520yum%25e7%259a%2584proxy%25e8%25ae%25be%25e7%25bd%25ae%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520/#disqus_thread'>View Comments</a></small>
  </div>

  <div class="post">
    <h2><a href="/unix/linux/2011/05/16/%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520yum%25e7%259a%2584proxy%25e8%25ae%25be%25e7%25bd%25ae%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520/">yum的proxy设置</a></h2>

    <p>方法一：</p>
<p>
<pre>export http_proxy="proxy:portnum"</pre>
<p>&nbsp;</p>
<p>方法二：（<a href="http://www.fedoraforum.org/forum/showthread.php?t=742">http://www.fedoraforum.org/forum/showthread.php?t=742</a>）</p>
<table id="post4089" class="tborder" style="width:100%;" border="0" cellspacing="1" cellpadding="6" align="center">
<tbody>
<tr>
<td class="alt1">
<div id="post_message_4089">create the following files in /etc/profile.d, and then this will work in *any* shell for *any* user of the system</p>
<pre>#proxy.sh
export http_proxy=http://host.com:port/
export ftp_proxy=http://host.com:port/
export no_proxy=.domain.com
export HTTP_PROXY=http://host.com:port/
export FTP_PROXY=http://host.com:port/
#proxy.csh
setenv http_proxy http://host.com:port/
setenv ftp_proxy http://host.com:port/
setenv no_proxy .domain.com
setenv HTTP_PROXY http://host.com:port/
setenv FTP_PROXY http://host.com:port/</pre>
<p>&nbsp;</p></div>
<div>方法三：(<a href="http://linux.die.net/man/5/yum.conf">http://linux.die.net/man/5/yum.conf</a>)</div>
<div>在/etc/yum.conf中设置proxy，prox_username和proxy_password选项。</div>
</td>
</tr>
</tbody>
</table>


    <small class="meta">May 16, 2011 | <a href='/unix/linux/2011/05/16/%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520yum%25e7%259a%2584proxy%25e8%25ae%25be%25e7%25bd%25ae%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520/#disqus_thread'>View Comments</a></small>
  </div>

  <div class="post">
    <h2><a href="/bkup/2011/05/16/%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520perl%25e7%259a%2584library%25e8%25ae%25be%25e7%25bd%25ae%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520/">Perl的library设置</a></h2>

    <p>参考链接：</p>
<ol>
<li><a href="http://stackoverflow.com/questions/841785/how-do-i-include-a-perl-module-thats-in-a-different-directory">http://stackoverflow.com/questions/841785/how-do-i-include-a-perl-module-thats-in-a-different-directory</a></li>
<li><a href="http://stackoverflow.com/questions/185114/how-do-i-use-a-perl-module-in-a-directory-not-in-inc">http://stackoverflow.com/questions/185114/how-do-i-use-a-perl-module-in-a-directory-not-in-inc</a></li>
</ol>
<p>&nbsp;</p>
<p>在Fedora/RHEL/CentOS中，perl 的library默认安装路径为：</p>
<p>
<pre>@INC (@INC contains: /usr/lib64/perl5/site_perl/5.8.8/x86_64-linux-thread-multi /usr/lib/perl5/site_perl/5.8.8 /usr/lib/perl5/site_perl /usr/lib64/perl5/vendor_perl/5.8.8/x86_64-linux-thread-multi /usr/lib/perl5/vendor_perl/5.8.8 /usr/lib/perl5/vendor_perl /usr/lib64/perl5/5.8.8/x86_64-linux-thread-multi /usr/lib/perl5/5.8.8 .)</pre>
<p>&nbsp;</p>
<p>如果要使用自定义的perllib，就需要参考以下的设置了。</p>
<p>&nbsp;</p>
<p>EDIT: Putting the right solution first, originally from&nbsp;<a href="http://stackoverflow.com/questions/185114/how-do-i-use-a-perl-module-in-a-directory-not-in-inc">this question</a>. It's the only one that searches relative to the&nbsp;<strong>module</strong>&nbsp;directory:</p>
<pre class="lang-perl prettyprint"><code><span class="kwd">use</span><span class="pln"> </span><span class="typ">FindBin</span><span class="pun">;</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com"># locate this script</span><span class="pln"><br /></span><span class="kwd">use</span><span class="pln"> lib </span><span class="str">"$FindBin::Bin/.."</span><span class="pun">;</span><span class="pln"> &nbsp;</span><span class="com"># use the parent directory</span><span class="pln"><br /></span><span class="kwd">use</span><span class="pln"> yourlib</span><span class="pun">;</span><span class="pln"><br /></span></code></pre>
<p>There's many other ways that search for libraries relative to the&nbsp;<strong>current</strong>&nbsp;directory. You can invoke perl with the -I argument, passing the directory of the other module:</p>
<pre class="lang-perl prettyprint"><code><span class="pln">perl </span><span class="pun">-</span><span class="pln">I</span><span class="pun">..</span><span class="pln"> yourscript</span><span class="pun">.</span><span class="pln">pl<br /></span></code></pre>
<p><span class="goog_qs-tidbit goog_qs-tidbit-0">You can include a line near the top of your perl script:</span></p>
<pre class="lang-perl prettyprint"><code><span class="kwd"><span class="goog_qs-tidbit goog_qs-tidbit-0">use</span></span><span class="pln"><span class="goog_qs-tidbit goog_qs-tidbit-0"> lib </span></span><span class="str"><span class="goog_qs-tidbit goog_qs-tidbit-0">'..'</span></span><span class="pun"><span class="goog_qs-tidbit goog_qs-tidbit-0">;</span></span><span class="pln"><br /></span></code></pre>
<p><span class="goog_qs-tidbit goog_qs-tidbit-0">You can modify the environment variable PERL5LIB before you run the</span>&nbsp;script:</p>
<pre class="lang-perl prettyprint"><code><span class="pln">export PERL5LIB</span><span class="pun">=</span><span class="pln">$PERL5LIB</span><span class="pun">:..</span><span class="pln"><br /></span></code></pre>
<p>The push(@INC) strategy can also work, but it has to be wrapped in BEGIN{} to make sure that the push is run before the module search:</p>
<pre class="lang-perl prettyprint"><code><span class="kwd">BEGIN</span><span class="pln"> </span><span class="pun">{</span><span class="pln">push </span><span class="lit">@INC</span><span class="pun">,</span><span class="pln"> </span><span class="str">'..'</span><span class="pun">}</span><span class="pln"><br /></span><span class="kwd">use</span><span class="pln"> yourlib</span><span class="pun">;</span></code></pre>
<p>&nbsp;</p>


    <small class="meta">May 16, 2011 | <a href='/bkup/2011/05/16/%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520perl%25e7%259a%2584library%25e8%25ae%25be%25e7%25bd%25ae%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520/#disqus_thread'>View Comments</a></small>
  </div>

  <div class="post">
    <h2><a href="/perl/unix/linux/2011/05/16/%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520perl%25e7%259a%2584library%25e8%25ae%25be%25e7%25bd%25ae%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520/">Perl的library设置</a></h2>

    <p>参考链接：</p>
<ol>
<li><a href="http://stackoverflow.com/questions/841785/how-do-i-include-a-perl-module-thats-in-a-different-directory">http://stackoverflow.com/questions/841785/how-do-i-include-a-perl-module-thats-in-a-different-directory</a></li>
<li><a href="http://stackoverflow.com/questions/185114/how-do-i-use-a-perl-module-in-a-directory-not-in-inc">http://stackoverflow.com/questions/185114/how-do-i-use-a-perl-module-in-a-directory-not-in-inc</a></li>
</ol>
<p>&nbsp;</p>
<p>在Fedora/RHEL/CentOS中，perl 的library默认安装路径为：</p>
<p>
<pre>@INC (@INC contains: /usr/lib64/perl5/site_perl/5.8.8/x86_64-linux-thread-multi /usr/lib/perl5/site_perl/5.8.8 /usr/lib/perl5/site_perl /usr/lib64/perl5/vendor_perl/5.8.8/x86_64-linux-thread-multi /usr/lib/perl5/vendor_perl/5.8.8 /usr/lib/perl5/vendor_perl /usr/lib64/perl5/5.8.8/x86_64-linux-thread-multi /usr/lib/perl5/5.8.8 .)</pre>
<p>&nbsp;</p>
<p>如果要使用自定义的perllib，就需要参考以下的设置了。</p>
<p>&nbsp;</p>
<p>EDIT: Putting the right solution first, originally from&nbsp;<a href="http://stackoverflow.com/questions/185114/how-do-i-use-a-perl-module-in-a-directory-not-in-inc">this question</a>. It's the only one that searches relative to the&nbsp;<strong>module</strong>&nbsp;directory:</p>
<pre class="lang-perl prettyprint"><code><span class="kwd">use</span><span class="pln"> </span><span class="typ">FindBin</span><span class="pun">;</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com"># locate this script</span><span class="pln"><br /></span><span class="kwd">use</span><span class="pln"> lib </span><span class="str">"$FindBin::Bin/.."</span><span class="pun">;</span><span class="pln"> &nbsp;</span><span class="com"># use the parent directory</span><span class="pln"><br /></span><span class="kwd">use</span><span class="pln"> yourlib</span><span class="pun">;</span><span class="pln"><br /></span></code></pre>
<p>There's many other ways that search for libraries relative to the&nbsp;<strong>current</strong>&nbsp;directory. You can invoke perl with the -I argument, passing the directory of the other module:</p>
<pre class="lang-perl prettyprint"><code><span class="pln">perl </span><span class="pun">-</span><span class="pln">I</span><span class="pun">..</span><span class="pln"> yourscript</span><span class="pun">.</span><span class="pln">pl<br /></span></code></pre>
<p><span class="goog_qs-tidbit goog_qs-tidbit-0">You can include a line near the top of your perl script:</span></p>
<pre class="lang-perl prettyprint"><code><span class="kwd"><span class="goog_qs-tidbit goog_qs-tidbit-0">use</span></span><span class="pln"><span class="goog_qs-tidbit goog_qs-tidbit-0"> lib </span></span><span class="str"><span class="goog_qs-tidbit goog_qs-tidbit-0">'..'</span></span><span class="pun"><span class="goog_qs-tidbit goog_qs-tidbit-0">;</span></span><span class="pln"><br /></span></code></pre>
<p><span class="goog_qs-tidbit goog_qs-tidbit-0">You can modify the environment variable PERL5LIB before you run the</span>&nbsp;script:</p>
<pre class="lang-perl prettyprint"><code><span class="pln">export PERL5LIB</span><span class="pun">=</span><span class="pln">$PERL5LIB</span><span class="pun">:..</span><span class="pln"><br /></span></code></pre>
<p>The push(@INC) strategy can also work, but it has to be wrapped in BEGIN{} to make sure that the push is run before the module search:</p>
<pre class="lang-perl prettyprint"><code><span class="kwd">BEGIN</span><span class="pln"> </span><span class="pun">{</span><span class="pln">push </span><span class="lit">@INC</span><span class="pun">,</span><span class="pln"> </span><span class="str">'..'</span><span class="pun">}</span><span class="pln"><br /></span><span class="kwd">use</span><span class="pln"> yourlib</span><span class="pun">;</span></code></pre>
<p>&nbsp;</p>


    <small class="meta">May 16, 2011 | <a href='/perl/unix/linux/2011/05/16/%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520perl%25e7%259a%2584library%25e8%25ae%25be%25e7%25bd%25ae%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520/#disqus_thread'>View Comments</a></small>
  </div>

  <div class="post">
    <h2><a href="/bkup/2011/05/13/%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520how%2520to%2520list%2520processes%2520attached%2520to%2520a%2520shared%2520memory%2520segment%2520in%2520linux%253f%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520/">How to list processes attached to a shared memory segment in linux?</a></h2>

    <p>本文整理自网络，参考网页(references):</p>
<ol>
<li><a href="http://stackoverflow.com/questions/5658568/how-to-list-processes-attached-to-a-shared-memory-segment-in-linux">http://stackoverflow.com/questions/5658568/how-to-list-processes-attached-to-a-shared-memory-segment-in-linux</a></li>
<li><a href="http://publib.boulder.ibm.com/infocenter/iseries/v5r4/index.jsp?topic=%2Frzahz%2Fipcs.htm">http://publib.boulder.ibm.com/infocenter/iseries/v5r4/index.jsp?topic=%2Frzahz%2Fipcs.htm</a></li>
</ol>
<p>[Question]:</p>
<p><span><br />
</span></p>
<p>How do I determine what process is attached to a shared memory segment?</p>
<pre><code>awagner@tree:/home/awagner$ ipcs -m

------ Shared Memory Segments --------
key        shmid      owner      perms      bytes      nattch     status      
0x00000000 0          root       777        102400     1                       
0x00000000 32769      root       774        96         1          dest         
0x00000000 98306      awagner    600        393216     2          dest         
0x00000000 131075     awagner    600        393216     2          dest    
</code></pre>
<p>i.e. how do I figure out which two processes are attached to segment 98305?</p>
<p>&nbsp;</p>
<p>[Answer]:</p>
<p>
<span><br />
</span></p>
<p>I don't think you can do this with the standard tools. You can use&nbsp;<code>ipcs -mp</code>&nbsp;to get the process ID of the<em>last</em>&nbsp;process to attach/detach but I'm not aware of how to get&nbsp;<em>all</em>&nbsp;attached processes with&nbsp;<code>ipcs</code>.</p>
<p>With a two-process-attached segment, assuming they both&nbsp;<em>stayed</em>&nbsp;attached, you can possibly figure out from the creator PID&nbsp;<code>cpid</code>&nbsp;and last-attached PID&nbsp;<code>lpid</code>&nbsp;which are the two processes but that won't scale to more than two processes so its usefulness is limited.</p>
<p>The&nbsp;<code>cat /proc/sysvipc/shm</code>&nbsp;method seems similarly limited but I believe there's a way to do it with other parts of the&nbsp;<code>/proc</code>&nbsp;filesystem, as shown below:</p>
<p>When I do a&nbsp;<code>grep</code>&nbsp;on the&nbsp;<code>procfs</code>&nbsp;maps for all processes, I get entries containing lines for the&nbsp;<code>cpid</code>and&nbsp;<code>lpid</code>&nbsp;processes.</p>
<p>For example, I get the following shared memory segment from&nbsp;<code>ipcs -m</code>:</p>
<pre><code>------ Shared Memory Segments --------
key        shmid      owner      perms      bytes      nattch     status      
0x00000000 123456     pax        600        1024       2          dest
</code></pre>
<p><span class="goog_qs-tidbit goog_qs-tidbit-0">and, from&nbsp;</span><code><span class="goog_qs-tidbit goog_qs-tidbit-0">ipcs -mp</span></code><span class="goog_qs-tidbit goog_qs-tidbit-0">, the&nbsp;</span><code><span class="goog_qs-tidbit goog_qs-tidbit-0">cpid</span></code><span class="goog_qs-tidbit goog_qs-tidbit-0">&nbsp;is 3956 and the&nbsp;</span><code><span class="goog_qs-tidbit goog_qs-tidbit-0">lpid</span></code><span class="goog_qs-tidbit goog_qs-tidbit-0">&nbsp;is 9999 for that given shared memory segment (123456).</span></p>
<p><span class="goog_qs-tidbit goog_qs-tidbit-0">Then, with the command&nbsp;</span><code><span class="goog_qs-tidbit goog_qs-tidbit-0">grep 123456</span>&nbsp;/proc/*/maps</code>, I see:</p>
<pre><code>/proc/3956/maps: blah blah blah 123456 /SYSV000000 (deleted)
/proc/9999/maps: blah blah blah 123456 /SYSV000000 (deleted)
</code></pre>
<p>So there&nbsp;<em>is</em>&nbsp;a way to get the processes that attached to it. I'm pretty certain that the&nbsp;<code>dest</code>&nbsp;status and<code>(deleted)</code>&nbsp;indicator are because the creator has marked the segment for destruction once the final detach occurs, not that it's already been destroyed.</p>
<p>So, by scanning of the&nbsp;<code>/proc/*/maps</code>&nbsp;"files", you should be able to discover which PIDs are currently attached to a given segment.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<hr />
<p>&nbsp;</p>
<p>
<span>
<dt><strong>CPID</strong>&nbsp;(-p, -a)</dt>
<dd>The process ID of the job that created the shared memory segment.</dd>
<p></span><span><br />
</span></p>
<p>&nbsp;</p>
<p><span>
<dt><strong>LPID</strong>&nbsp;(-p, -a)</dt>
<dd>The process ID of the last job to attach or detach from the shared memory segment or change the semaphore value.</dd>
<p></span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>


    <small class="meta">May 13, 2011 | <a href='/bkup/2011/05/13/%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520how%2520to%2520list%2520processes%2520attached%2520to%2520a%2520shared%2520memory%2520segment%2520in%2520linux%253f%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520/#disqus_thread'>View Comments</a></small>
  </div>

  <div class="post">
    <h2><a href="/unix/linux/2011/05/13/%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520how%2520to%2520list%2520processes%2520attached%2520to%2520a%2520shared%2520memory%2520segment%2520in%2520linux%253f%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520/">How to list processes attached to a shared memory segment in linux?</a></h2>

    <p>本文整理自网络，参考网页(references):</p>
<ol>
<li><a href="http://stackoverflow.com/questions/5658568/how-to-list-processes-attached-to-a-shared-memory-segment-in-linux">http://stackoverflow.com/questions/5658568/how-to-list-processes-attached-to-a-shared-memory-segment-in-linux</a></li>
<li><a href="http://publib.boulder.ibm.com/infocenter/iseries/v5r4/index.jsp?topic=%2Frzahz%2Fipcs.htm">http://publib.boulder.ibm.com/infocenter/iseries/v5r4/index.jsp?topic=%2Frzahz%2Fipcs.htm</a></li>
</ol>
<p>[Question]:</p>
<p><span><br />
</span></p>
<p>How do I determine what process is attached to a shared memory segment?</p>
<pre><code>awagner@tree:/home/awagner$ ipcs -m

------ Shared Memory Segments --------
key        shmid      owner      perms      bytes      nattch     status      
0x00000000 0          root       777        102400     1                       
0x00000000 32769      root       774        96         1          dest         
0x00000000 98306      awagner    600        393216     2          dest         
0x00000000 131075     awagner    600        393216     2          dest    
</code></pre>
<p>i.e. how do I figure out which two processes are attached to segment 98305?</p>
<p>&nbsp;</p>
<p>[Answer]:</p>
<p>
<span><br />
</span></p>
<p>I don't think you can do this with the standard tools. You can use&nbsp;<code>ipcs -mp</code>&nbsp;to get the process ID of the<em>last</em>&nbsp;process to attach/detach but I'm not aware of how to get&nbsp;<em>all</em>&nbsp;attached processes with&nbsp;<code>ipcs</code>.</p>
<p>With a two-process-attached segment, assuming they both&nbsp;<em>stayed</em>&nbsp;attached, you can possibly figure out from the creator PID&nbsp;<code>cpid</code>&nbsp;and last-attached PID&nbsp;<code>lpid</code>&nbsp;which are the two processes but that won't scale to more than two processes so its usefulness is limited.</p>
<p>The&nbsp;<code>cat /proc/sysvipc/shm</code>&nbsp;method seems similarly limited but I believe there's a way to do it with other parts of the&nbsp;<code>/proc</code>&nbsp;filesystem, as shown below:</p>
<p>When I do a&nbsp;<code>grep</code>&nbsp;on the&nbsp;<code>procfs</code>&nbsp;maps for all processes, I get entries containing lines for the&nbsp;<code>cpid</code>and&nbsp;<code>lpid</code>&nbsp;processes.</p>
<p>For example, I get the following shared memory segment from&nbsp;<code>ipcs -m</code>:</p>
<pre><code>------ Shared Memory Segments --------
key        shmid      owner      perms      bytes      nattch     status      
0x00000000 123456     pax        600        1024       2          dest
</code></pre>
<p><span class="goog_qs-tidbit goog_qs-tidbit-0">and, from&nbsp;</span><code><span class="goog_qs-tidbit goog_qs-tidbit-0">ipcs -mp</span></code><span class="goog_qs-tidbit goog_qs-tidbit-0">, the&nbsp;</span><code><span class="goog_qs-tidbit goog_qs-tidbit-0">cpid</span></code><span class="goog_qs-tidbit goog_qs-tidbit-0">&nbsp;is 3956 and the&nbsp;</span><code><span class="goog_qs-tidbit goog_qs-tidbit-0">lpid</span></code><span class="goog_qs-tidbit goog_qs-tidbit-0">&nbsp;is 9999 for that given shared memory segment (123456).</span></p>
<p><span class="goog_qs-tidbit goog_qs-tidbit-0">Then, with the command&nbsp;</span><code><span class="goog_qs-tidbit goog_qs-tidbit-0">grep 123456</span>&nbsp;/proc/*/maps</code>, I see:</p>
<pre><code>/proc/3956/maps: blah blah blah 123456 /SYSV000000 (deleted)
/proc/9999/maps: blah blah blah 123456 /SYSV000000 (deleted)
</code></pre>
<p>So there&nbsp;<em>is</em>&nbsp;a way to get the processes that attached to it. I'm pretty certain that the&nbsp;<code>dest</code>&nbsp;status and<code>(deleted)</code>&nbsp;indicator are because the creator has marked the segment for destruction once the final detach occurs, not that it's already been destroyed.</p>
<p>So, by scanning of the&nbsp;<code>/proc/*/maps</code>&nbsp;"files", you should be able to discover which PIDs are currently attached to a given segment.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<hr />
<p>&nbsp;</p>
<p>
<span>
<dt><strong>CPID</strong>&nbsp;(-p, -a)</dt>
<dd>The process ID of the job that created the shared memory segment.</dd>
<p></span><span><br />
</span></p>
<p>&nbsp;</p>
<p><span>
<dt><strong>LPID</strong>&nbsp;(-p, -a)</dt>
<dd>The process ID of the last job to attach or detach from the shared memory segment or change the semaphore value.</dd>
<p></span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>


    <small class="meta">May 13, 2011 | <a href='/unix/linux/2011/05/13/%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520how%2520to%2520list%2520processes%2520attached%2520to%2520a%2520shared%2520memory%2520segment%2520in%2520linux%253f%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520/#disqus_thread'>View Comments</a></small>
  </div>

  <div class="post">
    <h2><a href="/bkup/2011/05/03/%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520shell%25e6%25b5%25ae%25e7%2582%25b9%25e6%2595%25b0%25e8%25bf%2590%25e7%25ae%2597%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520/">Shell浮点数运算</a></h2>

    <p>Shell本身不支持浮点数运算，(())之类的数学运算符只能进行整数运算。要想在shell中运算浮点数，只能借助于bc, Awk或者Perl。 如</p>
<p>
<pre>a=0.1
b=0.2
c=$(echo "$a+$b" | bc -l)</pre>
<p>&nbsp;</p>
<p>或者</p>
<p>
<pre>perl -e "print STDOUT $a + $b;"</pre>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>需要注意的是，如果数学表达式中有负数，则必须确保运算符(+ - * /)与其前后的表达式之间至少有一空格。如：</p>
<p>
<pre>[bonn@bonn Downloads]$ echo $a $b
-0.1 -0.2
[bonn@bonn Downloads]$ echo "$a - $b" | bc -l
.1
[bonn@bonn Downloads]$ perl -e "print STDOUT $a - $b;"
0.1
</pre>
<p>&nbsp;</p>


    <small class="meta">May 03, 2011 | <a href='/bkup/2011/05/03/%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520shell%25e6%25b5%25ae%25e7%2582%25b9%25e6%2595%25b0%25e8%25bf%2590%25e7%25ae%2597%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520/#disqus_thread'>View Comments</a></small>
  </div>

  <div class="post">
    <h2><a href="/perl/unix/linux/2011/05/03/%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520shell%25e6%25b5%25ae%25e7%2582%25b9%25e6%2595%25b0%25e8%25bf%2590%25e7%25ae%2597%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520/">Shell浮点数运算</a></h2>

    <p>Shell本身不支持浮点数运算，(())之类的数学运算符只能进行整数运算。要想在shell中运算浮点数，只能借助于bc, Awk或者Perl。 如</p>
<p>
<pre>a=0.1
b=0.2
c=$(echo "$a+$b" | bc -l)</pre>
<p>&nbsp;</p>
<p>或者</p>
<p>
<pre>perl -e "print STDOUT $a + $b;"</pre>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>需要注意的是，如果数学表达式中有负数，则必须确保运算符(+ - * /)与其前后的表达式之间至少有一空格。如：</p>
<p>
<pre>[bonn@bonn Downloads]$ echo $a $b
-0.1 -0.2
[bonn@bonn Downloads]$ echo "$a - $b" | bc -l
.1
[bonn@bonn Downloads]$ perl -e "print STDOUT $a - $b;"
0.1
</pre>
<p>&nbsp;</p>


    <small class="meta">May 03, 2011 | <a href='/perl/unix/linux/2011/05/03/%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520shell%25e6%25b5%25ae%25e7%2582%25b9%25e6%2595%25b0%25e8%25bf%2590%25e7%25ae%2597%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520/#disqus_thread'>View Comments</a></small>
  </div>

</div>

<div class='paging'>
  
    <a href='/page13' class='older'>Older Posts</a>
  

  
    <a href='/page11' class='newer'>Newer Posts</a>
  

  
  <div class='clear'></div>
</div>

        </div>
      </div>

      <div id="bottom" class="span8 offset4">
        <div class="well">
          <a href="/about/">About</a> |
          <a href="/archives/">Archives</a> |
          <a href="/atom.xml">feed</a>
        </div>
      </div>
    </div>
  </div>

  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script src="/javascripts/bootstrap.min.js"></script>

  <!-- Google Analytics Code -->
  <script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-9947336-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script');
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 
          'http://www') + '.google-analytics.com/ga.js';
      ga.setAttribute('async', 'true');
      document.documentElement.firstChild.appendChild(ga);
    })();

  </script>
</body>
</html>

