
<!DOCTYPE HTML>
<html lang="en-US" xmlns="http://www.w3.org/1999/xhtml" xmlns:wb="http://open.weibo.com/wb">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bo Yang | Bo's Blog</title>
  
  <meta name="author" content="Bo Yang" />
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <!--
  <link href="/assets/themes/clear/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  -->

  <!-- Bootstrap -->
  <link href="/assets/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="/assets/bootstrap/css/bootstrap-theme.min.css" rel="stylesheet">

  <!-- font-awesome -->
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.css" rel="stylesheet">

  <!-- Google Prettify -->
  <link href="/assets/google-code-prettify/desert.css" rel="stylesheet" type="text/css" media="all">
  <!-- Google Pretty end -->

  <link href="/assets/style/blog.css" rel="stylesheet">
  
  <script src="/assets/bootstrap/js/jquery-1.10.2.js"></script>
  <script src="/assets/bootstrap/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>

<body>

   <!-- navigation bar -->
	<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">bo-yang</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse navbar-ex1-collapse">
				<ul class="nav navbar-nav">
					<li><a href="/archive.html">Archive</a>
                    </li>
                    <li><a href="/about.html">About</a>
                    </li>
                    <li><a href="/messages.html">Messages</a>
                    </li>
				</ul>
				<ul class="nav navbar-nav pull-right">
		          <li>
		            <form class="navbar-form navbar-search" method="get" action="http://www.google.com/search" target="google_window">
		              <input id="g_search" type="text" class="search-query" placeholder="Search..." name="q" />
		              <input type="submit" name="btnG" style="display:none" id="searchsubmit" value="Search" />
		              <input type="hidden" name="ie" value="UTF-8" />
		              <input type="hidden" name="oe" value="UTF-8" />
		              <input type="hidden" name="hl" value="en-US" />
		              <input type="hidden" name="domains" value="http://bo-yang.github.io/" />
					  <input type="hidden" name="sitesearch" value="http://bo-yang.github.io/" />
					  <button type="submit" class="button button-rounded button-flat-blue">Go</button>
		            </form>
		          </li>
		        </ul>
            </div>
			<!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

  <div class="container">
    <div class="row" id="content-row">
      
<div class="page-header">
	<h1>Bo Yang  <small style="margin-left:20px;"><font face="cursive"><i>Beginner's mind.</i></font></small></h1>
</div>

<div class="container">
    <div class="row" id="content-row">
		<div class="col-md-8">
	<!-- blog entry -->
	
	<div class="post paper">	
    <h2 class="header"><a href="/2011/06/22/solaris-shared-lib-error">Solaris下/usr/lib/secure/0@0.so.1的错误</a></h2>
    <p>
    	<span class="glyphicon glyphicon-time"></span> Posted by <strong>Bo Yang</strong> at <strong>2011-06-22</strong> with tags <span class="glyphicon glyphicon-tag"></span><a href="/tags.html#Unix/Linux-ref" rel="nofollow">Unix/Linux</a>
	</p>
	<hr>
    
    <div class="post_at_index thepost">
    	<p>&nbsp;</p>
<p>这两天一直被下面的错误所困扰：</p>
<p>
<pre>AP13: lb -m ccmscell uptime 
ld.so.1: uname: fatal: /usr/lib/secure/0@0.so.1: open failed: No such file or directory
ksh[216]: 4412 Killed
ld.so.1: uptime: fatal: /usr/lib/secure/0@0.so.1: open failed: No such file or directory
</pre>
<p>&nbsp;&nbsp;</p>
<p>lb是一个调用rsh的脚本，ccmscell是一个server pool，uname是在lb中被调用的。</p>
<p>&nbsp;</p>
<p>仔细研究了N遍相关的脚本，Google了N次相关的错误信息，都没有找到有价&#20540;的线索。后来问了一位做过IT的同事，她说以前遇见过类&#20284;的问题，可她的解决方案最终被证明无效。</p>
<p>&nbsp;</p>
<p>最终发现不是所有的server上执行这条命令都有问题，有些是可以执行的。对比了之后发现，如果/usr/lib/secure/0@0.so.1的group设置为bin，owner设为root，就不会出现上面的问题。出问题的server上/usr/lib/secure/0@0.so.1的group为other。</p>
<p>&nbsp;</p>
<p>进一步调查后发现，/usr/lib/secure/0@0.so.1是在Solaris 5.8上被设为LD_PRELOAD_32的，因为很多程序要被setuid&#043;chroot的伪root调用。当且仅当上面的命令被该伪root执行时，才会出现上面的错误！</p>
<p>&nbsp;</p>
<p>幸亏Solaris 5.8已经开始走进坟墓了，即使在落后如我们公司的地方！</p>
<p>&nbsp;</p>
<p><strong><span style="font-family:mceinline;">【update2011-06-23】：</span></strong></p>
<p><strong><span style="font-family:mceinline;">今天发现root cause 不是由于/usr/lib/secure/0@0.so.1的group不对，而是因为remote server（比如pool&nbsp;ccmscell中的server）上没有/usr/lib/secure/0@0.so.1 —— 执行rsh命令的login是setuid&#043;chroot实现的伪root，因此远程的server就需要/usr/lib/secure/0@0.so.1了。</span></strong></p>
<p><span style="font-family:mceinline;font-weight:bold;">【update 2012-03-12】</span></p>
<p><strong><span style="font-family:mceinline;">今天在Solaris 9上遇到了这样一个错误：</span></strong></p>
<p><span style="font-family:mceinline;">&nbsp; &nbsp; ld.so.1: pt_chmod: warning: /lib/0@0.so.1: open failed: illegal insecure pathname<br />
</span></p>
<p><strong><span style="font-family:mceinline;">查了很久才想起来有可能是</span></strong><strong>/usr/lib/secure/0@0.so.1造成的。一检查</strong><strong>/usr/lib/secure/0@0.so.1，果然不存在。</strong></p>
<p><strong><span style="font-family:mceinline;"></span></strong><strong></strong><strong>在一个正常工作的server上，</strong></p>
<p><strong><span style="font-family:mceinline;"></span></strong><strong></strong><strong></strong>
<pre>AP31: echo $LD_PRELOAD_32
/usr/lib/secure/0@0.so.1</pre></p>
<p><strong><span style="font-family:mceinline;"></span></strong><strong></strong><strong>在不能工作的server上，</strong></p>
<p><strong><span style="font-family:mceinline;"></span></strong><strong></strong><strong></strong>
<pre>AP13: echo $LD_PRELOAD_32
/lib/0@0.so.1</pre></p>
<p><strong><span style="font-family:mceinline;"></span></strong><strong></strong><strong>——仅仅升级了一个软件就又把这个library搞丢了，某些同志们啊，唉……</strong></p>

	</div>
	</div>
    
	<div class="post paper">	
    <h2 class="header"><a href="/2011/06/03/ksh-IPCSCMD-variable">ksh中包含变量的命令调用</a></h2>
    <p>
    	<span class="glyphicon glyphicon-time"></span> Posted by <strong>Bo Yang</strong> at <strong>2011-06-03</strong> with tags <span class="glyphicon glyphicon-tag"></span><a href="/tags.html#Unix/Linux-ref" rel="nofollow">Unix/Linux</a>, <span class="glyphicon glyphicon-tag"></span><a href="/tags.html#Shell-ref" rel="nofollow">Shell</a>
	</p>
	<hr>
    
    <div class="post_at_index thepost">
    	<p>当一个含有变量a的命令存储在某个变量b中时, 利用$($b)时有可能会报错。如下面的代码，有时可以成功执行，有时会发生&ldquo;ipcs|grep xxx can not be found"的错误。&nbsp;</p>
<p>
<pre>IFS="
"
if isLinux
then
	IPCSCMD="ipcs"
else
	IPCSCMD="ipcs|grep $LOGNAME"
fi
for Eachline in $($IPCSCMD)
do
	IFS=" " # Space
	# Handle IPCs
	...
done</pre>
<p>&nbsp;</p>
<p>究其根源，应该是对IPCSCMD的解析出了问题。将代码改为下面的形式，就可以正确执行了。注意IFS的变化&mdash;&mdash;改成下面的形式后必须将循环内的IFS改为Space和Tab。</p>
<p>
<pre>IFS="
"
if isLinux
then
	ipcs
else
	ipcs|grep $LOGNAME
fi | while read Eachline
do
	IFS=" 	" # Space and tab
	# Handle IPCs
	...
done
</pre>
<p>&nbsp;</p>
<p>&nbsp;</p>

	</div>
	</div>
    
	<div class="post paper">	
    <h2 class="header"><a href="/2011/06/02/chroot-setuid-setgid">chroot, setuid() and set gid</a></h2>
    <p>
    	<span class="glyphicon glyphicon-time"></span> Posted by <strong>Bo Yang</strong> at <strong>2011-06-02</strong> with tags <span class="glyphicon glyphicon-tag"></span><a href="/tags.html#Unix/Linux-ref" rel="nofollow">Unix/Linux</a>
	</p>
	<hr>
    
    <div class="post_at_index thepost">
    	<p>这篇文章搜集整理了网上chroot, setuid() &amp; set gid相关的文章。</p>
<ol>
<li><a href="http://www.unixwiz.net/techtips/chroot-practices.html">Best Practices for UNIX chroot() Operations</a></li>
<li><strong><a href="http://www.bpfh.net/simes/computing/chroot-break.html">How to break out of a&nbsp;<tt>chroot()</tt></a></strong><strong><a href="http://www.bpfh.net/simes/computing/chroot-break.html">&nbsp;jail</a></strong></li>
<li><strong><a href="http://www.cs.berkeley.edu/~daw/papers/setuid-usenix02.pdf">Setuid Demystifid</a></strong></li>
<li><strong><a href="http://oldfield.wattle.id.au/luv/permissions.html">Introduction to Unix file permissions</a></strong></li>
</ol>

	</div>
	</div>
    
	<div class="post paper">	
    <h2 class="header"><a href="/2011/05/20/zcat-gzcat">如何判断一个(压缩)文件的类型，以及zcat/gzcat</a></h2>
    <p>
    	<span class="glyphicon glyphicon-time"></span> Posted by <strong>Bo Yang</strong> at <strong>2011-05-20</strong> with tags <span class="glyphicon glyphicon-tag"></span><a href="/tags.html#Unix/Linux-ref" rel="nofollow">Unix/Linux</a>
	</p>
	<hr>
    
    <div class="post_at_index thepost">
    	<p>恰似&ldquo;一师是个好学校&rdquo;，dd是个好工具&mdash;&mdash;只消用它逐字copy出某个文件第一个block的内容，就可以判断出该文件的类型！！！</p>
<p>&nbsp;</p>
<p>
<pre>bjbldd&gt;1&gt; dd if=MMEgolden.tar bs=512 count=1 &gt; dd_tmp
1+0 records in
1+0 records out
bjbldd&gt;&gt; file dd_tmp
dd_tmp:         USTAR tar archive
bjbldd&gt;&gt; dd if=varofvar bs=512 count=1 &gt; dd_tmp
0+1 records in
0+1 records out
bjbldd&gt;&gt; file dd_tmp
dd_tmp:         executable /bin/ksh script
bjbldd&gt;&gt; dd if=Tk-804.029.tar.gz bs=512 count=1 &gt; dd_tmp
1+0 records in
1+0 records out
bjbldd&gt;&gt; file dd_tmp
dd_tmp:         gzip compressed data - deflate method , original file name , max compression
</pre>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>另外，zcat或者gzcat是用于cat gzip压缩文件的工具，只是在不同的平台有些差异：/bin/zcat在Linux上work的很好，可是当它在Solaris上cat gzip文件的内容时，就会报错。Solaris上cat gzip文件只能用/bin/gzcat. &mdash;&mdash;就是这个小小的差异，浪费了我一天的时间！</p>
<p>&nbsp;</p>
<p>跨平台的cat gzip文件的代码如下：</p>
<p>
<pre>OS="`/bin/uname`"
if [ "${OS}" != "Linux" ]
then
	ZCAT="/bin/zcat"
else
	ZCAT="/bin/gzcat"
fi
.......
${ZCAT} ${TMPDIR}/ngn_platform.cpio.Z | /bin/cpio -idmvu  -H odc ${SAT_CPIO_FLAG}</pre>
<p>&nbsp;</p>
<p>貌似cpio的用法也很强大哦～</p>

	</div>
	</div>
    
	<div class="post paper">	
    <h2 class="header"><a href="/2011/05/16/yum-proxy">yum的proxy设置</a></h2>
    <p>
    	<span class="glyphicon glyphicon-time"></span> Posted by <strong>Bo Yang</strong> at <strong>2011-05-16</strong> with tags <span class="glyphicon glyphicon-tag"></span><a href="/tags.html#Unix/Linux-ref" rel="nofollow">Unix/Linux</a>
	</p>
	<hr>
    
    <div class="post_at_index thepost">
    	<p>方法一：</p>
<p>
<pre>export http_proxy="proxy:portnum"</pre>
<p>&nbsp;</p>
<p>方法二：（<a href="http://www.fedoraforum.org/forum/showthread.php?t=742">http://www.fedoraforum.org/forum/showthread.php?t=742</a>）</p>
<table id="post4089" class="tborder" style="width:100%;" border="0" cellspacing="1" cellpadding="6" align="center">
<tbody>
<tr>
<td class="alt1">
<div id="post_message_4089">create the following files in /etc/profile.d, and then this will work in *any* shell for *any* user of the system</p>
<pre>#proxy.sh
export http_proxy=http://host.com:port/
export ftp_proxy=http://host.com:port/
export no_proxy=.domain.com
export HTTP_PROXY=http://host.com:port/
export FTP_PROXY=http://host.com:port/
#proxy.csh
setenv http_proxy http://host.com:port/
setenv ftp_proxy http://host.com:port/
setenv no_proxy .domain.com
setenv HTTP_PROXY http://host.com:port/
setenv FTP_PROXY http://host.com:port/</pre>
<p>&nbsp;</p></div>
<div>方法三：(<a href="http://linux.die.net/man/5/yum.conf">http://linux.die.net/man/5/yum.conf</a>)</div>
<div>在/etc/yum.conf中设置proxy，prox_username和proxy_password选项。</div>
</td>
</tr>
</tbody>
</table>

	</div>
	</div>
    
	<div class="post paper">	
    <h2 class="header"><a href="/2011/05/16/perl-library">Perl的library设置</a></h2>
    <p>
    	<span class="glyphicon glyphicon-time"></span> Posted by <strong>Bo Yang</strong> at <strong>2011-05-16</strong> with tags <span class="glyphicon glyphicon-tag"></span><a href="/tags.html#Perl-ref" rel="nofollow">Perl</a>, <span class="glyphicon glyphicon-tag"></span><a href="/tags.html#Unix/Linux-ref" rel="nofollow">Unix/Linux</a>
	</p>
	<hr>
    
    <div class="post_at_index thepost">
    	<p>参考链接：</p>
<ol>
<li><a href="http://stackoverflow.com/questions/841785/how-do-i-include-a-perl-module-thats-in-a-different-directory">http://stackoverflow.com/questions/841785/how-do-i-include-a-perl-module-thats-in-a-different-directory</a></li>
<li><a href="http://stackoverflow.com/questions/185114/how-do-i-use-a-perl-module-in-a-directory-not-in-inc">http://stackoverflow.com/questions/185114/how-do-i-use-a-perl-module-in-a-directory-not-in-inc</a></li>
</ol>
<p>&nbsp;</p>
<p>在Fedora/RHEL/CentOS中，perl 的library默认安装路径为：</p>
<p>
<pre>@INC (@INC contains: /usr/lib64/perl5/site_perl/5.8.8/x86_64-linux-thread-multi /usr/lib/perl5/site_perl/5.8.8 /usr/lib/perl5/site_perl /usr/lib64/perl5/vendor_perl/5.8.8/x86_64-linux-thread-multi /usr/lib/perl5/vendor_perl/5.8.8 /usr/lib/perl5/vendor_perl /usr/lib64/perl5/5.8.8/x86_64-linux-thread-multi /usr/lib/perl5/5.8.8 .)</pre>
<p>&nbsp;</p>
<p>如果要使用自定义的perllib，就需要参考以下的设置了。</p>
<p>&nbsp;</p>
<p>EDIT: Putting the right solution first, originally from&nbsp;<a href="http://stackoverflow.com/questions/185114/how-do-i-use-a-perl-module-in-a-directory-not-in-inc">this question</a>. It's the only one that searches relative to the&nbsp;<strong>module</strong>&nbsp;directory:</p>
<pre class="lang-perl prettyprint"><code><span class="kwd">use</span><span class="pln"> </span><span class="typ">FindBin</span><span class="pun">;</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com"># locate this script</span><span class="pln"><br /></span><span class="kwd">use</span><span class="pln"> lib </span><span class="str">"$FindBin::Bin/.."</span><span class="pun">;</span><span class="pln"> &nbsp;</span><span class="com"># use the parent directory</span><span class="pln"><br /></span><span class="kwd">use</span><span class="pln"> yourlib</span><span class="pun">;</span><span class="pln"><br /></span></code></pre>
<p>There's many other ways that search for libraries relative to the&nbsp;<strong>current</strong>&nbsp;directory. You can invoke perl with the -I argument, passing the directory of the other module:</p>
<pre class="lang-perl prettyprint"><code><span class="pln">perl </span><span class="pun">-</span><span class="pln">I</span><span class="pun">..</span><span class="pln"> yourscript</span><span class="pun">.</span><span class="pln">pl<br /></span></code></pre>
<p><span class="goog_qs-tidbit goog_qs-tidbit-0">You can include a line near the top of your perl script:</span></p>
<pre class="lang-perl prettyprint"><code><span class="kwd"><span class="goog_qs-tidbit goog_qs-tidbit-0">use</span></span><span class="pln"><span class="goog_qs-tidbit goog_qs-tidbit-0"> lib </span></span><span class="str"><span class="goog_qs-tidbit goog_qs-tidbit-0">'..'</span></span><span class="pun"><span class="goog_qs-tidbit goog_qs-tidbit-0">;</span></span><span class="pln"><br /></span></code></pre>
<p><span class="goog_qs-tidbit goog_qs-tidbit-0">You can modify the environment variable PERL5LIB before you run the</span>&nbsp;script:</p>
<pre class="lang-perl prettyprint"><code><span class="pln">export PERL5LIB</span><span class="pun">=</span><span class="pln">$PERL5LIB</span><span class="pun">:..</span><span class="pln"><br /></span></code></pre>
<p>The push(@INC) strategy can also work, but it has to be wrapped in BEGIN{} to make sure that the push is run before the module search:</p>
<pre class="lang-perl prettyprint"><code><span class="kwd">BEGIN</span><span class="pln"> </span><span class="pun">{</span><span class="pln">push </span><span class="lit">@INC</span><span class="pun">,</span><span class="pln"> </span><span class="str">'..'</span><span class="pun">}</span><span class="pln"><br /></span><span class="kwd">use</span><span class="pln"> yourlib</span><span class="pun">;</span></code></pre>
<p>&nbsp;</p>

	</div>
	</div>
    
	<div class="post paper">	
    <h2 class="header"><a href="/2011/05/13/process-attached-to-shared-memory">How to list processes attached to a shared memory segment in linux?</a></h2>
    <p>
    	<span class="glyphicon glyphicon-time"></span> Posted by <strong>Bo Yang</strong> at <strong>2011-05-13</strong> with tags <span class="glyphicon glyphicon-tag"></span><a href="/tags.html#Unix/Linux-ref" rel="nofollow">Unix/Linux</a>
	</p>
	<hr>
    
    <div class="post_at_index thepost">
    	<p>本文整理自网络，参考网页(references):</p>
<ol>
<li><a href="http://stackoverflow.com/questions/5658568/how-to-list-processes-attached-to-a-shared-memory-segment-in-linux">http://stackoverflow.com/questions/5658568/how-to-list-processes-attached-to-a-shared-memory-segment-in-linux</a></li>
<li><a href="http://publib.boulder.ibm.com/infocenter/iseries/v5r4/index.jsp?topic=%2Frzahz%2Fipcs.htm">http://publib.boulder.ibm.com/infocenter/iseries/v5r4/index.jsp?topic=%2Frzahz%2Fipcs.htm</a></li>
</ol>
<p>[Question]:</p>
<p><span><br />
</span></p>
<p>How do I determine what process is attached to a shared memory segment?</p>
<pre><code>awagner@tree:/home/awagner$ ipcs -m

------ Shared Memory Segments --------
key        shmid      owner      perms      bytes      nattch     status      
0x00000000 0          root       777        102400     1                       
0x00000000 32769      root       774        96         1          dest         
0x00000000 98306      awagner    600        393216     2          dest         
0x00000000 131075     awagner    600        393216     2          dest    
</code></pre>
<p>i.e. how do I figure out which two processes are attached to segment 98305?</p>
<p>&nbsp;</p>
<p>[Answer]:</p>
<p>
<span><br />
</span></p>
<p>I don't think you can do this with the standard tools. You can use&nbsp;<code>ipcs -mp</code>&nbsp;to get the process ID of the<em>last</em>&nbsp;process to attach/detach but I'm not aware of how to get&nbsp;<em>all</em>&nbsp;attached processes with&nbsp;<code>ipcs</code>.</p>
<p>With a two-process-attached segment, assuming they both&nbsp;<em>stayed</em>&nbsp;attached, you can possibly figure out from the creator PID&nbsp;<code>cpid</code>&nbsp;and last-attached PID&nbsp;<code>lpid</code>&nbsp;which are the two processes but that won't scale to more than two processes so its usefulness is limited.</p>
<p>The&nbsp;<code>cat /proc/sysvipc/shm</code>&nbsp;method seems similarly limited but I believe there's a way to do it with other parts of the&nbsp;<code>/proc</code>&nbsp;filesystem, as shown below:</p>
<p>When I do a&nbsp;<code>grep</code>&nbsp;on the&nbsp;<code>procfs</code>&nbsp;maps for all processes, I get entries containing lines for the&nbsp;<code>cpid</code>and&nbsp;<code>lpid</code>&nbsp;processes.</p>
<p>For example, I get the following shared memory segment from&nbsp;<code>ipcs -m</code>:</p>
<pre><code>------ Shared Memory Segments --------
key        shmid      owner      perms      bytes      nattch     status      
0x00000000 123456     pax        600        1024       2          dest
</code></pre>
<p><span class="goog_qs-tidbit goog_qs-tidbit-0">and, from&nbsp;</span><code><span class="goog_qs-tidbit goog_qs-tidbit-0">ipcs -mp</span></code><span class="goog_qs-tidbit goog_qs-tidbit-0">, the&nbsp;</span><code><span class="goog_qs-tidbit goog_qs-tidbit-0">cpid</span></code><span class="goog_qs-tidbit goog_qs-tidbit-0">&nbsp;is 3956 and the&nbsp;</span><code><span class="goog_qs-tidbit goog_qs-tidbit-0">lpid</span></code><span class="goog_qs-tidbit goog_qs-tidbit-0">&nbsp;is 9999 for that given shared memory segment (123456).</span></p>
<p><span class="goog_qs-tidbit goog_qs-tidbit-0">Then, with the command&nbsp;</span><code><span class="goog_qs-tidbit goog_qs-tidbit-0">grep 123456</span>&nbsp;/proc/*/maps</code>, I see:</p>
<pre><code>/proc/3956/maps: blah blah blah 123456 /SYSV000000 (deleted)
/proc/9999/maps: blah blah blah 123456 /SYSV000000 (deleted)
</code></pre>
<p>So there&nbsp;<em>is</em>&nbsp;a way to get the processes that attached to it. I'm pretty certain that the&nbsp;<code>dest</code>&nbsp;status and<code>(deleted)</code>&nbsp;indicator are because the creator has marked the segment for destruction once the final detach occurs, not that it's already been destroyed.</p>
<p>So, by scanning of the&nbsp;<code>/proc/*/maps</code>&nbsp;"files", you should be able to discover which PIDs are currently attached to a given segment.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<hr />
<p>&nbsp;</p>
<p>
<span>
<dt><strong>CPID</strong>&nbsp;(-p, -a)</dt>
<dd>The process ID of the job that created the shared memory segment.</dd>
<p></span><span><br />
</span></p>
<p>&nbsp;</p>
<p><span>
<dt><strong>LPID</strong>&nbsp;(-p, -a)</dt>
<dd>The process ID of the last job to attach or detach from the shared memory segment or change the semaphore value.</dd>
<p></span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>

	</div>
	</div>
    
	<div class="post paper">	
    <h2 class="header"><a href="/2011/05/03/shell-floating-point">Shell浮点数运算</a></h2>
    <p>
    	<span class="glyphicon glyphicon-time"></span> Posted by <strong>Bo Yang</strong> at <strong>2011-05-03</strong> with tags <span class="glyphicon glyphicon-tag"></span><a href="/tags.html#Perl-ref" rel="nofollow">Perl</a>, <span class="glyphicon glyphicon-tag"></span><a href="/tags.html#Unix/Linux-ref" rel="nofollow">Unix/Linux</a>, <span class="glyphicon glyphicon-tag"></span><a href="/tags.html#Shell-ref" rel="nofollow">Shell</a>
	</p>
	<hr>
    
    <div class="post_at_index thepost">
    	<p>Shell本身不支持浮点数运算，(())之类的数学运算符只能进行整数运算。要想在shell中运算浮点数，只能借助于bc, Awk或者Perl。 如</p>
<p>
<pre>a=0.1
b=0.2
c=$(echo "$a+$b" | bc -l)</pre>
<p>&nbsp;</p>
<p>或者</p>
<p>
<pre>perl -e "print STDOUT $a + $b;"</pre>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>需要注意的是，如果数学表达式中有负数，则必须确保运算符(+ - * /)与其前后的表达式之间至少有一空格。如：</p>
<p>
<pre>[bonn@bonn Downloads]$ echo $a $b
-0.1 -0.2
[bonn@bonn Downloads]$ echo "$a - $b" | bc -l
.1
[bonn@bonn Downloads]$ perl -e "print STDOUT $a - $b;"
0.1
</pre>
<p>&nbsp;</p>

	</div>
	</div>
    
	<div class="post paper">	
    <h2 class="header"><a href="/2011/04/20/groff">groff初体验</a></h2>
    <p>
    	<span class="glyphicon glyphicon-time"></span> Posted by <strong>Bo Yang</strong> at <strong>2011-04-20</strong> with tags <span class="glyphicon glyphicon-tag"></span><a href="/tags.html#Unix/Linux-ref" rel="nofollow">Unix/Linux</a>
	</p>
	<hr>
    
    <div class="post_at_index thepost">
    	<p>&ldquo;所见即所得（WYSIWYG，What you see is what you get）&rdquo;编辑器可以使简单的工作更简单，却无法完成某些复杂的工作。</p>
<p>&nbsp;</p>
<p>nroff/troff是UNIX下经典的typesetting工具，groff是GNU的*roff实现，并对troff的功能进行了增强。与LaTeX相比，体积较小，且大多为*nix自带，使用较为方便。虽说TeX为Donald Knuth所创，排版效果非常好，但体积相当庞大（安装完差不多3.5GB），而且通篇的/xx语法确实把我雷倒了&mdash;&mdash;还是先由groff入手吧。</p>
<p>&nbsp;</p>
<p>已经搜集到的*roff相关的资料：</p>
<ul>
<li><span><a class="l" href="http://www.angelfire.com/linux/mlaha/pdffiles/grofftut.pdfg" target="_blank">An Introduction to the GNU&nbsp;<em>Groff</em>&nbsp;Text Processing System</a></span></li>
<li><span><a class="l" href="http://www.angelfire.com/linux/mlaha/pdffiles/grofftut.pdfg" target="_blank"></a></span><a href="http://www.ibm.com/developerworks/aix/tutorials/au-groff/index.html">Produce device-independent documentation with Groff</a></li>
<li><a href="http://www.gnu.org/software/groff/manual/groff.pdf">Groff Manual</a></li>
<li><a href="http://www.ibm.com/developerworks/aix/tutorials/au-groff/index.html"></a><a href="http://troff.org/">http://troff.org/</a></li>
<li><a href="http://oreilly.com/openbook/utp/UnixTextProcessing.pdf">http://oreilly.com/openbook/utp/UnixTextProcessing.pdf</a></li>
<li><a href="http://floppsie.comp.glam.ac.uk/Glamorgan/gaius/web/groff_www.html">groff_www</a></li>
<li><a href="http://floppsie.comp.glam.ac.uk/Glamorgan/gaius/web/groff.xhtml">GROFF &amp; [X]HTML</a></li>
</ul>
<p>groff最吸引我的地方在于能够轻松的编辑数学公式、绘图、制表、排版并且转化为ps/pdf文件或者网页。为了体验这些功能，将下面的代码为输入纯文本文件html_test,</p>
<p>
<pre>.URL http://netpbm.sourceforge.net/doc "Netpbm manual"
.URL pic.html "Eric Raymond's pic guide"
.LK TestLink
.LP
.EQ
G(z) ~=~ e sup { ln ~ G(z) }
    ~=~ exp left ( sum from k&gt;=1 { S sub k z sup k } over k right )
    ~=~ prod from k&gt;=1 e sup { S sub k z sup k /k }
.EN
.LP
.TS
tab(:);
c s s
c | c | c
l | l | n.
Major New York Bridges
=
Bridge:Designer:Length
_
Brooklyn:J. A. Roebling:1595
Manhattan:G. Lindenthal: 1470
Williamsburg:L. L. Buck:1600
_
Queensborough:Palmer &amp;:1182
/^:  Hornbostel:/^
_
Triborough:O. H. Ammann:1380
/^:/^:383
_
Bronx Whitestone:O. H. Ammann:2300
Throgs Neck:O. H. Ammann:1800
_
George Washington:O. H. Ammann:3500
_
.TE
.LP
.PS
lineht = lineht / 2
box "/fIletter.tr/fP"
arrow
circle "tbl"
arrow
Eqn: circle "eqn"
arrow
Troff: circle "troff"
arc cw
line down
arc cw
left
arrow
circle "grops"
arrow
box "/fIletter.ps/fP"
up
line &lt;- from Troff.n
arc
line
box "/fItmac.m/fP"
.PE
</pre>
<p>&nbsp;</p>
<p>然后输入下列命令：</p>
<p>
<pre>pic html_test | eqn | tbl | groff -ms -Thtml &gt; html_test.html</pre>
<p>&nbsp;</p>
<p>或者</p>
<p>
<pre>groff -p -e -t -ms -Thtml html_test &gt; html_test.html</pre>
<p>&nbsp;</p>
<p>在处理pic时，宏-ms必不可少。</p>
<p>&nbsp;</p>
<p>如果不出错的话，链接将会在网页中正常显示，公式、表格以及图表会被转换为图片。</p>
<p>&nbsp;</p>
<p><img src="http://bonny95.files.wordpress.com/2011/04/0_1303308743p06n.gif" alt="" width="402" height="201" /></p>
<p>&nbsp;</p>
<p><img src="http://bonny95.files.wordpress.com/2011/04/0_13033087485aw7.gif" alt="" /></p>
<p>&nbsp;</p>
<p><img src="http://bonny95.files.wordpress.com/2011/04/0_13033087538dbq.gif" alt="" /></p>
<p>&nbsp;</p>
<p>groff的groff_www扩展会调用pnmcut，netpbm的工具包中的一个工具。netpbm可以在<a href="http://netpbm.sourceforge.net/">http://netpbm.sourceforge.net/</a>下载并安装。安装成功后，需要把netpbm的路径加入到PATH中，最好是在$HOME/.bashrc中加入。</p>
<p>&nbsp;</p>
<hr />
<p>Update 2011-04-21:</p>
<p>&nbsp;</p>
<p>今天试着用groff写了一个文件，并把它转化为html格式，那是相当的痛苦&mdash;&mdash;对于一个习惯了所见即所得的初学者，groff的学习曲线确实相当的陡峭。</p>
<p>&nbsp;</p>

	</div>
	</div>
    
	<div class="post paper">	
    <h2 class="header"><a href="/2011/04/05/qemu-commands">QEMU常用命令</a></h2>
    <p>
    	<span class="glyphicon glyphicon-time"></span> Posted by <strong>Bo Yang</strong> at <strong>2011-04-05</strong> with tags <span class="glyphicon glyphicon-tag"></span><a href="/tags.html#Unix/Linux-ref" rel="nofollow">Unix/Linux</a>, <span class="glyphicon glyphicon-tag"></span><a href="/tags.html#Virtualization-ref" rel="nofollow">Virtualization</a>, <span class="glyphicon glyphicon-tag"></span><a href="/tags.html#Virtual Machine-ref" rel="nofollow">Virtual Machine</a>
	</p>
	<hr>
    
    <div class="post_at_index thepost">
    	<p>Following are excerpted from <em>Build appliances with QEMU and OpenBSD</em>, <em>BSD Magazine,</em> 2011.04.</p>
<ul>
<li>Boot from an ISO image: &nbsp; &nbsp;<span style="font-family:'courier new', courier;">qemu -cdrom <em>image.iso</em></span></li>
<li>Create new hard disk for a VM: &nbsp; &nbsp;<span style="font-family:'courier new', courier;">qemu-img create <em>disk.bin</em> <em>2G</em></span></li>
<li>Install OS into the virtual disk: &nbsp; &nbsp;<span style="font-family:'courier new', courier;">qemu -hda <em>disk.bin </em>-cdrom <em>image.iso</em></span></li>
<li>Boot VM from virtual disk:<span style="font-family:'courier new', courier;">&nbsp; &nbsp; qemu <em>disk.bin</em></span></li>
<li><span style="font-family:'courier new', courier;">Boot VM with two virtual disks: &nbsp; <em>&nbsp;qemu -hda first.bin -hdb second.bin</em></span></li>
<li><span style="font-family:'courier new', courier;">Start VM in bridge mode network:<em>&nbsp; &nbsp; qemu -net nic -net tap disk.bin</em></span></li>
<li><span style="font-family:'courier new', courier;">Simulate multiple network cards:<em> &nbsp; qemu -net nic,model=lance -net nic,model=pcnet -net nic,model=rt18139 disk.bin</em></span></li>
<li><span style="font-family:mceinline;">QEMU can also be used with remote machines without X in -nographic mode. For this you have to have this in <em>boot.conf</em>(FreeBSD):</span></li>
</ul>
<p><span style="font-family:mceinline;"><em>
<pre># cat /etc/boot.conf
set tty com0</pre>
<p>&nbsp;</em></span></p>
<p><span style="font-family:mceinline;">And start QEMU with command:</span></p>
<ul>
</ul>
<p><em><span style="font-family:mceinline;">qemu -nographic disk.bin&nbsp;</span></em></p>

	</div>
	</div>
    
	
	<!-- Pagination links -->
	
	<ul class="pager">
	    
	    <li class="previous"><a href="/page9">&larr; Older</a></li>
	    
	
	    
	    <li class="next"><a href="/page7">Newer &rarr;</a></li>
	    
	</ul>
	
	<!-- content -->
</div>

<div class="col-lg-4">
		<div class="well">
            <h4>Links</h4>
            <a href="https://www.facebook.com/bo.yang.52493" target="_blank"> <i class="fa fa-facebook-square fa-3x"></i> </a> &nbsp;&nbsp;
			<a href="https://www.linkedin.com/pub/bo-yang/21/a3/893" target="_blank"> <i class="fa fa-linkedin-square fa-3x"></i> </a> &nbsp;&nbsp;
			<a href="https://github.com/bo-yang" target="_blank"> <i class="fa fa-github fa-3x"></i> </a> &nbsp;&nbsp;
			<a href="https://plus.google.com/" target="_blank"> <i class="fa fa-google-plus-square fa-3x"></i> </a> &nbsp;&nbsp;
			<a href="http://www.weibo.com/bonnyang" target="_blank"> <i class="fa fa-weibo fa-3x"></i> </a> &nbsp;&nbsp;
        	<a href="/atom.xml" target="_blank"> <i class="fa fa-rss-square fa-3x"></i> </a>	
        </div>
        <!-- /well -->
        <div class="well">
			<h4>Tags</h4>
			<div class="tag_box">
		    	
				
  
    
        <a href="/tags.html#MFC-ref" class="btn btn-mini">MFC <span class="badge">10</span></a>
    
        <a href="/tags.html#Algorithm-ref" class="btn btn-mini">Algorithm <span class="badge">23</span></a>
    
        <a href="/tags.html#C-ref" class="btn btn-mini">C <span class="badge">16</span></a>
    
        <a href="/tags.html#EMC-ref" class="btn btn-mini">EMC <span class="badge">9</span></a>
    
        <a href="/tags.html#fault diagnosis-ref" class="btn btn-mini">fault diagnosis <span class="badge">2</span></a>
    
        <a href="/tags.html#EMI-ref" class="btn btn-mini">EMI <span class="badge">1</span></a>
    
        <a href="/tags.html#notes-ref" class="btn btn-mini">notes <span class="badge">3</span></a>
    
        <a href="/tags.html#CBR-ref" class="btn btn-mini">CBR <span class="badge">1</span></a>
    
        <a href="/tags.html#AI-ref" class="btn btn-mini">AI <span class="badge">5</span></a>
    
        <a href="/tags.html#Database-ref" class="btn btn-mini">Database <span class="badge">1</span></a>
    
        <a href="/tags.html#Unix-ref" class="btn btn-mini">Unix <span class="badge">1</span></a>
    
        <a href="/tags.html#Linux-ref" class="btn btn-mini">Linux <span class="badge">1</span></a>
    
        <a href="/tags.html#Personal-ref" class="btn btn-mini">Personal <span class="badge">10</span></a>
    
        <a href="/tags.html#Unix/Linux-ref" class="btn btn-mini">Unix/Linux <span class="badge">93</span></a>
    
        <a href="/tags.html#Telecommunication-ref" class="btn btn-mini">Telecommunication <span class="badge">1</span></a>
    
        <a href="/tags.html#Tcl/Tk-ref" class="btn btn-mini">Tcl/Tk <span class="badge">6</span></a>
    
        <a href="/tags.html#Shell-ref" class="btn btn-mini">Shell <span class="badge">12</span></a>
    
        <a href="/tags.html#Network/Telecom-ref" class="btn btn-mini">Network/Telecom <span class="badge">3</span></a>
    
        <a href="/tags.html#Perl-ref" class="btn btn-mini">Perl <span class="badge">15</span></a>
    
        <a href="/tags.html#Essay-ref" class="btn btn-mini">Essay <span class="badge">12</span></a>
    
        <a href="/tags.html#Industry-ref" class="btn btn-mini">Industry <span class="badge">6</span></a>
    
        <a href="/tags.html#Cloud Computing-ref" class="btn btn-mini">Cloud Computing <span class="badge">2</span></a>
    
        <a href="/tags.html#Android-ref" class="btn btn-mini">Android <span class="badge">2</span></a>
    
        <a href="/tags.html#VBA-ref" class="btn btn-mini">VBA <span class="badge">4</span></a>
    
        <a href="/tags.html#ESXi-ref" class="btn btn-mini">ESXi <span class="badge">1</span></a>
    
        <a href="/tags.html#Virtual Machine-ref" class="btn btn-mini">Virtual Machine <span class="badge">2</span></a>
    
        <a href="/tags.html#Browser-ref" class="btn btn-mini">Browser <span class="badge">2</span></a>
    
        <a href="/tags.html#Plan 9-ref" class="btn btn-mini">Plan 9 <span class="badge">9</span></a>
    
        <a href="/tags.html#Go-ref" class="btn btn-mini">Go <span class="badge">3</span></a>
    
        <a href="/tags.html#Virtualization-ref" class="btn btn-mini">Virtualization <span class="badge">2</span></a>
    
        <a href="/tags.html#C/C++-ref" class="btn btn-mini">C/C++ <span class="badge">23</span></a>
    
        <a href="/tags.html#RHEL6.1-ref" class="btn btn-mini">RHEL6.1 <span class="badge">2</span></a>
    
        <a href="/tags.html#Tips-ref" class="btn btn-mini">Tips <span class="badge">5</span></a>
    
        <a href="/tags.html#CPP-ref" class="btn btn-mini">CPP <span class="badge">1</span></a>
    
        <a href="/tags.html#RPC-ref" class="btn btn-mini">RPC <span class="badge">1</span></a>
    
        <a href="/tags.html#rup-ref" class="btn btn-mini">rup <span class="badge">1</span></a>
    
        <a href="/tags.html#ksh-ref" class="btn btn-mini">ksh <span class="badge">1</span></a>
    
        <a href="/tags.html#Ubuntu-ref" class="btn btn-mini">Ubuntu <span class="badge">1</span></a>
    
        <a href="/tags.html#file descriptor-ref" class="btn btn-mini">file descriptor <span class="badge">1</span></a>
    
        <a href="/tags.html#Expect-ref" class="btn btn-mini">Expect <span class="badge">1</span></a>
    
        <a href="/tags.html#Here Document-ref" class="btn btn-mini">Here Document <span class="badge">1</span></a>
    
        <a href="/tags.html#Evolutionary Computation-ref" class="btn btn-mini">Evolutionary Computation <span class="badge">1</span></a>
    
        <a href="/tags.html#Genetic Algorihtm-ref" class="btn btn-mini">Genetic Algorihtm <span class="badge">1</span></a>
    
        <a href="/tags.html#ldd-ref" class="btn btn-mini">ldd <span class="badge">1</span></a>
    
        <a href="/tags.html#signal-ref" class="btn btn-mini">signal <span class="badge">1</span></a>
    
        <a href="/tags.html#swap-ref" class="btn btn-mini">swap <span class="badge">1</span></a>
    
        <a href="/tags.html#NIC-ref" class="btn btn-mini">NIC <span class="badge">1</span></a>
    
        <a href="/tags.html#Mac OS-ref" class="btn btn-mini">Mac OS <span class="badge">1</span></a>
    
        <a href="/tags.html#VNC-ref" class="btn btn-mini">VNC <span class="badge">1</span></a>
    
        <a href="/tags.html#X11-ref" class="btn btn-mini">X11 <span class="badge">1</span></a>
    
        <a href="/tags.html#Merge sort-ref" class="btn btn-mini">Merge sort <span class="badge">1</span></a>
    
        <a href="/tags.html#boost-ref" class="btn btn-mini">boost <span class="badge">1</span></a>
    
        <a href="/tags.html#CDF-ref" class="btn btn-mini">CDF <span class="badge">1</span></a>
    
        <a href="/tags.html#Matlab-ref" class="btn btn-mini">Matlab <span class="badge">3</span></a>
    
        <a href="/tags.html#Multi-Process-ref" class="btn btn-mini">Multi-Process <span class="badge">1</span></a>
    
        <a href="/tags.html#Multi-Threading-ref" class="btn btn-mini">Multi-Threading <span class="badge">1</span></a>
    
        <a href="/tags.html#Bioinformatics-ref" class="btn btn-mini">Bioinformatics <span class="badge">1</span></a>
    
        <a href="/tags.html#Computer Vision-ref" class="btn btn-mini">Computer Vision <span class="badge">4</span></a>
    
        <a href="/tags.html#DTF-ref" class="btn btn-mini">DTF <span class="badge">2</span></a>
    
        <a href="/tags.html#ffmpeg-ref" class="btn btn-mini">ffmpeg <span class="badge">1</span></a>
    
        <a href="/tags.html#OpenCV-ref" class="btn btn-mini">OpenCV <span class="badge">1</span></a>
    
        <a href="/tags.html#Machine Learning-ref" class="btn btn-mini">Machine Learning <span class="badge">2</span></a>
    
        <a href="/tags.html#parfor-ref" class="btn btn-mini">parfor <span class="badge">1</span></a>
    
        <a href="/tags.html#BACI-ref" class="btn btn-mini">BACI <span class="badge">1</span></a>
    
        <a href="/tags.html#Alogrithm-ref" class="btn btn-mini">Alogrithm <span class="badge">1</span></a>
    
        <a href="/tags.html#Jekyll-ref" class="btn btn-mini">Jekyll <span class="badge">1</span></a>
    
        <a href="/tags.html#Github-ref" class="btn btn-mini">Github <span class="badge">1</span></a>
    
        <a href="/tags.html#Architecture-ref" class="btn btn-mini">Architecture <span class="badge">1</span></a>
    
        <a href="/tags.html#Cache-ref" class="btn btn-mini">Cache <span class="badge">1</span></a>
    
        <a href="/tags.html#Fisher Vector-ref" class="btn btn-mini">Fisher Vector <span class="badge">1</span></a>
    
        <a href="/tags.html#SVM-ref" class="btn btn-mini">SVM <span class="badge">1</span></a>
    
        <a href="/tags.html#Java-ref" class="btn btn-mini">Java <span class="badge">1</span></a>
    
        <a href="/tags.html#Dynamic Programming-ref" class="btn btn-mini">Dynamic Programming <span class="badge">1</span></a>
    
        <a href="/tags.html#Distributed Systems-ref" class="btn btn-mini">Distributed Systems <span class="badge">1</span></a>
    
        <a href="/tags.html#Network-ref" class="btn btn-mini">Network <span class="badge">1</span></a>
    
  



			</div>
		</div>
		<!-- /well -->
        <div class="well">
			<h4>Visitors</h4>
			<div class="tag_box">
				<script type="text/javascript" src="http://je.revolvermaps.com/2/1.js?i=4nm24yds2ph&amp;s=300&amp;m=0&amp;v=true&amp;r=false&amp;b=000000&amp;n=false&amp;c=ff0000" async="async"></script>
	
			</div>
        </div>
        <!-- /well -->
        <div class="well">
            <h3>Recent Posts</h3>
	        <ul>
			
  			<li><span>2014-07-14</span> &raquo; <a href="/2014/07/14/insertion-sort-list">Insertion Sort List</a></li>
			
  			<li><span>2014-07-13</span> &raquo; <a href="/2014/07/13/linked-list-cycle">Linked List Cycle Problems</a></li>
			
  			<li><span>2014-07-08</span> &raquo; <a href="/2014/07/08/sort-list">Sort List</a></li>
			
  			<li><span>2014-07-07</span> &raquo; <a href="/2014/07/07/subset-sum">Subset Sum Problem</a></li>
			
  			<li><span>2014-07-07</span> &raquo; <a href="/2014/07/07/determine-top-common-ip-addresses">Find Top Source IP Addresses in Distributed Systems</a></li>
			
  			<li><span>2014-07-06</span> &raquo; <a href="/2014/07/06/longest-palindromic-substring">Longest Palindromic Substring</a></li>
			
  			<li><span>2014-07-01</span> &raquo; <a href="/2014/07/01/strstr">The First Occurrence of Needle In Haystack</a></li>
			
  			<li><span>2014-07-01</span> &raquo; <a href="/2014/07/01/longest-consecutive-sequence">Longest Consecutive Sequence</a></li>
			
  			<li><span>2014-06-29</span> &raquo; <a href="/2014/06/29/top-n-numbers">Top N Numbers</a></li>
			
  			<li><span>2014-06-27</span> &raquo; <a href="/2014/06/27/nqueens">N-Queens Problem</a></li>
			
			</ul>
        </div>
        <!-- /well -->
</div>

	</div>
</div>


    </div>

    <footer>
        <p>&copy; 2007 <span id="now_year"></span> Bo Yang. </p>
        <script type="text/javascript">
          var now_year = new Date().getFullYear();
          if (now_year != 2007) {
              $('#now_year').html('- ' + now_year);
          }
	    </script>
      </footer>
  </div>

  <script type="text/javascript" src="/assets/google-code-prettify/prettify.js"></script>
  <script src="/assets/run_prettify.js"></script>
  <script type="text/javascript">
    $(function() {

      $('a[href^="http"]').each(function () {
        $(this).attr('target', '_blank');
      });

      $('pre').addClass('prettyprint linenums').attr('style', 'overflow:auto');
      window.prettyPrint && prettyPrint();

      function traverse($node, len, maxCount) {
        var reachMaxCount = len > maxCount;
        if (reachMaxCount) {
          $node.hide();
        }
        var $contents = $node.contents();
        for (var i = 0; i < $contents.length; ++i) {
          if (reachMaxCount) {
            $contents.eq(i).hide();
            continue;
          }
          if ($contents[i].nodeType == 3) { // TextNode
            var tmp = len;
            var s = $contents[i].nodeValue;
            len += s.length;
            reachMaxCount = len > maxCount;
            if (reachMaxCount && $contents[i].parentNode.nodeName != 'A') {
              $contents[i].nodeValue = s.substring(0, maxCount - tmp);
            }
          }
          else if ($contents[i].nodeType == 1) { // Element
            len = traverse($contents.eq(i), len, maxCount);
          }
        }
        return len;
      }

      $('.post_at_index').each(function() {
        var count = traverse($(this), 0, 400);
        if (count > 400) {
          var thisUrl = $(this).siblings().first().children().attr('href');
          $(this).after('\n<a href="' + thisUrl + '" rel="nofollow" class="btn btn-primary" role="button">' + 'Read More &raquo;</a>');
        }
      });
    });
  </script>

  

</body>
</html>

