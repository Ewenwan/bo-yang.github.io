<!DOCTYPE html>
<html lang="en">
<head>
  <title>John Duff - Home </title>
  <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
  <meta name="verify-v1" content="fI45uNHehVNiO9Dt0Fp7XnsV0Z/ozBTkPoS6RlYAe50=" />
  <meta name="y_key" content="6c948e75a617b12d" />
  <meta name='technorati-claim' content='8QN7CWNH8BSJ' />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" media="screen" href="/css/bootstrap.css">
  <link rel="stylesheet" type="text/css" href="/css/default.css" />
  <link rel="stylesheet" type="text/css" href="/css/syntax.css" />
  <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="John Duff's blog" />
</head>

<body class='blog'>
  <div class="container">
    <div class="row">
      <div class="span4 sidebar affix">
        <div class="well">
          <h2 class='site-title'>
            <a href="http://bo-yang.github.io">Bo Yang</a>
          </h2>

		  <p><i>You got to make the back of the fence that nobody will see just as good looking as the front of the fence.</i></p>

          <ul id="navigation" class="clearfix">
            <li class='about'><a href='/about/'>About</a></li>
            <li class='archives'><a href='/archives/'>Archives</a></li>
            <li class="github"><a href="http://github.com/bo-yang" rel='me' class='url'>@github</a></li>
          </ul>
        </div>
      </div>
      <div class="span8 main offset4">
        <div class="well">
          <div id='index'>

  <div class="post">
    <h2><a href="/bkup/2012/06/14/sock_raw-issue-with-setuidchroot-ed-login-on-linux-serversstill-unresolved/">SOCK_RAW Issue with setuid&chroot-ed login on Linux Servers(Still Unresolved)</a></h2>

    <p>Problem:</p>
<blockquote><p>when using function socket(AF_INET,<strong>SOCK_RAW</strong>,IPPROTO_TCP...) with setuid&amp;chroot-ed fake root on Linux servers, it would always fail. However, the real root can work well. Usually the fake root can do most things that root login required.
</p></blockquote>
<p>After investigation, got following hints:</p>
<ul>
<li>According to man page of <a href="http://linux.die.net/man/7/raw">SOCK_RAW(7)</a>, &quot;Only processes with an effective user ID of 0 or the CAP_NET_RAW capability are allowed to open raw sockets&quot;.</li>
<li>According to <a href="http://www.kernel.org/doc/man-pages/online/pages/man7/capabilities.7.html">capabilities(7) - Linux man page</a>, &quot;For the purpose of performing permission checks, traditional UNIX implementations distinguish two categories of processes: privileged processes (whose effective user ID is 0, referred to as superuser or root), and unprivileged processes (whose effective UID is nonzero). Privileged processes bypass all kernel permission checks, while unprivileged processes are subject to full permission checking based on the process's credentials (usually: effective UID, effective GID, and supplementary group list)&quot;.</li>
</ul>
<blockquote><p>Starting with kernel 2.2, Linux divides the privileges traditionally associated with superuser into distinct units, known as capabilities, which can be independently enabled and disabled. Capabilities are a per-thread attribute.
</p></blockquote>
<blockquote><p>CAP_NET_RAW
</p></blockquote>
<blockquote><blockquote> Use RAW and PACKET sockets.</p>
</blockquote>
</blockquote>
<ul>
<li>In raw socket access as normal user on linux 2.4, setuid is suggested, but it didn’t work.</li>
</ul>
<p>Since we can't provide root login to all users, we must either find a way to let raw sockets work with setuid&amp;chroot-ed login, or substitute raw sockets with other options.</p>


    <small class="meta">June 14, 2012 | <a href='/bkup/2012/06/14/sock_raw-issue-with-setuidchroot-ed-login-on-linux-serversstill-unresolved/#disqus_thread'>View Comments</a></small>
  </div>

  <div class="post">
    <h2><a href="/2012/06/14/sock_raw-issue-with-setuidchroot-ed-login-on-linux-serversstill-unresolved/">SOCK_RAW Issue with setuid&chroot-ed login on Linux Servers(Still Unresolved)</a></h2>

    <p>Problem:</p>
<blockquote><p>when using function socket(AF_INET,<strong>SOCK_RAW</strong>,IPPROTO_TCP...) with setuid&amp;chroot-ed fake root on Linux servers, it would always fail. However, the real root can work well. Usually the fake root can do most things that root login required.
</p></blockquote>
<p>After investigation, got following hints:</p>
<ul>
<li>According to man page of <a href="http://linux.die.net/man/7/raw">SOCK_RAW(7)</a>, &quot;Only processes with an effective user ID of 0 or the CAP_NET_RAW capability are allowed to open raw sockets&quot;.</li>
<li>According to <a href="http://www.kernel.org/doc/man-pages/online/pages/man7/capabilities.7.html">capabilities(7) - Linux man page</a>, &quot;For the purpose of performing permission checks, traditional UNIX implementations distinguish two categories of processes: privileged processes (whose effective user ID is 0, referred to as superuser or root), and unprivileged processes (whose effective UID is nonzero). Privileged processes bypass all kernel permission checks, while unprivileged processes are subject to full permission checking based on the process's credentials (usually: effective UID, effective GID, and supplementary group list)&quot;.</li>
</ul>
<blockquote><p>Starting with kernel 2.2, Linux divides the privileges traditionally associated with superuser into distinct units, known as capabilities, which can be independently enabled and disabled. Capabilities are a per-thread attribute.
</p></blockquote>
<blockquote><p>CAP_NET_RAW
</p></blockquote>
<blockquote><blockquote> Use RAW and PACKET sockets.</p>
</blockquote>
</blockquote>
<ul>
<li>In raw socket access as normal user on linux 2.4, setuid is suggested, but it didn’t work.</li>
</ul>
<p>Since we can't provide root login to all users, we must either find a way to let raw sockets work with setuid&amp;chroot-ed login, or substitute raw sockets with other options.</p>


    <small class="meta">June 14, 2012 | <a href='/2012/06/14/sock_raw-issue-with-setuidchroot-ed-login-on-linux-serversstill-unresolved/#disqus_thread'>View Comments</a></small>
  </div>

  <div class="post">
    <h2><a href="/unix/linux/2012/06/04/today-some-guy/">Error "ldd:  execution failed due to signal 9"</a></h2>

    <p>Today, one of my folks met a very weird problem and finally he asked me for help. The issue was, when running command "ldd CDNap" on a Solaris 9 server(AP11), following error would show up:</p>
<p><code>AP11: ldd CDNap<br />
ldd: CDNap: execution failed due to signal 9</code></p>
<p>However, when running this command on another Solaris 9 server(ap15), it worked well.</p>
<p>According to <a href="https://forums.oracle.com/forums/thread.jspa?threadID=1919581">Weird exec failure</a>, "<strong>My bet is that the program has a rather large BSS segment, and there isn't enough swap to reserve the space. (ldd(1) works by setting up some environment variables, then running the program itself, which is why it would fail)</strong>". To verify this, you can run</p>
<pre>/usr/ccs/bin/size /path/to/program</pre>
<p>To check the free space of swap, you can</p>
<pre>swap -s</pre>
<p>After comparing the swap space and memory of the two Solaris servers, I noticed that the server(AP11) bearing this issue has smaller memory(1GB) and swap space(only 75008k available).</p>
<pre>AP11: swap -l
swapfile             dev  swaplo blocks   free
/dev/dsk/c0t2d0s1   136,1      16 4198304 4198304
AP11: swap -s
total: 513384k bytes allocated + 2296288k reserved = 2809672k used, 75008k available
AP11: uname -a
SunOS coolap22n 5.9 Generic_122300-61 sun4u sparc SUNW,UltraAX-i2
AP11: prtconf|grep Memory
Memory size: 1024 Megabytes</pre>
<p>Server(ap15) without ldd issue has 2GB memory and larger swap(4966160k available).</p>
<pre>ap15:root &gt; swap -s
total: 372136k bytes allocated + 522864k reserved = 895000k used, 4966160k available
ap15:root &gt; df -k swap
Filesystem            kbytes    used   avail capacity  Mounted on
swap                 1793064960 1589658648 203406312    89%    /tmp
ap15:root &gt; swap -l
swapfile             dev  swaplo blocks   free
/dev/dsk/c0t2d0s1   136,1      16 8392544 8392544
ap15:root &gt; uname -a
SunOS coolap10n 5.9 Generic_122300-61 sun4u sparc SUNW,UltraAX-i2</pre>
<p>It seems it's time for such old Solaris servers to retire.</p>


    <small class="meta">June 04, 2012 | <a href='/unix/linux/2012/06/04/today-some-guy/#disqus_thread'>View Comments</a></small>
  </div>

  <div class="post">
    <h2><a href="/bkup/2012/06/04/today-some-guy/">Error "ldd:  execution failed due to signal 9"</a></h2>

    <p>Today, one of my folks met a very weird problem and finally he asked me for help. The issue was, when running command "ldd CDNap" on a Solaris 9 server(AP11), following error would show up:</p>
<p><code>AP11: ldd CDNap<br />
ldd: CDNap: execution failed due to signal 9</code></p>
<p>However, when running this command on another Solaris 9 server(ap15), it worked well.</p>
<p>According to <a href="https://forums.oracle.com/forums/thread.jspa?threadID=1919581">Weird exec failure</a>, "<strong>My bet is that the program has a rather large BSS segment, and there isn't enough swap to reserve the space. (ldd(1) works by setting up some environment variables, then running the program itself, which is why it would fail)</strong>". To verify this, you can run</p>
<pre>/usr/ccs/bin/size /path/to/program</pre>
<p>To check the free space of swap, you can</p>
<pre>swap -s</pre>
<p>After comparing the swap space and memory of the two Solaris servers, I noticed that the server(AP11) bearing this issue has smaller memory(1GB) and swap space(only 75008k available).</p>
<pre>AP11: swap -l
swapfile             dev  swaplo blocks   free
/dev/dsk/c0t2d0s1   136,1      16 4198304 4198304
AP11: swap -s
total: 513384k bytes allocated + 2296288k reserved = 2809672k used, 75008k available
AP11: uname -a
SunOS coolap22n 5.9 Generic_122300-61 sun4u sparc SUNW,UltraAX-i2
AP11: prtconf|grep Memory
Memory size: 1024 Megabytes</pre>
<p>Server(ap15) without ldd issue has 2GB memory and larger swap(4966160k available).</p>
<pre>ap15:root &gt; swap -s
total: 372136k bytes allocated + 522864k reserved = 895000k used, 4966160k available
ap15:root &gt; df -k swap
Filesystem            kbytes    used   avail capacity  Mounted on
swap                 1793064960 1589658648 203406312    89%    /tmp
ap15:root &gt; swap -l
swapfile             dev  swaplo blocks   free
/dev/dsk/c0t2d0s1   136,1      16 8392544 8392544
ap15:root &gt; uname -a
SunOS coolap10n 5.9 Generic_122300-61 sun4u sparc SUNW,UltraAX-i2</pre>
<p>It seems it's time for such old Solaris servers to retire.</p>


    <small class="meta">June 04, 2012 | <a href='/bkup/2012/06/04/today-some-guy/#disqus_thread'>View Comments</a></small>
  </div>

  <div class="post">
    <h2><a href="/c/c++/evolutionary%20computation/2012/05/04/%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520string%2520evolver%252c%2520my%2520first%2520genetic%2520algorithm%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520/">String Evolver, My First Genetic Algorithm</a></h2>

    <p>When reading <em>Evolutionary Computation for Modeling and Optimization[1]</em>, I found following problem in section 1.2.3:</p>
<p><strong><em>A string evolver is an evolutionary algorithm that tries to match a reference string from a population of random strings. The underlying character set of the string evolver is the alphabet from which the strings are drawn.</em></strong></p>
<p>The solution given in the context is:</p>
<ol>
<li>Start with a reference string and a population of random strings.</li>
<li>The fitness of a string is the number of positions in which it has the same character as the reference string.</li>
<li>To evolve the population, split it into small random groups called&nbsp;tournaments.</li>
<li>Copy the most fit string(break ties by picking at random among the most fit strings) over the least fit string in each tournament.</li>
<li>Then change one randomly chosen character in each copy(mutation).</li>
<li>Repeat until an exact match with the reference string is obtained.</li>
</ol>
<p>When trying this solution, I noticed that it won't converge even after a long time. Therefore, I modified the crossover and mutation strategy.<strong>A subset of population(strings) will be selected based on fitness in a tournament, and the bottom-ranked<br />
 50% of each tournament will be deleted. New population is formed by crossing the remaining high 20 individuals in a tournament, while the high-ranked parents are kept unchanged[2]. Finally, a random selected string in a tournament will be mutated.</strong></p>
<p>
My codes are:</p></p>
<pre>#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;

#define POP 20 
#define TNMT 4	    // Total number of tournaments
#define MAXSTR 80
char strPop[POP][MAXSTR]; // population of strings
char* REF=&quot;Hello,world!&quot;; // Reference string
char* mostFit[TNMT]; 	  // the most fit string of each tournament
char* leastFit[TNMT]; 	// the least fit string of each 

tournament

char GenRandChar()
{
	return (char)(32+rand()%96);
}

char * GenRandStr(char* str, unsigned int len)
{
	int i;
	for(i=0;i&lt;len-1;++i)
	{
		str[i]=GenRandChar();
	}
	str[i]='';
	return str;
}

// Copy the most fit string(break ties by picking at 
// random among the most fit strings) over the least 
// fit string in each tournament.
unsigned int CrossoverM2L(char* strMostFit, char* strLeastFit, unsigned int len)
{
	int i,p;
	char tmp;

	// Generate random position. Make sure the string
	// won't be broken at the first or last character.
	p=rand()%(len-2)+1;
	for(i=0;i&lt;p;++i)
	{
		tmp=strMostFit[i];
		strMostFit[i]=strLeastFit[i];
		strLeastFit[i]=tmp;
	}
	return p;
}

// Change one randomly chosen character in each copy.
unsigned int Mutate(char* str,unsigned int len)
{
	int p;

	p=rand()%len;
	str[p]=GenRandChar();
	return p;
}

// Count the number of identical chars between ref and str.
unsigned int GetFitness(char* str,unsigned int len)
{
	int i;
	int cnt=0;
	for(i=0;i&lt;len;++i)
	{
		if(REF[i]==str[i])
			cnt++;
	}
	
	return cnt;
}

// Find out the most and least fit strings in a tournament.
// 	tourn -- the number of tourn, starting from 0.
void GetFitOfTnmt(char* mostFit[],char* leastFit[],unsigned int tourn)
{
	int i,fit;
	char* str;
	int most_fit,least_fit;

	// Make sure the most and least fit strings are different
	mostFit[tourn]=strPop[tourn*POP/TNMT];
	most_fit=GetFitness(mostFit[tourn],strlen(REF));
	leastFit[tourn]=strPop[tourn*POP/TNMT+1];
	least_fit=GetFitness(leastFit[tourn],strlen(REF));
	for(i=1;i&lt;POP/TNMT;++i)
	{
		str=strPop[tourn*POP/TNMT+i];
		fit=GetFitness(str,strlen(REF));
		if(most_fitfit)
		{
			least_fit=fit;
			leastFit[tourn]=str;
		}
	}
}

// Get the most fit string of the population
char* GetMostFit(char* mostFit[])
{
	int i,fit;
	char* strFit=mostFit[0];
	int most_fit=GetFitness(strFit,strlen(REF));
	for(i=1;i&lt;TNMT;++i)
	{
		fit=GetFitness(mostFit[i],strlen(REF));
		if(most_fit&lt;fit)
		{
			most_fit=fit;
			strFit=mostFit[i];
		}
	}
	
	return strFit;
}

// Sort the strings in a tournament by fitness.
void SortTournByFit(unsigned int tourn)
{
	int tmpInt;
	unsigned int fit[POP/TNMT];
	int i,j;
	int len=strlen(REF);
	char tmpStr[MAXSTR];

	// Get the fitness of each string in this tournament
	for(i=0;i&lt;POP/TNMT;i++)
	{
		fit[i]=GetFitness(strPop[tourn*POP/TNMT+i],len);
	}

	// Sort strings by fitness
	for(i=0;i&lt;POP/TNMT;i++)
	{
		for(j=i+1;j&lt;POP/TNMT;j++)
		{
			if(fit[i]&lt;fit[j])
			{
				tmpInt=fit[i];
				fit[i]=fit[j];
				fit[j]=tmpInt;

				strcpy(tmpStr,strPop[tourn*POP/TNMT+i]);
				strcpy(strPop[tourn*POP/TNMT+i],strPop[tourn*POP/TNMT+j]);
				strcpy(strPop[tourn*POP/TNMT+j],tmpStr);
			}
		} // end of for j
	} // end of for i
}

// Crossover the top half strings.
// Remove the second half strings after sorting, keep the top half, 
// and generate children by crossing over top half strings.
void CrossoverByFit(unsigned int tourn)
{
	int i,j,p,len;
	char* strTmp;

	SortTournByFit(tourn);

	// Generate random position. Make sure the string
	// won't be broken at the first or last character.
	len=strlen(REF);
	p=rand()%(len-2)+1;
	
	for(i=0;i&lt;(int)POP/TNMT/2;i+=2)
	{
		for(j=0;j
p;--j)
		{
			strPop[(tourn+1)*POP/TNMT-1-i][j]=strPop[tourn*POP/TNMT+i+1][j];
			strPop[(tourn+1)*POP/TNMT-2-i][j]=strPop[tourn*POP/TNMT+i][j];
		}
	}
}


// Print population by tournaments.
void DumpPop()
{
	int i,j;
	char* curStr;
	for(i=0;i&lt;TNMT;i++)
	{
		printf(&quot;Tournament %d:n&quot;,i);
		for(j=0;j&lt;POP/TNMT;j++)
		{
			curStr=strPop[i*POP/TNMT+j];
			printf(&quot;t%stFitness: %dn&quot;,curStr,GetFitness(curStr,strlen(curStr)));
		}
		printf(&quot;n&quot;);
	}
}

//
// MAIN START HERE
//
int main()
{
	int LEN=strlen(REF);

	int i,j,p;
	long cnt=0;
	char * strFit=NULL;
	
	// Initionlization
	for(i=0;i&lt;POP;++i)
	{
		GenRandStr(strPop[i],LEN);
	}
	
	printf(&quot;---------------- Original Population ---------------n&quot;);
	DumpPop();
	
	for(i=0;i&lt;TNMT;++i)
		GetFitOfTnmt(mostFit,leastFit,i);
		
	strFit=GetMostFit(mostFit);
	while(GetFitness(strFit,LEN) != LEN)
	//while(GetFitness(strFit,LEN)&lt;5)
	{
		printf(&quot;n---------------- Generation %d ----------------n&quot;,cnt);
		DumpPop();

		printf(&quot;%stReferencen&quot;,REF);
		printf(&quot;%stGen: %dtFitness: %dn&quot;,strFit,cnt++,GetFitness(strFit,LEN));
		for(i=0;i&lt;TNMT;++i)
		{
			// Crossover
			//CrossoverM2L(mostFit[i],leastFit[i],LEN);
			CrossoverByFit(i);
			
			// Mutation
			p=rand()%(POP/TNMT);
			Mutate(strPop[i*POP/TNMT+p],LEN);

			// Re-calculate the fitness
			GetFitOfTnmt(mostFit,leastFit,i);
		}
		strFit=GetMostFit(mostFit);
	}

	strFit=GetMostFit(mostFit);
	printf(&quot;n---------------- Generation %d ----------------n&quot;,cnt);
	DumpPop();
	printf(&quot;%stReferencen&quot;,REF);
	printf(&quot;%stGen: %dtFitness: %dn&quot;,strFit,cnt++,GetFitness(strFit,LEN));

	return 0;
}</pre>
<p>
<span style="font-family:monospace;"><span style="white-space:pre;">And the output is:</span></span></p>
<pre>---------------- Generation 0 ----------------
Tournament 0:
	F~AKK[b;tV]	Fitness: 0
	\agA_q&gt;vr	Fitness: 0
	OGG&amp;Gy*(|yj	Fitness: 0
	6s[rEA8|45/	Fitness: 0
	W.e[:bYXlCz	Fitness: 0

Tournament 1:
	6n?y9o??VN#	Fitness: 0
	8mmZ~f:Dfn&lt;	Fitness: 0
	i-nV!P`{oQ	Fitness: 0
	8%p%)3-j;(	Fitness: 0
	92S2}&amp;jU&quot;f	Fitness: 0

Tournament 2:
	38IrA~lrHq|	Fitness: 0
	RF51Vo7V9]v	Fitness: 0
	Z(tUX&lt;w|!{m	Fitness: 1
	qNoPy'a;OS]	Fitness: 0
	1`]em-+SM~~	Fitness: 0

Tournament 3:
	o^f(T&amp;zQC3Q	Fitness: 0
	($g[j@ Asi	Fitness: 0
	@gb#E`!QGUb	Fitness: 0
	%H/&gt;N)Kt_Pm	Fitness: 0
	i&gt;Z+F0@6/'L	Fitness: 0

Hello,world!	Reference
Z(tUX&lt;w|!{m	Gen: 0	Fitness: 1

---------------- Generation 1 ----------------
Tournament 0:
	F~AKK[b;tVx	Fitness: 0
	\agA_q&gt;vr	Fitness: 0
	OGG&amp;Gy*(|yj	Fitness: 0
	\agA_q&gt;5]	Fitness: 0
	F~AKK[b;tCr	Fitness: 0

Tournament 1:
	6n?y9o??VN#	Fitness: 0
	kmmZ~f:Dfn&lt;	Fitness: 0
	i-nV!P`{oQ	Fitness: 0
	8mm%9o??VN#	Fitness: 0
	6n?2~f:Dfn&lt;	Fitness: 0

Tournament 2:
	Z(tUX&lt;w|!{m	Fitness: 1
	RF51Vo7V9]v	Fitness: 0
	38IrA~lrHq|	Fitness: 0
	RFoUX&lt;w|r{m	Fitness: 2
	Z(]1Vo7V9]v	Fitness: 0

Tournament 3:
	o^f(T&amp;zQC3Q	Fitness: 0
	($g[j@ Asi	Fitness: 0
	@gb#E`!QGUb	Fitness: 0
	($/(T&amp;zQC3Q	Fitness: 0
	@^Z[j@ Asi	Fitness: 0

Hello,world!	Reference
RFoUX&lt;w|r{m	Gen: 1	Fitness: 2

---------------- Generation 2 ----------------
Tournament 0:
	F~AKK[b;tVx	Fitness: 0
	\agA_q&gt;vr	Fitness: 0
	OGG&amp;Gy*(|yj	Fitness: 0
	\agA_q&gt;v]	Fitness: 0
	F~AeK[b;tVr	Fitness: 0

Tournament 1:
	Pn?y9o??VN#	Fitness: 0
	kmmZ~f:Dfn&lt;	Fitness: 0
	i-nV!P`{oQ	Fitness: 0
	kmmZ~f??VN#	Fitness: 0
	6n?y9o:Dfn&lt;	Fitness: 0

Tournament 2:
	RFoDX&lt;w|r{m	Fitness: 2
	Z(tUX&lt;w|!{m	Fitness: 1
	38IrA~lrHq|	Fitness: 0
	Z(t1X&lt;w|r{m	Fitness: 2
	RFo1X&lt;w|!{m	Fitness: 1

Tournament 3:
	o^f(T&amp;zQC3Q|	Fitness: 0
	($g[j@ Asi	Fitness: 0
	@gb#E`!QGUb	Fitness: 0
	($f(T&amp;zQC3Q	Fitness: 0
	o^g[j@ Asi	Fitness: 0

Hello,world!	Reference
RFoDX&lt;w|r{m	Gen: 2	Fitness: 2

---------------- Generation 3 ----------------
Tournament 0:
	F~AKK[b;tVx	Fitness: 0
	\agA_q&gt;vr	Fitness: 0
	OGG&amp;Gy*(|yj	Fitness: 0
	\KK[b;tVx	Fitness: 0
	F~Aag~_q&gt;vr	Fitness: 0

Tournament 1:
	Pn?y9o??VN#	Fitness: 0
	kmmZ~f:Dfn&lt;@	Fitness: 0
	i-nV!P`{oQ	Fitness: 0
	km?y9o??VN#	Fitness: 0
	PnmZ~f:Dfn&lt;	Fitness: 0

Tournament 2:
	RFoDX&lt;w|r{m	Fitness: 2
	Z(t1X&lt;w|r{m	Fitness: 2
	Z(tUX~w|!{m	Fitness: 1
	Z(oDX&lt;w|r{m	Fitness: 2
	RFI1X&lt;w|r{m	Fitness: 2

Tournament 3:
	o^f(T&amp;zQC3Q|	Fitness: 0
	($g[j@ Asi	Fitness: 0
	@gb#E`!QGUb	Fitness: 0
	($g[W@ QC3Q|	Fitness: 0
	o^f(T&amp;zAsi	Fitness: 0

Hello,world!	Reference
RFoDX&lt;w|r{m	Gen: 3	Fitness: 2

---------------- Generation 4 ----------------
Tournament 0:
	F~AKK[b;tVx	Fitness: 0
	\JgA_q&gt;vr	Fitness: 0
	OGG&amp;Gy*(|yj	Fitness: 0
	\KK[b;tVx	Fitness: 0
	F~AagA_q&gt;vr	Fitness: 0

Tournament 1:
	Pn?y9o??VN#	Fitness: 0
	kmmZ~f:Dfn&lt;@	Fitness: 0
	i-nV!P`{oQ	Fitness: 0
	kmmZ~o??VN#	Fitness: 0
	Pnsy9f:Dfn&lt;@	Fitness: 0

Tournament 2:
	RFoDX&lt;w|r{m	Fitness: 2
	Z(t1X&lt;w|r{m	Fitness: 2
	Z(oDXFw|r{m	Fitness: 2
	Z(t1X&lt;w|r{m	Fitness: 2
	RFoDX&lt;w|r{m	Fitness: 2

Tournament 3:
	o^f(T'zQC3Q|	Fitness: 0
	($g[j@ Asi	Fitness: 0
	@gb#E`!QGUb	Fitness: 0
	($g[j@ AsQ|	Fitness: 0
	o^f(T&amp;zQC3i	Fitness: 0

Hello,world!	Reference
RFoDX&lt;w|r{m	Gen: 4	Fitness: 2

      ......
      ......

---------------- Generation 2342 ----------------
Tournament 0:
	Hpllk,world!	Fitness: 10
	Hpllo,world!	Fitness: 11
	Hpllo,world!	Fitness: 11
	Hpllo,world!	Fitness: 11
	Hpllo,world!	Fitness: 11

Tournament 1:
	Hello,worlF!	Fitness: 11
	Hello,worlf!	Fitness: 11
	Hello,worlf!	Fitness: 11
	Hello,worlf!	Fitness: 11
	Hello,worlf!	Fitness: 11

Tournament 2:
	Hello,worldh	Fitness: 11
	Hello,worldJ	Fitness: 11
	Hello,worldh	Fitness: 11
	Hello,worldh	Fitness: 11
	Hello,worVdJ	Fitness: 10

Tournament 3:
	He:lo,w4rld!	Fitness: 10
	He:lo,w0rld!	Fitness: 10
	He:lo,w4rld!	Fitness: 10
	He:lo,w0rld!	Fitness: 10
	He:2o,w4rld!	Fitness: 9

Hello,world!	Reference
Hpllo,world!	Gen: 2342	Fitness: 11

---------------- Generation 2343 ----------------
Tournament 0:
	Hp|lo,world!	Fitness: 10
	Hpllo,world!	Fitness: 11
	Hpllo,world!	Fitness: 11
	Hpllo,world!	Fitness: 11
	Hpllo,world!	Fitness: 11

Tournament 1:
	Hello,worlF!	Fitness: 11
	Hello,wo&amp;lf!	Fitness: 10
	Hello,worlf!	Fitness: 11
	Hello,worlF!	Fitness: 11
	Hello,worlf!	Fitness: 11

Tournament 2:
	Hello,worldh	Fitness: 11
	Hello,worldJ	Fitness: 11
	Hello,worldh	Fitness: 11
	Hello,wor&amp;dh	Fitness: 10
	Hello,worldJ	Fitness: 11

Tournament 3:
	He:lo,w4rld!	Fitness: 10
	He:lo,w0rld!	Fitness: 10
	He:lo,w4rld!	Fitness: 10
	He:lo,w0rld!	Fitness: 10
	He:lozw4rld!	Fitness: 9

Hello,world!	Reference
Hpllo,world!	Gen: 2343	Fitness: 11

---------------- Generation 2344 ----------------
Tournament 0:
	Hpllo,world!	Fitness: 11
	Hpllo,world!	Fitness: 11
	Hllo,world!	Fitness: 11
	Hpllo,world!	Fitness: 11
	Hpllo,world!	Fitness: 11

Tournament 1:
	Hello,worlF!	Fitness: 11
	Hello,worlf!	Fitness: 11
	Hello,world!	Fitness: 12
	Hello,worlF!	Fitness: 11
	Hello,wo&amp;lf!	Fitness: 10

Tournament 2:
	Hello,world 	Fitness: 11
	Hello,worldJ	Fitness: 11
	Hello,worldh	Fitness: 11
	Hello,worldh	Fitness: 11
	Hello,worldJ	Fitness: 11

Tournament 3:
	He:lo,w44ld!	Fitness: 9
	He:lo,w0rld!	Fitness: 10
	He:lo,w4rld!	Fitness: 10
	He:lo,w0rld!	Fitness: 10
	He:lo,w4rld!	Fitness: 10

Hello,world!	Reference
Hello,world!	Gen: 2344	Fitness: 12
</pre>
<p></p>
<p>-----------------------------------------------------------------</p>
<p><em>References:</em></p>
<p>[1]: Daniel Ashlock, <em>Evolutionary Computation for Modeling and Optimization</em>, Springer, 2005.</p>
<p>[2]: FORREST, S., WEIMER, W., NGUYEN, T., AND GOUES, C. L., <em>A Genetic Programming Approach to Automated Software Repair</em>, In GECCO (July 2009).</p>


    <small class="meta">May 04, 2012 | <a href='/c/c++/evolutionary%20computation/2012/05/04/%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520string%2520evolver%252c%2520my%2520first%2520genetic%2520algorithm%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520/#disqus_thread'>View Comments</a></small>
  </div>

  <div class="post">
    <h2><a href="/bkup/2012/05/04/%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520string%2520evolver%252c%2520my%2520first%2520genetic%2520algorithm%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520/">String Evolver, My First Genetic Algorithm</a></h2>

    <p>When reading <em>Evolutionary Computation for Modeling and Optimization[1]</em>, I found following problem in section 1.2.3:</p>
<p><strong><em>A string evolver is an evolutionary algorithm that tries to match a reference string from a population of random strings. The underlying character set of the string evolver is the alphabet from which the strings are drawn.</em></strong></p>
<p>The solution given in the context is:</p>
<ol>
<li>Start with a reference string and a population of random strings.</li>
<li>The fitness of a string is the number of positions in which it has the same character as the reference string.</li>
<li>To evolve the population, split it into small random groups called&nbsp;tournaments.</li>
<li>Copy the most fit string(break ties by picking at random among the most fit strings) over the least fit string in each tournament.</li>
<li>Then change one randomly chosen character in each copy(mutation).</li>
<li>Repeat until an exact match with the reference string is obtained.</li>
</ol>
<p>When trying this solution, I noticed that it won't converge even after a long time. Therefore, I modified the crossover and mutation strategy.<strong>A subset of population(strings) will be selected based on fitness in a tournament, and the bottom-ranked<br />
 50% of each tournament will be deleted. New population is formed by crossing the remaining high 20 individuals in a tournament, while the high-ranked parents are kept unchanged[2]. Finally, a random selected string in a tournament will be mutated.</strong></p>
<p>
My codes are:</p></p>
<pre>#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;

#define POP 20 
#define TNMT 4	    // Total number of tournaments
#define MAXSTR 80
char strPop[POP][MAXSTR]; // population of strings
char* REF=&quot;Hello,world!&quot;; // Reference string
char* mostFit[TNMT]; 	  // the most fit string of each tournament
char* leastFit[TNMT]; 	// the least fit string of each 

tournament

char GenRandChar()
{
	return (char)(32+rand()%96);
}

char * GenRandStr(char* str, unsigned int len)
{
	int i;
	for(i=0;i&lt;len-1;++i)
	{
		str[i]=GenRandChar();
	}
	str[i]='';
	return str;
}

// Copy the most fit string(break ties by picking at 
// random among the most fit strings) over the least 
// fit string in each tournament.
unsigned int CrossoverM2L(char* strMostFit, char* strLeastFit, unsigned int len)
{
	int i,p;
	char tmp;

	// Generate random position. Make sure the string
	// won't be broken at the first or last character.
	p=rand()%(len-2)+1;
	for(i=0;i&lt;p;++i)
	{
		tmp=strMostFit[i];
		strMostFit[i]=strLeastFit[i];
		strLeastFit[i]=tmp;
	}
	return p;
}

// Change one randomly chosen character in each copy.
unsigned int Mutate(char* str,unsigned int len)
{
	int p;

	p=rand()%len;
	str[p]=GenRandChar();
	return p;
}

// Count the number of identical chars between ref and str.
unsigned int GetFitness(char* str,unsigned int len)
{
	int i;
	int cnt=0;
	for(i=0;i&lt;len;++i)
	{
		if(REF[i]==str[i])
			cnt++;
	}
	
	return cnt;
}

// Find out the most and least fit strings in a tournament.
// 	tourn -- the number of tourn, starting from 0.
void GetFitOfTnmt(char* mostFit[],char* leastFit[],unsigned int tourn)
{
	int i,fit;
	char* str;
	int most_fit,least_fit;

	// Make sure the most and least fit strings are different
	mostFit[tourn]=strPop[tourn*POP/TNMT];
	most_fit=GetFitness(mostFit[tourn],strlen(REF));
	leastFit[tourn]=strPop[tourn*POP/TNMT+1];
	least_fit=GetFitness(leastFit[tourn],strlen(REF));
	for(i=1;i&lt;POP/TNMT;++i)
	{
		str=strPop[tourn*POP/TNMT+i];
		fit=GetFitness(str,strlen(REF));
		if(most_fitfit)
		{
			least_fit=fit;
			leastFit[tourn]=str;
		}
	}
}

// Get the most fit string of the population
char* GetMostFit(char* mostFit[])
{
	int i,fit;
	char* strFit=mostFit[0];
	int most_fit=GetFitness(strFit,strlen(REF));
	for(i=1;i&lt;TNMT;++i)
	{
		fit=GetFitness(mostFit[i],strlen(REF));
		if(most_fit&lt;fit)
		{
			most_fit=fit;
			strFit=mostFit[i];
		}
	}
	
	return strFit;
}

// Sort the strings in a tournament by fitness.
void SortTournByFit(unsigned int tourn)
{
	int tmpInt;
	unsigned int fit[POP/TNMT];
	int i,j;
	int len=strlen(REF);
	char tmpStr[MAXSTR];

	// Get the fitness of each string in this tournament
	for(i=0;i&lt;POP/TNMT;i++)
	{
		fit[i]=GetFitness(strPop[tourn*POP/TNMT+i],len);
	}

	// Sort strings by fitness
	for(i=0;i&lt;POP/TNMT;i++)
	{
		for(j=i+1;j&lt;POP/TNMT;j++)
		{
			if(fit[i]&lt;fit[j])
			{
				tmpInt=fit[i];
				fit[i]=fit[j];
				fit[j]=tmpInt;

				strcpy(tmpStr,strPop[tourn*POP/TNMT+i]);
				strcpy(strPop[tourn*POP/TNMT+i],strPop[tourn*POP/TNMT+j]);
				strcpy(strPop[tourn*POP/TNMT+j],tmpStr);
			}
		} // end of for j
	} // end of for i
}

// Crossover the top half strings.
// Remove the second half strings after sorting, keep the top half, 
// and generate children by crossing over top half strings.
void CrossoverByFit(unsigned int tourn)
{
	int i,j,p,len;
	char* strTmp;

	SortTournByFit(tourn);

	// Generate random position. Make sure the string
	// won't be broken at the first or last character.
	len=strlen(REF);
	p=rand()%(len-2)+1;
	
	for(i=0;i&lt;(int)POP/TNMT/2;i+=2)
	{
		for(j=0;j
p;--j)
		{
			strPop[(tourn+1)*POP/TNMT-1-i][j]=strPop[tourn*POP/TNMT+i+1][j];
			strPop[(tourn+1)*POP/TNMT-2-i][j]=strPop[tourn*POP/TNMT+i][j];
		}
	}
}


// Print population by tournaments.
void DumpPop()
{
	int i,j;
	char* curStr;
	for(i=0;i&lt;TNMT;i++)
	{
		printf(&quot;Tournament %d:n&quot;,i);
		for(j=0;j&lt;POP/TNMT;j++)
		{
			curStr=strPop[i*POP/TNMT+j];
			printf(&quot;t%stFitness: %dn&quot;,curStr,GetFitness(curStr,strlen(curStr)));
		}
		printf(&quot;n&quot;);
	}
}

//
// MAIN START HERE
//
int main()
{
	int LEN=strlen(REF);

	int i,j,p;
	long cnt=0;
	char * strFit=NULL;
	
	// Initionlization
	for(i=0;i&lt;POP;++i)
	{
		GenRandStr(strPop[i],LEN);
	}
	
	printf(&quot;---------------- Original Population ---------------n&quot;);
	DumpPop();
	
	for(i=0;i&lt;TNMT;++i)
		GetFitOfTnmt(mostFit,leastFit,i);
		
	strFit=GetMostFit(mostFit);
	while(GetFitness(strFit,LEN) != LEN)
	//while(GetFitness(strFit,LEN)&lt;5)
	{
		printf(&quot;n---------------- Generation %d ----------------n&quot;,cnt);
		DumpPop();

		printf(&quot;%stReferencen&quot;,REF);
		printf(&quot;%stGen: %dtFitness: %dn&quot;,strFit,cnt++,GetFitness(strFit,LEN));
		for(i=0;i&lt;TNMT;++i)
		{
			// Crossover
			//CrossoverM2L(mostFit[i],leastFit[i],LEN);
			CrossoverByFit(i);
			
			// Mutation
			p=rand()%(POP/TNMT);
			Mutate(strPop[i*POP/TNMT+p],LEN);

			// Re-calculate the fitness
			GetFitOfTnmt(mostFit,leastFit,i);
		}
		strFit=GetMostFit(mostFit);
	}

	strFit=GetMostFit(mostFit);
	printf(&quot;n---------------- Generation %d ----------------n&quot;,cnt);
	DumpPop();
	printf(&quot;%stReferencen&quot;,REF);
	printf(&quot;%stGen: %dtFitness: %dn&quot;,strFit,cnt++,GetFitness(strFit,LEN));

	return 0;
}</pre>
<p>
<span style="font-family:monospace;"><span style="white-space:pre;">And the output is:</span></span></p>
<pre>---------------- Generation 0 ----------------
Tournament 0:
	F~AKK[b;tV]	Fitness: 0
	\agA_q&gt;vr	Fitness: 0
	OGG&amp;Gy*(|yj	Fitness: 0
	6s[rEA8|45/	Fitness: 0
	W.e[:bYXlCz	Fitness: 0

Tournament 1:
	6n?y9o??VN#	Fitness: 0
	8mmZ~f:Dfn&lt;	Fitness: 0
	i-nV!P`{oQ	Fitness: 0
	8%p%)3-j;(	Fitness: 0
	92S2}&amp;jU&quot;f	Fitness: 0

Tournament 2:
	38IrA~lrHq|	Fitness: 0
	RF51Vo7V9]v	Fitness: 0
	Z(tUX&lt;w|!{m	Fitness: 1
	qNoPy'a;OS]	Fitness: 0
	1`]em-+SM~~	Fitness: 0

Tournament 3:
	o^f(T&amp;zQC3Q	Fitness: 0
	($g[j@ Asi	Fitness: 0
	@gb#E`!QGUb	Fitness: 0
	%H/&gt;N)Kt_Pm	Fitness: 0
	i&gt;Z+F0@6/'L	Fitness: 0

Hello,world!	Reference
Z(tUX&lt;w|!{m	Gen: 0	Fitness: 1

---------------- Generation 1 ----------------
Tournament 0:
	F~AKK[b;tVx	Fitness: 0
	\agA_q&gt;vr	Fitness: 0
	OGG&amp;Gy*(|yj	Fitness: 0
	\agA_q&gt;5]	Fitness: 0
	F~AKK[b;tCr	Fitness: 0

Tournament 1:
	6n?y9o??VN#	Fitness: 0
	kmmZ~f:Dfn&lt;	Fitness: 0
	i-nV!P`{oQ	Fitness: 0
	8mm%9o??VN#	Fitness: 0
	6n?2~f:Dfn&lt;	Fitness: 0

Tournament 2:
	Z(tUX&lt;w|!{m	Fitness: 1
	RF51Vo7V9]v	Fitness: 0
	38IrA~lrHq|	Fitness: 0
	RFoUX&lt;w|r{m	Fitness: 2
	Z(]1Vo7V9]v	Fitness: 0

Tournament 3:
	o^f(T&amp;zQC3Q	Fitness: 0
	($g[j@ Asi	Fitness: 0
	@gb#E`!QGUb	Fitness: 0
	($/(T&amp;zQC3Q	Fitness: 0
	@^Z[j@ Asi	Fitness: 0

Hello,world!	Reference
RFoUX&lt;w|r{m	Gen: 1	Fitness: 2

---------------- Generation 2 ----------------
Tournament 0:
	F~AKK[b;tVx	Fitness: 0
	\agA_q&gt;vr	Fitness: 0
	OGG&amp;Gy*(|yj	Fitness: 0
	\agA_q&gt;v]	Fitness: 0
	F~AeK[b;tVr	Fitness: 0

Tournament 1:
	Pn?y9o??VN#	Fitness: 0
	kmmZ~f:Dfn&lt;	Fitness: 0
	i-nV!P`{oQ	Fitness: 0
	kmmZ~f??VN#	Fitness: 0
	6n?y9o:Dfn&lt;	Fitness: 0

Tournament 2:
	RFoDX&lt;w|r{m	Fitness: 2
	Z(tUX&lt;w|!{m	Fitness: 1
	38IrA~lrHq|	Fitness: 0
	Z(t1X&lt;w|r{m	Fitness: 2
	RFo1X&lt;w|!{m	Fitness: 1

Tournament 3:
	o^f(T&amp;zQC3Q|	Fitness: 0
	($g[j@ Asi	Fitness: 0
	@gb#E`!QGUb	Fitness: 0
	($f(T&amp;zQC3Q	Fitness: 0
	o^g[j@ Asi	Fitness: 0

Hello,world!	Reference
RFoDX&lt;w|r{m	Gen: 2	Fitness: 2

---------------- Generation 3 ----------------
Tournament 0:
	F~AKK[b;tVx	Fitness: 0
	\agA_q&gt;vr	Fitness: 0
	OGG&amp;Gy*(|yj	Fitness: 0
	\KK[b;tVx	Fitness: 0
	F~Aag~_q&gt;vr	Fitness: 0

Tournament 1:
	Pn?y9o??VN#	Fitness: 0
	kmmZ~f:Dfn&lt;@	Fitness: 0
	i-nV!P`{oQ	Fitness: 0
	km?y9o??VN#	Fitness: 0
	PnmZ~f:Dfn&lt;	Fitness: 0

Tournament 2:
	RFoDX&lt;w|r{m	Fitness: 2
	Z(t1X&lt;w|r{m	Fitness: 2
	Z(tUX~w|!{m	Fitness: 1
	Z(oDX&lt;w|r{m	Fitness: 2
	RFI1X&lt;w|r{m	Fitness: 2

Tournament 3:
	o^f(T&amp;zQC3Q|	Fitness: 0
	($g[j@ Asi	Fitness: 0
	@gb#E`!QGUb	Fitness: 0
	($g[W@ QC3Q|	Fitness: 0
	o^f(T&amp;zAsi	Fitness: 0

Hello,world!	Reference
RFoDX&lt;w|r{m	Gen: 3	Fitness: 2

---------------- Generation 4 ----------------
Tournament 0:
	F~AKK[b;tVx	Fitness: 0
	\JgA_q&gt;vr	Fitness: 0
	OGG&amp;Gy*(|yj	Fitness: 0
	\KK[b;tVx	Fitness: 0
	F~AagA_q&gt;vr	Fitness: 0

Tournament 1:
	Pn?y9o??VN#	Fitness: 0
	kmmZ~f:Dfn&lt;@	Fitness: 0
	i-nV!P`{oQ	Fitness: 0
	kmmZ~o??VN#	Fitness: 0
	Pnsy9f:Dfn&lt;@	Fitness: 0

Tournament 2:
	RFoDX&lt;w|r{m	Fitness: 2
	Z(t1X&lt;w|r{m	Fitness: 2
	Z(oDXFw|r{m	Fitness: 2
	Z(t1X&lt;w|r{m	Fitness: 2
	RFoDX&lt;w|r{m	Fitness: 2

Tournament 3:
	o^f(T'zQC3Q|	Fitness: 0
	($g[j@ Asi	Fitness: 0
	@gb#E`!QGUb	Fitness: 0
	($g[j@ AsQ|	Fitness: 0
	o^f(T&amp;zQC3i	Fitness: 0

Hello,world!	Reference
RFoDX&lt;w|r{m	Gen: 4	Fitness: 2

      ......
      ......

---------------- Generation 2342 ----------------
Tournament 0:
	Hpllk,world!	Fitness: 10
	Hpllo,world!	Fitness: 11
	Hpllo,world!	Fitness: 11
	Hpllo,world!	Fitness: 11
	Hpllo,world!	Fitness: 11

Tournament 1:
	Hello,worlF!	Fitness: 11
	Hello,worlf!	Fitness: 11
	Hello,worlf!	Fitness: 11
	Hello,worlf!	Fitness: 11
	Hello,worlf!	Fitness: 11

Tournament 2:
	Hello,worldh	Fitness: 11
	Hello,worldJ	Fitness: 11
	Hello,worldh	Fitness: 11
	Hello,worldh	Fitness: 11
	Hello,worVdJ	Fitness: 10

Tournament 3:
	He:lo,w4rld!	Fitness: 10
	He:lo,w0rld!	Fitness: 10
	He:lo,w4rld!	Fitness: 10
	He:lo,w0rld!	Fitness: 10
	He:2o,w4rld!	Fitness: 9

Hello,world!	Reference
Hpllo,world!	Gen: 2342	Fitness: 11

---------------- Generation 2343 ----------------
Tournament 0:
	Hp|lo,world!	Fitness: 10
	Hpllo,world!	Fitness: 11
	Hpllo,world!	Fitness: 11
	Hpllo,world!	Fitness: 11
	Hpllo,world!	Fitness: 11

Tournament 1:
	Hello,worlF!	Fitness: 11
	Hello,wo&amp;lf!	Fitness: 10
	Hello,worlf!	Fitness: 11
	Hello,worlF!	Fitness: 11
	Hello,worlf!	Fitness: 11

Tournament 2:
	Hello,worldh	Fitness: 11
	Hello,worldJ	Fitness: 11
	Hello,worldh	Fitness: 11
	Hello,wor&amp;dh	Fitness: 10
	Hello,worldJ	Fitness: 11

Tournament 3:
	He:lo,w4rld!	Fitness: 10
	He:lo,w0rld!	Fitness: 10
	He:lo,w4rld!	Fitness: 10
	He:lo,w0rld!	Fitness: 10
	He:lozw4rld!	Fitness: 9

Hello,world!	Reference
Hpllo,world!	Gen: 2343	Fitness: 11

---------------- Generation 2344 ----------------
Tournament 0:
	Hpllo,world!	Fitness: 11
	Hpllo,world!	Fitness: 11
	Hllo,world!	Fitness: 11
	Hpllo,world!	Fitness: 11
	Hpllo,world!	Fitness: 11

Tournament 1:
	Hello,worlF!	Fitness: 11
	Hello,worlf!	Fitness: 11
	Hello,world!	Fitness: 12
	Hello,worlF!	Fitness: 11
	Hello,wo&amp;lf!	Fitness: 10

Tournament 2:
	Hello,world 	Fitness: 11
	Hello,worldJ	Fitness: 11
	Hello,worldh	Fitness: 11
	Hello,worldh	Fitness: 11
	Hello,worldJ	Fitness: 11

Tournament 3:
	He:lo,w44ld!	Fitness: 9
	He:lo,w0rld!	Fitness: 10
	He:lo,w4rld!	Fitness: 10
	He:lo,w0rld!	Fitness: 10
	He:lo,w4rld!	Fitness: 10

Hello,world!	Reference
Hello,world!	Gen: 2344	Fitness: 12
</pre>
<p></p>
<p>-----------------------------------------------------------------</p>
<p><em>References:</em></p>
<p>[1]: Daniel Ashlock, <em>Evolutionary Computation for Modeling and Optimization</em>, Springer, 2005.</p>
<p>[2]: FORREST, S., WEIMER, W., NGUYEN, T., AND GOUES, C. L., <em>A Genetic Programming Approach to Automated Software Repair</em>, In GECCO (July 2009).</p>


    <small class="meta">May 04, 2012 | <a href='/bkup/2012/05/04/%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520string%2520evolver%252c%2520my%2520first%2520genetic%2520algorithm%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520/#disqus_thread'>View Comments</a></small>
  </div>

  <div class="post">
    <h2><a href="/bkup/2012/05/02/%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520%25e5%258d%2587%25e7%25ba%25a7ubuntu%252012-04%25e6%2589%2580%25e9%2581%2587%25e5%2588%25b0%25e7%259a%2584%25e4%25b8%2580%25e4%25ba%259b%25e9%2597%25ae%25e9%25a2%2598%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520/">升级Ubuntu 12.04所遇到的一些问题</a></h2>

    <p>升级Ubuntu 11.10到12.04后，开机报错“<em>no partition found</em>”,进入Grub后，输入&quot;ls&quot;命令，也报错“no partition found”。可见Grub已经崩溃了。</p>
<p>于是我下载了<a href="http://unetbootin.sourceforge.net/">UNetbootin</a>，然后利用它在Win 7下制作Ubuntu自启动U盘。制作好之后，结果发现不会自动引导启动，需要在开机之后出现Thinkpad欢迎界面时按F12，然后选择U盘启动。然后选择U盘启动Ubuntu，进入Ubuntu后按照&nbsp;<a href="http://www.webupd8.org/2009/12/how-to-recover-grub2-linux.html">How to<br />
 Fix Grub 2</a>&nbsp;中的方法安装Grub 2到硬盘。</p></p>
<div style="color:rgb(85,85,85);font-size:14px;line-height:20px;text-align:justify;margin:0;padding:0;">
<span style="margin:0;padding:0;">To fix GRUB 2, you need an Ubuntu live CD from which you need to boot.</span>&nbsp;Once you boot to the LIVE<br />
 CD, open a terminal an and type these commands:</div>
<p><br style="color:rgb(85,85,85);font-size:14px;line-height:20px;margin:0;padding:0;" /></p>
<div style="color:rgb(85,85,85);font-size:14px;line-height:20px;text-align:justify;margin:0;padding:0;">
<span style="font-weight:bold;margin:0;padding:0;">a) Firstly, you need to find out on which partition your Linux system is installed:</span><br style="margin:0;padding:0;" /></p>
<pre class="linux-code" style="margin-top:10px;margin-bottom:10px;margin-left:10px;background-color:rgb(229,202,202);color:rgb(0,0,0);font-size:13px;font-family:'UbuntuBeta Mono', 'Ubuntu Mono', 'Courier New', Courier, monospace;max-height:500px;min-height:16px;overflow-x:auto;overflow-y:auto;width:522px;z-index:10000;border-color:rgb(155,5,5);border-style:solid;border-width:1px 1px 1px 20px;padding:28px 10px 10px;"><code style="margin:0;padding:0;">sudo fdisk -l</code></pre>
<p>(in my case, it's &quot;sda1&quot;)<br style="margin:0;padding:0;" /><br />
<br style="margin:0;padding:0;" /><br />
<span style="font-weight:bold;margin:0;padding:0;">b) Now, we must mount this partition:</span><br style="margin:0;padding:0;" /></p>
<pre class="linux-code" style="margin-top:10px;margin-bottom:10px;margin-left:10px;background-color:rgb(229,202,202);color:rgb(0,0,0);font-size:13px;font-family:'UbuntuBeta Mono', 'Ubuntu Mono', 'Courier New', Courier, monospace;max-height:500px;min-height:16px;overflow-x:auto;overflow-y:auto;width:522px;z-index:10000;border-color:rgb(155,5,5);border-style:solid;border-width:1px 1px 1px 20px;padding:28px 10px 10px;"><code style="margin:0;padding:0;">sudo mount /dev/<span style="font-weight:bold;margin:0;padding:0;">sda1</span> /mnt</code></pre>
<p>Where &quot;sda1&quot; is the partition where you installed Ubuntu (or any other Linux distro). It could be &quot;sda5&quot;, &quot;sda6&quot;, etc. for you.<br style="margin:0;padding:0;" /><br />
<br style="margin:0;padding:0;" /><br />
<span style="font-weight:bold;margin:0;padding:0;">c) Install grub to the partition you've mounted:</span><br style="margin:0;padding:0;" /></p>
<pre class="linux-code" style="margin-top:10px;margin-bottom:10px;margin-left:10px;background-color:rgb(229,202,202);color:rgb(0,0,0);font-size:13px;font-family:'UbuntuBeta Mono', 'Ubuntu Mono', 'Courier New', Courier, monospace;max-height:500px;min-height:16px;overflow-x:auto;overflow-y:auto;width:522px;z-index:10000;border-color:rgb(155,5,5);border-style:solid;border-width:1px 1px 1px 20px;padding:28px 10px 10px;"><code style="margin:0;padding:0;">sudo grub-install --root-directory=/mnt/ /dev/sda</code></pre>
<p><br style="margin:0;padding:0;" /><br />
<br style="margin:0;padding:0;" /><br />
<span style="background-color:rgb(255,255,177);border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(223,223,223);border-right-width:1px;border-right-style:solid;border-right-color:rgb(223,223,223);color:rgb(51,51,51);margin:0;padding:0 2px;">Important:</span>&nbsp;Please<br />
 notice that it's &quot;/dev/sda&quot;, not &quot;/dev/sda1&quot;. &quot;sda&quot; is the hard disk on which your Linux distribution is installed!<br style="margin:0;padding:0;" /><br />
<br style="margin:0;padding:0;" /><br />
<span style="font-weight:bold;margin:0;padding:0;">d) Restart your computer. As previous Grub 2 entries are removed, run the following<br />
 command to restore them:</span><br style="margin:0;padding:0;" /></p>
<pre class="linux-code" style="margin-top:10px;margin-bottom:10px;margin-left:10px;background-color:rgb(229,202,202);color:rgb(0,0,0);font-size:13px;font-family:'UbuntuBeta Mono', 'Ubuntu Mono', 'Courier New', Courier, monospace;max-height:500px;min-height:16px;overflow-x:auto;overflow-y:auto;width:522px;z-index:10000;border-color:rgb(155,5,5);border-style:solid;border-width:1px 1px 1px 20px;padding:28px 10px 10px;"><code style="margin:0;padding:0;">sudo update-grub</code></pre>
</div>
<p>我以前是用USB Stick安装的Ubuntu，在安装过程中有一选项是选择引导程序的安装位置，默认是/dev/sdb，也就是U盘。因为当时我没注意，所以Grub 2被安装到了U盘，尽管事后重新安装到了硬盘上，但貌&#20284;升级后还是不太正常。</p>
<p>重启电脑进入Grub 2之后，输入命令（Grub 2中已经不再支持kernel命令，需要用<strong><em>linux</em></strong>指定kernel）：</p></p>
<pre>linux (hd0,X)/vmlinuz-3.2......
initrd (hd0,X)/initrd.img-3.2......
boot</pre>
<p>悲哀的是系统启动到一半仍然无法进入GUI或者shell。多次检查测试后确认 / 所在的分区已经崩溃，Ubuntu根本无法识别。</p>
<p>虽然不想，但此时我已别无选择，只能重新安装Ubuntu 12.04了。可惜我电脑里那些尚未备份的文件和电影啊……</p>
<p></p>


    <small class="meta">May 02, 2012 | <a href='/bkup/2012/05/02/%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520%25e5%258d%2587%25e7%25ba%25a7ubuntu%252012-04%25e6%2589%2580%25e9%2581%2587%25e5%2588%25b0%25e7%259a%2584%25e4%25b8%2580%25e4%25ba%259b%25e9%2597%25ae%25e9%25a2%2598%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520/#disqus_thread'>View Comments</a></small>
  </div>

  <div class="post">
    <h2><a href="/tips/unix/linux/2012/05/02/%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520%25e5%258d%2587%25e7%25ba%25a7ubuntu%252012-04%25e6%2589%2580%25e9%2581%2587%25e5%2588%25b0%25e7%259a%2584%25e4%25b8%2580%25e4%25ba%259b%25e9%2597%25ae%25e9%25a2%2598%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520/">升级Ubuntu 12.04所遇到的一些问题</a></h2>

    <p>升级Ubuntu 11.10到12.04后，开机报错“<em>no partition found</em>”,进入Grub后，输入&quot;ls&quot;命令，也报错“no partition found”。可见Grub已经崩溃了。</p>
<p>于是我下载了<a href="http://unetbootin.sourceforge.net/">UNetbootin</a>，然后利用它在Win 7下制作Ubuntu自启动U盘。制作好之后，结果发现不会自动引导启动，需要在开机之后出现Thinkpad欢迎界面时按F12，然后选择U盘启动。然后选择U盘启动Ubuntu，进入Ubuntu后按照&nbsp;<a href="http://www.webupd8.org/2009/12/how-to-recover-grub2-linux.html">How to<br />
 Fix Grub 2</a>&nbsp;中的方法安装Grub 2到硬盘。</p></p>
<div style="color:rgb(85,85,85);font-size:14px;line-height:20px;text-align:justify;margin:0;padding:0;">
<span style="margin:0;padding:0;">To fix GRUB 2, you need an Ubuntu live CD from which you need to boot.</span>&nbsp;Once you boot to the LIVE<br />
 CD, open a terminal an and type these commands:</div>
<p><br style="color:rgb(85,85,85);font-size:14px;line-height:20px;margin:0;padding:0;" /></p>
<div style="color:rgb(85,85,85);font-size:14px;line-height:20px;text-align:justify;margin:0;padding:0;">
<span style="font-weight:bold;margin:0;padding:0;">a) Firstly, you need to find out on which partition your Linux system is installed:</span><br style="margin:0;padding:0;" /></p>
<pre class="linux-code" style="margin-top:10px;margin-bottom:10px;margin-left:10px;background-color:rgb(229,202,202);color:rgb(0,0,0);font-size:13px;font-family:'UbuntuBeta Mono', 'Ubuntu Mono', 'Courier New', Courier, monospace;max-height:500px;min-height:16px;overflow-x:auto;overflow-y:auto;width:522px;z-index:10000;border-color:rgb(155,5,5);border-style:solid;border-width:1px 1px 1px 20px;padding:28px 10px 10px;"><code style="margin:0;padding:0;">sudo fdisk -l</code></pre>
<p>(in my case, it's &quot;sda1&quot;)<br style="margin:0;padding:0;" /><br />
<br style="margin:0;padding:0;" /><br />
<span style="font-weight:bold;margin:0;padding:0;">b) Now, we must mount this partition:</span><br style="margin:0;padding:0;" /></p>
<pre class="linux-code" style="margin-top:10px;margin-bottom:10px;margin-left:10px;background-color:rgb(229,202,202);color:rgb(0,0,0);font-size:13px;font-family:'UbuntuBeta Mono', 'Ubuntu Mono', 'Courier New', Courier, monospace;max-height:500px;min-height:16px;overflow-x:auto;overflow-y:auto;width:522px;z-index:10000;border-color:rgb(155,5,5);border-style:solid;border-width:1px 1px 1px 20px;padding:28px 10px 10px;"><code style="margin:0;padding:0;">sudo mount /dev/<span style="font-weight:bold;margin:0;padding:0;">sda1</span> /mnt</code></pre>
<p>Where &quot;sda1&quot; is the partition where you installed Ubuntu (or any other Linux distro). It could be &quot;sda5&quot;, &quot;sda6&quot;, etc. for you.<br style="margin:0;padding:0;" /><br />
<br style="margin:0;padding:0;" /><br />
<span style="font-weight:bold;margin:0;padding:0;">c) Install grub to the partition you've mounted:</span><br style="margin:0;padding:0;" /></p>
<pre class="linux-code" style="margin-top:10px;margin-bottom:10px;margin-left:10px;background-color:rgb(229,202,202);color:rgb(0,0,0);font-size:13px;font-family:'UbuntuBeta Mono', 'Ubuntu Mono', 'Courier New', Courier, monospace;max-height:500px;min-height:16px;overflow-x:auto;overflow-y:auto;width:522px;z-index:10000;border-color:rgb(155,5,5);border-style:solid;border-width:1px 1px 1px 20px;padding:28px 10px 10px;"><code style="margin:0;padding:0;">sudo grub-install --root-directory=/mnt/ /dev/sda</code></pre>
<p><br style="margin:0;padding:0;" /><br />
<br style="margin:0;padding:0;" /><br />
<span style="background-color:rgb(255,255,177);border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(223,223,223);border-right-width:1px;border-right-style:solid;border-right-color:rgb(223,223,223);color:rgb(51,51,51);margin:0;padding:0 2px;">Important:</span>&nbsp;Please<br />
 notice that it's &quot;/dev/sda&quot;, not &quot;/dev/sda1&quot;. &quot;sda&quot; is the hard disk on which your Linux distribution is installed!<br style="margin:0;padding:0;" /><br />
<br style="margin:0;padding:0;" /><br />
<span style="font-weight:bold;margin:0;padding:0;">d) Restart your computer. As previous Grub 2 entries are removed, run the following<br />
 command to restore them:</span><br style="margin:0;padding:0;" /></p>
<pre class="linux-code" style="margin-top:10px;margin-bottom:10px;margin-left:10px;background-color:rgb(229,202,202);color:rgb(0,0,0);font-size:13px;font-family:'UbuntuBeta Mono', 'Ubuntu Mono', 'Courier New', Courier, monospace;max-height:500px;min-height:16px;overflow-x:auto;overflow-y:auto;width:522px;z-index:10000;border-color:rgb(155,5,5);border-style:solid;border-width:1px 1px 1px 20px;padding:28px 10px 10px;"><code style="margin:0;padding:0;">sudo update-grub</code></pre>
</div>
<p>我以前是用USB Stick安装的Ubuntu，在安装过程中有一选项是选择引导程序的安装位置，默认是/dev/sdb，也就是U盘。因为当时我没注意，所以Grub 2被安装到了U盘，尽管事后重新安装到了硬盘上，但貌&#20284;升级后还是不太正常。</p>
<p>重启电脑进入Grub 2之后，输入命令（Grub 2中已经不再支持kernel命令，需要用<strong><em>linux</em></strong>指定kernel）：</p></p>
<pre>linux (hd0,X)/vmlinuz-3.2......
initrd (hd0,X)/initrd.img-3.2......
boot</pre>
<p>悲哀的是系统启动到一半仍然无法进入GUI或者shell。多次检查测试后确认 / 所在的分区已经崩溃，Ubuntu根本无法识别。</p>
<p>虽然不想，但此时我已别无选择，只能重新安装Ubuntu 12.04了。可惜我电脑里那些尚未备份的文件和电影啊……</p>
<p></p>


    <small class="meta">May 02, 2012 | <a href='/tips/unix/linux/2012/05/02/%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520%25e5%258d%2587%25e7%25ba%25a7ubuntu%252012-04%25e6%2589%2580%25e9%2581%2587%25e5%2588%25b0%25e7%259a%2584%25e4%25b8%2580%25e4%25ba%259b%25e9%2597%25ae%25e9%25a2%2598%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520/#disqus_thread'>View Comments</a></small>
  </div>

  <div class="post">
    <h2><a href="/tips/2012/04/21/%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520briss%2520-%2520crop%2520the%2520margins%2520of%2520your%2520pdf%2520files%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520/">Briss -- Crop the Margins of Your PDF Files</a></h2>

    <p><span style="font-size:18px;">今天用iPad阅读一个PDF文档时，发现每页留白太多，字体特别小，在iBooks中每翻一页都要手动去缩放，实在是麻烦。于是搜索去掉PDF留白的方法。</span></p>
<p><span style="font-size:18px;">先是寄希望于Linux系统自带的pdfcrop，结果尝试了各种选项后，发现PDF的size没有变，还是原来的8.5x8.9 inch。</span></p>
<p><span style="font-size:18px;">后来搜索Ghostscript的用法，把papersize或者resolution强制改成希望的数&#20540;，仍然没有变化。郁闷！</span></p>
<p><span style="font-size:18px;">再后来发现了网上的一个PDFcrop版本，也是用Perl写的，只是更加友好一点，尝试之后仍不奏效。自己上手用hardcode改为自己想要的结果，失败。不过在该tool中最大的发现就是<em> 1inch=28.3464567bp(dpi)</em>.</span></p>
<p><span style="font-size:18px;">总结一晚上失败的经验就是：<strong>该PDF文档是扫描的图片转PDF&#26684;式，而不是文字直接转的，因此pdfcrop等工具无法发现并处理留白！</strong></span></p>
<p><span style="font-size:18px;">最后在网上搜索PDF Margin Crop，无意中发现了<a href="http://sourceforge.net/projects/briss/">Briss</a>，抱着试试看的心态下载使用了一下，发现竟然能够识别图片转PDF的文字区域，拖动左上或右下脚上的蓝色正方形区域还可一手动选择保留的区域， Terrific！</span></p>
<p><span style="font-size:18px;">使用方法就是下载<a href="http://sourceforge.net/projects/briss/">Briss</a>，解压缩，然后执行</span></p></p>
<pre>java -jar briss-0.0.13.jar
or
java -jar briss-0.0.13.jar cropthis.pdf

(The second line comes in handy if you want shortlinks for pdf editing) 
</pre>
<p>
<span style="font-size:18px;">更详细的使用说明参见&nbsp;<a href="http://www.freewaregenius.com/2011/01/18/briss-crop-your-pdf-documents-using-a-visual-interface/" title="Briss: crop your PDF documents using a visual interface" rel="bookmark" style="font-family:'Myriad Pro', Calibri;line-height:22px;vertical-align:baseline;outline-style:none;outline-width:initial;outline-color:initial;background-color:transparent;border-width:initial;border-color:initial;color:rgb(34,34,34);border-style:none;margin:0;padding:0;">Briss:<br />
 crop your PDF documents using a visual interface</a><span style="color:rgb(68,68,68);font-family:'Myriad Pro', Calibri;line-height:22px;">。</span></span></p>
<p></p>
<p></p>
<p></p>


    <small class="meta">April 21, 2012 | <a href='/tips/2012/04/21/%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520briss%2520-%2520crop%2520the%2520margins%2520of%2520your%2520pdf%2520files%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520/#disqus_thread'>View Comments</a></small>
  </div>

  <div class="post">
    <h2><a href="/bkup/2012/04/21/%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520briss%2520-%2520crop%2520the%2520margins%2520of%2520your%2520pdf%2520files%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520/">Briss -- Crop the Margins of Your PDF Files</a></h2>

    <p><span style="font-size:18px;">今天用iPad阅读一个PDF文档时，发现每页留白太多，字体特别小，在iBooks中每翻一页都要手动去缩放，实在是麻烦。于是搜索去掉PDF留白的方法。</span></p>
<p><span style="font-size:18px;">先是寄希望于Linux系统自带的pdfcrop，结果尝试了各种选项后，发现PDF的size没有变，还是原来的8.5x8.9 inch。</span></p>
<p><span style="font-size:18px;">后来搜索Ghostscript的用法，把papersize或者resolution强制改成希望的数&#20540;，仍然没有变化。郁闷！</span></p>
<p><span style="font-size:18px;">再后来发现了网上的一个PDFcrop版本，也是用Perl写的，只是更加友好一点，尝试之后仍不奏效。自己上手用hardcode改为自己想要的结果，失败。不过在该tool中最大的发现就是<em> 1inch=28.3464567bp(dpi)</em>.</span></p>
<p><span style="font-size:18px;">总结一晚上失败的经验就是：<strong>该PDF文档是扫描的图片转PDF&#26684;式，而不是文字直接转的，因此pdfcrop等工具无法发现并处理留白！</strong></span></p>
<p><span style="font-size:18px;">最后在网上搜索PDF Margin Crop，无意中发现了<a href="http://sourceforge.net/projects/briss/">Briss</a>，抱着试试看的心态下载使用了一下，发现竟然能够识别图片转PDF的文字区域，拖动左上或右下脚上的蓝色正方形区域还可一手动选择保留的区域， Terrific！</span></p>
<p><span style="font-size:18px;">使用方法就是下载<a href="http://sourceforge.net/projects/briss/">Briss</a>，解压缩，然后执行</span></p></p>
<pre>java -jar briss-0.0.13.jar
or
java -jar briss-0.0.13.jar cropthis.pdf

(The second line comes in handy if you want shortlinks for pdf editing) 
</pre>
<p>
<span style="font-size:18px;">更详细的使用说明参见&nbsp;<a href="http://www.freewaregenius.com/2011/01/18/briss-crop-your-pdf-documents-using-a-visual-interface/" title="Briss: crop your PDF documents using a visual interface" rel="bookmark" style="font-family:'Myriad Pro', Calibri;line-height:22px;vertical-align:baseline;outline-style:none;outline-width:initial;outline-color:initial;background-color:transparent;border-width:initial;border-color:initial;color:rgb(34,34,34);border-style:none;margin:0;padding:0;">Briss:<br />
 crop your PDF documents using a visual interface</a><span style="color:rgb(68,68,68);font-family:'Myriad Pro', Calibri;line-height:22px;">。</span></span></p>
<p></p>
<p></p>
<p></p>


    <small class="meta">April 21, 2012 | <a href='/bkup/2012/04/21/%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520briss%2520-%2520crop%2520the%2520margins%2520of%2520your%2520pdf%2520files%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520/#disqus_thread'>View Comments</a></small>
  </div>

</div>

<div class='paging'>
  
    <a href='/page6' class='older'>Older Posts</a>
  

  
    <a href='/page4' class='newer'>Newer Posts</a>
  

  
  <div class='clear'></div>
</div>

        </div>
      </div>

      <div id="bottom" class="span8 offset4">
        <div class="well">
          <a href="/about/">About</a> |
          <a href="/archives/">Archives</a> |
          <a href="/atom.xml">feed</a>
        </div>
      </div>
    </div>
  </div>

  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script src="/javascripts/bootstrap.min.js"></script>

  <!-- Google Analytics Code -->
  <script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-9947336-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script');
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 
          'http://www') + '.google-analytics.com/ga.js';
      ga.setAttribute('async', 'true');
      document.documentElement.firstChild.appendChild(ga);
    })();

  </script>
</body>
</html>

