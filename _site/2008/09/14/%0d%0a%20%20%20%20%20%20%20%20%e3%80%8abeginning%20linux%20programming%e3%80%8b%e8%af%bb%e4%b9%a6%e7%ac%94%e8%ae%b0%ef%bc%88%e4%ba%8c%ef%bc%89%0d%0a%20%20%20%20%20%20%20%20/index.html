
<!DOCTYPE HTML>
<html lang="en-US" xmlns="http://www.w3.org/1999/xhtml" xmlns:wb="http://open.weibo.com/wb">
<head>
  <title>《Beginning Linux Programming》读书笔记（二） | Bo's Blog</title>
  
  <meta name="author" content="boyang" />
  <meta http-equiv="content-type" content="text/html;charset=utf-8">

  <meta name="wumiiVerification" content="b53186bf-1c2c-42e8-babc-8628eb14dd59" />
  <!-- using baidu cdn instead
  <link href="/assets/themes/clear/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
  -->
  <link href="http://libs.baidu.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet">


  <!-- Google Prettify -->
  <link href="/assets/themes/clear/google-code-prettify/desert.css" rel="stylesheet" type="text/css" media="all">
  <!-- Google Pretty end -->

  <link href="/assets/themes/clear/css/style.css" rel="stylesheet" type="text/css" media="all" />
  <!-- using baidu cdn instead
  <script type="text/javascript" src="/static/js/jquery-1.8.3.min.js"></script>
  -->

  <script src="http://libs.baidu.com/jquery/1.9.0/jquery.min.js"></script>
  <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>

<body>

  <div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container">
        <a class="brand" href="/">bo-yang</a>
        <ul class="nav">
          <li><a href="/archive.html">Archive</a></li>
          <li><a href="/about.html">About</a></li>
          <li><a href="/messages.html">Messages</a></li>
        </ul>
        <ul class="pull-right">
          <li>
            <form class="navbar-search" method="get" action="http://www.google.com/search" target="google_window">
              <input id="g_search" type="text" class="search-query" placeholder="Search..." name="q" />
              <input type="submit" name="btnG" style="display:none" id="searchsubmit" value="Search" />
              <input type="hidden" name="ie" value="UTF-8" />
              <input type="hidden" name="oe" value="UTF-8" />
              <input type="hidden" name="hl" value="zh-CN" />
              <input type="hidden" name="domains" value="http://bo-yang.github.io/" />
              <input type="hidden" name="sitesearch" value="http://bo-yang.github.io/" />
            </form>
          </li>
        </ul>
        <ul class="nav pull-right">
          <li><a href="/atom.xml">RSS</a></li>
        </ul>
      </div>
    </div>
  </div>

  <div class="container page-container">
    <div class="content">
      
<div class="page-header">
  <h1>《Beginning Linux Programming》读书笔记（二）</h1>
</div>

<div class="row-fluid page-body">
  <div class="span9 left">
    <div class="main-container shadow">
      <div class="mainbody thepost">
        <p>
    &nbsp;<font size="4"><b>3 基本的Shell命令</b></font><br />3.1 Redirecting Output<br />&nbsp;&nbsp;&nbsp; 管道重定向：&gt;<br />&nbsp;&nbsp;&nbsp; 对文件追加：&gt;&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;For<br />
"&gt;", by default, if the file already exists, then it will be<br />
overwritten. If you want to change the default behavior, you can use<br />
the command <i>set -o noclobber</i> (or <i>set -C</i>), which sets the noclobber option to prevent a file from being overwritten using redirection. You can cancel this option using <i>set +o noclobber</i>. <br />&nbsp;&nbsp;&nbsp; For "&gt;&gt;", outputs are appended to the end of the file.</p>
<p>&nbsp;&nbsp;&nbsp;<br />
File descriptor 0 is the standard input to a program, file descriptor 1<br />
is the standard output, and file descriptor 2 is the standard error<br />
output. It’s unusual to want to redirect any other than the standard<br />
ones: 0, 1, and 2.</p>
<p>&nbsp;&nbsp;&nbsp; To redirect the<br />
standard error output, preface the &gt; operator with the number of the<br />
file descriptor you wish to redirect. Because the standard error is on<br />
file descriptor 2, use the 2&gt; operator. This is often useful to<br />
discard error information and prevent it from appearing on the screen.</p>
<p>&nbsp;&nbsp;&nbsp; The command<br />&nbsp;&nbsp;&nbsp;&nbsp; $ kill -HUP 1234 &gt;killout.txt 2&gt;killerr.txt<br />will put the output and error information into separate files.</p>
<p>&nbsp;&nbsp;&nbsp; If you prefer to capture both sets of output into a single file, you can use the <i><span id="mtpf0" style="color:rgb(0,0,255);">&gt;&amp;</span></i> operator to combine the two outputs. Therefore,<br />&nbsp;&nbsp;&nbsp;&nbsp; $ kill -1 1234 &gt;killouterr.txt 2&gt;&amp;1<br />will<br />
put both the output and error outputs into the same file. Notice the<br />
order of the operators. This reads as “redirect standard output to the<br />
file killouterr.txt, and then direct standard error to the same place<br />
as the standard output.” If you get the order wrong, the redirect won’t<br />
work as you expect.</p>
<p>3.2 Redirecting Input<br />&nbsp;&nbsp;&nbsp; &lt;</p>
<p>3.3 Pipes<br />&nbsp;&nbsp;&nbsp; Processes connected by pipes can run simultaneously and are automatically rescheduled as data flows between them.</p>
<p>3.4 <span style="color:rgb(0,0,255);"><i>file</i></span> command<br />&nbsp;&nbsp;&nbsp; The best way to check if a file is a script or not is to use the <i>file</i> command — for example, <i><span id="rbhf0" style="color:rgb(0,0,255);">file first</span></i> or <i>file /bin/bash</i>. </p>
<p>3.5 <span style="color:rgb(0,0,255);"><i>read</i></span> command
<div>&nbsp;&nbsp; &nbsp;You can assign user input to a variable by using the <span style="color:rgb(0,0,255);"><i>read</i></span> command.The read normally&nbsp;completes when the user presses Enter.</div>
<div></div>
<div>3.6 <span style="color:rgb(0,0,255);"><i>which</i></span></div>
<p><span>&nbsp;&nbsp; &nbsp;</span>Check which command is used, e.g. <i>which test</i>.</p>
<p>3.7 <i>touch</i> filename<br /><span>&nbsp;&nbsp;&nbsp; </span>Check whether it exists and create it if it doesn’t.
<div><font size="4">4 Shell Scripts</font></div>
<div>4.1 Quoting</div>
<div>&nbsp;&nbsp;<br />
&nbsp;If you&nbsp;enclose a $ variable expression in double quotes, then it’s<br />
replaced with its value when the line is executed.&nbsp;If you enclose it in<br />
single quotes, then no substitution takes place. You can also remove<br />
the special&nbsp;meaning of the $ symbol by prefacing it with a /.</div>
<div></div>
<div>&nbsp;&nbsp;<br />
&nbsp;Usually, strings are enclosed in double quotes, which protects<br />
variables from being separated by whitespace but allows $ expansion to<br />
take place.</div>
<div></div>
<div>4.2 Environment Variables</div>
<div style="padding:1em 0;text-align:center;" id="tfjq"><img src="http://docs.google.com/File?id=dd6nw3mt_59g32fh2hs_b" style="width:830px;height:522px;" /></div>
<div style="padding:1em 0;text-align:left;" id="tfjq">&nbsp;&nbsp; &nbsp;If you want to check out how the program works in a different environment by running&nbsp;the <span style="color:rgb(0,0,255);"><i>env &lt;command&gt;</i></span>, try looking at the env manual pages.</div>
<p>4.3 Parameter&nbsp;Variables<br />&nbsp;&nbsp;<br />
&nbsp;If<br />
your&nbsp;script&nbsp;is&nbsp;invoked&nbsp;with&nbsp;parameters,&nbsp;some&nbsp;additional&nbsp;variables&nbsp;are&nbsp;created.&nbsp;If&nbsp;no&nbsp;parameters&nbsp;are&nbsp;passed,&nbsp;the&nbsp;environment&nbsp;variable&nbsp;<span style="color:rgb(0,0,255);">$#</span>&nbsp;still&nbsp;exists&nbsp;but&nbsp;has&nbsp;a&nbsp;value&nbsp;of&nbsp;0.
<div style="padding:1em 0;text-align:center;" id="mmzl"><img src="http://docs.google.com/File?id=dd6nw3mt_60d6q52vkg_b" style="width:822px;height:231px;" /></div>
<div>&nbsp;&nbsp;&nbsp;<br />
As&nbsp;you&nbsp;can&nbsp;see,&nbsp;within&nbsp;double&nbsp;quotes,&nbsp;$@&nbsp;expands&nbsp;the&nbsp;positional&nbsp;parameters&nbsp;as&nbsp;separate&nbsp;fields,&nbsp;regardless&nbsp;of&nbsp;the&nbsp;IFS&nbsp;value.&nbsp;In&nbsp;general,&nbsp;if&nbsp;you&nbsp;want&nbsp;access&nbsp;to&nbsp;the&nbsp;parameters,&nbsp;$@&nbsp;is&nbsp;the&nbsp;sensible&nbsp;choice.</p>
</div>
<div>4.4 A Problem With Variables<br />&nbsp;&nbsp;&nbsp; &nbsp;For a script<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; <span style="background-color:rgb(204,204,204);font-family:Courier New;">if [ $timeofday = “yes” ]</span><br />, if just press "Enter",rather than answer anything.When the variable <span style="background-color:rgb(204,204,204);"><span style="font-family:Courier New;">timeofday </span><span style="background-color:rgb(255,255,255);">was tested,</span></span> it consisted of a blank string. Therefore, the <span style="background-color:rgb(204,204,204);">if</span> clause looks like<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; <span style="background-color:rgb(204,204,204);">if [ = “yes” ]</span><br />which isn't a valid condition. To avoid this, you must use quotes around the variable:<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; <span style="background-color:rgb(204,204,204);">if [ “$timeofday” = “yes” ]</span><br />An empty variable then gives the valid test:<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; <span style="background-color:rgb(204,204,204);">if [ “” = “yes” ]</span></p>
<p>&nbsp;&nbsp; &nbsp;<span style="color:rgb(0,0,255);">Remember<br />
that adding the quotes tells the shell to consider everything between<br />
them as a single string. This is one way of getting spaces to be stored<br />
in a variable.</span></p>
<p>4.5 The <span style="color:rgb(0,0,255);"><i>test</i></span> or <span style="color:rgb(0,0,255);"><i>[</i></span> Command</div>
<div>&nbsp;&nbsp; &nbsp;The <span style="color:rgb(0,0,255);"><i>[</i></span> and <span style="color:rgb(0,0,255);"><i>test</i></span> commands are synonymous, except that when the <span style="color:rgb(0,0,255);"><i>[</i></span> command is used, a trailing <span style="color:rgb(0,0,255);"><i>]</i></span> is also used. The <span style="color:rgb(0,0,255);"><i>test</i></span> or <span style="color:rgb(0,0,255);"><i>[</i></span> can be used to check to see whether a file exists.</div>
<div>e.g.&nbsp;&nbsp; &nbsp;<i>test -f &lt;filename&gt; </i>or<i> [ -f &lt;filename&gt; ]</i></div>
<div>&nbsp;&nbsp; &nbsp;(<span style="color:rgb(255,0,0);">Note: You must put spaces between the [ braces and the condition being checked.</span>)</div>
<div></div>
<div>&nbsp;&nbsp; &nbsp;Conditions that you can use <span style="color:rgb(0,0,255);"><i>test</i></span> command are:</div>
<div style="padding:1em 0;text-align:center;" id="p1.x"><img src="http://docs.google.com/File?id=dd6nw3mt_61fhn45rcs_b" style="width:546px;height:645px;" /></div>
<div>4.6 Control Structures</div>
<div>(1)<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<span style="font-family:Courier New;">if</span> <i>condition</i><br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<span style="font-family:Courier New;">then</span><br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<i>statements</i><br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; <span style="font-family:Courier New;">elif</span> <i>condition</i><span style="font-family:Courier New;">; then</span> <br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<span style="font-family:Courier New;">else</span><br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<i>statements</i><br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<span style="font-family:Courier New;">fi</p>
<p></span>(2)</div>
<p>&nbsp;&nbsp;&nbsp; <span style="font-family:Courier New;">for</span> <i><span style="font-family:Arial;">variable</span></i> <span style="font-family:Courier New;">in</span> <i>values</i><br />&nbsp;&nbsp; &nbsp;<span style="font-family:Courier New;">do</span><br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<i>statements</i><br />&nbsp;&nbsp; &nbsp;<span style="font-family:Courier New;">done</span></p>
<p>Note: <br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<span style="background-color:rgb(204,204,204);">for file in $(ls f*.sh); do</span><br />In this example,&nbsp; the parameter list for the for command is provided by the output of the command enclosed in the $() sequence.</p>
<p>(3) <br />&nbsp;&nbsp; &nbsp;<span style="font-family:Courier New;">while</span> <i>condition</i> <span style="font-family:Courier New;">do</span><br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<i>statements</i><br />&nbsp;&nbsp; &nbsp;<span style="font-family:Courier New;">done</span></p>
<p>(4) <br />&nbsp;&nbsp; &nbsp;<span style="font-family:Courier New;">until </span><i>condition</i><br />&nbsp;&nbsp; &nbsp;<span style="font-family:Courier New;">do</span><br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<i>statements</i><br />&nbsp;&nbsp; &nbsp;<span style="font-family:Courier New;">done</span></p>
<p><font size="3"><span style="background-color:rgb(255,229,153);font-family:Arial;">Note:&nbsp;&nbsp;&nbsp; In general, if a loop should always execute at least once, use a <span style="font-family:Courier New;">while</span> loop; if it may not need to execute at all, use an <span style="font-family:Courier New;">until</span> loop.</span></font></p>
<p>(5)</p>
<p>&nbsp;&nbsp; &nbsp;case variable in<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;pattern [ | pattern] ...) statements;;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;pattern [ | pattern] ...) statements;;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;...<br />&nbsp;&nbsp; &nbsp;esac</p>
<p>&nbsp;&nbsp;&nbsp; <span style="background-color:rgb(255,229,153);">Note:<br /><span></span></span>
<ul>
<li><span style="background-color:rgb(255,229,153);"><span><span>&nbsp;&nbsp;&nbsp; </span>Notice<br />
that each pattern line is terminated with double semicolons (;;). You<br />
can put multiple statements between each pattern and the next, so a<br />
double semicolon is needed to mark where one statement ends and the<br />
next pattern begins.</span></span></li>
</ul>
<p><span style="background-color:rgb(255,229,153);"><br /><span> </span></span>
<ul>
<li><span style="background-color:rgb(255,229,153);"><span><span>&nbsp;&nbsp; &nbsp;</span></span>Be<br />
careful with the case construct if you are using wildcards such as ‘*‘<br />
in the pattern. The problem is that the first matching pattern will be<br />
taken, even if a later pattern matches more exactly.</span></li>
</ul>
<p>(6) Lists
<ul>
<li><span>&nbsp;&nbsp;&nbsp; </span><b>AND</b><br />
List: The AND list construct enables you to execute a series of<br />
commands, executing the next command only if all the previous commands<br />
have succeeded. The syntax is<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="background-color:rgb(204,204,204);">statement1 &amp;&amp; statement2 &amp;&amp; statement3 &amp;&amp; ...</span></li>
</ul>
<ul>
<li><span>&nbsp;&nbsp;&nbsp; </span><b>OR</b><br />
List: The OR list construct enables us to execute a series of commands<br />
until one succeeds, and then not execute any more. The syntax is as<br />
follows:<br />&nbsp;&nbsp;&nbsp; <span style="background-color:rgb(204,204,204);">statement1 || statement2 || statement3 || ...</span></p>
</li>
</ul>
<p>(7) Statement Blocks<br />
<span>&nbsp;&nbsp; &nbsp;</span>If you want to use multiple statements in a place<br />
where only one is allowed, such as in an AND or OR list, you can do so<br />
by enclosing them in braces {} to make a statement block.</p>
<p>(8) Shell Function<br />
<span>&nbsp;&nbsp;&nbsp; </span><span style="background-color:rgb(204,204,204);">function_name () {</span><br style="background-color:rgb(204,204,204);" /><br />
<span style="background-color:rgb(204,204,204);">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;statements</span><br style="background-color:rgb(204,204,204);" /><br />
<span style="background-color:rgb(204,204,204);">&nbsp;&nbsp; &nbsp;}</span></p>

      </div>
    </div>

    <div class="main-container shadow">
      <div class="mainbody">
        <div class="bshare-custom">
	<span class='st_facebook_large' displayText='Facebook'></span>
	<span class='st_googleplus_large' displayText='Google +'></span>
	<span class='st_twitter_large' displayText='Tweet'></span>
	<span class='st_sina_large' displayText='Sina'></span>
	<span class='st_linkedin_large' displayText='LinkedIn'></span>
	<span class='st_tumblr_large' displayText='Tumblr'></span>
	<span class='st_sharethis_large' displayText='ShareThis'></span>
	<span class='st_blogger_large' displayText='Blogger'></span>
	<span class='st_email_large' displayText='Email'></span>
</div>
<script type="text/javascript">var switchTo5x=true;</script>
<script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
<script type="text/javascript">stLight.options({publisher: "6e9cb968-ad78-4055-b1e7-1b7ab6751416", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>

        
        <div class="post-end">
</div>


        <div class="pagination">
          <ul>
          
            <li class="prev"><a href="/2008/09/11/%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520%25e3%2580%258alinux%25e7%25a8%258b%25e5%25ba%258f%25e8%25ae%25be%25e8%25ae%25a1%25e3%2580%258b%25e8%25af%25bb%25e4%25b9%25a6%25e7%25ac%2594%25e8%25ae%25b0%25ef%25bc%2588%25e4%25b8%2580%25ef%25bc%2589%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520" title="《Linux程序设计》读书笔记（一）">&larr; Previous</a></li>
          
            <li><a href="/archive.html">Archive</a></li>
          
            <li class="next"><a href="/2008/09/15/%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520fedora%25209%25e4%25b8%25adfirefox%25e5%2590%25af%25e5%258a%25a8%25e5%2590%258e%25e8%25bf%259b%25e5%2585%25a5www-s-com%25e7%259a%2584%25e8%25a7%25a3%25e5%2586%25b3%25e6%2596%25b9%25e6%25b3%2595%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520" title="Fedora 9中Firefox启动后进入www.s.com的解决方法">Next &rarr;</a></li>
          
          </ul>
        </div>
      </div>
    </div>

    <div class="main-container shadow">
      <div class="mainbody">
		


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'boyang'; // required: replace example with your forum shortname
     var disqus_identifier = '/2008/09/14/%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520%25e3%2580%258abeginning%2520linux%2520programming%25e3%2580%258b%25e8%25af%25bb%25e4%25b9%25a6%25e7%25ac%2594%25e8%25ae%25b0%25ef%25bc%2588%25e4%25ba%258c%25ef%25bc%2589%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520';
    var disqus_url = 'http://bo-yang.github.io//2008/09/14/%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520%25e3%2580%258abeginning%2520linux%2520programming%25e3%2580%258b%25e8%25af%25bb%25e4%25b9%25a6%25e7%25ac%2594%25e8%25ae%25b0%25ef%25bc%2588%25e4%25ba%258c%25ef%25bc%2589%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




	  </div>
    </div>

  </div>

  <div class="span3 right">
    <div class="side-container shadow">
      <div class="sidebar">
        <h4>Published</h4>
        <div class="date"><span>2008-09-14</span></div>
      </div>
    </div>

    <div class="side-container shadow">
      <div class="sidebar">
        
          <h4>Tags</h4>
          <ul class="tag_box">
          
          


  
     
    	<li><a href="/tags.html#Unix/Linux-ref">Unix/Linux <span>86</span></a></li>
    
  



          </ul>
        
      </div>
    </div>

    <div class="side-container shadow">
		<div class="sidebar">
			<!--
			<script type="text/javascript" id="wumiiRelatedItems"></script>
			-->
		  <script type="text/javascript">
	var linkwithin_site_id = 2140443;
    var lwPermaLink = "http://bo-yang.github.io//2008/09/14/%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520%25e3%2580%258abeginning%2520linux%2520programming%25e3%2580%258b%25e8%25af%25bb%25e4%25b9%25a6%25e7%25ac%2594%25e8%25ae%25b0%25ef%25bc%2588%25e4%25ba%258c%25ef%25bc%2589%250d%250a%2520%2520%2520%2520%2520%2520%2520%2520";
    var lwTitle = "《Beginning Linux Programming》读书笔记（二）";
    var lwTags = "";
    var lwCategories = [];
    var lwSitePrefix = "http://bo-yang.github.io/";
    var lwParams = "&num=5&mode=3&pf=JAVASCRIPT";
</script>
<script src="http://www.linkwithin.com/widget.js"></script>
<a href="http://www.linkwithin.com/"><img src="http://www.linkwithin.com/pixel.png" alt="Related Posts Plugin for WordPress, Blogger..." style="border: 0" /></a>


      </div>
    </div>

  </div>
</div>




    </div>

    <footer>
        <p>&copy; 2007 <span id="now_year"></span> boyang. </p>
        <script type="text/javascript">
          var now_year = new Date().getFullYear();
          if (now_year != 2007) {
              $('#now_year').html('- ' + now_year);
          }
        </script>
      </footer>
  </div>

  <!-- Comment out Sina Weibo
  <script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
  -->
  <script type="text/javascript" src="/assets/themes/clear/google-code-prettify/prettify.js"></script>
  <script type="text/javascript">
    $(function() {

      $('a[href^="http"]').each(function () {
        $(this).attr('target', '_blank');
      });

      $('pre').addClass('prettyprint linenums').attr('style', 'overflow:auto');
      window.prettyPrint && prettyPrint();

      function traverse($node, len, maxCount) {
        var reachMaxCount = len > maxCount;
        if (reachMaxCount) {
          $node.hide();
        }
        var $contents = $node.contents();
        for (var i = 0; i < $contents.length; ++i) {
          if (reachMaxCount) {
            $contents.eq(i).hide();
            continue;
          }
          if ($contents[i].nodeType == 3) { // TextNode
            var tmp = len;
            var s = $contents[i].nodeValue;
            len += s.length;
            reachMaxCount = len > maxCount;
            if (reachMaxCount && $contents[i].parentNode.nodeName != 'A') {
              $contents[i].nodeValue = s.substring(0, maxCount - tmp);
            }
          }
          else if ($contents[i].nodeType == 1) { // Element
            len = traverse($contents.eq(i), len, maxCount);
          }
        }
        return len;
      }

      $('.post_at_index').each(function() {
        var count = traverse($(this), 0, 200);
        if (count > 200) {
          var thisUrl = $(this).siblings().first().children().attr('href');
          $(this).after('\n<a href="' + thisUrl + '" rel="nofollow">' + 'Read More ...</a>');
        }
      });
    });
  </script>
  
</body>
</html>

