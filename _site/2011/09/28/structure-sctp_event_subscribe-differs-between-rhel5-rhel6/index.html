
<!DOCTYPE HTML>
<html lang="en-US" xmlns="http://www.w3.org/1999/xhtml" xmlns:wb="http://open.weibo.com/wb">
<head>
  <title>Struct sctp_event_subscribe Differs Between RHEL5 and RHEL6 | Bo's Blog</title>
  
  <meta name="author" content="Bo Yang" />
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <!--
  <link href="http://libs.baidu.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet">
  -->
   <link href="/assets/themes/clear/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Google Prettify -->
  <link href="/assets/themes/clear/google-code-prettify/desert.css" rel="stylesheet" type="text/css" media="all">
  <!-- Google Pretty end -->

  <link href="/assets/themes/clear/css/style.css" rel="stylesheet" type="text/css" media="all" />
  <!-- using baidu cdn instead
  <script src="http://libs.baidu.com/jquery/1.9.0/jquery.min.js"></script>
  -->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script type='text/javascript' src='http://www.mathjax.org/wp-content/plugins/syntax-highlighter-mt/scripts/shCore.js?ver=2.2.4'></script>
  <script type='text/javascript' src='http://www.mathjax.org/wp-content/plugins/syntax-highlighter-mt/scripts/shAutoloader.js?ver=2.2.4'></script>
  <script type="text/x-mathjax-config">
  	MathJax.Hub.Config({
    	tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]}
  	});
  </script>
  <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>

<body>

  <div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container">
        <a class="brand" href="/">bo-yang</a>
        <ul class="nav">
          <li><a href="/archive.html">Archive</a></li>
          <li><a href="/about.html">About</a></li>
          <li><a href="/messages.html">Messages</a></li>
        </ul>
        <ul class="pull-right">
          <li>
            <form class="navbar-search" method="get" action="http://www.google.com/search" target="google_window">
              <input id="g_search" type="text" class="search-query" placeholder="Search..." name="q" />
              <input type="submit" name="btnG" style="display:none" id="searchsubmit" value="Search" />
              <input type="hidden" name="ie" value="UTF-8" />
              <input type="hidden" name="oe" value="UTF-8" />
              <input type="hidden" name="hl" value="en-US" />
              <input type="hidden" name="domains" value="http://bo-yang.github.io/" />
              <input type="hidden" name="sitesearch" value="http://bo-yang.github.io/" />
            </form>
          </li>
        </ul>
        <ul class="nav pull-right">
          <li><a href="/atom.xml">RSS</a></li>
        </ul>
      </div>
    </div>
  </div>

  <div class="container page-container">
    <div class="content">
      
<div class="page-header">
	<h1>Struct sctp_event_subscribe Differs Between RHEL5 and RHEL6</h1>
</div>

<div class="row-fluid page-body">
  <div class="span11 left">
    <div class="main-container shadow">
	  <div class="mainbody thepost">
        <p>Recently meet an SCTP issue: one product application running on MontaVista(kernel version 2.6.21) can't run on RedHat Enterprise Linux 5.5. After hours investion between millions lines  of  log file and source code, I finally noticed following error showed up:<br />
[sourcecode language="text"]<br />
^?0 2011-08-16 09:11:57.316267 coolnjmcl018 AMMServ 26555[26566]<br />
 ../com/AMMSSctpLib.cc,369 [EAMMS1315] AMMSSctpLib::ammsSetSockOpt()<br />
 setsockopt - Invalid argument<br />
^?1 2011-08-16 09:11:57.316326 coolnjmcl018 AMMServ 26555[26566]<br />
../com/AMMSAccessServer.cc,779 [EAMMS1036] AMMSAccessServer::setSocketOpts():<br />
 failed to set SCTP_EVENTS for socket 6<br />
[/sourcecode]<br />
C function ammsSetSockOpt() was a function used in that product application, which eventually calls Linux system API setsockopt().</p>
<p>The product developers told me that they updated libsctp.so shared library in MV, so I copied that library directly to RHEL5.5(usually this way will work). However, that shared library didn't work this time.</p>
<p>Then I noticed that the kernel of RHEL5.5 was 2.6.18-194.el5, which means Linux kernel 2.6.18 was used. I also found some webpages about RHEL kernel, and all of them claimed that Red Hat would backport new-developed Linux kernel(community) features to RHEL5 kernels, which means that the older kernel version of RHEL may also contains some features in higher Linux kernel.  Since SCTP codes were largely changed in 2.6.21, I decided to upgrade RHEL kernel to 2.6.18-238.9.1.el5(the default version in RHEL5.7).</p>
<p>After 4.5 hours compiling and installing, RHEL kernel upgraded to the latest one. Unfortunately, the SCTP issue still existed.</p>
<p>I wen to back to reading source code, and tried to change the last parameter of setsockopt() from sizeof(events) to 8, and it worked!  Where, events is defined as<br />
[sourcecode language="cpp"]struct sctp_event_subscribe events;[/sourcecode]<br />
Then I began to check the definition of struct sctp_event_subscribe in both RHEL5.5 and RHEL6.0 - they were different:</p>
<p>In <a href="http://rhkernel.org/RHEL6+2.6.32-71.18.2.el6/include/net/sctp/user.h#L406">RHEL 6</a>,</p>
<pre><a id="L402" name="L402" href="http://rhkernel.org/RHEL6+2.6.32-71.18.2.el6/include/net/sctp/user.h#L402"></a> 402/*
<a id="L403" name="L403" href="http://rhkernel.org/RHEL6+2.6.32-71.18.2.el6/include/net/sctp/user.h#L403"></a> 403 * Described in Section 7.3
<a id="L404" name="L404" href="http://rhkernel.org/RHEL6+2.6.32-71.18.2.el6/include/net/sctp/user.h#L404"></a> 404 *   Ancillary Data and Notification Interest Options
<a id="L405" name="L405" href="http://rhkernel.org/RHEL6+2.6.32-71.18.2.el6/include/net/sctp/user.h#L405"></a> 405 */
<a id="L406" name="L406" href="http://rhkernel.org/RHEL6+2.6.32-71.18.2.el6/include/net/sctp/user.h#L406"></a> 406struct <a href="http://rhkernel.org/RHEL6+2.6.32-71.18.2.el6/+code=sctp_event_subscribe">sctp_event_subscribe</a> {
<a id="L407" name="L407" href="http://rhkernel.org/RHEL6+2.6.32-71.18.2.el6/include/net/sctp/user.h#L407"></a> 407        <a href="http://rhkernel.org/RHEL6+2.6.32-71.18.2.el6/+code=__u8">__u8</a> <a href="http://rhkernel.org/RHEL6+2.6.32-71.18.2.el6/+code=sctp_data_io_event">sctp_data_io_event</a>;
<a id="L408" name="L408" href="http://rhkernel.org/RHEL6+2.6.32-71.18.2.el6/include/net/sctp/user.h#L408"></a> 408        <a href="http://rhkernel.org/RHEL6+2.6.32-71.18.2.el6/+code=__u8">__u8</a> <a href="http://rhkernel.org/RHEL6+2.6.32-71.18.2.el6/+code=sctp_association_event">sctp_association_event</a>;
<a id="L409" name="L409" href="http://rhkernel.org/RHEL6+2.6.32-71.18.2.el6/include/net/sctp/user.h#L409"></a> 409        <a href="http://rhkernel.org/RHEL6+2.6.32-71.18.2.el6/+code=__u8">__u8</a> <a href="http://rhkernel.org/RHEL6+2.6.32-71.18.2.el6/+code=sctp_address_event">sctp_address_event</a>;
<a id="L410" name="L410" href="http://rhkernel.org/RHEL6+2.6.32-71.18.2.el6/include/net/sctp/user.h#L410"></a> 410        <a href="http://rhkernel.org/RHEL6+2.6.32-71.18.2.el6/+code=__u8">__u8</a> <a href="http://rhkernel.org/RHEL6+2.6.32-71.18.2.el6/+code=sctp_send_failure_event">sctp_send_failure_event</a>;
<a id="L411" name="L411" href="http://rhkernel.org/RHEL6+2.6.32-71.18.2.el6/include/net/sctp/user.h#L411"></a> 411        <a href="http://rhkernel.org/RHEL6+2.6.32-71.18.2.el6/+code=__u8">__u8</a> <a href="http://rhkernel.org/RHEL6+2.6.32-71.18.2.el6/+code=sctp_peer_error_event">sctp_peer_error_event</a>;
<a id="L412" name="L412" href="http://rhkernel.org/RHEL6+2.6.32-71.18.2.el6/include/net/sctp/user.h#L412"></a> 412        <a href="http://rhkernel.org/RHEL6+2.6.32-71.18.2.el6/+code=__u8">__u8</a> <a href="http://rhkernel.org/RHEL6+2.6.32-71.18.2.el6/+code=sctp_shutdown_event">sctp_shutdown_event</a>;
<a id="L413" name="L413" href="http://rhkernel.org/RHEL6+2.6.32-71.18.2.el6/include/net/sctp/user.h#L413"></a> 413        <a href="http://rhkernel.org/RHEL6+2.6.32-71.18.2.el6/+code=__u8">__u8</a> <a href="http://rhkernel.org/RHEL6+2.6.32-71.18.2.el6/+code=sctp_partial_delivery_event">sctp_partial_delivery_event</a>;
<a id="L414" name="L414" href="http://rhkernel.org/RHEL6+2.6.32-71.18.2.el6/include/net/sctp/user.h#L414"></a> 414        <a href="http://rhkernel.org/RHEL6+2.6.32-71.18.2.el6/+code=__u8">__u8</a> <a href="http://rhkernel.org/RHEL6+2.6.32-71.18.2.el6/+code=sctp_adaptation_layer_event">sctp_adaptation_layer_event</a>;
<a id="L415" name="L415" href="http://rhkernel.org/RHEL6+2.6.32-71.18.2.el6/include/net/sctp/user.h#L415"></a> 415        <a href="http://rhkernel.org/RHEL6+2.6.32-71.18.2.el6/+code=__u8">__u8</a> <a href="http://rhkernel.org/RHEL6+2.6.32-71.18.2.el6/+code=sctp_authentication_event">sctp_authentication_event</a>;
<a id="L416" name="L416" href="http://rhkernel.org/RHEL6+2.6.32-71.18.2.el6/include/net/sctp/user.h#L416"></a> 416};</pre>
<p>While in <a href="http://rhkernel.org/RHEL5+2.6.18-194.el5/include/net/sctp/user.h#L367">RHEL5</a>,</p>
<pre><a id="L363" name="L363" href="http://rhkernel.org/RHEL5+2.6.18-194.el5/include/net/sctp/user.h#L363"></a> 363/*
<a id="L364" name="L364" href="http://rhkernel.org/RHEL5+2.6.18-194.el5/include/net/sctp/user.h#L364"></a> 364 * Described in Section 7.3
<a id="L365" name="L365" href="http://rhkernel.org/RHEL5+2.6.18-194.el5/include/net/sctp/user.h#L365"></a> 365 *   Ancillary Data and Notification Interest Options
<a id="L366" name="L366" href="http://rhkernel.org/RHEL5+2.6.18-194.el5/include/net/sctp/user.h#L366"></a> 366 */
<a id="L367" name="L367" href="http://rhkernel.org/RHEL5+2.6.18-194.el5/include/net/sctp/user.h#L367"></a> 367struct <a href="http://rhkernel.org/RHEL5+2.6.18-194.el5/+code=sctp_event_subscribe">sctp_event_subscribe</a> {
<a id="L368" name="L368" href="http://rhkernel.org/RHEL5+2.6.18-194.el5/include/net/sctp/user.h#L368"></a> 368        <a href="http://rhkernel.org/RHEL5+2.6.18-194.el5/+code=__u8">__u8</a> <a href="http://rhkernel.org/RHEL5+2.6.18-194.el5/+code=sctp_data_io_event">sctp_data_io_event</a>;
<a id="L369" name="L369" href="http://rhkernel.org/RHEL5+2.6.18-194.el5/include/net/sctp/user.h#L369"></a> 369        <a href="http://rhkernel.org/RHEL5+2.6.18-194.el5/+code=__u8">__u8</a> <a href="http://rhkernel.org/RHEL5+2.6.18-194.el5/+code=sctp_association_event">sctp_association_event</a>;
<a id="L370" name="L370" href="http://rhkernel.org/RHEL5+2.6.18-194.el5/include/net/sctp/user.h#L370"></a> 370        <a href="http://rhkernel.org/RHEL5+2.6.18-194.el5/+code=__u8">__u8</a> <a href="http://rhkernel.org/RHEL5+2.6.18-194.el5/+code=sctp_address_event">sctp_address_event</a>;
<a id="L371" name="L371" href="http://rhkernel.org/RHEL5+2.6.18-194.el5/include/net/sctp/user.h#L371"></a> 371        <a href="http://rhkernel.org/RHEL5+2.6.18-194.el5/+code=__u8">__u8</a> <a href="http://rhkernel.org/RHEL5+2.6.18-194.el5/+code=sctp_send_failure_event">sctp_send_failure_event</a>;
<a id="L372" name="L372" href="http://rhkernel.org/RHEL5+2.6.18-194.el5/include/net/sctp/user.h#L372"></a> 372        <a href="http://rhkernel.org/RHEL5+2.6.18-194.el5/+code=__u8">__u8</a> <a href="http://rhkernel.org/RHEL5+2.6.18-194.el5/+code=sctp_peer_error_event">sctp_peer_error_event</a>;
<a id="L373" name="L373" href="http://rhkernel.org/RHEL5+2.6.18-194.el5/include/net/sctp/user.h#L373"></a> 373        <a href="http://rhkernel.org/RHEL5+2.6.18-194.el5/+code=__u8">__u8</a> <a href="http://rhkernel.org/RHEL5+2.6.18-194.el5/+code=sctp_shutdown_event">sctp_shutdown_event</a>;
<a id="L374" name="L374" href="http://rhkernel.org/RHEL5+2.6.18-194.el5/include/net/sctp/user.h#L374"></a> 374        <a href="http://rhkernel.org/RHEL5+2.6.18-194.el5/+code=__u8">__u8</a> <a href="http://rhkernel.org/RHEL5+2.6.18-194.el5/+code=sctp_partial_delivery_event">sctp_partial_delivery_event</a>;
<a id="L375" name="L375" href="http://rhkernel.org/RHEL5+2.6.18-194.el5/include/net/sctp/user.h#L375"></a> 375        <a href="http://rhkernel.org/RHEL5+2.6.18-194.el5/+code=__u8">__u8</a> <a href="http://rhkernel.org/RHEL5+2.6.18-194.el5/+code=sctp_adaption_layer_event">sctp_adaption_layer_event</a>;
<a id="L376" name="L376" href="http://rhkernel.org/RHEL5+2.6.18-194.el5/include/net/sctp/user.h#L376"></a> 376};</pre>
<p id="b9/7a/901cb22644e92e629902da22bf3d62baf0cc_3/0">It seems upgrading RHEL5.5 to RHEL6 is the final choice!</p>

      </div>
    </div>

    <div class="main-container shadow">
      <div class="mainbody">
        <div class="bshare-custom">
	<span class='st_facebook_large' displayText='Facebook'></span>
	<span class='st_googleplus_large' displayText='Google +'></span>
	<span class='st_twitter_large' displayText='Tweet'></span>
	<span class='st_sina_large' displayText='Sina'></span>
	<span class='st_linkedin_large' displayText='LinkedIn'></span>
	<span class='st_tumblr_large' displayText='Tumblr'></span>
	<span class='st_sharethis_large' displayText='ShareThis'></span>
	<span class='st_blogger_large' displayText='Blogger'></span>
	<span class='st_email_large' displayText='Email'></span>
</div>
<script type="text/javascript">var switchTo5x=true;</script>
<script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
<script type="text/javascript">stLight.options({publisher: "6e9cb968-ad78-4055-b1e7-1b7ab6751416", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>

        
        <div class="post-end">
</div>


        <div class="pagination">
          <ul>
          
            <li class="prev"><a href="/2011/09/21/dot-flag-in-rhel" title="Dot(.) after the file permission flags in Redhat">&larr; Previous</a></li>
          
            <li><a href="/archive.html">Archive</a></li>
          
            <li class="next"><a href="/2011/10/09/in-memory-of-steve-jobs" title="帮主远行，智慧永生">Next &rarr;</a></li>
          
          </ul>
        </div>
      </div>
    </div>

    <div class="main-container shadow">
      <div class="mainbody">
		


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'boyang'; // required: replace example with your forum shortname
     var disqus_identifier = '/2011/09/28/structure-sctp_event_subscribe-differs-between-rhel5-rhel6';
    var disqus_url = 'http://bo-yang.github.com//2011/09/28/structure-sctp_event_subscribe-differs-between-rhel5-rhel6';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




	  </div>
    </div>

  </div>

  <div class="span3 right">
    <div class="side-container shadow">
      <div class="sidebar">
        <h4>Published</h4>
        <div class="date"><span>2011-09-28</span></div>
      </div>
    </div>

    <div class="side-container shadow">
      <div class="sidebar">
        
          <h4>Tags</h4>
          <ul class="tag_box">
          
          


  
     
    	<li><a href="/tags.html#Unix/Linux-ref">Unix/Linux <span>93</span></a></li>
     
    	<li><a href="/tags.html#RHEL6.1-ref">RHEL6.1 <span>2</span></a></li>
    
  



          </ul>
        
      </div>
    </div>

	
    <div class="side-container shadow">
		<div class="sidebar">
			<!--
			<script>
var linkwithin_site_id = 2140443;
</script>
<script src="http://www.linkwithin.com/widget.js"></script>
<a href="http://www.linkwithin.com/"><img src="http://www.linkwithin.com/pixel.png" alt="Related Posts Plugin for WordPress, Blogger..." style="border: 0" /></a>

			-->
			<h4>Related Posts</h4>
			
  				<li><a href="/2014/06/20/coin-change">Coin Change Problem</a></li>
			
  				<li><a href="/2014/06/18/text-justification">Text Justification</a></li>
			
  				<li><a href="/2014/06/17/sort-colors">Sort Colors</a></li>
			
  				<li><a href="/2014/06/14/soduku">Check Soduku Solution</a></li>
			
  				<li><a href="/2014/06/12/lru-cache">Least Recently Used(LRU) Cache</a></li>
			
  				<li><a href="/2014/05/26/binary-tree-traversal">Binary Tree Operations</a></li>
			
      </div>
  </div>
  	

  	<div class="side-container shadow">
		<div class="sidebar">
			<h4>Recent Posts</h4>
			
  				<li><a href="/2014/06/20/coin-change">Coin Change Problem</a></li>
  			
  				<li><a href="/2014/06/18/text-justification">Text Justification</a></li>
  			
  				<li><a href="/2014/06/17/sort-colors">Sort Colors</a></li>
  			
  				<li><a href="/2014/06/14/soduku">Check Soduku Solution</a></li>
  			
  				<li><a href="/2014/06/12/lru-cache">Least Recently Used(LRU) Cache</a></li>
  			
  				<li><a href="/2014/05/26/binary-tree-traversal">Binary Tree Operations</a></li>
  			
  				<li><a href="/2014/04/30/fisher-vector-in-action-recognition">Action Recognition with Fisher Vectors</a></li>
  			
  				<li><a href="/2014/03/29/how-to-install-jekyll-in-mac-osx-mavericks">How To Install Jekyll in Mac OSX Mavericks</a></li>
  			
  				<li><a href="/2014/03/26/c-code-to-print-pascal-triangle">C++ Code to Print Pascal Triangle</a></li>
  			
  				<li><a href="/2014/01/22/baci-simple-install-and-compile-guide">BACI Simple Install and Compile Guide</a></li>
  			
      </div>
    </div>


  </div>
</div>




    </div>

    <footer>
        <p>&copy; 2007 <span id="now_year"></span> Bo Yang. </p>
        <script type="text/javascript">
          var now_year = new Date().getFullYear();
          if (now_year != 2007) {
              $('#now_year').html('- ' + now_year);
          }
	    </script>
        <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      </footer>
  </div>

  <script type="text/javascript" src="/assets/themes/clear/google-code-prettify/prettify.js"></script>
  <script type="text/javascript">
    $(function() {

      $('a[href^="http"]').each(function () {
        $(this).attr('target', '_blank');
      });

      $('pre').addClass('prettyprint linenums').attr('style', 'overflow:auto');
      window.prettyPrint && prettyPrint();

      function traverse($node, len, maxCount) {
        var reachMaxCount = len > maxCount;
        if (reachMaxCount) {
          $node.hide();
        }
        var $contents = $node.contents();
        for (var i = 0; i < $contents.length; ++i) {
          if (reachMaxCount) {
            $contents.eq(i).hide();
            continue;
          }
          if ($contents[i].nodeType == 3) { // TextNode
            var tmp = len;
            var s = $contents[i].nodeValue;
            len += s.length;
            reachMaxCount = len > maxCount;
            if (reachMaxCount && $contents[i].parentNode.nodeName != 'A') {
              $contents[i].nodeValue = s.substring(0, maxCount - tmp);
            }
          }
          else if ($contents[i].nodeType == 1) { // Element
            len = traverse($contents.eq(i), len, maxCount);
          }
        }
        return len;
      }

      $('.post_at_index').each(function() {
        var count = traverse($(this), 0, 400);
        if (count > 400) {
          var thisUrl = $(this).siblings().first().children().attr('href');
          $(this).after('\n<a href="' + thisUrl + '" rel="nofollow">' + 'Read More ...</a>');
        }
      });
    });
  </script>
  

</body>
</html>

