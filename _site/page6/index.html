
<!DOCTYPE HTML>
<html lang="en-US" xmlns="http://www.w3.org/1999/xhtml" xmlns:wb="http://open.weibo.com/wb">
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<head>
  <title>Bo Yang | Bo's Blog</title>
  
  <meta name="author" content="Bo Yang" />
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <!--
  <link href="http://libs.baidu.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet">
  -->
   <link href="/assets/themes/clear/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Google Prettify -->
  <link href="/assets/themes/clear/google-code-prettify/desert.css" rel="stylesheet" type="text/css" media="all">
  <!-- Google Pretty end -->

  <link href="/assets/themes/clear/css/style.css" rel="stylesheet" type="text/css" media="all" />
  <!-- using baidu cdn instead
  <script src="http://libs.baidu.com/jquery/1.9.0/jquery.min.js"></script>
  -->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>

<body>

  <div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container">
        <a class="brand" href="/">bo-yang</a>
        <ul class="nav">
          <li><a href="/archive.html">Archive</a></li>
          <li><a href="/about.html">About</a></li>
          <li><a href="/messages.html">Messages</a></li>
        </ul>
        <ul class="pull-right">
          <li>
            <form class="navbar-search" method="get" action="http://www.google.com/search" target="google_window">
              <input id="g_search" type="text" class="search-query" placeholder="Search..." name="q" />
              <input type="submit" name="btnG" style="display:none" id="searchsubmit" value="Search" />
              <input type="hidden" name="ie" value="UTF-8" />
              <input type="hidden" name="oe" value="UTF-8" />
              <input type="hidden" name="hl" value="en-US" />
              <input type="hidden" name="domains" value="http://bo-yang.github.io/" />
              <input type="hidden" name="sitesearch" value="http://bo-yang.github.io/" />
            </form>
          </li>
        </ul>
        <ul class="nav pull-right">
          <li><a href="/atom.xml">RSS</a></li>
        </ul>
      </div>
    </div>
  </div>

  <div class="container page-container">
    <div class="content">
      
<div class="page-header">
  <h1>Bo Yang  <small>Beginner's mind.</small></h1>
</div>

<div class="row-fluid page-body">
  <div class="span12">
    

<div class="row-fluid page-body">

  <div class="span11 left">
    
    <div class="main-container shadow">
      <div class="mainbody">
        <h2><a href="/2011/08/24/sctp_event_subscribe-in-RHEL">RHEL5和RHEL6中的sctp_event_subscribe定义大不同</a></h2>
        <p>
          Posted by <strong>Bo Yang</strong> at <strong>2011-08-24</strong> with tags <a href="/tags.html#C-ref" rel="nofollow">C</a>, <a href="/tags.html#Unix/Linux-ref" rel="nofollow">Unix/Linux</a>
        </p>
        
        <div class="post_at_index thepost">
        </p>
<p>近来碰到一个关于SCTP的问题：某个产品跑在Monta Vista上，其内核版本号为2.6.21；可每次该产品泡在我们的Red Hat Enterprise Linux 5.5上时，都会报错错误信息如下：
<pre>^?0 2011-08-16 09:11:57.316267 coolnjmcl018 AMMServ 26555[26566] ../com/AMMSSctpLib.cc,369 [EAMMS1315] AMMSSctpLib::ammsSetSockOpt() setsockopt - Invalid argument
^?1 2011-08-16 09:11:57.316326 coolnjmcl018 AMMServ 26555[26566] ../com/AMMSAccessServer.cc,779 [EAMMS1036] AMMSAccessServer::setSocketOpts(): failed to set SCTP_EVENTS for socket 6</pre></p>
<p>ammsSetSockOpt()调用了Linux API setsockopt()。产品的同事告诉我们他们升级过libsctp.so，于是我们copy了MV中的这个shared lib到RHEL中，问题依旧。后来我们以为是RHEL5.5的内核和Monta Vista的内核不一致，于是我把RHEL的内核从2.6.18-194.el5升级到2.6.18-238.9.1.el5，问题还在。当我们还在考虑要不要把我们的server替换为Monta Vista时，一位同事受<a href="http://centos.org/modules/newbb/viewtopic.php?viewmode=threaded&amp;order=ASC&amp;topic_id=18994&amp;forum=37&amp;move=next&amp;topic_time=1236769500">http://centos.org/modules/newbb/viewtopic.php?viewmode=threaded&amp;order=ASC&amp;topic_id=18994&amp;forum=37&amp;move=next&amp;topic_time=1236769500</a><br />
 的启发，把setsockopt()最后一个参数由sizeof(events)改为8，竟然成功了！ events定义如下。
<pre>struct sctp_event_subscribe events; </pre></p>
<pre></pre>
<p>最终，发现RHEL5和RHEL6中struct<span style="font-family:'Times New Roman';font-size:13px;">&nbsp;</span><span style="font-family:monospace;white-space:pre;background-color:rgb(240,240,240);">sctp_event_subscribe</span>的定义竟然完全不同！要想根本解决上面的问题，只能升级操作系统到RHEL6了。</p></p>
<p>RHEL5中的定义：<a href="http://rhkernel.org/RHEL5+2.6.18-194.el5/include/net/sctp/user.h#L367">http://rhkernel.org/RHEL5&#043;2.6.18-194.el5/include/net/sctp/user.h#L367</a></p></p>
<pre>/*
 364 * Described in Section 7.3
 365 *   Ancillary Data and Notification Interest Options
 366 */
 367struct sctp_event_subscribe {
 368        __u8 sctp_data_io_event;
 369        __u8 sctp_association_event;
 370        __u8 sctp_address_event;
 371        __u8 sctp_send_failure_event;
 372        __u8 sctp_peer_error_event;
 373        __u8 sctp_shutdown_event;
 374        __u8 sctp_partial_delivery_event;
 375        __u8 sctp_adaption_layer_event;
 376};</pre></p>
<p>RHEL 6中的定义：<a href="http://rhkernel.org/RHEL6+2.6.32-71.18.2.el6/include/net/sctp/user.h#L406">http://rhkernel.org/RHEL6&#043;2.6.32-71.18.2.el6/include/net/sctp/user.h#L406</a></p></p>
<pre>/*
 403 * Described in Section 7.3
 404 *   Ancillary Data and Notification Interest Options
 405 */
 406struct sctp_event_subscribe {
 407        __u8 sctp_data_io_event;
 408        __u8 sctp_association_event;
 409        __u8 sctp_address_event;
 410        __u8 sctp_send_failure_event;
 411        __u8 sctp_peer_error_event;
 412        __u8 sctp_shutdown_event;
 413        __u8 sctp_partial_delivery_event;
 414        __u8 sctp_adaptation_layer_event;
 415        __u8 sctp_authentication_event;
 416};
 417</pre></p>

        </div>
        <a href="javascript:void(0);" style="float:right" onclick="window.scrollTo(0, 0);">Top</a>
        <div style="clear: both;"></div>
      </div>
    </div>
    
    <div class="main-container shadow">
      <div class="mainbody">
        <h2><a href="/2011/08/02/displacement-activity">Displacement Activity</a></h2>
        <p>
          Posted by <strong>Bo Yang</strong> at <strong>2011-08-02</strong> with tags <a href="/tags.html#Personal-ref" rel="nofollow">Personal</a>, <a href="/tags.html#Essay-ref" rel="nofollow">Essay</a>
        </p>
        
        <div class="post_at_index thepost">
        <p>
<span style="font-family:'Times New Roman';font-size:16px;"></span></p>
<div style="font-family:Arial;background-color:rgb(255,255,255);overflow-y:scroll;word-wrap:break-word;word-break:break-all;line-height:1.6;font-size:14px;margin:1px 4px 2px 2px;">
<p style="margin-top:0;margin-bottom:.5em;">你是否有过这样的经历：&#30524;看考试或某个任务、活动的大限将至，自己很是担心，可你却不是在努力准备，而是看电影、玩游戏或者和朋友聊天？ 至少对于我，这样的矛盾行为并不罕见。今天才知道，这种行为叫做Displacement Activity，是人和动物身上的一种普遍存在的行为。</p>
<p style="margin-top:0;margin-bottom:.5em;">Displacement Activity貌&#20284;还没有确切的中文翻译，有在线词典译作“替换行为”，个人认为翻译不准确，不予采纳。根据我的理解，<span style="font-family:楷体_GB2312;color:#ff0000;line-height:1.3em;"><strong>Displacement Activity就是当你不得不去做某件事情的时候，你担心会失败于是产生一种不去做的消极心态，当你无法做出一个做还是不做的决定时，纠结中你下意识得选择逃避——不由自主的做一些让自己感觉舒服（但很明显不在状态）的事情，比如吃饭、看电影、睡觉、玩游戏、逛街等等。恰恰由于你的逃避，往往会使事情办的更糟，所以等到下一个你不得不面对的抉择时，你的这种表现会更严重，由此造成恶性的循环往复……</strong></span></p>
<p style="margin-top:0;margin-bottom:.5em;">个人感觉Displacement Activity还是心理不够强大的表现。真的强者不会有这种表现的。悲哀的是这种状态已伴随我十几年，至少在高中时就有这种表现，目前看来已经越来越严重了。我能想到的解决这种现象的根本方法就是：1. 深入研究你要做的事情，搞清楚你要做什么，想清楚怎么做，多看一些别人成功的经验（以及别人失败的教训，当然这种东西比较少了）；2. 制定一个达到目标所需要的可行的计划；3. 每天坚持执行你的计划；4.<br />
 尽量不要调整你的计划。这只是一个设想，目前本人还没有真正实践过。</p>
<p style="margin-top:0;margin-bottom:.5em;"></p>
<p style="margin-top:0;margin-bottom:.5em;">下面是搜集的相关解释。</p>
<p style="margin-top:0;margin-bottom:.5em;"><strong>Displacement Activities are behaviors that animals(including human beings) have conflicting drives. Such behaviors are completely out of place.</strong></p>
<p style="margin-top:0;margin-bottom:.5em;"></p>
<p style="margin-top:0;margin-bottom:.5em;"><strong>Displacement behavior is usually thought of as self-grooming, touching, or scratching, which is displayed when an animal has a conflict between two drives, such as the desire to approach an object, while<br />
 at the same time being fearful of that object.&nbsp;</strong>With the fall of drive theory into disfavor, animal behaviorists paid little attention to displacement behavior until Maestripieri et al. (1992) pointed out that displacement behavior might be a good<br />
 measure of anxiety levels.</p>
<p style="margin-top:0;margin-bottom:.5em;"></p>
<p style="margin-top:0;margin-bottom:.5em;">------------------------------</p>
<p style="margin-top:0;margin-bottom:.5em;">From Wiki:&nbsp;<a href="http://en.wikipedia.org/wiki/Displacement_activity" target="_blank" style="border-color:rgb(255,255,255);border-style:solid;border-width:0;">http://en.wikipedia.org/wiki/Displacement_activity</a></p>
<p style="margin-top:0;margin-bottom:.5em;"></p>
<p style="margin-top:0;margin-bottom:.5em;"><strong>A displacement activity is the result of two contradicting instincts in a particular situation.&nbsp;</strong>Birds, for example, may peck at grass when uncertain whether to attack or flee from an opponent;<br />
 similarly, a human may scratch his or her head when they do not know which of two options to choose.</p>
<p style="margin-top:0;margin-bottom:.5em;"></p>
<p style="margin-top:0;margin-bottom:.5em;"><strong>Displacement activities often involve actions to bring comfort such as scratching, drinking or feeding.</strong></p>
<p style="margin-top:0;margin-bottom:.5em;"></p>
<p style="margin-top:0;margin-bottom:.5em;">The first description of a displacement activity (though not the use of the term) is probably by Julian Huxley in 1914. The subsequent development of research on displacement activities was a direct consequence<br />
 of Konrad Lorenz's works on instincts. However, the first mentions of the phenomenon came in 1940 by the two Dutch researchers Nikolaas Tinbergen and Adriaan Kortlandt.</p>
<p style="margin-top:0;margin-bottom:.5em;"></p>
<p style="margin-top:0;margin-bottom:.5em;">---------------------------</p>
<p style="margin-top:0;margin-bottom:.5em;">From&nbsp;<a href="http://c2.com/cgi/wiki?DisplacementActivity" target="_blank" style="border-color:rgb(255,255,255);border-style:solid;border-width:0;">http://c2.com/cgi/wiki?DisplacementActivity</a></p>
<p style="margin-top:0;margin-bottom:.5em;"><strong>Activity undertaken when some more important task's deadline is looming.</strong></p>
<p style="margin-top:0;margin-bottom:.5em;">When I was studying for my final degree examinations I played more bridge than ever before. That was pretty much a pure DisplacementActivity.</p>
<p style="margin-top:0;margin-bottom:.5em;">I'm wondering how much other authors and programmers suffer from this weakness -- SteveHolden</p>
<p style="margin-top:0;margin-bottom:.5em;"></p>
<p style="margin-top:0;margin-bottom:.5em;">----------------------------</p>
<p style="margin-top:0;margin-bottom:.5em;">From&nbsp;<a href="http://baillement.com/displacement-delius.html" target="_blank" style="border-color:rgb(255,255,255);border-style:solid;border-width:0;">http://baillement.com/displacement-delius.html</a></p>
<p style="margin-top:0;margin-bottom:.5em;">In 1940 Tinbergen and Kortlandt independently drew attention to a behavioural phenomenon which has since been called displacement activity and has received a good deal of attention. Although no binding rules exist<br />
 by which displacement behaviour can be recognized, the term is applied to behaviour patterns which appear to be out of context with the behaviour which closely precedes or follows them either in the sense that they do not seem functionally integrated with<br />
 the preceding or following behaviour or that they occur in situations in which causal factors usually responsible for them appear to be absent or at least weak compared with those determining the behavioural envelope.</p>
<p style="margin-top:0;margin-bottom:.5em;"></p>
<p style="margin-top:0;margin-bottom:.5em;"><strong>Displacement activities occur in three situations: motivational, conflict, frustration of consummatory acts and physical thwarting of performance.</strong>&nbsp;Several theories have been put forward to explain<br />
 the causal mechanism involved. A variety of behaviour patterns have been reported as displacement activities, even in a single species, but this variety needs revision.</p>
<p style="margin-top:0;margin-bottom:.5em;"></p>
<p style="margin-top:0;margin-bottom:.5em;">Monographie treatments of the behaviour of any one species usually indicate only two or three activities which according te the judgment of the observer occur commonly as displacement. None of the theories on displacement<br />
 activities gives cogent reasons why particular behaviour patterns should be more common than others as displacement activities, apart from stating that the causal agents which usually elicit them in non-displacement situations can also be presumed te be present,<br />
 if only weakly, in the displacement context, or remarking that those patterns are prepotent in the repertoire of the animal.</p>
<div>
</div>
</div>

        </div>
        <a href="javascript:void(0);" style="float:right" onclick="window.scrollTo(0, 0);">Top</a>
        <div style="clear: both;"></div>
      </div>
    </div>
    
    <div class="main-container shadow">
      <div class="mainbody">
        <h2><a href="/2011/07/26/immaneul-kants-philosophy-of-morality">Immaneul Kant's Philosophy of Morality</a></h2>
        <p>
          Posted by <strong>Bo Yang</strong> at <strong>2011-07-26</strong> with tags <a href="/tags.html#Essay-ref" rel="nofollow">Essay</a>
        </p>
        
        <div class="post_at_index thepost">
        <p>Following are part of my notes of the famous Harvard open course <strong><em>Justice</em></strong>. Kant's theory is too hard to be understood in a shot time. I think the best way is to record his main idea and try to digest in the future.</p>
<p>===============================================================================================</p>
<p><strong>Part 1  Kant's Conception of Freedom</p>
<p></strong>Kant thinks that the individual person, all human beings, have a certain dignity that commands our respect.</p>
<p>The reason the individual is sacred or the bearer of rights, doesn't stem from the idea that we own ourselves, but instead from the we are all rational beings, which means we are beings who are capable of reason.</p>
<p>We are also autonomous beings, which is to say that we are beings capable of acting and choosing freely.</p>
<p>The capacity of reason and freedom, isn't the only capacity we have. It is our rational capacity that makes our distinctive.</p>
<p>Freedom is the opposite of necessity.</p>
<p>Kant's Conception of Freedom<br />
Autonomy:<br />
To act freely (= to act autonomously =)<br />
To act according to a law I give myself<br />
Heteronomy:<br />
To act according to desires I haven't chosen myself</p>
<p>To act freely is not to choose the best means to a given end; it's choose the end itself for its own sake. In so far we act on inclination or pursue pleasure, we act as means to the realization of ends given outside of us. We are instruments rather than  authors of the purposes we pursue, that's the heteronymous determination of the will.<br />
On the other hand, in so fas as we act autonomously, according to a law we give ourselves, we do something for its own sake as an end in itself. When we act autonomously, wee seems to be instruments to purposes given outside us, we become as ends in ourselves. This capacity to act freely, is what gives human life its special dignity.<br />
Respecting human dignity means regarding persons not just as means, but also as ends in themselves. This is why it is wrong to use people for the sake of other people's well-being or happiness. This is the real reason that utilitarianism goes wrong.</p>
<p>------------------------------------<br />
<strong>Part 2. Kant's Conception of Morality</p>
<p></strong>Kant's Conception of Morality<br />
*moral worth of an action depends on motive (do the right thing for the right reason, or for the sake of duty)</p>
<p>What makes an action morally worthy, consists not in the consequences or in the results that flow from it, what makes an action morally worthy has to do with the motive, with the quality of the will, with the Intention for which the act is done. What matters is the motive, and the motive must be of a certain kind.</p>
<p>A good will isn't good because of what it effects or accomplishes, it's good in itself. Even if by utmost effort the good will accomplishes nothing it would still shine like a jewel for it's own sake as something which has it's full value in itself. -- Immanuel Kant<br />
The idea is that the motive confers the moral worth on an action and the only kind of motive that can confer moral worth on an action is the motive of duty.<br />
The opposite of acting out of duty, is all of the motives having to do with our inclinations. Inclinations refer to all of our desires, all of our contingently given wants, preferences, impulses, and the like.<br />
Only actions done for the sake of the moral law, for the sake of duty, only these actions have moral duty.</p>
<p>-------------------------------<br />
<strong>Part 3. Kant's Conception of Supreme Morality</p>
<p></strong>What's the supreme principle of morality?<br />
Only one kind of motive is consistent with morality, the motive of duty, doing the right thing for the right reason. Other motives are summed up by Kant in the category of inclination.<br />
Every thine the motive for what we do is to satisfy a desire or a preference that we may have, to pursue some interest, we are acting of inclination.<br />
It's fine to have sentiments and feelings that support the right thing provided they don't provide the reason for acting. One may have more than one motive, but it doesn't mean that the action is devoid of moral worth, just because he has one other motive -- the motive which involves duty is what gives the moral worth.</p>
<p>Kant's Three Contrasts:<br />
(MORALITY) Motives:                         Duty vs. Inclination<br />
(FREEDOM)  Determination of will :   autonomous  vs. Heteronomous<br />
(REASON) Imperatives:                      Categorical vs. Hypothetical</p>
<p>If reason determines my will, then the will becomes a power to choose indecent of the dictates of nature, or inclination or circumstance. So, connected with Kant's demanding notions of morality and freedom, is a specially demanding notion of reason.</p>
<p>How can reason determine the will?<br />
There are two ways. There are two different commands of reason. One is an imperative. An imperative is an *ought*.<br />
One kind of imperative, perhaps the most familiar kind, is a *hypothetical* imperative. Hypothetical imperatives use instrumental reason. If want X then do y. It's means-ends reason.<br />
If the action would be good solely as a means to something else, the imperative is hypothetical; if the action is represented as good in itself and therefore as necessary... for a will which of itself accords with reason, then the imperative is *categorical*.</p>
<p>What is the categorical imperative? What is the supreme principle of morality? What does it command of us?<br />
THE CATEGORICAL IMPERATIVE<br />
(1) The Formula of Universal Law<br />
Act only on that maxim whereby you can at the same time will that is should become a universal law. "the maxim", he means a rule that explains the reason for what you are doing, a principle. For example, promise keeping.<br />
And the test, the way we can determine that the false promise is at odds with the categorical imperative, is try to universalize it, universalize the maxim upon which you are about to act. If the maxim universalized would undermine itself, then it's not categorical.</p>
<p>(2) The Formula of Humanity as End<br />
We can't base the categorical imperative on any particular interests, purposes, or ends, because then it would be only relative to the person whose ends they were. But suppose, however, there were something whose existence has in itself an absolute value.... an end in itself.... then in it, and in it alone, would there be the ground of a possible categorical imperative.<br />
"I say that man, and in general every rational being, exists as an end in himself, not merely as a means for arbitrary used by this or that will." -- Kant</p>
<p>Act in such a way that you always treat humanity, whether in your own person or in the person of any other, never simply as a means, but always at the same time, as an end.</p>
<p>Respect is respect for humanity which is universal, for a rational capacity which is universal, and that's why violating it, in my own case, is as objectionable as violating it in the case of any other.</p>
<p>-------------------------------<br />
<strong>Part 4. The Application of Kant' Categorical Imperative on Lying</p>
<p></strong>How is a categorical imperative possible? How is morality possible?</p>
<p>"when we think of ourselves as free, we transfer ourselves into the intelligible world as members and recognize the autonomy of the will." --immanuel Kant<br />
Only because the idea of freedom makes me a member of an intelligible world, the categorical imperative is possible.</p>
<p>Since we inhabits simultaneously the two standpoints, the two realms, the realm of freedom and the realm of necessity, there is always potentially a gap between what we do and what we ought to to, between is and ought.<br />
Morality is not empirical. Whatever you see in the world, whatever you discover through science, can't decide moral questions. Morality stands at a certain distance from the world, from the empirical world. That's why no science could deliver moral truth.</p>
<p>From Kant's point of view, there actually is a world of difference between a lie and a misleading truth.</p>
<p>White lie 善意的谎言<br />
Kant preferred leading truth(误导的真相) to a white lie.<br />
Unlike a falsehood, unlike a lie, a misleading truth pays a certain homage to duty.</p>
<p>-----------------------------------<br />
<strong>Part 5  The Application of Kant's Categorical Imperative On Contract</p>
<p></strong>Just laws arise from a certain kind of social contract, which is of an exceptional nature. What makes the contract exceptional is that it is not an actual contract, that happens when people come together and try to figure out what the constitution should be. That the contract generates justice is an idea of reason.</p>
<p>A contract that generates principles of right is merely an idea of reason, but it has undoubted practical reality, because it can oblige every legislator to frame his laws in such a way that they could have been produced by the united will of the whole nation.</p>
<p>"Each person possesses an inviolability founded on justice that even the welfare of society as a whole cannot override... The rights secured by justice are not subject to political bargaining or to the calculus of social interests." -- John Rawls</p>
<p>Moral Force of Actual Contracts<br />
1. How do they bind or obligate?<br />
(1) consent-based -&gt; AUTONOMY(自律)<br />
(2) benefit- based -&gt; RECIPROCITY(互惠) : contracts sometimes bind us in so far as they are instruments of mutual benefit.</p>
<p>2. How do they justify the terms they produce?<br />
Actual contracts are not self-sufficient moral instruments of any actual contract or agreement. The fact of the agreement never guarantees the fairness of the agreement.</p>

        </div>
        <a href="javascript:void(0);" style="float:right" onclick="window.scrollTo(0, 0);">Top</a>
        <div style="clear: both;"></div>
      </div>
    </div>
    
    <div class="main-container shadow">
      <div class="mainbody">
        <h2><a href="/2011/07/13/merge-excel-sheets-2">选中Excel单元格自动导入多个Excel worksheets</a></h2>
        <p>
          Posted by <strong>Bo Yang</strong> at <strong>2011-07-13</strong> with tags <a href="/tags.html#VBA-ref" rel="nofollow">VBA</a>
        </p>
        
        <div class="post_at_index thepost">
        <p>前日完成<a href="http://blog.csdn.net/bonny95/article/details/6597776">将多个Excel文件批量导入某个Excel文件中</a>老婆规定的任务后，老婆又提出了新的要求：</p></p>
<ol>
<li>可以update每个worksheet</li>
<li>对导入的worksheets进行排序</li>
<li>自动匹配代导入文件的文件名</li>
<li>将导入的worksheets中的特定多个单元&#26684;（cells）的内容自动填充到某一表&#26684;的特定区域</li>
</ol>
<p><strong><span style="color:#ff0000;">本文中用到的Excel文件及VBA宏可以在<a href="http://download.csdn.net/detail/bonny95/3438424">此处</a>下载。</span></strong></p>
<p></p>
<table border="1" width="200" cellspacing="1" cellpadding="1" style="text-align:center;">
<caption><span style="font-size:16px;">表1 &nbsp;选中的单元&#26684;</span><br />
</caption>
<tbody>
<tr>
<td style="text-align:center;">1</td>
<td style="text-align:center;">工作表 1</td>
</tr>
<tr>
<td style="text-align:center;">2</td>
<td style="text-align:center;">工作表 2</td>
</tr>
<tr>
<td style="text-align:center;">3</td>
<td style="text-align:center;">工作表 3</td>
</tr>
<tr>
<td style="text-align:center;">4</td>
<td style="text-align:center;">工作表 4</td>
</tr>
<tr>
<td style="text-align:center;">5</td>
<td style="text-align:center;">工作表 5</td>
</tr>
<tr>
<td style="text-align:center;">6</td>
<td style="text-align:center;">工作表 6</td>
</tr>
<tr>
<td style="text-align:center;">7</td>
<td style="text-align:center;">工作表 7</td>
</tr>
<tr>
<td style="text-align:center;">8</td>
<td style="text-align:center;">工作表 8</td>
</tr>
<tr>
<td style="text-align:center;">9</td>
<td style="text-align:center;">工作表 9</td>
</tr>
<tr>
<td style="text-align:center;">10</td>
<td style="text-align:center;">工作表 10</td>
</tr>
</tbody>
</table></p>
<p>对应的各个worksheet的名字(Name)是：<em>01&nbsp;工作表 1，&nbsp;02&nbsp;工作表 2，03&nbsp;工作表 3，……，10&nbsp;工作表 10.</em></p>
<p><em><img src="http://bonny95.files.wordpress.com/2011/07/0_1310521133c6e4.gif" alt="" /><br />
</em></p>
<p>待导入的Excel文件的名字为“<em>02 某某银行XX项目_工作表 1_20110701.xls</em>”。</p>
<p></p>
<p><span style="color:#ff0000;"><em>Update 2011-07-13 21:50</em></span></p>
<p>应老婆的要求，更新了程序，遇到并解决的问题有：</p></p>
<ol>
<li>Office 2003和2007不兼容——有些method在office2003中正常工作但在office2007中却不再支持，如判定某文件是否存在的函数，解决方法参见<span style="font-family:monospace;white-space:pre-wrap;background-color:rgb(240,240,240);">FindFileName函数。</span></li>
<li>如果某个表中的一些单元&#26684;被筛选，则会遇到“不能复制合并的单元&#26684;”(Can't copy merged cell)的问题，解决方法就是在copy前强制关闭autofilter: &nbsp;&nbsp;<span style="font-family:monospace;white-space:pre-wrap;background-color:rgb(240,240,240);">newWB.Sheets(SheetToBeCopy).AutoFilterMode = False ' disable auto filter</span></li>
<li><span style="font-family:monospace;"><span style="white-space:pre-wrap;">关闭打开的Excel文件或者copy单元&#26684;时会有各种各样的对话框弹出来，解决办法就是加上下面语句：</span></span></li>
</ol>
<p><span style="font-family:monospace;"><span style="white-space:pre-wrap;"><span style="font-family:monospace;white-space:pre;background-color:rgb(240,240,240);"></span></span></span></p>
<pre style="word-wrap:break-word;white-space:pre-wrap;"><span style="font-family:monospace;white-space:pre-wrap;"></span></pre>
<pre style="word-wrap:break-word;white-space:pre-wrap;">Application.DisplayAlerts = True</pre>
<pre style="word-wrap:break-word;white-space:pre-wrap;">newWB.Close SaveChanges:=False  ' close without change
Application.DisplayAlerts = True</pre></p>
<p><em><span style="color:#ff0000;">Update 2011-07-14 15:37</span></em></p>
<p>傻瓜型用户的需求就是无穷无尽啊……我老婆发现在选择不连续的区域时，只有第一个区域会被处理，其他的没有变化。顶着挨骂的压力Google之后才知道，原来Slection.Areas可以包含所有不连续的选择，然后通过遍历，处理所有的选择……程序改动如下。</p></p>
<pre>       ' Create new worksheets
        ' Discontinuous selection is supported by Selection.Areas
        For Each Rng In Selection.Areas
            Set SelRange = Rng.Cells
            Set ColNo = Rng.Columns(1)
            Set ColDepart = Rng.Columns(2)
            idx = 1
            For Each cell In ColDepart.Cells
                no_str = ColNo.Cells(idx).Value
                If Len(no_str) = 1 Then
                    no_str = &quot;0&quot; + no_str
                End If
                Call CreateNewWorksheet(no_str, cell.Value, myFolder, SheetToBeCopy) ' call is needed here
                idx = idx + 1
            Next
        Next</pre>
<p></p></p>
<p>实现以上所有需求的代码如下（<em><span style="color:#ff0000;">Update 2011-07-14 15:37</span></em>）：</p></p>
<pre>&lt;span style="font-family: 'Times New Roman';font-size:16px; "&gt;&lt;/span&gt;&lt;pre style="word-wrap: break-word; white-space: pre-wrap; "&gt;                                         
Option Explicit
Dim curWS As Worksheet


Sub LoadWorksheets()
'
' LoadWorksheets Macro
' Macro recorded 7/13/2011 by Bo Yang
'
' Keyboard Shortcut: Ctrl+Shift+L
'
' *How to use this macro?*
' *Select columns &quot;??(NO)&quot; and &quot;??(Deparment)&quot; and then run this macro.*
'
&nbsp; &nbsp; Application.ScreenUpdating = False &nbsp;' stop screen flickering
&nbsp; &nbsp;&nbsp;
&nbsp; &nbsp; ' Create new sheets according to selected cells and copy the
&nbsp; &nbsp; ' contebts of other files into the new sheets
&nbsp; &nbsp; Dim YesNo As Variant, myFolder As String, MyLF As String
&nbsp; &nbsp; Dim SelRange As Range, ColNo As Range, ColDepart As Range, cell As Range, Rng As Range
&nbsp; &nbsp; Dim SheetName As String, SheetToBeCopy As String
&nbsp; &nbsp; Dim ColCnt As Integer
&nbsp; &nbsp; Dim no_str As String, idx As Integer
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
&nbsp; &nbsp; myFolder = &quot;D:&quot; &nbsp; '*****Change this value as you need*****
&nbsp; &nbsp; SheetToBeCopy = &quot;信息资产风险评估&quot; &nbsp;' *****Change this value as you need*****
&nbsp; &nbsp;&nbsp;
&nbsp; &nbsp; MyLF = Chr(10) &amp; Chr(13) &nbsp; &nbsp;' a line feed command
&nbsp; &nbsp; Set curWS = ThisWorkbook.ActiveSheet ' Save current worksheet
&nbsp; &nbsp;&nbsp;
&nbsp; &nbsp; ' check that if user select valid columns
&nbsp; &nbsp; ColCnt = Selection.Columns.Count
&nbsp; &nbsp;&nbsp;
&nbsp; &nbsp; If ColCnt &lt;&gt; 2 Then
&nbsp; &nbsp; &nbsp; &nbsp; MsgBox (&quot;Please select 2 columns!!!&quot; &amp; MyLF &amp; _
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;The first column must be digital numbers,&quot; &amp; MyLF &amp; _
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;And the Second column must be department names&quot; _
&nbsp; &nbsp; &nbsp; &nbsp; )
&nbsp; &nbsp; &nbsp; &nbsp; Exit Sub
&nbsp; &nbsp; End If
&nbsp; &nbsp;&nbsp;
&nbsp; &nbsp; YesNo = MsgBox(&quot;This Macro is going to create new worksheets according to your selected cells.&quot; &amp; MyLF &amp; _
&nbsp; &nbsp; &nbsp; &nbsp; &quot;Do you want to continue?&quot;, _
&nbsp; &nbsp; &nbsp; &nbsp; vbYesNo, &quot;Caution&quot;)
&nbsp; &nbsp; Select Case YesNo
&nbsp; &nbsp; Case vbYes
&nbsp; &nbsp; &nbsp; &nbsp; myFolder = InputBox(&quot;Please enter the folder where all your Excel files locates:&quot;, Default:=myFolder)
&nbsp; &nbsp; &nbsp; &nbsp; SheetToBeCopy = InputBox(&quot;Please enter the worksheet you want to copy:&quot;, Default:=SheetToBeCopy)
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; ' Create new worksheets
&nbsp; &nbsp; &nbsp; &nbsp; ' Discontinuous selection is supported by Selection.Areas
&nbsp; &nbsp; &nbsp; &nbsp; For Each Rng In Selection.Areas
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Set SelRange = Rng.Cells
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Set ColNo = Rng.Columns(1)
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Set ColDepart = Rng.Columns(2)
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; idx = 1
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; For Each cell In ColDepart.Cells
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; no_str = ColNo.Cells(idx).Value
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; If Len(no_str) = 1 Then
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; no_str = &quot;0&quot; + no_str
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; End If
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Call CreateNewWorksheet(no_str, cell.Value, myFolder, SheetToBeCopy) ' call is needed here
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; idx = idx + 1
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Next
&nbsp; &nbsp; &nbsp; &nbsp; Next
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; curWS.Activate
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; ' Sort worksheets
&nbsp; &nbsp; &nbsp; &nbsp; Call SortWorksheets
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
&nbsp; &nbsp; Case vbNo
&nbsp; &nbsp; &nbsp; &nbsp; Application.ScreenUpdating = True
&nbsp; &nbsp; &nbsp; &nbsp; Exit Sub
&nbsp; &nbsp; End Select
&nbsp; &nbsp;&nbsp;
&nbsp; &nbsp; curWS.Activate
&nbsp; &nbsp; Application.ScreenUpdating = True
End Sub


Function CreateNewWorksheet(no As String, Depart As String, FolderName As String, SheetToBeCopy As String) As String
&nbsp; &nbsp; Dim oSheet As Worksheet, vRet As Variant
&nbsp; &nbsp; Dim SheetName As String, FileName As String
&nbsp; &nbsp; Dim Entry As Integer, i As Integer


&nbsp; &nbsp; ' Determine where to insert new worksheet
&nbsp; &nbsp; Entry = 0
&nbsp; &nbsp; For i = Sheets.Count To 1 Step -1
&nbsp; &nbsp; &nbsp; &nbsp; If Val(Worksheets(i).Name) &gt; 0 Then
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Entry = i
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GoTo Determ_Entry
&nbsp; &nbsp; &nbsp; &nbsp; End If
&nbsp; &nbsp; Next i
Determ_Entry:
&nbsp; &nbsp; If Entry = 0 Then
&nbsp; &nbsp; &nbsp; &nbsp; Entry = Sheets.Count
&nbsp; &nbsp; End If
&nbsp; &nbsp;&nbsp;
&nbsp; &nbsp; 'Example of one worksheet name:
&nbsp; &nbsp; ' &nbsp; 07 oa祙?DDISMS?ㄩ????_D???钻2???_D?'?轶???_20110705.xls
&nbsp; &nbsp; SheetName = no + &quot; &quot; + Depart
&nbsp; &nbsp; If Not SheetExists(SheetName) Then
&nbsp; &nbsp; &nbsp; &nbsp; 'worksheet XXX doesn't exist in current workbook
&nbsp; &nbsp; &nbsp; &nbsp; 'creating a new excel worksheet
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; Set oSheet = Worksheets.Add
&nbsp; &nbsp; &nbsp; &nbsp; With oSheet
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .Name = SheetName
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .Move After:=Sheets(Entry)
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .Activate
&nbsp; &nbsp; &nbsp; &nbsp; End With
&nbsp; &nbsp; End If
&nbsp; &nbsp;&nbsp;
&nbsp; &nbsp; FileName = FindFileName(no, Depart, FolderName)
&nbsp; &nbsp; If FileName &lt;&gt; &quot;&quot; Then
&nbsp; &nbsp; &nbsp; &nbsp; Call CopyWorksheet(SheetName, FileName, SheetToBeCopy)
&nbsp; &nbsp; End If
&nbsp; &nbsp;&nbsp;
&nbsp; &nbsp; Exit Function


End Function


Function SheetExists(SheetName As String) As Boolean
' returns TRUE if the sheet exists in the active workbook
&nbsp; &nbsp; SheetExists = False
&nbsp; &nbsp; On Error GoTo NoSuchSheet
&nbsp; &nbsp; If Len(Sheets(SheetName).Name) &gt; 0 Then
&nbsp; &nbsp; &nbsp; &nbsp; SheetExists = True
&nbsp; &nbsp; &nbsp; &nbsp; Exit Function
&nbsp; &nbsp; End If
NoSuchSheet:
End Function


Function CopyWorksheet(SheetName As String, FileName As String, SheetToBeCopy As String) As String
&nbsp; &nbsp; 'open Excel files and copy the contents to this sheet
&nbsp; &nbsp; Dim newWB As Workbook, curWB As Workbook
&nbsp; &nbsp; Dim startRange As Range
&nbsp; &nbsp;&nbsp;
&nbsp; &nbsp; If Dir(FileName) &lt;&gt; &quot;&quot; Then
&nbsp; &nbsp; &nbsp; &nbsp; ' file exists
&nbsp; &nbsp; &nbsp; &nbsp; ' Clear all cells of current worksheet
&nbsp; &nbsp; &nbsp; &nbsp; Sheets(SheetName).UsedRange.Clear
&nbsp; &nbsp; &nbsp; &nbsp; Application.DisplayAlerts = False ' disable alerts
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; ' Open workbooks to be copied
&nbsp; &nbsp; &nbsp; &nbsp; Set curWB = ThisWorkbook ' For WorkBook and Range objects, set is necessary during assignment
&nbsp; &nbsp; &nbsp; &nbsp; Set newWB = Workbooks.Open(FileName)
&nbsp; &nbsp; &nbsp; &nbsp; newWB.Sheets(SheetToBeCopy).AutoFilterMode = False ' disable auto filter
&nbsp; &nbsp; &nbsp; &nbsp; Set startRange = newWB.Sheets(SheetToBeCopy).UsedRange ' Only used range will be copied
&nbsp; &nbsp; &nbsp; &nbsp; newWB.Sheets(SheetToBeCopy).UsedRange.Copy
&nbsp; &nbsp; &nbsp; &nbsp; ' paste to target worksheet
&nbsp; &nbsp; &nbsp; &nbsp; curWB.Activate
&nbsp; &nbsp; &nbsp; &nbsp; Sheets(SheetName).Range(startRange.Address).PasteSpecial
&nbsp; &nbsp; &nbsp; &nbsp; Application.CutCopyMode = False &nbsp;'Clear Clipboard
&nbsp; &nbsp; &nbsp; &nbsp; newWB.Close SaveChanges:=False &nbsp;' close without change
&nbsp; &nbsp; &nbsp; &nbsp; Application.DisplayAlerts = True
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
&nbsp; &nbsp; End If


End Function


Function FindFileName(no As String, Depart As String, FolderName As String) As String
&nbsp; &nbsp; Dim Coll_Docs As New Collection
&nbsp; &nbsp; Dim Search_path, Search_Filter, Search_Fullname As String
&nbsp; &nbsp; Dim DocName As String
&nbsp; &nbsp; Dim i As Long


&nbsp; &nbsp; Search_path = FolderName &nbsp; ' where ?
&nbsp; &nbsp; Search_Filter = no + &quot;*&quot; + Depart + &quot;*&quot; + &quot;.xls&quot; ' what ?
&nbsp; &nbsp; Set Coll_Docs = Nothing


&nbsp; &nbsp; DocName = Dir(Search_path &amp; &quot;&quot; &amp; Search_Filter)


&nbsp; &nbsp; Do Until DocName = &quot;&quot; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;' build the collection
&nbsp; &nbsp; &nbsp; &nbsp; Coll_Docs.Add Item:=DocName
&nbsp; &nbsp; &nbsp; &nbsp; DocName = Dir
&nbsp; &nbsp; Loop
&nbsp; &nbsp;&nbsp;
&nbsp; &nbsp; If Coll_Docs.Count = 1 Then
&nbsp; &nbsp; &nbsp; &nbsp; FindFileName = Search_path &amp; &quot;&quot; &amp; Coll_Docs(1)
&nbsp; &nbsp; Else
&nbsp; &nbsp; &nbsp; &nbsp; FindFileName = &quot;&quot;
&nbsp; &nbsp; End If


End Function


Function SortWorksheetsByName() As String
&nbsp; &nbsp; ' sort worksheets in a workbook in ascending order
&nbsp; &nbsp; Dim sCount As Integer, i As Integer, j As Integer
&nbsp; &nbsp;&nbsp;
&nbsp; &nbsp; Application.ScreenUpdating = False
&nbsp; &nbsp; sCount = Worksheets.Count
&nbsp; &nbsp; If sCount = 1 Then Exit Function
&nbsp; &nbsp; For i = 1 To sCount - 1
&nbsp; &nbsp; &nbsp; &nbsp; For j = i + 1 To sCount
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; If Worksheets(j).Name &lt; Worksheets(i).Name Then
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Worksheets(j).Move Before:=Worksheets(i)
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; End If
&nbsp; &nbsp; &nbsp; &nbsp; Next j
&nbsp; &nbsp; Next i
&nbsp; &nbsp;&nbsp;
End Function


Function SortWorksheets() As String
&nbsp; &nbsp; ' sort worksheets in a workbook in ascending order
&nbsp; &nbsp; Dim cnt As Integer, i As Integer, j As Integer
&nbsp; &nbsp; Dim Entry As Integer
&nbsp; &nbsp; Dim curWS As Worksheet
&nbsp; &nbsp;&nbsp;
&nbsp; &nbsp; Set curWS = ThisWorkbook.ActiveSheet
&nbsp; &nbsp; 'Application.ScreenUpdating = False
&nbsp; &nbsp;&nbsp;
&nbsp; &nbsp; cnt = Worksheets.Count
&nbsp; &nbsp;&nbsp;
&nbsp; &nbsp; ' Determine where to start sorting
&nbsp; &nbsp; Entry = 0
&nbsp; &nbsp; For i = 1 To cnt
&nbsp; &nbsp; &nbsp; &nbsp; If Val(Worksheets(i).Name) &gt; 0 Then
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Entry = i
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GoTo Determ_Entry
&nbsp; &nbsp; &nbsp; &nbsp; End If
&nbsp; &nbsp; Next i
Determ_Entry:
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
&nbsp; &nbsp; For i = Entry To cnt - 1
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; For j = i + 1 To cnt
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; If Val(Worksheets(i).Name) &gt; Val(Worksheets(j).Name) Then
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Worksheets(j).Move Before:=Worksheets(i)
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; End If
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Next j
&nbsp; &nbsp; Next i
&nbsp; &nbsp;&nbsp;
&nbsp; &nbsp; curWS.Activate
&nbsp; &nbsp; 'Application.ScreenUpdating = True
End Function
</pre>
<pre></pre>
<p>如要自动导入每个worksheet的特定单元&#26684;（L2:L6）到表2中的D，E，F，G，H列，可以使用下面的UpdateCells宏。</p>
<p><img src="http://bonny95.files.wordpress.com/2011/07/0_1310521124rpsk.gif" alt="" /></p></p></p>
<pre>Option Explicit

Sub UpdateCells()
'
' UpdateCells Macro
' Macro recorded 7/13/2011 by Bo Yang
'
' Keyboard Shortcut: Ctrl+Shift+C
'
' Risk:Cell
' 5: L2 , 4: L3 , 3: L4 , 2: L5 , 1: L6
Dim Risk5 As Range
Dim num As String, depart As Range, idx As Integer
Dim SheetName As String
Dim SelRange As Range
Dim curWS As Worksheet

Application.ScreenUpdating = False

Set curWS = ActiveSheet
Set SelRange = Selection

idx = 1
For Each depart In SelRange.Columns(2).Cells
    num = SelRange.Columns(1).Cells(idx).value
    If Len(num) = 1 Then
        num = &quot;0&quot; + num
    End If
    SheetName = num + &quot; &quot; + depart.value
    
    Set Risk5 = SelRange.Columns(3).Cells(idx)
    
    ThisWorkbook.Sheets(SheetName).Range(&quot;L2:L6&quot;).Copy
    Risk5.Select
    Risk5.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    Application.CutCopyMode = False 'Clear Clipboard
    
    idx = idx + 1
Next

Application.ScreenUpdating = True
End Sub
</pre>
<p></p>
<pre></pre>

        </div>
        <a href="javascript:void(0);" style="float:right" onclick="window.scrollTo(0, 0);">Top</a>
        <div style="clear: both;"></div>
      </div>
    </div>
    
    <div class="main-container shadow">
      <div class="mainbody">
        <h2><a href="/2011/07/13/importing-multi-excel-filesworksheets-into-an-excel-workbook">Importing Multi-Excel Files/Worksheets Into An Excel Workbook</a></h2>
        <p>
          Posted by <strong>Bo Yang</strong> at <strong>2011-07-13</strong> with tags 
        </p>
        
        <div class="post_at_index thepost">
        <p>Two days ago, my wife asked me to write an Excel VBA script to automatically import multi-Excel worksheets stored in different workbooks into an already opened Excel workbook.  Her requirements were:</p>
<ol>
<li>Select a range in a worksheet, which stores the names of worksheets to be imported. After executing the macro, worksheets will be created if it doesn't exist, or it will be updated according to the specified  Excel worksheet in another Excel workbook. Table 1 is the range selected in the worksheet, in which the first column is the serial number of worksheet, the second column denotes department name and the worksheet name should be like "01 Department A".</li>
<li>The imported/created worksheets should be sorted by the serial number of Table 1.</li>
<li>The macro should be smart enough to match the Excel files to be imported. The name is like "01 XXXX_Department  A_20110707.xls".</li>
<li>After importing, specified cells in every other worksheets should be automatically copied to cells on the same row next to department.</li>
</ol>
<p style="text-align:center;">Table 1  Selected Range of a worksheet</p>
<table class="aligncenter" width="200" border="1" cellspacing="1" cellpadding="1">
<tbody>
<tr>
<td>1</td>
<td>Department  A</td>
</tr>
<tr>
<td>2</td>
<td>Department  B</td>
</tr>
<tr>
<td>3</td>
<td>Department  C</td>
</tr>
<tr>
<td>4</td>
<td>Department  D</td>
</tr>
<tr>
<td>5</td>
<td>Department  E</td>
</tr>
<tr>
<td>6</td>
<td>Department  F</td>
</tr>
<tr>
<td>7</td>
<td>Department  G</td>
</tr>
<tr>
<td>8</td>
<td>Department  H</td>
</tr>
<tr>
<td>9</td>
<td>Department  I</td>
</tr>
<tr>
<td>10</td>
<td>Department  J</td>
</tr>
</tbody>
</table>
<p>Actually I am not familiar with VBA, although I studied Visual Basic 6.0 for several months, I rarely touched it after passing the Jiangsu Province Computer Rank Test Level 2 in 2003. Besides, almost all my work was done in Linux/UNIX last 3 years.  As a result, I have to Google every VBA syntax and tips all day long.</p>
<p>Finally, I finishes the VBA macros and meet my wife's requirement in a inelegant way. Following is the verbose source code.</p>
<p>Following the macro to implement first 3 requirements.<br />
[sourcecode language="vb"]<br />
Option Explicit<br />
Dim curWS As Worksheet</p>
<p>Sub LoadWorksheets()<br />
'<br />
' LoadWorksheets Macro<br />
' Macro recorded 7/13/2011 by Bo Yang<br />
'<br />
' Keyboard Shortcut: Ctrl+Shift+L<br />
'<br />
' *How to use this macro?*<br />
' *Select columns &quot;??(NO)&quot; and &quot;??(Deparment)&quot; and then run this macro.*<br />
'<br />
    Application.ScreenUpdating = False  ' stop screen flickering</p>
<p>    ' Create new sheets according to selected cells and copy the<br />
    ' contebts of other files into the new sheets<br />
    Dim YesNo As Variant, myFolder As String, MyLF As String<br />
    Dim SelRange As Range, ColNo As Range, ColDepart As Range, cell As Range, Rng As Range<br />
    Dim SheetName As String, SheetToBeCopy As String<br />
    Dim ColCnt As Integer<br />
    Dim no_str As String, idx As Integer</p>
<p>    myFolder = &quot;D:\&quot;   '*****Change this value as you need*****<br />
    SheetToBeCopy = &quot;信息资产风险评估&quot;  ' *****Change this value as you need*****</p>
<p>    MyLF = Chr(10) &amp;amp; Chr(13)    ' a line feed command<br />
    Set curWS = ThisWorkbook.ActiveSheet ' Save current worksheet</p>
<p>    ' check that if user select valid columns<br />
    ColCnt = Selection.Columns.Count</p>
<p>    If ColCnt  2 Then<br />
        MsgBox (&quot;Please select 2 columns!!!&quot; &amp;amp; MyLF &amp;amp; _<br />
            &quot;The first column must be digital numbers,&quot; &amp;amp; MyLF &amp;amp; _<br />
            &quot;And the Second column must be department names&quot; _<br />
        )<br />
        Exit Sub<br />
    End If</p>
<p>    YesNo = MsgBox(&quot;This Macro is going to create new worksheets according to your selected cells.&quot; &amp;amp; MyLF &amp;amp; _<br />
        &quot;Do you want to continue?&quot;, _<br />
        vbYesNo, &quot;Caution&quot;)<br />
    Select Case YesNo<br />
    Case vbYes<br />
        myFolder = InputBox(&quot;Please enter the folder where all your Excel files locates:&quot;, Default:=myFolder)<br />
        SheetToBeCopy = InputBox(&quot;Please enter the worksheet you want to copy:&quot;, Default:=SheetToBeCopy)</p>
<p>        ' Create new worksheets<br />
        ' Discontinuous selection is supported by Selection.Areas<br />
        For Each Rng In Selection.Areas<br />
            Set SelRange = Rng.Cells<br />
            Set ColNo = Rng.Columns(1)<br />
            Set ColDepart = Rng.Columns(2)<br />
            idx = 1<br />
            For Each cell In ColDepart.Cells<br />
                no_str = ColNo.Cells(idx).Value<br />
                If Len(no_str) = 1 Then<br />
                    no_str = &quot;0&quot; + no_str<br />
                End If<br />
                Call CreateNewWorksheet(no_str, cell.Value, myFolder, SheetToBeCopy) ' call is needed here<br />
                idx = idx + 1<br />
            Next<br />
        Next</p>
<p>        curWS.Activate</p>
<p>        ' Sort worksheets<br />
        Call SortWorksheets</p>
<p>    Case vbNo<br />
        Application.ScreenUpdating = True<br />
        Exit Sub<br />
    End Select</p>
<p>    curWS.Activate<br />
    Application.ScreenUpdating = True<br />
End Sub</p>
<p>Function CreateNewWorksheet(no As String, Depart As String, FolderName As String, SheetToBeCopy As String) As String<br />
    Dim oSheet As Worksheet, vRet As Variant<br />
    Dim SheetName As String, FileName As String<br />
    Dim Entry As Integer, i As Integer</p>
<p>    ' Determine where to insert new worksheet<br />
    Entry = 0<br />
    For i = Sheets.Count To 1 Step -1<br />
        If Val(Worksheets(i).Name) &amp;gt; 0 Then<br />
            Entry = i<br />
            GoTo Determ_Entry<br />
        End If<br />
    Next i<br />
Determ_Entry:<br />
    If Entry = 0 Then<br />
        Entry = Sheets.Count<br />
    End If</p>
<p>    'Example of one worksheet name:<br />
    '   07 oa祙?DDISMS?ㄩ????_D???钻2???_D?'?轶???_20110705.xls<br />
    SheetName = no + &quot; &quot; + Depart<br />
    If Not SheetExists(SheetName) Then<br />
        'worksheet XXX doesn't exist in current workbook<br />
        'creating a new excel worksheet</p>
<p>        Set oSheet = Worksheets.Add<br />
        With oSheet<br />
            .Name = SheetName<br />
            .Move After:=Sheets(Entry)<br />
            .Activate<br />
        End With<br />
    End If</p>
<p>    FileName = FindFileName(no, Depart, FolderName)<br />
    If FileName  &quot;&quot; Then<br />
        Call CopyWorksheet(SheetName, FileName, SheetToBeCopy)<br />
    End If</p>
<p>    Exit Function</p>
<p>End Function</p>
<p>Function SheetExists(SheetName As String) As Boolean<br />
' returns TRUE if the sheet exists in the active workbook<br />
    SheetExists = False<br />
    On Error GoTo NoSuchSheet<br />
    If Len(Sheets(SheetName).Name) &amp;gt; 0 Then<br />
        SheetExists = True<br />
        Exit Function<br />
    End If<br />
NoSuchSheet:<br />
End Function</p>
<p>Function CopyWorksheet(SheetName As String, FileName As String, SheetToBeCopy As String) As String<br />
    'open Excel files and copy the contents to this sheet<br />
    Dim newWB As Workbook, curWB As Workbook<br />
    Dim startRange As Range</p>
<p>    If Dir(FileName)  &quot;&quot; Then<br />
        ' file exists<br />
        ' Clear all cells of current worksheet<br />
        Sheets(SheetName).UsedRange.Clear<br />
        Application.DisplayAlerts = False ' disable alerts</p>
<p>        ' Open workbooks to be copied<br />
        Set curWB = ThisWorkbook ' For WorkBook and Range objects, set is necessary during assignment<br />
        Set newWB = Workbooks.Open(FileName)<br />
        newWB.Sheets(SheetToBeCopy).AutoFilterMode = False ' disable auto filter<br />
        Set startRange = newWB.Sheets(SheetToBeCopy).UsedRange ' Only used range will be copied<br />
        newWB.Sheets(SheetToBeCopy).UsedRange.Copy<br />
        ' paste to target worksheet<br />
        curWB.Activate<br />
        Sheets(SheetName).Range(startRange.Address).PasteSpecial<br />
        Application.CutCopyMode = False  'Clear Clipboard<br />
        newWB.Close SaveChanges:=False  ' close without change<br />
        Application.DisplayAlerts = True</p>
<p>    End If</p>
<p>End Function</p>
<p>Function FindFileName(no As String, Depart As String, FolderName As String) As String<br />
    Dim Coll_Docs As New Collection<br />
    Dim Search_path, Search_Filter, Search_Fullname As String<br />
    Dim DocName As String<br />
    Dim i As Long</p>
<p>    Search_path = FolderName   ' where ?<br />
    Search_Filter = no + &quot;*&quot; + Depart + &quot;*&quot; + &quot;.xls&quot; ' what ?<br />
    Set Coll_Docs = Nothing</p>
<p>    DocName = Dir(Search_path &amp;amp; &quot;\&quot; &amp;amp; Search_Filter)</p>
<p>    Do Until DocName = &quot;&quot;            ' build the collection<br />
        Coll_Docs.Add Item:=DocName<br />
        DocName = Dir<br />
    Loop</p>
<p>    If Coll_Docs.Count = 1 Then<br />
        FindFileName = Search_path &amp;amp; &quot;\&quot; &amp;amp; Coll_Docs(1)<br />
    Else<br />
        FindFileName = &quot;&quot;<br />
    End If</p>
<p>End Function</p>
<p>Function SortWorksheetsByName() As String<br />
    ' sort worksheets in a workbook in ascending order<br />
    Dim sCount As Integer, i As Integer, j As Integer</p>
<p>    Application.ScreenUpdating = False<br />
    sCount = Worksheets.Count<br />
    If sCount = 1 Then Exit Function<br />
    For i = 1 To sCount - 1<br />
        For j = i + 1 To sCount<br />
            If Worksheets(j).Name  0 Then<br />
            Entry = i<br />
            GoTo Determ_Entry<br />
        End If<br />
    Next i<br />
Determ_Entry:</p>
<p>    For i = Entry To cnt - 1<br />
            For j = i + 1 To cnt<br />
                    If Val(Worksheets(i).Name) &amp;gt; Val(Worksheets(j).Name) Then<br />
                            Worksheets(j).Move Before:=Worksheets(i)<br />
                    End If<br />
            Next j<br />
    Next i</p>
<p>    curWS.Activate<br />
    'Application.ScreenUpdating = True<br />
End Function<br />
[/sourcecode]</p>
<p>And here comes the macro to implement the 4th requirement.<br />
[sourcecode language="vb"]<br />
Option Explicit</p>
<p>Sub UpdateCells()<br />
'<br />
' UpdateCells Macro<br />
' Macro recorded 7/13/2011 by Bo Yang<br />
'<br />
' Keyboard Shortcut: Ctrl+Shift+C<br />
'<br />
' Risk:Cell<br />
' 5: L2 , 4: L3 , 3: L4 , 2: L5 , 1: L6<br />
Dim Risk5 As Range<br />
Dim num As String, depart As Range, idx As Integer<br />
Dim SheetName As String<br />
Dim SelRange As Range<br />
Dim curWS As Worksheet</p>
<p>Application.ScreenUpdating = False</p>
<p>Set curWS = ActiveSheet<br />
Set SelRange = Selection</p>
<p>idx = 1<br />
For Each depart In SelRange.Columns(2).Cells<br />
    num = SelRange.Columns(1).Cells(idx).value<br />
    If Len(num) = 1 Then<br />
        num = &quot;0&quot; + num<br />
    End If<br />
    SheetName = num + &quot; &quot; + depart.value</p>
<p>    Set Risk5 = SelRange.Columns(3).Cells(idx)</p>
<p>    ThisWorkbook.Sheets(SheetName).Range(&quot;L2:L6&quot;).Copy<br />
    Risk5.Select<br />
    Risk5.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=True<br />
    Application.CutCopyMode = False 'Clear Clipboard</p>
<p>    idx = idx + 1<br />
Next</p>
<p>Application.ScreenUpdating = True<br />
End Sub<br />
[/sourcecode]<br />
<span style="font-size:small;"><span class="Apple-style-span" style="line-height:normal;"><br />
</span></span></p>

        </div>
        <a href="javascript:void(0);" style="float:right" onclick="window.scrollTo(0, 0);">Top</a>
        <div style="clear: both;"></div>
      </div>
    </div>
    
    <div class="main-container shadow">
      <div class="mainbody">
        <h2><a href="/2011/07/11/merge-multi-excel-sheets">将多个Excel文件批量导入某个Excel文件中</a></h2>
        <p>
          Posted by <strong>Bo Yang</strong> at <strong>2011-07-11</strong> with tags <a href="/tags.html#VBA-ref" rel="nofollow">VBA</a>
        </p>
        
        <div class="post_at_index thepost">
        <p>这是我老婆提出的一个需求：(1)选中Excel表格中的某些行或列，运行某个Macro，自动根据选中的cells创建新的worksheets，worksheets的名字就是选中的cells的名字。(2)创建新的worksheet的同时，要把某指定目录下与新的worksheet同名的Excel文件的内容copy到新的worksheet中去。</p>
<p>下面是搜索了半天之后搞出来的Macro，没有异常处理，而且使用了copy/paste，文件太多时效率肯定不高。其实完全可以参照<span style="font-family:Arial, Helvetica, sans-serif;"></span></p>
<p><a href="http://www.exceltip.com/st/Copy_a_sheet_from_each_workbook_into_your_workbook_in_a_folder_using_VBA_in_Microsoft_Excel/560.html">Copy a sheet from each workbook into your workbook in a folder using VBA in Microsoft Excel</a>&nbsp;和 <a href="http://www.ozgrid.com/VBA/SpeedingUpVBACode.htm">Optimize Slow VBA Code</a> 中的方法来优化。</p></p>
<pre>Sub LoadSheets()
    Application.ScreenUpdating = False  ' stop screen flickering
    
    ' Create new sheets according to selected cells and copy the
    ' contebts of other files into the new sheets
    Dim YesNo As Variant, myFolder As String, MyLF As String
        
    MyLF = Chr(10) &amp; Chr(13)    ' a line feed command
    myFolder = &quot;D:Documents and SettingsbonnyMy Documentstools&quot;   'change this to the location of saved XML files
    'Windows 7下C盘默认不可写，请修改DefFolder的值
    
    YesNo = MsgBox(&quot;This Macro is going to create new worksheets according to your selected cells.&quot; &amp; myclf &amp; _
        &quot;Do you want to continue?&quot;, _
        vbYesNo, &quot;Caution&quot;)
    Select Case YesNo
    Case vbYes
        myFolder = InputBox(&quot;Please enter the folder where all your Excel files locates&quot;, Default:=myFolder)
        'Create new worksheets
        For Each cell In Selection.Cells
            Call CreateNewWorksheet(cell.Value, myFolder)
        Next
    Case vbNo
        Exit Sub
    End Select
    
    Application.ScreenUpdating = True
End Sub

Function CreateNewWorksheet(SheetName As String, FolderName As String) As String

    Dim oSheet As Worksheet, vRet As Variant
    Dim fName As String
    
    'creating a new excel worksheet
    Set oSheet = Worksheets.Add
    With oSheet
        .Name = SheetName
        .Move after:=Sheets(Sheets.Count) '在当前所有worksheet后创建新的工作表
        .Activate
    End With
    
    'open Excel files and copy the contents to this sheet
    Dim newWB As Workbook, curWB As Workbook
    Dim startRange As Range
    
    Set curWB = ThisWorkbook ' For WorkBook and Range objects, set is necessary during assignment
    fName = FolderName + &quot;&quot; + SheetName + &quot;.xls&quot;
    Set newWB = Workbooks.Open(fName)
    newWB.Activate
    newWB.Sheets(1).Activate ' 假定只有第一个worksheet需要copy
    Set startRange = newWB.Sheets(1).UsedRange ' Only used range will be copied
    newWB.Sheets(1).UsedRange.Copy
    
    'select the destination cell
    curWB.Activate
    Sheets(SheetName).Activate
    Range(startRange.Address).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False  'Clear Clipboard
    newWB.Close
    
    Exit Function

End Function

</pre></p>

        </div>
        <a href="javascript:void(0);" style="float:right" onclick="window.scrollTo(0, 0);">Top</a>
        <div style="clear: both;"></div>
      </div>
    </div>
    
    <div class="main-container shadow">
      <div class="mainbody">
        <h2><a href="/2011/06/22/solaris-shared-lib-error">Solaris下/usr/lib/secure/0@0.so.1的错误</a></h2>
        <p>
          Posted by <strong>Bo Yang</strong> at <strong>2011-06-22</strong> with tags <a href="/tags.html#Unix/Linux-ref" rel="nofollow">Unix/Linux</a>
        </p>
        
        <div class="post_at_index thepost">
        <p>&nbsp;</p>
<p>这两天一直被下面的错误所困扰：</p>
<p>
<pre>AP13: lb -m ccmscell uptime 
ld.so.1: uname: fatal: /usr/lib/secure/0@0.so.1: open failed: No such file or directory
ksh[216]: 4412 Killed
ld.so.1: uptime: fatal: /usr/lib/secure/0@0.so.1: open failed: No such file or directory
</pre>
<p>&nbsp;&nbsp;</p>
<p>lb是一个调用rsh的脚本，ccmscell是一个server pool，uname是在lb中被调用的。</p>
<p>&nbsp;</p>
<p>仔细研究了N遍相关的脚本，Google了N次相关的错误信息，都没有找到有价&#20540;的线索。后来问了一位做过IT的同事，她说以前遇见过类&#20284;的问题，可她的解决方案最终被证明无效。</p>
<p>&nbsp;</p>
<p>最终发现不是所有的server上执行这条命令都有问题，有些是可以执行的。对比了之后发现，如果/usr/lib/secure/0@0.so.1的group设置为bin，owner设为root，就不会出现上面的问题。出问题的server上/usr/lib/secure/0@0.so.1的group为other。</p>
<p>&nbsp;</p>
<p>进一步调查后发现，/usr/lib/secure/0@0.so.1是在Solaris 5.8上被设为LD_PRELOAD_32的，因为很多程序要被setuid&#043;chroot的伪root调用。当且仅当上面的命令被该伪root执行时，才会出现上面的错误！</p>
<p>&nbsp;</p>
<p>幸亏Solaris 5.8已经开始走进坟墓了，即使在落后如我们公司的地方！</p>
<p>&nbsp;</p>
<p><strong><span style="font-family:mceinline;">【update2011-06-23】：</span></strong></p>
<p><strong><span style="font-family:mceinline;">今天发现root cause 不是由于/usr/lib/secure/0@0.so.1的group不对，而是因为remote server（比如pool&nbsp;ccmscell中的server）上没有/usr/lib/secure/0@0.so.1 —— 执行rsh命令的login是setuid&#043;chroot实现的伪root，因此远程的server就需要/usr/lib/secure/0@0.so.1了。</span></strong></p>
<p><span style="font-family:mceinline;font-weight:bold;">【update 2012-03-12】</span></p>
<p><strong><span style="font-family:mceinline;">今天在Solaris 9上遇到了这样一个错误：</span></strong></p>
<p><span style="font-family:mceinline;">&nbsp; &nbsp; ld.so.1: pt_chmod: warning: /lib/0@0.so.1: open failed: illegal insecure pathname<br />
</span></p>
<p><strong><span style="font-family:mceinline;">查了很久才想起来有可能是</span></strong><strong>/usr/lib/secure/0@0.so.1造成的。一检查</strong><strong>/usr/lib/secure/0@0.so.1，果然不存在。</strong></p>
<p><strong><span style="font-family:mceinline;"></span></strong><strong></strong><strong>在一个正常工作的server上，</strong></p>
<p><strong><span style="font-family:mceinline;"></span></strong><strong></strong><strong></strong>
<pre>AP31: echo $LD_PRELOAD_32
/usr/lib/secure/0@0.so.1</pre></p>
<p><strong><span style="font-family:mceinline;"></span></strong><strong></strong><strong>在不能工作的server上，</strong></p>
<p><strong><span style="font-family:mceinline;"></span></strong><strong></strong><strong></strong>
<pre>AP13: echo $LD_PRELOAD_32
/lib/0@0.so.1</pre></p>
<p><strong><span style="font-family:mceinline;"></span></strong><strong></strong><strong>——仅仅升级了一个软件就又把这个library搞丢了，某些同志们啊，唉……</strong></p>

        </div>
        <a href="javascript:void(0);" style="float:right" onclick="window.scrollTo(0, 0);">Top</a>
        <div style="clear: both;"></div>
      </div>
    </div>
    
    <div class="main-container shadow">
      <div class="mainbody">
        <h2><a href="/2011/06/03/ksh-IPCSCMD-variable">ksh中包含变量的命令调用</a></h2>
        <p>
          Posted by <strong>Bo Yang</strong> at <strong>2011-06-03</strong> with tags <a href="/tags.html#Unix/Linux-ref" rel="nofollow">Unix/Linux</a>, <a href="/tags.html#Shell-ref" rel="nofollow">Shell</a>
        </p>
        
        <div class="post_at_index thepost">
        <p>当一个含有变量a的命令存储在某个变量b中时, 利用$($b)时有可能会报错。如下面的代码，有时可以成功执行，有时会发生&ldquo;ipcs|grep xxx can not be found"的错误。&nbsp;</p>
<p>
<pre>IFS="
"
if isLinux
then
	IPCSCMD="ipcs"
else
	IPCSCMD="ipcs|grep $LOGNAME"
fi
for Eachline in $($IPCSCMD)
do
	IFS=" " # Space
	# Handle IPCs
	...
done</pre>
<p>&nbsp;</p>
<p>究其根源，应该是对IPCSCMD的解析出了问题。将代码改为下面的形式，就可以正确执行了。注意IFS的变化&mdash;&mdash;改成下面的形式后必须将循环内的IFS改为Space和Tab。</p>
<p>
<pre>IFS="
"
if isLinux
then
	ipcs
else
	ipcs|grep $LOGNAME
fi | while read Eachline
do
	IFS=" 	" # Space and tab
	# Handle IPCs
	...
done
</pre>
<p>&nbsp;</p>
<p>&nbsp;</p>

        </div>
        <a href="javascript:void(0);" style="float:right" onclick="window.scrollTo(0, 0);">Top</a>
        <div style="clear: both;"></div>
      </div>
    </div>
    
    <div class="main-container shadow">
      <div class="mainbody">
        <h2><a href="/2011/06/02/chroot-setuid-setgid">chroot, setuid() and set gid</a></h2>
        <p>
          Posted by <strong>Bo Yang</strong> at <strong>2011-06-02</strong> with tags <a href="/tags.html#Unix/Linux-ref" rel="nofollow">Unix/Linux</a>
        </p>
        
        <div class="post_at_index thepost">
        <p>这篇文章搜集整理了网上chroot, setuid() &amp; set gid相关的文章。</p>
<ol>
<li><a href="http://www.unixwiz.net/techtips/chroot-practices.html">Best Practices for UNIX chroot() Operations</a></li>
<li><strong><a href="http://www.bpfh.net/simes/computing/chroot-break.html">How to break out of a&nbsp;<tt>chroot()</tt></a></strong><strong><a href="http://www.bpfh.net/simes/computing/chroot-break.html">&nbsp;jail</a></strong></li>
<li><strong><a href="http://www.cs.berkeley.edu/~daw/papers/setuid-usenix02.pdf">Setuid Demystifid</a></strong></li>
<li><strong><a href="http://oldfield.wattle.id.au/luv/permissions.html">Introduction to Unix file permissions</a></strong></li>
</ol>

        </div>
        <a href="javascript:void(0);" style="float:right" onclick="window.scrollTo(0, 0);">Top</a>
        <div style="clear: both;"></div>
      </div>
    </div>
    
    <div class="main-container shadow">
      <div class="mainbody">
        <h2><a href="/2011/05/20/zcat-gzcat">如何判断一个(压缩)文件的类型，以及zcat/gzcat</a></h2>
        <p>
          Posted by <strong>Bo Yang</strong> at <strong>2011-05-20</strong> with tags <a href="/tags.html#Unix/Linux-ref" rel="nofollow">Unix/Linux</a>
        </p>
        
        <div class="post_at_index thepost">
        <p>恰似&ldquo;一师是个好学校&rdquo;，dd是个好工具&mdash;&mdash;只消用它逐字copy出某个文件第一个block的内容，就可以判断出该文件的类型！！！</p>
<p>&nbsp;</p>
<p>
<pre>bjbldd&gt;1&gt; dd if=MMEgolden.tar bs=512 count=1 &gt; dd_tmp
1+0 records in
1+0 records out
bjbldd&gt;&gt; file dd_tmp
dd_tmp:         USTAR tar archive
bjbldd&gt;&gt; dd if=varofvar bs=512 count=1 &gt; dd_tmp
0+1 records in
0+1 records out
bjbldd&gt;&gt; file dd_tmp
dd_tmp:         executable /bin/ksh script
bjbldd&gt;&gt; dd if=Tk-804.029.tar.gz bs=512 count=1 &gt; dd_tmp
1+0 records in
1+0 records out
bjbldd&gt;&gt; file dd_tmp
dd_tmp:         gzip compressed data - deflate method , original file name , max compression
</pre>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>另外，zcat或者gzcat是用于cat gzip压缩文件的工具，只是在不同的平台有些差异：/bin/zcat在Linux上work的很好，可是当它在Solaris上cat gzip文件的内容时，就会报错。Solaris上cat gzip文件只能用/bin/gzcat. &mdash;&mdash;就是这个小小的差异，浪费了我一天的时间！</p>
<p>&nbsp;</p>
<p>跨平台的cat gzip文件的代码如下：</p>
<p>
<pre>OS="`/bin/uname`"
if [ "${OS}" != "Linux" ]
then
	ZCAT="/bin/zcat"
else
	ZCAT="/bin/gzcat"
fi
.......
${ZCAT} ${TMPDIR}/ngn_platform.cpio.Z | /bin/cpio -idmvu  -H odc ${SAT_CPIO_FLAG}</pre>
<p>&nbsp;</p>
<p>貌似cpio的用法也很强大哦～</p>

        </div>
        <a href="javascript:void(0);" style="float:right" onclick="window.scrollTo(0, 0);">Top</a>
        <div style="clear: both;"></div>
      </div>
    </div>
    

    <div class="main-container shadow">
      <div class="mainbody">
        
<div class="pagination">
    <ul>
    
        <li class="prev">
        <a href="/page5">&larr; Previous</a>
        
        </li>
    

    
        <li><a href="/">1</a></li>
        

        
            <li><a href="/page2">2</a></li>
            
        
            <li><a href="/page3">3</a></li>
            
        
            <li><a href="/page4">4</a></li>
            
        
            <li><a href="/page5">5</a></li>
            
        
            <li class="disabled"><a>6</a></li>
            
        
            <li><a href="/page7">7</a></li>
            
        
            <li><a href="/page8">8</a></li>
            
        
            <li><a href="/page9">9</a></li>
            
        
            <li><a href="/page10">10</a></li>
            
        
            <li><a href="/page11">11</a></li>
            
        
            <li><a href="/page12">12</a></li>
            
        
            <li><a href="/page13">13</a></li>
            
        
            <li><a href="/page14">14</a></li>
            
        
            <li><a href="/page15">15</a></li>
            
        
            <li><a href="/page16">16</a></li>
            
        
            <li><a href="/page17">17</a></li>
            
        
            <li><a href="/page18">18</a></li>
            
        
            <li><a href="/page19">19</a></li>
            
        
            <li><a href="/page20">20</a></li>
            
        
    

    
        <li class="next"><a href="/page7">Next &rarr;</a></li>
    
    </ul>
</div>


      </div>
    </div>

  </div>

  <div class="span3 right">

	<div class="side-container shadow">
      <div class="sidebar">
        
        <h3>Links</h3>
        <ul>
        
        
    <li><a href=https://github.com/bo-yang title="My GitHub Channel">My GitHub Channel</a></li>

    <li><a href=https://www.linkedin.com/pub/bo-yang/21/a3/893 title="My Linkedin Page">My Linkedin Page</a></li>

    <li><a href=http://blog.csdn.net/bonny95 title="My Chinese Blog(obsolete)">My Chinese Blog(obsolete)</a></li>

        </ul>
        
      </div>
    </div>

	<div class="side-container shadow">
      <div class="sidebar">
        
        <h3>Tags</h3>
        <div class="tag_box">
        
        
  
    
        <a href="/tags.html#MFC-ref" class="btn btn-mini">MFC <span>10</span></a>
    
        <a href="/tags.html#Algorithm-ref" class="btn btn-mini">Algorithm <span>11</span></a>
    
        <a href="/tags.html#C-ref" class="btn btn-mini">C <span>16</span></a>
    
        <a href="/tags.html#EMC-ref" class="btn btn-mini">EMC <span>5</span></a>
    
        <a href="/tags.html#fault diagnosis-ref" class="btn btn-mini">fault diagnosis <span>2</span></a>
    
        <a href="/tags.html#EMI-ref" class="btn btn-mini">EMI <span>1</span></a>
    
        <a href="/tags.html#notes-ref" class="btn btn-mini">notes <span>3</span></a>
    
        <a href="/tags.html#CBR-ref" class="btn btn-mini">CBR <span>1</span></a>
    
        <a href="/tags.html#AI-ref" class="btn btn-mini">AI <span>5</span></a>
    
        <a href="/tags.html#Database-ref" class="btn btn-mini">Database <span>1</span></a>
    
        <a href="/tags.html#电磁兼容-ref" class="btn btn-mini">电磁兼容 <span>4</span></a>
    
        <a href="/tags.html#Unix-ref" class="btn btn-mini">Unix <span>1</span></a>
    
        <a href="/tags.html#Linux-ref" class="btn btn-mini">Linux <span>5</span></a>
    
        <a href="/tags.html#Personal-ref" class="btn btn-mini">Personal <span>10</span></a>
    
        <a href="/tags.html#Unix/Linux-ref" class="btn btn-mini">Unix/Linux <span>88</span></a>
    
        <a href="/tags.html#网络/通信-ref" class="btn btn-mini">网络/通信 <span>1</span></a>
    
        <a href="/tags.html#Telecommunication-ref" class="btn btn-mini">Telecommunication <span>1</span></a>
    
        <a href="/tags.html#Tcl/Tk-ref" class="btn btn-mini">Tcl/Tk <span>6</span></a>
    
        <a href="/tags.html#Shell-ref" class="btn btn-mini">Shell <span>12</span></a>
    
        <a href="/tags.html#Network/Telecom-ref" class="btn btn-mini">Network/Telecom <span>3</span></a>
    
        <a href="/tags.html#Perl-ref" class="btn btn-mini">Perl <span>14</span></a>
    
        <a href="/tags.html#Essay-ref" class="btn btn-mini">Essay <span>12</span></a>
    
        <a href="/tags.html#Industry-ref" class="btn btn-mini">Industry <span>6</span></a>
    
        <a href="/tags.html#Cloud Computing-ref" class="btn btn-mini">Cloud Computing <span>2</span></a>
    
        <a href="/tags.html#Android-ref" class="btn btn-mini">Android <span>2</span></a>
    
        <a href="/tags.html#VBA-ref" class="btn btn-mini">VBA <span>4</span></a>
    
        <a href="/tags.html#ESXi-ref" class="btn btn-mini">ESXi <span>1</span></a>
    
        <a href="/tags.html#Virtual Machine-ref" class="btn btn-mini">Virtual Machine <span>2</span></a>
    
        <a href="/tags.html#Browser-ref" class="btn btn-mini">Browser <span>2</span></a>
    
        <a href="/tags.html#Plan 9-ref" class="btn btn-mini">Plan 9 <span>9</span></a>
    
        <a href="/tags.html#Go-ref" class="btn btn-mini">Go <span>3</span></a>
    
        <a href="/tags.html#Virtualization-ref" class="btn btn-mini">Virtualization <span>2</span></a>
    
        <a href="/tags.html#CPP-ref" class="btn btn-mini">CPP <span>6</span></a>
    
        <a href="/tags.html#Linux/UNIX-ref" class="btn btn-mini">Linux/UNIX <span>1</span></a>
    
        <a href="/tags.html#Tips-ref" class="btn btn-mini">Tips <span>5</span></a>
    
        <a href="/tags.html#RHEL6.1-ref" class="btn btn-mini">RHEL6.1 <span>1</span></a>
    
        <a href="/tags.html#RPC-ref" class="btn btn-mini">RPC <span>1</span></a>
    
        <a href="/tags.html#rup-ref" class="btn btn-mini">rup <span>1</span></a>
    
        <a href="/tags.html#ksh-ref" class="btn btn-mini">ksh <span>1</span></a>
    
        <a href="/tags.html#Ubuntu-ref" class="btn btn-mini">Ubuntu <span>1</span></a>
    
        <a href="/tags.html#file descriptor-ref" class="btn btn-mini">file descriptor <span>1</span></a>
    
        <a href="/tags.html#Expect-ref" class="btn btn-mini">Expect <span>1</span></a>
    
        <a href="/tags.html#Here Document-ref" class="btn btn-mini">Here Document <span>1</span></a>
    
        <a href="/tags.html#C/C++-ref" class="btn btn-mini">C/C++ <span>6</span></a>
    
        <a href="/tags.html#Evolutionary Computation-ref" class="btn btn-mini">Evolutionary Computation <span>1</span></a>
    
        <a href="/tags.html#Genetic Algorihtm-ref" class="btn btn-mini">Genetic Algorihtm <span>1</span></a>
    
        <a href="/tags.html#ldd-ref" class="btn btn-mini">ldd <span>1</span></a>
    
        <a href="/tags.html#signal-ref" class="btn btn-mini">signal <span>1</span></a>
    
        <a href="/tags.html#swap-ref" class="btn btn-mini">swap <span>1</span></a>
    
        <a href="/tags.html#NIC-ref" class="btn btn-mini">NIC <span>1</span></a>
    
        <a href="/tags.html#Mac OS-ref" class="btn btn-mini">Mac OS <span>1</span></a>
    
        <a href="/tags.html#VNC-ref" class="btn btn-mini">VNC <span>1</span></a>
    
        <a href="/tags.html#X11-ref" class="btn btn-mini">X11 <span>1</span></a>
    
        <a href="/tags.html#Merge sort-ref" class="btn btn-mini">Merge sort <span>1</span></a>
    
        <a href="/tags.html#boost-ref" class="btn btn-mini">boost <span>1</span></a>
    
        <a href="/tags.html#CDF-ref" class="btn btn-mini">CDF <span>1</span></a>
    
        <a href="/tags.html#Matlab-ref" class="btn btn-mini">Matlab <span>3</span></a>
    
        <a href="/tags.html#Multi-Process-ref" class="btn btn-mini">Multi-Process <span>1</span></a>
    
        <a href="/tags.html#Multi-Threading-ref" class="btn btn-mini">Multi-Threading <span>1</span></a>
    
        <a href="/tags.html#Bioinformatics-ref" class="btn btn-mini">Bioinformatics <span>1</span></a>
    
        <a href="/tags.html#Computer Vision-ref" class="btn btn-mini">Computer Vision <span>3</span></a>
    
        <a href="/tags.html#DTF-ref" class="btn btn-mini">DTF <span>2</span></a>
    
        <a href="/tags.html#ffmpeg-ref" class="btn btn-mini">ffmpeg <span>1</span></a>
    
        <a href="/tags.html#OpenCV-ref" class="btn btn-mini">OpenCV <span>1</span></a>
    
        <a href="/tags.html#Machine Learning-ref" class="btn btn-mini">Machine Learning <span>1</span></a>
    
        <a href="/tags.html#parfor-ref" class="btn btn-mini">parfor <span>1</span></a>
    
        <a href="/tags.html#BACI-ref" class="btn btn-mini">BACI <span>1</span></a>
    
        <a href="/tags.html#Alogrithm-ref" class="btn btn-mini">Alogrithm <span>1</span></a>
    
        <a href="/tags.html#Jekyll-ref" class="btn btn-mini">Jekyll <span>1</span></a>
    
        <a href="/tags.html#Github-ref" class="btn btn-mini">Github <span>1</span></a>
    
        <a href="/tags.html#Fisher Vector-ref" class="btn btn-mini">Fisher Vector <span>1</span></a>
    
        <a href="/tags.html#SVM-ref" class="btn btn-mini">SVM <span>1</span></a>
    
  



        </div>
        
      </div>
    </div>

    <div class="side-container shadow">
      <div class="sidebar">
        
        <h3>Recent Posts</h3>
        <ul>
        
          <li><span>2014-06-17</span> &raquo; <a href="/2014/06/17/sort-colors">
            Sort Colors</a></li>
        
          <li><span>2014-06-14</span> &raquo; <a href="/2014/06/14/soduku">
            Check Soduku Solution</a></li>
        
          <li><span>2014-06-12</span> &raquo; <a href="/2014/06/12/lru-cache">
            Least Recently Used(LRU) Cache</a></li>
        
          <li><span>2014-05-26</span> &raquo; <a href="/2014/05/26/binary-tree-traversal">
            Binary Tree Operations</a></li>
        
          <li><span>2014-04-30</span> &raquo; <a href="/2014/04/30/fisher-vector-in-action-recognition">
            Action Recognition with Fisher Vectors</a></li>
        
          <li><span>2014-03-29</span> &raquo; <a href="/2014/03/29/how-to-install-jekyll-in-mac-osx-mavericks">
            How To Install Jekyll in Mac OSX Mavericks</a></li>
        
          <li><span>2014-03-26</span> &raquo; <a href="/2014/03/26/c-code-to-print-pascal-triangle">
            C++ Code to Print Pascal Triangle</a></li>
        
          <li><span>2014-01-22</span> &raquo; <a href="/2014/01/22/baci-simple-install-and-compile-guide">
            BACI Simple Install and Compile Guide</a></li>
        
          <li><span>2014-01-10</span> &raquo; <a href="/2014/01/10/dense-trajectory-notes">
            Dense Trajectory Notes</a></li>
        
          <li><span>2013-10-20</span> &raquo; <a href="/2013/10/20/parallel-mex-file-in-matlab">
            Parallelize mex file in Matlab</a></li>
        
        </ul>
        
      </div>
    </div>

   </div>

</div>

  </div>
</div>


    </div>

    <footer>
        <p>&copy; 2007 <span id="now_year"></span> Bo Yang. </p>
        <script type="text/javascript">
          var now_year = new Date().getFullYear();
          if (now_year != 2007) {
              $('#now_year').html('- ' + now_year);
          }
        </script>
      </footer>
  </div>

  <script type="text/javascript" src="/assets/themes/clear/google-code-prettify/prettify.js"></script>
  <script type="text/javascript">
    $(function() {

      $('a[href^="http"]').each(function () {
        $(this).attr('target', '_blank');
      });

      $('pre').addClass('prettyprint linenums').attr('style', 'overflow:auto');
      window.prettyPrint && prettyPrint();

      function traverse($node, len, maxCount) {
        var reachMaxCount = len > maxCount;
        if (reachMaxCount) {
          $node.hide();
        }
        var $contents = $node.contents();
        for (var i = 0; i < $contents.length; ++i) {
          if (reachMaxCount) {
            $contents.eq(i).hide();
            continue;
          }
          if ($contents[i].nodeType == 3) { // TextNode
            var tmp = len;
            var s = $contents[i].nodeValue;
            len += s.length;
            reachMaxCount = len > maxCount;
            if (reachMaxCount && $contents[i].parentNode.nodeName != 'A') {
              $contents[i].nodeValue = s.substring(0, maxCount - tmp);
            }
          }
          else if ($contents[i].nodeType == 1) { // Element
            len = traverse($contents.eq(i), len, maxCount);
          }
        }
        return len;
      }

      $('.post_at_index').each(function() {
        var count = traverse($(this), 0, 400);
        if (count > 400) {
          var thisUrl = $(this).siblings().first().children().attr('href');
          $(this).after('\n<a href="' + thisUrl + '" rel="nofollow">' + 'Read More ...</a>');
        }
      });
    });
  </script>
  

</body>
</html>

