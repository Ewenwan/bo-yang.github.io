<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Bo's Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Bo&#39;s blog.">
    <meta name="author" content="Bo Yang">
    
    <link rel="canonical" href="http://www.bo-yang.net//page7/">
    <link rel="alternate" type="application/rss+xml" title="RSS Feed for Bo's Blog" href="/feed.xml" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/pixyll.css?201602041831" type="text/css">

    <!-- Fonts -->
    <link href='//fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Lato:900,300' rel='stylesheet' type='text/css'>
    
      <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet">
    

    <!-- Google Prettify -->
    <link href="http://www.bo-yang.net//assets/google-code-prettify/desert.css" rel="stylesheet" type="text/css" media="all">

    <!-- MathJax -->
    
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
    

    <!-- Verifications -->
    

    <!-- Open Graph -->
    <!-- From: https://github.com/mmistakes/hpstr-jekyll-theme/blob/master/_includes/head.html -->
    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Bo&#39;s Blog">
    <meta property="og:description" content="Bo&#39;s blog.">
    <meta property="og:url" content="http://www.bo-yang.net//page7/">
    <meta property="og:site_name" content="Bo&#39;s Blog">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    
        <meta name="twitter:site" content="@bonnyang" />
    
    <meta name="twitter:title" content="Bo's Blog" />
    <meta name="twitter:description" content="Bo's blog." />
    <meta name="twitter:url" content="http://www.bo-yang.net//page7/" />

    <!-- Icons -->
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-160x160.png" sizes="160x160">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">

    
    <script type="text/javascript">
       (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
       (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
       m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
       })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
       ga('create', 'UA-50551633-1', 'auto');
       ga('send', 'pageview');
    </script>
    
</head>

<body class="site">

	
		<div id="fb-root"></div>
		<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.5&appId=";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));</script>
	

  <div class="site-wrap">
    <header class="site-header px2 px-responsive">
  <div class="mt2 wrap">
    <div class="measure">
        <a href="http://www.bo-yang.net/" class="site-title"><b>Bo's Blog</b></a>
      <nav class="site-nav">
        
    

    

    
        <a href="/archive/">Archive</a>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    


    

    

    

    

    

    

    

    
        <a href="/tags/">Tags</a>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    


    

    
        <a href="/about/">About Me</a>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    


    

    

    

    
        <a href="/contact/">Contact</a>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    


      </nav>
      <div class="clearfix"></div>
      
        <div class="social-icons">
  <div class="social-icons-right">
    
      <a class="fa fa-github" href="https://github.com/bo-yang"></a>
    
    
    
      <a class="fa fa-stack-overflow" href="https://stackoverflow.com/users/boyang"></a>
    
    <a class="fa fa-rss" href="/feed.xml"></a>
    
      <a class="fa fa-twitter" href="https://twitter.com/bonnyang"></a>
    
    
    
    
    
      <a class="fa fa-envelope" href="mailto:bonny95@gmail.com"></a>
    
    
      <a class="fa fa-linkedin" href="https://www.linkedin.com/in/boyanglink"></a>
    
    
    
  </div>
  <div class="right">
    
    
    
  </div>
</div>
<div class="clearfix"></div>

      
    </div>
  </div>
</header>


    <div class="post p2 p-responsive wrap" role="main">
      <div class="measure">
        

<div class="home">
  
    <div class="posts">
      
        <div class="post py3">
          <p class="post-meta">Jun 14, 2012</p>
          <a href="/2012/06/14/sock_raw-issue-with-setuidchroot-ed-login-on-linux-serversstill-unresolved" class="post-link"><h3 class="h2 post-title">SOCK_RAW Issue with setuid and chroot-ed login on Linux Servers(Still Unresolved)</h3></a>
          <p class="post-summary">
            
              <p>Problem:</p>
<blockquote><p>when using function socket(AF_INET,<strong>SOCK_RAW</strong>,IPPROTO_TCP...) with setuid&amp;chroot-ed fake root on Linux servers, it would always fail. However, the real root can work well. Usually the fake root can do most things that root login required.
</p></blockquote>
<p>After investigation, got following hints:</p>
<ul>
<li>According to man page of <a href="http://linux.die.net/man/7/raw">SOCK_RAW(7)</a>, &quot;Only processes with an effective user ID of 0 or the CAP_NET_RAW capability are allowed to open raw sockets&quot;.</li>
<li>According to <a href="http://www.kernel.org/doc/man-pages/online/pages/man7/capabilities.7.html">capabilities(7) - Linux man page</a>, &quot;For the purpose of performing permission checks, traditional UNIX implementations distinguish two categories of processes: privileged processes (whose effective user ID is 0, referred to as superuser or root), and unprivileged processes (whose effective UID is nonzero). Privileged processes bypass all kernel permission checks, while unprivileged processes are subject to full permission checking based on the process's credentials (usually: effective UID, effective GID, and supplementary group list)&quot;.</li>
</ul>
<blockquote><p>Starting with kernel 2.2, Linux divides the privileges traditionally associated with superuser into distinct units, known as capabilities, which can be independently enabled and disabled. Capabilities are a per-thread attribute.
</p></blockquote>
<blockquote><p>CAP_NET_RAW
</p></blockquote>
<blockquote><blockquote> Use RAW and PACKET sockets.</p>
</blockquote>
</blockquote>
<ul>
<li>In raw socket access as normal user on linux 2.4, setuid is suggested, but it didn’t work.</li>
</ul>
<p>Since we can't provide root login to all users, we must either find a way to let raw sockets work with setuid&amp;chroot-ed login, or substitute raw sockets with other options.</p>

            
          </p>
        </div>
      
        <div class="post py3">
          <p class="post-meta">Jun 4, 2012</p>
          <a href="/2012/06/04/ldd-error" class="post-link"><h3 class="h2 post-title">Error "ldd:  execution failed due to signal 9"</h3></a>
          <p class="post-summary">
            
              <p>Today, one of my folks met a very weird problem and finally he asked me for help. The issue was, when running command "ldd CDNap" on a Solaris 9 server(AP11), following error would show up:</p>
<p><code>AP11: ldd CDNap<br />
ldd: CDNap: execution failed due to signal 9</code></p>
<p>However, when running this command on another Solaris 9 server(ap15), it worked well.</p>
<p>According to <a href="https://forums.oracle.com/forums/thread.jspa?threadID=1919581">Weird exec failure</a>, "<strong>My bet is that the program has a rather large BSS segment, and there isn't enough swap to reserve the space. (ldd(1) works by setting up some environment variables, then running the program itself, which is why it would fail)</strong>". To verify this, you can run</p>
<pre>/usr/ccs/bin/size /path/to/program</pre>
<p>To check the free space of swap, you can</p>
<pre>swap -s</pre>
<p>After comparing the swap space and memory of the two Solaris servers, I noticed that the server(AP11) bearing this issue has smaller memory(1GB) and swap space(only 75008k available).</p>
<pre>AP11: swap -l
swapfile             dev  swaplo blocks   free
/dev/dsk/c0t2d0s1   136,1      16 4198304 4198304
AP11: swap -s
total: 513384k bytes allocated + 2296288k reserved = 2809672k used, 75008k available
AP11: uname -a
SunOS coolap22n 5.9 Generic_122300-61 sun4u sparc SUNW,UltraAX-i2
AP11: prtconf|grep Memory
Memory size: 1024 Megabytes</pre>
<p>Server(ap15) without ldd issue has 2GB memory and larger swap(4966160k available).</p>
<pre>ap15:root &gt; swap -s
total: 372136k bytes allocated + 522864k reserved = 895000k used, 4966160k available
ap15:root &gt; df -k swap
Filesystem            kbytes    used   avail capacity  Mounted on
swap                 1793064960 1589658648 203406312    89%    /tmp
ap15:root &gt; swap -l
swapfile             dev  swaplo blocks   free
/dev/dsk/c0t2d0s1   136,1      16 8392544 8392544
ap15:root &gt; uname -a
SunOS coolap10n 5.9 Generic_122300-61 sun4u sparc SUNW,UltraAX-i2</pre>
<p>It seems it's time for such old Solaris servers to retire.</p>

            
          </p>
        </div>
      
        <div class="post py3">
          <p class="post-meta">May 4, 2012</p>
          <a href="/2012/05/04/string-evolver" class="post-link"><h3 class="h2 post-title">String Evolver, My First Genetic Algorithm</h3></a>
          <p class="post-summary">
            
              <p>When reading <em>Evolutionary Computation for Modeling and Optimization[1]</em>, I found following problem in section 1.2.3:</p>
<p><strong><em>A string evolver is an evolutionary algorithm that tries to match a reference string from a population of random strings. The underlying character set of the string evolver is the alphabet from which the strings are drawn.</em></strong></p>
<p>The solution given in the context is:</p>
<ol>
<li>Start with a reference string and a population of random strings.</li>
<li>The fitness of a string is the number of positions in which it has the same character as the reference string.</li>
<li>To evolve the population, split it into small random groups called&nbsp;tournaments.</li>
<li>Copy the most fit string(break ties by picking at random among the most fit strings) over the least fit string in each tournament.</li>
<li>Then change one randomly chosen character in each copy(mutation).</li>
<li>Repeat until an exact match with the reference string is obtained.</li>
</ol>
<p>When trying this solution, I noticed that it won't converge even after a long time. Therefore, I modified the crossover and mutation strategy.<strong>A subset of population(strings) will be selected based on fitness in a tournament, and the bottom-ranked<br />
 50% of each tournament will be deleted. New population is formed by crossing the remaining high 20 individuals in a tournament, while the high-ranked parents are kept unchanged[2]. Finally, a random selected string in a tournament will be mutated.</strong></p>
<p>
My codes are:</p></p>
<pre>#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;


            
          </p>
        </div>
      
        <div class="post py3">
          <p class="post-meta">May 2, 2012</p>
          <a href="/2012/05/02/ubuntu-1204-update" class="post-link"><h3 class="h2 post-title">升级Ubuntu 12.04所遇到的一些问题</h3></a>
          <p class="post-summary">
            
              <p>升级Ubuntu 11.10到12.04后，开机报错“<em>no partition found</em>”,进入Grub后，输入&quot;ls&quot;命令，也报错“no partition found”。可见Grub已经崩溃了。</p>
<p>于是我下载了<a href="http://unetbootin.sourceforge.net/">UNetbootin</a>，然后利用它在Win 7下制作Ubuntu自启动U盘。制作好之后，结果发现不会自动引导启动，需要在开机之后出现Thinkpad欢迎界面时按F12，然后选择U盘启动。然后选择U盘启动Ubuntu，进入Ubuntu后按照&nbsp;<a href="http://www.webupd8.org/2009/12/how-to-recover-grub2-linux.html">How to<br />
 Fix Grub 2</a>&nbsp;中的方法安装Grub 2到硬盘。</p></p>
<div style="color:rgb(85,85,85);font-size:14px;line-height:20px;text-align:justify;margin:0;padding:0;">
<span style="margin:0;padding:0;">To fix GRUB 2, you need an Ubuntu live CD from which you need to boot.</span>&nbsp;Once you boot to the LIVE<br />
 CD, open a terminal an and type these commands:</div>
<p><br style="color:rgb(85,85,85);font-size:14px;line-height:20px;margin:0;padding:0;" /></p>
<div style="color:rgb(85,85,85);font-size:14px;line-height:20px;text-align:justify;margin:0;padding:0;">
<span style="font-weight:bold;margin:0;padding:0;">a) Firstly, you need to find out on which partition your Linux system is installed:</span><br style="margin:0;padding:0;" /></p>
<pre class="linux-code" style="margin-top:10px;margin-bottom:10px;margin-left:10px;background-color:rgb(229,202,202);color:rgb(0,0,0);font-size:13px;font-family:'UbuntuBeta Mono', 'Ubuntu Mono', 'Courier New', Courier, monospace;max-height:500px;min-height:16px;overflow-x:auto;overflow-y:auto;width:522px;z-index:10000;border-color:rgb(155,5,5);border-style:solid;border-width:1px 1px 1px 20px;padding:28px 10px 10px;"><code style="margin:0;padding:0;">sudo fdisk -l</code></pre>
<p>(in my case, it's &quot;sda1&quot;)<br style="margin:0;padding:0;" /><br />
<br style="margin:0;padding:0;" /><br />
<span style="font-weight:bold;margin:0;padding:0;">b) Now, we must mount this partition:</span><br style="margin:0;padding:0;" /></p>
<pre class="linux-code" style="margin-top:10px;margin-bottom:10px;margin-left:10px;background-color:rgb(229,202,202);color:rgb(0,0,0);font-size:13px;font-family:'UbuntuBeta Mono', 'Ubuntu Mono', 'Courier New', Courier, monospace;max-height:500px;min-height:16px;overflow-x:auto;overflow-y:auto;width:522px;z-index:10000;border-color:rgb(155,5,5);border-style:solid;border-width:1px 1px 1px 20px;padding:28px 10px 10px;"><code style="margin:0;padding:0;">sudo mount /dev/<span style="font-weight:bold;margin:0;padding:0;">sda1</span> /mnt</code></pre>
<p>Where &quot;sda1&quot; is the partition where you installed Ubuntu (or any other Linux distro). It could be &quot;sda5&quot;, &quot;sda6&quot;, etc. for you.<br style="margin:0;padding:0;" /><br />
<br style="margin:0;padding:0;" /><br />
<span style="font-weight:bold;margin:0;padding:0;">c) Install grub to the partition you've mounted:</span><br style="margin:0;padding:0;" /></p>
<pre class="linux-code" style="margin-top:10px;margin-bottom:10px;margin-left:10px;background-color:rgb(229,202,202);color:rgb(0,0,0);font-size:13px;font-family:'UbuntuBeta Mono', 'Ubuntu Mono', 'Courier New', Courier, monospace;max-height:500px;min-height:16px;overflow-x:auto;overflow-y:auto;width:522px;z-index:10000;border-color:rgb(155,5,5);border-style:solid;border-width:1px 1px 1px 20px;padding:28px 10px 10px;"><code style="margin:0;padding:0;">sudo grub-install --root-directory=/mnt/ /dev/sda</code></pre>
<p><br style="margin:0;padding:0;" /><br />
<br style="margin:0;padding:0;" /><br />
<span style="background-color:rgb(255,255,177);border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(223,223,223);border-right-width:1px;border-right-style:solid;border-right-color:rgb(223,223,223);color:rgb(51,51,51);margin:0;padding:0 2px;">Important:</span>&nbsp;Please<br />
 notice that it's &quot;/dev/sda&quot;, not &quot;/dev/sda1&quot;. &quot;sda&quot; is the hard disk on which your Linux distribution is installed!<br style="margin:0;padding:0;" /><br />
<br style="margin:0;padding:0;" /><br />
<span style="font-weight:bold;margin:0;padding:0;">d) Restart your computer. As previous Grub 2 entries are removed, run the following<br />
 command to restore them:</span><br style="margin:0;padding:0;" /></p>
<pre class="linux-code" style="margin-top:10px;margin-bottom:10px;margin-left:10px;background-color:rgb(229,202,202);color:rgb(0,0,0);font-size:13px;font-family:'UbuntuBeta Mono', 'Ubuntu Mono', 'Courier New', Courier, monospace;max-height:500px;min-height:16px;overflow-x:auto;overflow-y:auto;width:522px;z-index:10000;border-color:rgb(155,5,5);border-style:solid;border-width:1px 1px 1px 20px;padding:28px 10px 10px;"><code style="margin:0;padding:0;">sudo update-grub</code></pre>
</div>
<p>我以前是用USB Stick安装的Ubuntu，在安装过程中有一选项是选择引导程序的安装位置，默认是/dev/sdb，也就是U盘。因为当时我没注意，所以Grub 2被安装到了U盘，尽管事后重新安装到了硬盘上，但貌&#20284;升级后还是不太正常。</p>
<p>重启电脑进入Grub 2之后，输入命令（Grub 2中已经不再支持kernel命令，需要用<strong><em>linux</em></strong>指定kernel）：</p></p>
<pre>linux (hd0,X)/vmlinuz-3.2......
initrd (hd0,X)/initrd.img-3.2......
boot</pre>
<p>悲哀的是系统启动到一半仍然无法进入GUI或者shell。多次检查测试后确认 / 所在的分区已经崩溃，Ubuntu根本无法识别。</p>
<p>虽然不想，但此时我已别无选择，只能重新安装Ubuntu 12.04了。可惜我电脑里那些尚未备份的文件和电影啊……</p>
<p></p>

            
          </p>
        </div>
      
        <div class="post py3">
          <p class="post-meta">Apr 21, 2012</p>
          <a href="/2012/04/21/briss-intro" class="post-link"><h3 class="h2 post-title">Briss -- Crop the Margins of Your PDF Files</h3></a>
          <p class="post-summary">
            
              <p><span style="font-size:18px;">今天用iPad阅读一个PDF文档时，发现每页留白太多，字体特别小，在iBooks中每翻一页都要手动去缩放，实在是麻烦。于是搜索去掉PDF留白的方法。</span></p>
<p><span style="font-size:18px;">先是寄希望于Linux系统自带的pdfcrop，结果尝试了各种选项后，发现PDF的size没有变，还是原来的8.5x8.9 inch。</span></p>
<p><span style="font-size:18px;">后来搜索Ghostscript的用法，把papersize或者resolution强制改成希望的数&#20540;，仍然没有变化。郁闷！</span></p>
<p><span style="font-size:18px;">再后来发现了网上的一个PDFcrop版本，也是用Perl写的，只是更加友好一点，尝试之后仍不奏效。自己上手用hardcode改为自己想要的结果，失败。不过在该tool中最大的发现就是<em> 1inch=28.3464567bp(dpi)</em>.</span></p>
<p><span style="font-size:18px;">总结一晚上失败的经验就是：<strong>该PDF文档是扫描的图片转PDF&#26684;式，而不是文字直接转的，因此pdfcrop等工具无法发现并处理留白！</strong></span></p>
<p><span style="font-size:18px;">最后在网上搜索PDF Margin Crop，无意中发现了<a href="http://sourceforge.net/projects/briss/">Briss</a>，抱着试试看的心态下载使用了一下，发现竟然能够识别图片转PDF的文字区域，拖动左上或右下脚上的蓝色正方形区域还可一手动选择保留的区域， Terrific！</span></p>
<p><span style="font-size:18px;">使用方法就是下载<a href="http://sourceforge.net/projects/briss/">Briss</a>，解压缩，然后执行</span></p></p>
<pre>java -jar briss-0.0.13.jar
or
java -jar briss-0.0.13.jar cropthis.pdf


            
          </p>
        </div>
      
        <div class="post py3">
          <p class="post-meta">Mar 6, 2012</p>
          <a href="/2012/03/06/using-expect-here-document-in-shell-scripts-4" class="post-link"><h3 class="h2 post-title">Using Expect Here Document in Shell Scripts</h3></a>
          <p class="post-summary">
            
              <p>Sometimes simple interactions are needed for Shell scripts. In this scenario, a here document written in Expect will work well. In following example, the output of Expect here document is assigned to KSH variable rcs_stat.<br />
<P></p>
<pre class="python">#!/bin/ksh

autoload formatAPnum

# Set the lab name, COOLLAB
. $COOLXDIR/.netlabs
# Get the RCS cell list
set -A RCSs
typeset -i nx=0
cat $COOLXDIR/.coolcell2dcs | while read cell
do
	if [[ &quot;$cell&quot; = c* ]]
	then
		rcs=${cell%%$COOLLAB*}
		RCSs[$nx]=${rcs#c}
		nx=$nx+1
	fi
done

# Check RCS status
typeset -i loopCount=0
rcs_cnt=${#RCSs[*]}
B_server=$(formatAPnum $BserverAP)
while [ &quot;${#RCSs[*]}&quot; != 0 -a $loopCount -lt 720 ]  # wait at most 2 hours
do
	loopCount=${loopCount}+1

	nx=0
	while [ $nx -lt $rcs_cnt ]
	do
		rcs_stat=&quot;OOS&quot;
		rcs_stat=$(
expect - &lt;&lt;!
log_user 0
set timeout 20
spawn $COOL_RSH ap$B_server TICLI
send &quot;op:cell ${RCSs[$nx]}\r&quot;
expect {
	timeout {puts &quot;OOS\n&quot;}
	&quot;*DL(S) DOWN&quot; {puts &quot;OOS\n&quot;}
	&quot;*DL(S) UP&quot; {puts &quot;UP\n&quot;}
}
!
		)

		if [ &quot;$rcs_stat&quot; = &quot;UP&quot; ]
		then
			coolprint - &quot;RCS cell ${RCSs[$nx]} is up.&quot;
			unset RCSs[$nx]
		fi

		nx=${nx}+1
	done

	[ -n &quot;${RCSs[*]}&quot; ] &amp;&amp; sleep 10 
done

coolprint - &quot;All RCSs are up.&quot;
exit 0
</pre>
<p>&nbsp;</p>

            
          </p>
        </div>
      
        <div class="post py3">
          <p class="post-meta">Mar 6, 2012</p>
          <a href="/2012/03/06/expect-here-doc-in-shell" class="post-link"><h3 class="h2 post-title">Shell中使用Expect Here Document</h3></a>
          <p class="post-summary">
            
              <p>在使用Shell写程序时，有时不得不面对交互的问题——可惜shell往往无法自动完成交互。如果交互的内容很多，自然是直接应用Expect脚本比较方便；如果交互的内容很少，而且考虑到Shell的易用性，在Shell脚本中创建一个Expect 的Here Document更加方便灵活。</p>
<p>如下例所示，Expect&nbsp;Here Document可以直接运行并将运行结果赋给KSH变量rcs_stat。</p>
<p>
<pre>#!/bin/ksh


            
          </p>
        </div>
      
        <div class="post py3">
          <p class="post-meta">Feb 2, 2012</p>
          <a href="/2012/02/02/file-descriptors-per-process" class="post-link"><h3 class="h2 post-title">File Descriptors per Process</h3></a>
          <p class="post-summary">
            
              <p>A file descriptor is a handle created by a process when a file is opened. There is a limit to the amount of file descriptors per process. In order to check the default limit of the system, you can use command:</p>
<ol>
<li><code>ulimit -a # all limitations</code></li>
<li><code>ulimit -Sn # soft limit</code></li>
<li><code>ulimit -Hn # hard limit</code></li>
</ol>
<p>If the file descriptor limit is exceeded for a process, you may see the error <code>Too Many Open Files</code>.</p>
<p>And if you want to change the limit per process temporarily, you can:</p>
<ol>
<li><code>ulimit -n &lt;desired_#&gt; # both</code></li>
<li><code>ulimit -Sn &lt;desired_#&gt; # soft limit</code></li>
<li><code>ulimit -Hn &lt;desired_#&gt; # hard limit</code></li>
</ol>
<p>To check the open files of a process, you can use command <code>pfiles &lt;PID&gt;</code>.</p>
<p>To check the run time limit of each process in Solaris, you can <code>plimit &lt;PID&gt;</code>(it seems this command is not supported in Linux). If you have the root permission and you want to change the limit of an process without killing or restarting the process, you can <code>plimit -n &lt;desired_#&gt;</code>.</p>
<p>It was said that it may be dangerous to set the soft limit higher than 256 or hard limit greater than 1024 due to limitations with the stdio library.If programs require more file descriptors, they should use setrlimit directly.</p>
<p>-------------<br />
References:</p>
<ol>
<li><a href="http://www.brandonhutchinson.com/File_descriptors.html">File descriptors</a></li>
<li><a href="http://www.cyberciti.biz/faq/linux-increase-the-maximum-number-of-open-files/">Linux Increase The Maximum Number Of Open Files / File Descriptors (FD)</a></li>
<li><a href="http://www.cyberciti.biz/faq/howto-linux-get-list-of-open-files/">Linux / UNIX: List Open Files for Process</a></li>
<li><a href="http://www.princeton.edu/~unix/Solaris/troubleshoot/filedesc.html">Princeton University Enterprise Servers and Storage, File Descriptors</a></li>
<li><a href="http://compute.cnr.berkeley.edu/cgi-bin/man-cgi?plimit+1">plimit</a></li>
</ol>

            
          </p>
        </div>
      
        <div class="post py3">
          <p class="post-meta">Jan 13, 2012</p>
          <a href="/2012/01/13/onlive" class="post-link"><h3 class="h2 post-title">OnLive——在iPad上使用MS Word, Excel, PowerPoint</h3></a>
          <p class="post-summary">
            
              <p>昨晚睡前看到Walter Mossburg的最新文章<a href="http://allthingsd.com/20120111/working-in-word-excel-powerpoint-on-an-ipad/">Working in Word, Excel, PowerPoint on an iPad</a>：尽管iPad上已经有office软件，可以在上面编辑或创建文档，但这些软件对MS Office的兼容性并不好，而且还是收费的。<a href="http://desktop.onlive.com/">OnLive<br />
 Desktop</a>即将推出一个免费的应用，该应用可以利用云端的MS Word, Excel, PowerPoint创建并编辑文档，文档保存在云端，可以在iPad和PC上（今后会有Android版）编辑。免费版每人2G云端存储空间，付费版$10每月每人50G空间。&nbsp;除常用的Office软件，还支持常用的Windows小程序，如计算器，画图板，记事本等。</p>
<p>OnLive对于网络要求较高，低于1M的网络很可能无法连接到服务器。另外，文档输入时的虚拟键盘不是iPad的虚拟键盘而是Windows的键盘，编辑长文档时会很麻烦。</p>
<p style="text-align:center;"><img src="http://online.wsj.com/public/resources/images/PJ-BE740_PTECHJ_G_20120111170747.jpg" alt="" /></p>
<p>看过视频之后，我认为这个软件就是一个高级版的VNC应用，创新之处就在于云端的Windows服务器集群，能维护Windows环境以及自动为用户分配Windows服务器。一年多以前，在《<a href="http://blog.csdn.net/bonny95/article/details/5857256">Splashtop Remote——让你在iPad上也能用Windows下的应用</a>》一文中，我曾预言</p>
<p><span style="background-color:rgb(204,204,204);">&quot;<span style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;text-align:left;">试想如果将来有公司（比如这个DeviceVM）推出一项服务（可以免费，也可收费），为用户提供现成的Windows应用，而用户所需要做的就是在iPad或gPad上安装Splashtop Remote，打开这个应用就可以自动连接到DeviceVM的Windows<br />
 PC/Server，利用现成的Windows程序了——省去了自己购买并维护PC的很多麻烦，节省了购买大量Windows软件的开支，何乐而不为呢？而且这也正契合了时下的云计算潮流。</span>&quot;</span></p>
<p>果然英雄所见略同，已经有人开始提供这样的服务了。不过OnLive能否流行开来，还有待用户和市场的检验。使用体验是否可以被用户接受？如何解决网速（无论有线或无线）慢的情况？ 微软会不会推出iPad版的Office软件？即使该服务的终极目标不仅仅限于Windows或者Office软件，其他只能能在PC运行的程序会不会有替代解决方案在iPad或者Android平板上？以及现存的很多类VNC的软件……凡此种种，都构成了该服务的不确定因素。</p>
<p>无论如何，这都是一个很好的尝试。</p>

            
          </p>
        </div>
      
        <div class="post py3">
          <p class="post-meta">Jan 9, 2012</p>
          <a href="/2012/01/09/updating-fedora-to-fedora16-and-installing-ubuntu-11-04" class="post-link"><h3 class="h2 post-title">Updating Fedora to Fedora16 and Installing Ubuntu 11.04</h3></a>
          <p class="post-summary">
            
              <p>2.5years ago I installed Fedora11 on my Thinkpad R61,and then updated it to Fedora 12 and then Fedora 14. A bunch of software were installed, and as a result, the system went slower and slower... 固然有我个人懒惰不愿优化的原因，系统性能下降也与两年多来Fedora的复杂程度的增长有关。前天晚上禁不住诱惑升级到了Fedora 16，过程中没遇到问题，只是升级后发现：（1）Gnome 3的界面进不去，因为笔记本配置太低，没有独立显卡；（2）Classic Gnome with compiz也基本无法使用，尽管我已经装好了compiz；（3）KDE界面虽然花哨但速度较慢不甚喜欢；（4）无线网卡经常无法工作。<br />
基于以上缺陷，我终于忍无可忍，决定更换系统到Ubuntu或者FreeBSD了。本来我更倾向于FreeBSD的，但是由于下载速度缓慢，不得不暂时放弃。<br />
Ubuntu很快就下完。首先在Fedora下创建启动U盘，参照 How to create and use Live USB：<br />
Check the size of your USB stick<br />
Many USB sticks indicate the size on the packaging or the outside of the stick.</p>
<p>If you don't know the size of the stick, or want to check it for data, you should be able to auto-mount the USB stick by inserting it into a USB port. You can check the contents and size using the graphical file manager. In Linux, you can also use the command line:</p>
<p>$ df -h<br />
Filesystem Size Used Avail Use% Mounted on<br />
/dev/mapper/VolGroup00-LogVol00<br />
143G 14G 122G 10% /<br />
/dev/sda1 99M 12M 82M 13% /boot<br />
tmpfs 1009M 0 1009M 0% /dev/shm<br />
/dev/sdb1 3.9G 4.0K 3.9G 1% /media/usbdisk<br />
USB drives are usually mounted in /media. In this case, the device is /dev/sdb1, has a 3.9GB capacity and is almost empty.</p>
<p>Take note of "/dev/sdb1" or equivalent; you will be specifying the device name if you use the command line method.</p>
<p>How to Partition</p>
<p>CAUTION<br />
This will erase all data on the USB drive! Please read the instructions below carefully.<br />
If the drive has not been partitioned properly (or if you are unsure), use fdisk to repartition it.</p>
<p>It is also possible to do a non-destructive installation of a LiveUSB image, if you have sufficient empty space. See How to install non-destructively below.</p>
<p>The fdisk command must be run as root. Include only the drive name in the command, not the partition number. Be sure to select the correct disk, or you may erase important data! Check the output of "df -h" if you are unsure. For example, if your partition will be /dev/sdb1, do:</p>
<p>$ /sbin/fdisk /dev/sdb<br />
If you don't have fdisk installed, run</p>
<p>yum install util-linux-ng<br />
as root.<br />
The following session output from fdisk shows the responses to give to the prompts. The line starting Last cylinder ... refers to the size of the flash drive, so may be different than in the example.</p>
<p>Command (m for help): d<br />
Selected partition 1</p>
<p>Command (m for help): n<br />
Command action<br />
e extended<br />
p primary partition (1-4)<br />
p<br />
Partition number (1-4): 1<br />
First cylinder (1-960, default 1): ↵<br />
Using default value 1<br />
Last cylinder or +size or +sizeM or +sizeK (1-960, default 960): ↵<br />
Using default value 960</p>
<p>Command (m for help): t<br />
Selected partition 1<br />
Hex code (type L to list codes): 6<br />
Changed system type of partition 1 to 6 (FAT16)</p>
<p>Command (m for help): a<br />
Partition number (1-4): 1</p>
<p>Command (m for help): w<br />
The partition table has been altered!</p>
<p>Calling ioctl() to re-read partition table.</p>
<p>WARNING: If you have created or modified any DOS 6.x<br />
partitions, please see the fdisk manual page for additional<br />
information.<br />
Syncing disks.<br />
How to Format</p>
<p>CAUTION<br />
This will erase all data on the USB drive! Please read the instructions below carefully.<br />
If your USB media has sufficient free space on a vfat file system already, you do not need to perform this step.</p>
<p>To finish, the partition must be formatted with an actual file system using mkdosfs as the root user. Unmount the device before using mkdosfs. In the below example, /dev/USBPARTITIONNAME might be, for example, /dev/sdb1. Be sure to select the correct partition; formatting destroys all data on it!</p>
<p>$ umount /dev/USBPARTITIONNAME<br />
$ /sbin/mkdosfs -F 32 -n usbdisk /dev/USBPARTITIONNAME<br />
If you don't have mkdosfs installed, run "yum install dosfstools" as root.</p>
<p>通过命令<br />
su -c "yum install liveusb-creator"<br />
安装了Fedora的liveusb-creator，但是发现Fedora的这个程序无法制作Ubuntu的启动盘。无奈之下，试着把Ubuntu的iso文件复制到U盘里：<br />
sudo dd if=F12-Live-i686.iso of=/dev/sdX bs=8M</p>
<p>之后重启电脑，开机之后按c进入grub引导程序。尝试以往的通过kernel指定vmlinuz时失败，才发现Grub2中已经没有了kernel命令，尝试legacy_kernel和xnu_kernel，结果均遭失败。于是我尝试直接指定 initrd (hd1,4)/casper/initrd.gz，然后exit，没成想Ubuntu的安装界面竟然出现了！<br />
安装Ubuntu的过程中竟然就已经支持了WIFI，着实令我欣慰，看来Ubuntu这么多年在用户友好性上改进不少。<br />
安装完成后重启，结果Grub无法正常工作，进入grub rescue模式。用iPad百度之后，发现好文Ubuntu启动问题以及Grub Rescue修复方法，逐步去试，果然灵验。转载该文如下：<br />
Ubuntu启动问题以及Grub Rescue修复方法</p>
<p>问题：<br />
之前系统是Windows7 64bit（C盘） + D，E盘（都是NTFS） + Ubuntu。<br />
今天，在Windows7中删除了E盘，准备向其中安装RedHat 6。 重启Windows7之后发现Ubuntu的grub菜单不能启动。屏幕显示Invalid FileSystem。 （如果没有记错的话，呵呵）<br />
分析<br />
由于在Windows下面更改了分区状态，删掉了Ubuntu之前的一个分区，造成Ubuntu的分区由sda5变为sda4了，这样找不到grub了，开机显示<br />
grub rescue&gt;<br />
解决<br />
1. 先使用ls命令，找到Ubuntu的安装在哪个分区：<br />
grub rescue&gt;ls<br />
会罗列所有的磁盘分区信息，比方说：<br />
(hd0,1),(hd0,5),(hd0,3),(hd0,2)<br />
2. 然后依次调用如下命令： X表示各个分区号码<br />
grub rescue&gt;ls (hd0,X)/boot/grub<br />
如果都找不到的话，需要查一下是否因为Linux版本差异，造成grub的路径不对，例如直接ls(hd0,X)/grub等等。<br />
3. 假设找到（hd0,5）时，显示了文件夹中的文件，则表示Linux安装在这个分区。<br />
4. 调用如下命令：<br />
grub rescue&gt;set root=(hd0,5)<br />
grub rescue&gt;set prefix=(hd0,5)/boot/grub<br />
grub rescue&gt;insmod /boot/grub/normal.mod<br />
5. 然后调用如下命令，就可以显示出丢失的grub菜单了。<br />
grub rescue&gt;normal<br />
6. 不过不要高兴，如果这时重启，问题依旧存在，我们需要进入Linux中，对grub进行修复。<br />
进入Linux之后，在命令行执行：<br />
sudo update-grub<br />
sudo grub-install /dev/sda<br />
（sda是你的硬盘号码，千万不要指定分区号码，例如sda1，sda5等都不对）<br />
7. 重启测试是否已经恢复了grub的启动菜单？ 恭喜你恢复成功！</p>
<p>Grub恢复成功后，开始安装常用软件。Ubuntu新的界面不像以前想象中那么难用，而且他们终于部分放弃了以前屎黄色的界面风格，最难得的是在我那破本本上速度还是很快滴！期待Ubuntu12.04早日发布，到时直接升级之。</p>

            
          </p>
        </div>
      
    </div>

    <div class="pagination clearfix mb1 mt4">
  <div class="left">
    
      
        <a class="pagination-item" href="/page6/">Newer</a>
      
    
  </div>
  <div class="right">
    
      <a class="pagination-item" href="/page8/">Older</a>
    
  </div>
</div>

  
</div>

      </div>
    </div>
  </div>

  <footer class="center">
    <div class="measure">
        <small>
            <p>&copy; 2007-2016 by <a href="http://www.bo-yang.net/">Bo Yang</a>. &nbsp; <script type="text/javascript" src="//rc.revolvermaps.com/0/0/3.js?i=493pvkdo4nt&amp;b=0&amp;s=20&amp;m=2&amp;cl=ffffff&amp;co=010020&amp;cd=aa0000&amp;v0=60&amp;v1=60&amp;r=1" async="async"></script>
 </p>

            <p>Powered by <a href="https://github.com/jekyll/jekyll">Jekyll</a> and <a href="https://github.com/johnotander/pixyll">Pixyll</a>.</p>
        </small>
    </div>
</footer>

</body>
</html>
