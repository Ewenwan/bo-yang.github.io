<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>How To Use Local Facilities For Logging? &#8211; Bo's Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Bo&#39;s blog.">
    <meta name="author" content="Bo Yang">
    <meta name="keywords" content="Notes, Unix/Linux">
    <link rel="canonical" href="http://www.bo-yang.net//2015/08/20/linux-system-log-2">
    <link rel="alternate" type="application/rss+xml" title="RSS Feed for Bo's Blog" href="/feed.xml" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/pixyll.css?201602031831" type="text/css">

    <!-- Fonts -->
    <link href='//fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Lato:900,300' rel='stylesheet' type='text/css'>
    
      <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet">
    

    <!-- Google Prettify -->
    <link href="http://www.bo-yang.net//assets/google-code-prettify/desert.css" rel="stylesheet" type="text/css" media="all">

    <!-- MathJax -->
    
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
    

    <!-- Verifications -->
    

    <!-- Open Graph -->
    <!-- From: https://github.com/mmistakes/hpstr-jekyll-theme/blob/master/_includes/head.html -->
    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="article">
    <meta property="og:title" content="How To Use Local Facilities For Logging?">
    <meta property="og:description" content="Bo&#39;s blog.">
    <meta property="og:url" content="http://www.bo-yang.net//2015/08/20/linux-system-log-2">
    <meta property="og:site_name" content="Bo&#39;s Blog">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    
        <meta name="twitter:site" content="@bonnyang" />
    
    <meta name="twitter:title" content="How To Use Local Facilities For Logging?" />
    <meta name="twitter:description" content="Bo's blog." />
    <meta name="twitter:url" content="http://www.bo-yang.net//2015/08/20/linux-system-log-2" />

    <!-- Icons -->
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-160x160.png" sizes="160x160">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">

    
    <script type="text/javascript">
       (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
       (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
       m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
       })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
       ga('create', 'UA-50551633-1', 'auto');
       ga('send', 'pageview');
    </script>
    
</head>

<body class="site">

	
		<div id="fb-root"></div>
		<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.5&appId=";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));</script>
	

  <div class="site-wrap">
    <header class="site-header px2 px-responsive">
  <div class="mt2 wrap">
    <div class="measure">
        <a href="http://www.bo-yang.net/" class="site-title"><b>Bo's Blog</b></a>
      <nav class="site-nav">
        
    

    

    
        <a href="/archive/">Archive</a>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    


    

    

    

    

    

    

    

    
        <a href="/tags/">Tags</a>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    


    

    
        <a href="/about/">About Me</a>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    


    

    

    

    
        <a href="/contact/">Contact</a>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    


      </nav>
      <div class="clearfix"></div>
      
        <div class="social-icons">
  <div class="social-icons-right">
    
      <a class="fa fa-github" href="https://github.com/bo-yang"></a>
    
    
    
      <a class="fa fa-stack-overflow" href="https://stackoverflow.com/users/boyang"></a>
    
    <a class="fa fa-rss" href="/feed.xml"></a>
    
      <a class="fa fa-twitter" href="https://twitter.com/bonnyang"></a>
    
    
    
    
    
      <a class="fa fa-envelope" href="mailto:bonny95@gmail.com"></a>
    
    
      <a class="fa fa-linkedin" href="https://www.linkedin.com/in/boyanglink"></a>
    
    
    
  </div>
  <div class="right">
    
    
    
  </div>
</div>
<div class="clearfix"></div>

      
    </div>
  </div>
</header>


    <div class="post p2 p-responsive wrap" role="main">
      <div class="measure">
        


<div class="post-header mb2">
  <h1>How To Use Local Facilities For Logging?</h1>
  <span class="post-meta">Aug 20, 2015</span><br>
  
  <span class="post-meta small">
  
    3 minute read
  
  </span>
</div>

<article class="post-content">
  <p>This post introduces how to configure and use syslogd-compatible syslog tools. These tips should be supported by rsyslog, but rsyslog-specific commands are not covered.</p>

<p>As documented in the man page, the Linux system log is configured in file <code class="highlighter-rouge">/etc/syslog.conf</code> by default.You can specify other config file with <code class="highlighter-rouge">-f</code> option for syslogd. The format of syslog config file is</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;facility&gt;.&lt;priority&gt;   [logfile]
</code></pre>
</div>

<p>The supported facilities and priorites are defined in <code class="highlighter-rouge">syslog.h</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    <span class="cp">#define	LOG_EMERG	0	</span><span class="cm">/* system is unusable */</span><span class="cp">
</span>    <span class="cp">#define	LOG_ALERT	1	</span><span class="cm">/* action must be taken immediately */</span><span class="cp">
</span>    <span class="cp">#define	LOG_CRIT	2	</span><span class="cm">/* critical conditions */</span><span class="cp">
</span>    <span class="cp">#define	LOG_ERR		3	</span><span class="cm">/* error conditions */</span><span class="cp">
</span>    <span class="cp">#define	LOG_WARNING	4	</span><span class="cm">/* warning conditions */</span><span class="cp">
</span>    <span class="cp">#define	LOG_NOTICE	5	</span><span class="cm">/* normal but significant condition */</span><span class="cp">
</span>    <span class="cp">#define	LOG_INFO	6	</span><span class="cm">/* informational */</span><span class="cp">
</span>    <span class="cp">#define	LOG_DEBUG	7	</span><span class="cm">/* debug-level messages */</span><span class="cp">
</span>    
    <span class="cm">/* facility codes */</span>
    <span class="cp">#define	LOG_KERN	(0&lt;&lt;3)	</span><span class="cm">/* kernel messages */</span><span class="cp">
</span>    <span class="cp">#define	LOG_USER	(1&lt;&lt;3)	</span><span class="cm">/* random user-level messages */</span><span class="cp">
</span>    <span class="cp">#define	LOG_MAIL	(2&lt;&lt;3)	</span><span class="cm">/* mail system */</span><span class="cp">
</span>    <span class="cp">#define	LOG_DAEMON	(3&lt;&lt;3)	</span><span class="cm">/* system daemons */</span><span class="cp">
</span>    <span class="cp">#define	LOG_AUTH	(4&lt;&lt;3)	</span><span class="cm">/* security/authorization messages */</span><span class="cp">
</span>    <span class="cp">#define	LOG_SYSLOG	(5&lt;&lt;3)	</span><span class="cm">/* messages generated internally by syslogd */</span><span class="cp">
</span>    <span class="cp">#define	LOG_LPR		(6&lt;&lt;3)	</span><span class="cm">/* line printer subsystem */</span><span class="cp">
</span>    <span class="cp">#define	LOG_NEWS	(7&lt;&lt;3)	</span><span class="cm">/* network news subsystem */</span><span class="cp">
</span>    <span class="cp">#define	LOG_UUCP	(8&lt;&lt;3)	</span><span class="cm">/* UUCP subsystem */</span><span class="cp">
</span>    <span class="cp">#define	LOG_CRON	(9&lt;&lt;3)	</span><span class="cm">/* clock daemon */</span><span class="cp">
</span>    <span class="cp">#define	LOG_AUTHPRIV	(10&lt;&lt;3)	</span><span class="cm">/* security/authorization messages (private) */</span><span class="cp">
</span>    <span class="cp">#define	LOG_FTP		(11&lt;&lt;3)	</span><span class="cm">/* ftp daemon */</span><span class="cp">
</span>    
    <span class="cm">/* other codes through 15 reserved for system use */</span>
    <span class="cp">#define	LOG_LOCAL0	(16&lt;&lt;3)	</span><span class="cm">/* reserved for local use */</span><span class="cp">
</span>    <span class="cp">#define	LOG_LOCAL1	(17&lt;&lt;3)	</span><span class="cm">/* reserved for local use */</span><span class="cp">
</span>    <span class="cp">#define	LOG_LOCAL2	(18&lt;&lt;3)	</span><span class="cm">/* reserved for local use */</span><span class="cp">
</span>    <span class="cp">#define	LOG_LOCAL3	(19&lt;&lt;3)	</span><span class="cm">/* reserved for local use */</span><span class="cp">
</span>    <span class="cp">#define	LOG_LOCAL4	(20&lt;&lt;3)	</span><span class="cm">/* reserved for local use */</span><span class="cp">
</span>    <span class="cp">#define	LOG_LOCAL5	(21&lt;&lt;3)	</span><span class="cm">/* reserved for local use */</span><span class="cp">
</span>    <span class="cp">#define	LOG_LOCAL6	(22&lt;&lt;3)	</span><span class="cm">/* reserved for local use */</span><span class="cp">
</span>    <span class="cp">#define	LOG_LOCAL7	(23&lt;&lt;3)	</span><span class="cm">/* reserved for local use */</span><span class="cp">
</span></code></pre>
</div>

<p>The local facilities can be used for redirecting/filtering the log of your own programs. For example, given a program <code class="highlighter-rouge">foo</code>, if you want to log all the non-critical messages in <code class="highlighter-rouge">/var/log/foo.log</code>, and make the critical logs go to system log file <code class="highlighter-rouge">/var/log/messages</code>, you can use the following config file</p>

<div class="highlighter-rouge"><pre class="highlight"><code># use facility local1 for foo logs
local1.debug;local1.info;local1.notice;local1.warn   -/var/log/foo.log
local1.panic;local1.alert;local1.crit;local1.err   -/var/log/messages
*.*;local1.none   /var/log/messages 
</code></pre>
</div>

<p>The special priority <code class="highlighter-rouge">none</code> prevents those messages from being logged even though they would have been included in the <em>.</em>. In the above config, all facilities except for <code class="highlighter-rouge">local1</code> will be logged to <code class="highlighter-rouge">/var/log/messages</code>.</p>

<p>However, the dash(-) in front of the log filename is not documented in the man page, but it turns out to mean “Don’t sync after every write to the file”. Except that rsyslogd won’t sync anyway, unless you add a special directive in the Global Directives section. Note that you might lose information if the system crashes right behind a write attempt. Nevertheless this might give you back some performance, especially if you run programs that use logging in a very verbose manner. So for most people, a dash makes no difference one way or the other – it will be ignored.</p>

<p>And in program <code class="highlighter-rouge">foo</code>, what you need to do is open log file by specifing <code class="highlighter-rouge">LOG_LOCAL1</code> facility. The use of <code class="highlighter-rouge">openlog()</code> is mandatory here. Otherwise, it will automatically be called by syslog(), in which case facility will default to <code class="highlighter-rouge">LOG_USER</code>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    <span class="cp">#include &lt;syslog.h&gt;
</span>    <span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">openlog</span><span class="p">(</span><span class="s">"foo"</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">LOG_LOCAL1</span><span class="p">);</span>
        <span class="n">syslog</span><span class="p">(</span><span class="n">LOG_INFO</span><span class="p">,</span> <span class="s">"test info log"</span><span class="p">);</span> <span class="cm">/* go to /var/log/foo.log */</span>
        <span class="n">syslog</span><span class="p">(</span><span class="n">LOG_ERR</span><span class="p">,</span> <span class="s">"test error log"</span><span class="p">);</span> <span class="cm">/* go to /var/log/messages */</span>
        <span class="n">closelog</span><span class="p">();</span>
    <span class="p">}</span>
</code></pre>
</div>

<h3 id="references">References</h3>
<ul>
  <li><a href="http://linux.die.net/man/5/syslog.conf">http://linux.die.net/man/5/syslog.conf</a></li>
  <li><a href="http://linux.die.net/man/3/openlog">http://linux.die.net/man/3/openlog</a></li>
  <li><a href="http://shallowsky.com/blog/linux/rsyslog-conf-tutorial.html">A Brief Tutorial on rsyslog.conf</a></li>
</ul>

</article>


  <div class="share-page">
  <br>
  Share this post!

  <div class="share-links">
    
      <a class="fa fa-facebook" href="https://facebook.com/sharer.php?u=http://www.bo-yang.net//2015/08/20/linux-system-log-2" rel="nofollow" target="_blank" title="Share on Facebook"></a>
    

    
      <a class="fa fa-twitter" href="https://twitter.com/intent/tweet?text=How To Use Local Facilities For Logging?&url=http://www.bo-yang.net//2015/08/20/linux-system-log-2" rel="nofollow" target="_blank" title="Share on Twitter"></a>
    

    
      <a class="fa fa-google-plus" href="https://plus.google.com/share?url=http://www.bo-yang.net//2015/08/20/linux-system-log-2" rel="nofollow" target="_blank" title="Share on Google+"></a>
    

    
      <a class="fa fa-linkedin" href="http://www.linkedin.com/shareArticle?url=http://www.bo-yang.net//2015/08/20/linux-system-log-2&title=How To Use Local Facilities For Logging?" rel="nofollow" target="_blank" title="Share on LinkedIn"></a>
    

    

    
      <a class="fa fa-tumblr" href="http://www.tumblr.com/share/link?url=http://www.bo-yang.net//2015/08/20/linux-system-log-2&name=How To Use Local Facilities For Logging?" rel="nofollow" target="_blank" title="Share on Tumblr"></a>
    

    
      <a class="fa fa-reddit" href="http://reddit.com/submit?url=http://www.bo-yang.net//2015/08/20/linux-system-log-2&title=How To Use Local Facilities For Logging?" rel="nofollow" target="_blank" title="Share on Reddit"></a>
    

    

    
      <a class="fa fa-hacker-news" onclick="parent.postMessage('submit','*')" href="https://news.ycombinator.com/submitlink?u=http://www.bo-yang.net//2015/08/20/linux-system-log-2&t=How To Use Local Facilities For Logging?" rel="nofollow" target="_blank" title="Share on Hacker News"></a>
    
  </div>
</div>





<center><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Banner_728x90 -->
<ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-4220046549022535"
     data-ad-slot="5852972202"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</center>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-50551633-1', 'auto');
  ga('send', 'pageview');

</script>



  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_shortname  = 'boyang';
    var disqus_identifier = '/2015/08/20/linux-system-log-2';
    var disqus_title      = 'How To Use Local Facilities For Logging?';

    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>



  <div class="fb-comments" data-href="http://www.bo-yang.net//2015/08/20/linux-system-log-2" data-width="100%" data-numposts="10"></div>



  <h3 class="related-post-title">Related Posts</h3>
  
    <div class="post ml2">
      <a href="/2016/01/26/gen-hex-dump" class="post-link">
        <h4 class="post-title">Generate Wireshark-Understandable Hexdump</h4>
        <p class="post-summary"></p>
      </a>
    </div>
  
    <div class="post ml2">
      <a href="/2015/08/31/centos7-install-tftp-server" class="post-link">
        <h4 class="post-title">A Complete Guide For Installing TFTP Server In CentOS 7</h4>
        <p class="post-summary"></p>
      </a>
    </div>
  
    <div class="post ml2">
      <a href="/2015/05/27/retrieve-last-log" class="post-link">
        <h4 class="post-title">Retrieve Last Log After Crash</h4>
        <p class="post-summary"></p>
      </a>
    </div>
  
    <div class="post ml2">
      <a href="/2015/04/02/customize-linux-system-log-timestamp" class="post-link">
        <h4 class="post-title">Customizing OpenWRT System Log Timestamp</h4>
        <p class="post-summary"></p>
      </a>
    </div>
  
    <div class="post ml2">
      <a href="/2015/03/30/debug-kernel-space-memory-leak" class="post-link">
        <h4 class="post-title">Debug Kernel Space Memory Leak</h4>
        <p class="post-summary"></p>
      </a>
    </div>
  
    <div class="post ml2">
      <a href="/2015/01/12/linux-system-log" class="post-link">
        <h4 class="post-title">Linux System Log</h4>
        <p class="post-summary"></p>
      </a>
    </div>
  
    <div class="post ml2">
      <a href="/2015/01/07/click-notes-click-language" class="post-link">
        <h4 class="post-title">Click Notes II - Click Script Language</h4>
        <p class="post-summary"></p>
      </a>
    </div>
  
    <div class="post ml2">
      <a href="/2014/12/23/click-notes-overview" class="post-link">
        <h4 class="post-title">Click Notes I - Overview</h4>
        <p class="post-summary"></p>
      </a>
    </div>
  
    <div class="post ml2">
      <a href="/2014/12/19/remote-local-linux-develop-env-2" class="post-link">
        <h4 class="post-title">Building Remote+Local *nix Develop Environment(II)</h4>
        <p class="post-summary"></p>
      </a>
    </div>
  
    <div class="post ml2">
      <a href="/2014/11/20/pthread_exit-in-main" class="post-link">
        <h4 class="post-title">Be careful to pthread_exit() in main()</h4>
        <p class="post-summary"></p>
      </a>
    </div>
  


      </div>
    </div>
  </div>

  <footer class="center">
    <div class="measure">
        <small>
            <p>&copy; 2007-2016 by <a href="http://www.bo-yang.net/">Bo Yang</a>. &nbsp; <script type="text/javascript" src="//rc.revolvermaps.com/0/0/3.js?i=493pvkdo4nt&amp;b=0&amp;s=20&amp;m=2&amp;cl=ffffff&amp;co=010020&amp;cd=aa0000&amp;v0=60&amp;v1=60&amp;r=1" async="async"></script>
 </p>

            <p>Powered by <a href="https://github.com/jekyll/jekyll">Jekyll</a> and <a href="https://github.com/johnotander/pixyll">Pixyll</a>.</p>.
        </small>
    </div>
</footer>

</body>
</html>
